{
  "section_index": 227,
  "section_id": "3.3.2.4",
  "title": "3.3.2.4 I/O Queue Deletion",
  "level": 4,
  "pages": {
    "start": 120,
    "end": 121,
    "count": 2
  },
  "content": {
    "text": "NVMe over Fabrics deletes an individual I/O Queue and may delete the associated NVMe Transport\nconnection as a result of:\n•\nthe exchange of a Disconnect command and response (refer to section 6.4) between a host and\ncontroller; or\n•\nthe detection and processing of a transport error on an NVMe Transport connection.\nThe host indicates support for the deletion of an individual I/O Queue by setting the Individual I/O Queue\nDeletion Support (INDIVIOQDELS) bit to ‘1’ in the CATTR field in the Connect command (refer to Figure\n579) used to create the Admin Queue. The controller indicates support for the deletion of an individual I/O\nQueue by setting the Disconnect Command Support (DCS) bit to ‘1’ in the OFCS field of the Identify\nController data structure (refer to Figure 328).\nIf both the host and the controller support deletion of an individual I/O Queue, then the termination of an\nindividual I/O Queue impacts only that I/O Queue (i.e., the association and all other I/O Queues and their\nassociated NVMe Transport connections are not impacted). If either the host or the controller does not\nsupport deletion of an individual I/O Queue, then the deletion of an individual I/O Queue or the termination\nof an NVMe Transport connection causes the association to be terminated.\nNVMe over Fabrics uses the Disconnect command to delete an Individual I/O Queue. This command is\nsent on the I/O Submission Queue to be deleted and affects only that I/O Submission Queue and its\nassociated I/O Completion Queue (i.e., other I/O Queues are not affected). To delete an I/O Queue, the\nNVMe Transport connection for that I/O Queue is used. If all Queues associated with an NVMe Transport\nconnection are deleted, then the NVMe Transport connection may be deleted after completion of the\nDisconnect command. Actions necessary to delete the NVMe Transport connection are transport specific.\nThe association between the host and the controller is not affected.\nIf a Disconnect command returns a status code other than success, the host may delete an I/O Queue\nusing other methods including:\n•\nwaiting a vendor specific amount of time and retry the Disconnect command;\n•\ndeleting the NVMe Transport connection (note: this may impact other I/O Queues);\n•\nperforming a Controller Level Reset (note: this impacts other I/O Queues); or\n•\nending the host to controller association.\nIf the transport requires a separate NVMe Transport connection for each Admin and I/O Queue (refer to\nsection 3.3.2.2), then the host should not delete an NVMe Transport connection until after:\n•\na Disconnect command has been submitted to the I/O Submission Queue; and\n•\nthe response for that Disconnect command has been received by the host on the corresponding\nI/O Completion Queue or a vendor specific timeout (refer to section 3.9) has occurred while waiting\nfor that response.\nIf the transport requires a separate NVMe Transport connection for each Admin and I/O Queue, then the\ncontroller should not delete an NVMe Transport connection until after:\n•\na Disconnect command has been received on the I/O Submission Queue and processed by the\ncontroller;\n•\nthe responses for commands received by the controller on that I/O Submission Queue prior to\nreceiving the Disconnect command have been sent to the host on the corresponding I/O\nCompletion Queue; and\n•\nthe resulting response for that Disconnect command has been sent to the host on the\ncorresponding I/O Completion queue (i.e., this response is the last response sent). It is\nrecommended that the controller delay destroying the NVMe Transport connection to allow time for\nthe Disconnect command response to be received by the host (e.g., a transport specific event\noccurs or a transport specific time period elapses).\nIf the transport utilizes the same NVMe Transport connection for all Admin and I/O Queues associated with\na particular controller (refer to section 3.3.2.2), then the deletion of an individual I/O Queue has no impact\non the NVMe Transport connection.\nA Disconnect command is the last I/O Submission Queue entry processed by the controller for an I/O\nQueue. Controller processing of the Disconnect command completes or aborts all commands on the I/O\nQueue on which the Disconnect command was received. The controller determines whether to complete\nor abort each of those commands. Until the controller sends a successful completion for a Disconnect\ncommand, outstanding commands may continue being processed by the controller. The controller ensures\nthat there is no further processing of any command sent on that I/O Queue after posting the completion\nqueue entry for the Disconnect command as described in section 6.4.\nThe response to the Disconnect command is the last I/O Completion Queue entry processed by the host\nfor an I/O Queue. To avoid command aborts, the host should wait for all outstanding commands on an I/O\nQueue to complete before sending the Disconnect command.\nIf the controller terminates an NVMe Transport connection or detects an NVMe Transport connection loss,\nthen the controller shall stop processing all commands received on I/O Queues associated with that NVMe\nTransport connection within the time reported in the CQT field (refer to Figure 328), if non-zero.\nIf the host terminates an NVMe Transport connection or detects an NVMe Transport connection loss before\nthe responses are received for all outstanding commands submitted to the associated I/O Queue (refer to\nsection 3.4.5), then it is strongly recommended that the host take the steps described in section 9.6 to avoid\npossible data corruption caused by interaction between outstanding commands and subsequent\ncommands submitted by that host to another controller.",
    "tables": [],
    "figures": []
  },
  "statistics": {
    "table_count": 0,
    "figure_count": 0
  }
}