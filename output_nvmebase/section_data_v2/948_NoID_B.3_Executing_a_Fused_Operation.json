{
  "section_index": 948,
  "section_id": "",
  "title": "B.3 Executing a Fused Operation",
  "level": 2,
  "pages": {
    "start": 776,
    "end": 778,
    "count": 3
  },
  "content": {
    "text": "This example describes how the host creates and executes a fused command, specifically Compare and\nWrite for a total of 16 KiB of data. In this case, there are two commands that are created. The first command\nis the Compare, referred to as CMD0. The second command is the Write, referred to as CMD1. In this case,\nend-to-end data protection is not enabled and the size of each logical block is 4 KiB.\nTo build commands for a fused operation, the host utilizes two available adjacent command locations in the\nappropriate I/O Submission Queue as is described in section 3.4.2.\nThe attributes of the Compare command are:\n•\nCMD0.CDW0.OPC is set to 05h for Compare;\n•\nCMD0.CDW0.FUSE is set to 01b indicating that this is the first command of a fused operation;\n•\nCMD0.CDW0.CID is set to a free command identifier;\n•\nCMD0.NSID is set to identify the appropriate namespace;\n•\nIf metadata is being used in a separate buffer, then the location of that buffer is specified in the\nCMD0.MPTR field;\n•\nThe physical address of the first page of the data to compare:\no\nIf PRPs are used, CMD0.PRP1 is set to the physical address of the first page of the data\nto compare and CMD0 PRP2 is set to the physical address of the PRP List The PRP List\np\np y\nis shown in Figure 816 for a PRP List with three entries; or\no\nIf the command uses SGLs, CMD0.SGL1 is set to an appropriate SGL segment descriptor\ndepending on whether more than one descriptor is needed;\n•\nCMD0.CDW10.SLBA is set to the first LBA to compare against. Note that this field also spans\nCommand Dword 11;\n•\nCMD0.CDW12.LR is cleared to ‘0’ to indicate that the controller should apply all available error\nrecovery means to retrieve the data for comparison;\n•\nCMD0.CDW12.FUA is cleared to ‘0’, indicating that the data may be read from any location,\nincluding a volatile cache, in the NVM subsystem;\n•\nCMD0.CDW12.PRINFO is cleared to 0h since end-to-end protection is not enabled;\n•\nCMD0.CDW12.NLB is set to 3h, indicating that four logical blocks of a size of 4 KiB each are to be\ncompared against;\n•\nCMD0.CDW14 is cleared to 0h since end-to-end protection is not enabled; and\n•\nCMD0.CDW15 is cleared to 0h since end-to-end protection is not enabled.\nThe attributes of the Write command are:\n•\nCMD1.CDW0.OPC is set to 01h for Write;\n•\nCMD1.CDW0.FUSE is set to 10b indicating that this is the second command of a fused operation;\n•\nCMD1.CDW0.CID is set to a free command identifier;\n•\nCMD1.NSID is set to identify the appropriate namespace. This value shall be the same as\nCMD0.NSID;\n•\nIf metadata is being used in a separate buffer, then the location of that buffer is specified in the\nCMD1.MPTR field;\n•\nThe physical address of the first page of data to write is identified:\no\nIf the command uses PRPs, then CMD1.PRP1 is set to the physical address of the first\npage of the data to write and CMD1.PRP2 is set to the physical address of the PRP List.\nThe PRP List includes three entries; or\no\nIf the command uses SGLs, CMD1.SGL1 is set to an appropriate SGL segment descriptor\ndepending on whether more than one descriptor is needed;\n•\nCMD1.CDW10.SLBA is set to the first LBA to write. Note that this field also spans Command Dword\n11. This value shall be the same as CMD0.CDW10.SLBA;\n•\nCMD1.CDW12.LR is cleared to ‘0’ to indicate that the controller should apply all available error\nrecovery means to write the data to the NVM;\n•\nCMD1.CDW12.FUA is cleared to ‘0’, indicating that the data may be written to any location,\nincluding a volatile cache, in the NVM subsystem;\n•\nCMD1.CDW12.PRINFO is cleared to 0h since end-to-end protection is not enabled;\n•\nCMD1.CDW12.NLB is set to 3h, indicating that four logical blocks of a size of 4 KiB each are to be\ncompared against. This value shall be the same as CMD0.CDW12.NLB;\n•\nCMD1.CDW14 is cleared to 0h since end-to-end protection is not enabled; and\n•\nCMD1.CDW15 is cleared to 0h since end-to-end protection is not enabled.\nThe host then completes a transport specific action in order to submit the command for processing. Note\nthat the transport specific submit action shall indicate both commands have been submitted at one time.",
    "tables": [],
    "figures": []
  },
  "statistics": {
    "table_count": 0,
    "figure_count": 0
  }
}