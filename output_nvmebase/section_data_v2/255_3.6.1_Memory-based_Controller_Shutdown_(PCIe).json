{
  "section_index": 255,
  "section_id": "3.6.1",
  "title": "3.6.1 Memory-based Controller Shutdown (PCIe)",
  "level": 3,
  "pages": {
    "start": 137,
    "end": 138,
    "count": 2
  },
  "content": {
    "text": "It is recommended that the host perform an orderly shutdown of the controller by following the procedure\nin this section when a power-off or shutdown condition is imminent.\nThe host should perform the following actions in sequence for a normal controller shutdown:\n1. If the controller is enabled (i.e., CC.EN (refer to Figure 41) is set to ‘1’):\na. Stop submitting any new I/O commands to the controller and allow any outstanding\ncommands to complete;\nb. If the controller implements I/O queues, then the host should delete all I/O Submission\nQueues, using the Delete I/O Submission Queue command (refer to section 5.3.4). A result\nof the successful completion of the Delete I/O Submission Queue command is that any\nremaining commands outstanding are aborted;\nc. If the controller implements I/O queues, then the host should delete all I/O Completion\nQueues, using the Delete I/O Completion Queue command (refer to section 5.3.3);\nand\n2. The host should set the Shutdown Notification (CC.SHN) field (refer to Figure 41) to 01b to indicate\na normal controller shutdown operation. The controller indicates when shutdown processing is\ncompleted by updating the Shutdown Status (CSTS.SHST) field to 10b and the Shutdown Type\n(CSTS.ST) field (refer to Figure 42) is cleared to ‘0’.\nThe host should perform the following actions in sequence for an abrupt shutdown:\n1. If the controller is enabled (i.e., CC.EN is set to ‘1’), then stop submitting any new I/O commands\nto the controller; and\n2. The host should set the Shutdown Notification (CC.SHN) field (refer to Figure 41) to 10b to indicate\nan abrupt shutdown operation. The controller indicates when shutdown processing is completed\nby updating the Shutdown Status (CSTS.SHST) field (refer to Figure 42) to 10b and CSTS.ST\n(refer to Figure 42) is cleared to ‘0’.\nFor entry to the D3 power state (refer to the PCI Express Base Specification), the shutdown steps outlined\nfor a normal controller shutdown should be followed.\nIt is recommended that the host wait a minimum of the RTD3 Entry Latency reported in the Identify\nController data structure (refer to Figure 328) for the shutdown operations to complete; if the value reported\nin RTD3 Entry Latency is 0h, then the host should wait for a minimum of one second. While shutdown\nprocessing is in progress on a controller, it is not recommended to disable that controller via the CC.EN bit\n(i.e., via a Controller Reset), which may impact the time required to complete shutdown processing. While\nshutdown processing is in progress on a controller, that controller may abort any command with a status\ncode of Commands Aborted due to Power Loss Notification.\nThe controller is ready to be powered off (e.g., the media is in the shutdown state (refer to Figure 85)) when\nthe CSTS.ST bit is cleared to ‘0’, and the CSTS.SHST field indicates that controller shutdown processing\nis complete (i.e., the CSTS.SHST field is set to 10b), regardless of the value of the CC.EN bit. The controller\nremains ready to be powered off (e.g., the media remains in the shutdown state) until:\nA. the controller is enabled (i.e., the CC.EN bit transitions from ‘0’ to ‘1’);\nB. the controller is reset by a Controller Level Reset; or\nC. an Admin command that requires access to the media (refer to Figure 84) and specifies the Ignore\nShutdown bit set to ‘1’ is processed by the controller via the out-of-band mechanism (refer to the\nNVM Express Management Interface Specification).\nIf a Controller Level Reset occurs while controller shutdown processing is reported as complete (i.e., the\nCSTS.ST bit is cleared to ‘0’ and the CSTS.SHST field is set to 10b), then the controller may remain ready\nto be powered off (e.g., the media remains in the shutdown state) or the controller may cease being ready\nto be powered off (e.g., because the controller is preparing the media for use (refer to section 3.7.2)).\nIf the power scope for the controller includes multiple controllers (e.g., the CAP.CPS field is set to 10b or is\nset to 11b), and any controller included in that power scope is not ready to be powered off, then the portion\nof the NVM subsystem included in that power scope is not ready to be powered off.\nTo start executing commands on the controller after that controller reports controller shutdown processing\ncomplete (i.e., the CSTS.ST bit is cleared to ‘0’ and the CSTS.SHST field is set to 10b) utilizing the CC.EN\nbit:\n•\nif the CC.EN bit is set to ‘1’, then a Controller Level Reset is required to clear the CC.EN bit to ‘0’\non that controller and the CC.EN bit is subsequently required to be set to ‘1’ as part of the\ninitialization sequence (refer to section 3.5); and\n•\nif the CC.EN bit is cleared to ‘0’, then:\na Controller Level Reset is required and the CC.EN bit is subsequently required to be set\nto ‘1’ as part of the initialization sequence (refer to section 3.5); or\nthe CC.EN bit is required to be set to ‘1’ and the CC.SHN field is required to be cleared to\n00b with the same write to the CC property (refer to Figure 41). The controller clears the\nCSTS.SHST field to 00b in response to that write.\nThe initialization sequence (refer to section 3.5) should then be executed on that controller.\nIt is an implementation choice whether the host aborts all outstanding commands to the Admin Queue prior\nto the controller shutdown. The only commands that should be outstanding to the Admin Queue when the\ncontroller reports shutdown processing complete are Asynchronous Event Request commands.\nIf the host is no longer able to communicate with the controller before that host receives either:\n•\ncompletions for all outstanding commands submitted to that controller (refer to section 3.4.5); or\n•\na CSTS.SHST field value that indicates that the controller shutdown is complete,\nthen it is strongly recommended that the host take the steps described in section 9.6 to avoid possible data\ncorruption caused by interaction between outstanding commands and subsequent commands submitted\nby that host to another controller.",
    "tables": [],
    "figures": []
  },
  "statistics": {
    "table_count": 0,
    "figure_count": 0
  }
}