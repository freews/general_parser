{
  "section_index": 773,
  "section_id": "8.1.24.7",
  "title": "8.1.24.7 Preempting a Reservation or Registration",
  "level": 4,
  "pages": {
    "start": 650,
    "end": 652,
    "count": 3
  },
  "content": {
    "text": "A host that is a registrant may preempt a reservation and/or registration by executing a Reservation Acquire\ncommand (refer to section 7.5), specifying:\n•\nthe Reservation Acquire Action (RACQA) field set to 001b (i.e., Preempt) or set to 010b (i.e.,\nPreempt and Abort); and\n•\nthe current reservation key associated with the host in the Current Reservation Key (CRKEY) field.\nThe CRKEY value shall match that used by the registrant to register with the namespace. If the CRKEY\nvalue does not match, then the command is aborted with a status code of Reservation Conflict. The preempt\nactions that occur are dependent on the type of reservation held on the namespace, if any, and the value\nof the Preempt Reservation Key (PRKEY) field in the command. If the host is not a registrant, then the\ncommand is aborted with a status code of Reservation Conflict. The remainder of this section assumes that\nthe host is a registrant.\nIf the existing reservation type is not Write Exclusive - All Registrants and not Exclusive Access - All\nRegistrants, then the actions performed by the command depend on the value of the PRKEY field as\nfollows:\na) If the PRKEY field value matches the reservation key of the current reservation holder, then the\nfollowing occur as an atomic operation:\n•\nall registrants with a matching reservation key other than the host that issued the command\nare unregistered;\n•\nthe reservation is released; and\n•\na new reservation is created of the type specified by the Reservation Type (RTYPE) field in the\ncommand for the host that issued the command as the reservation key holder;\nor\nIf the PRKEY field value does not match that of the current reservation holder and is not equal to\nb) If the PRKEY field value does not match that of the current reservation holder and is not equal to\n0h, then registrants whose reservation key matches the value of the PRKEY field are unregistered.\nIf the PRKEY field value does not match that of the current reservation holder and is equal to 0h,\nthen the command is aborted with a status code of Invalid Field in Command.\nIf the existing reservation type is Write Exclusive - All Registrants or Exclusive Access - All Registrants,\nthen the actions performed by the command depend on the value of the PRKEY field as follows:\na) If the PRKEY field value is 0h, then the following occurs as an atomic operation:\n•\nall registrants other than the host that issued the command are unregistered;\n•\nthe reservation is released; and\n•\na new reservation is created of the type specified by the Reservation Type (RTYPE) field in the\ncommand for the host that issued the command as the reservation key holder;\nor\nIf the PRKEY value is non-zero, then registrants whose reservation key matches the value of the\nPRKEY field are unregistered If the PRKEY value is non zero and there are no registrants whose\nPRKEY field are unregistered. If the PRKEY value is non zero and there are no registrants whose\nreservation key matches the value of the PRKEY field, the controller shall abort the command with\na status code of Reservation Conflict.\nIf there is no reservation held on the namespace, then execution of the command causes registrants whose\nreservation key match the value of the PRKEY field to be unregistered.\nIf the existing reservation type is not Write Exclusive - All Registrants and not Exclusive Access - All\nRegistrants, then a reservation holder may preempt itself using the above mechanism. When a host\npreempts itself, the following occurs as an atomic operation:\n•\nregistration of the host is maintained;\n•\nthe reservation is released; and\n•\na new reservation is created for the host of the type specified by the RTYPE field.\nA host may abort commands as a side effect of preempting a reservation by executing a Reservation\nAcquire command (refer to section 7.5) and setting the RACQA field to 010b (Preempt and Abort). The\nbehavior of such a command is exactly the same as that described above with the RACQA field set to 001b\n(Preempt), with two exceptions:\n•\nAfter the atomic operation changes namespace reservation and registration state, all controllers\nassociated with any host whose reservation or registration is preempted by that atomic operation\nare requested to abort all commands being processed that were addressed to the specified\nnamespace in the NSID field in the Reservation Acquire command (refer to section 3.4.4 for the\ndefinition of “being processed”); and\n•\nCompletion of the Reservation Acquire command shall not occur until all commands that are\nrequested to be aborted are completed, regardless of whether or not each command is actually\naborted.\nAs with the Abort command (refer to section 5.1.2), aborting a command as a side effect of preempting a\nreservation is best effort; as a command that is requested to be aborted may currently be at a point in\nexecution where that command is no longer able to be aborted or may have already completed, when a\nReservation Acquire or Abort Admin command is submitted. Although prompt execution of abort requests\nreduces delay in completing the Reservation Acquire command, a command which is requested to be\naborted shall either be aborted or otherwise completed before the completion of the Reservation Acquire\ncommand.\nWhen a registrant is unregistered as a result of actions described in this section, then a registration\npreempted notification occurs on all controllers associated with a host that was unregistered other than the\nhost that issued the Reservation Acquire command.\nWhen the type of reservation held on a namespace changes as a result of actions described in this section,\nthen a reservation released notification occurs on all controllers associated with hosts that remain\nregistrants of the namespace except the host that issued the Reservation Acquire command.",
    "tables": [],
    "figures": []
  },
  "statistics": {
    "table_count": 0,
    "figure_count": 0
  }
}