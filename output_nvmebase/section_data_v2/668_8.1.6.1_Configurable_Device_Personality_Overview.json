{
  "section_index": 668,
  "section_id": "8.1.6.1",
  "title": "8.1.6.1 Configurable Device Personality Overview",
  "level": 4,
  "pages": {
    "start": 559,
    "end": 561,
    "count": 3
  },
  "content": {
    "text": "The Configurable Device Personality (CDP) is an optional capability allowing a host to change the NVM\nsubsystem configuration. If the CDP capability is supported, then all controllers in the NVM subsystem shall\nsupport:\n•\nthe Configurable Device Personality feature;\n•\nthe Device Personalities log page;\n•\nthe Persistent Event log page;\n•\nthe Device Personality Change Event (refer to section 5.2.12.1.14.2.15); and\n•\nat least one personality, other than the Manufacturing Default Personality (refer to section\n5.2.12.1.28).\nA change to the settings of the personality specified in a Set Features command for this Feature consists\nof the settings of that personality taking effect in the NVM subsystem as described in this section.\nPersonality settings are any of the following:\n•\nfeature values for the personality specified by the Set Features command with the Configurable\nDevice Personality feature (e.g., settings in the Security Personality that allow a host to enable or\ndisable security protocols);\n•\nfeature values for personalities other than the personality specified by the Set Features command\n(e.g., the Manufacturing Default Personality causes the feature current value of all other\npersonalities in the NVM subsystem to change to the feature default value);\n•\nsettings that are host visible via means other than feature values (e.g., a field in the Identify\nController data structure); or\n•\ninternal NVM subsystem settings that are not host visible using methods defined by this\nspecification.\nA host submits a Set Features command specifying the CDP feature (refer to section 5.2.26.1.24) for a\ngiven personality to request any of the following:\n•\na change to the settings of the specified personality (i.e., the command specifies the Change\nPersonality Settings bit (CHPS) set to ‘1’, and the command may specify additional data in the\ncommand data buffer); and\n•\na personality to be frozen (i.e., the command specifies the Freeze State bit set to ‘1’).\nIf a Set Features command specifying the CDP feature requests the specified personality to be frozen, then\nthe controller shall freeze that personality before the successful completion of the Set Features command\n(i.e., the personality is frozen and therefore prevents a host from making further changes to that\npersonality).\nIf no reset is required for the settings of the specified personality to be changed, as indicated by the\nMinimum Required Reset Type (MRSTT) field in Figure 285, then that change shall take effect before the\nsuccessful completion of the Set Features command.\nIf a reset is required for the settings of the specified personality to be changed, then that change of the\nsettings of the specified personality is pending and shall be changed as the result of the required reset\nbeing performed by the controller processing the Set Features command.\nIf the settings of the specified personality that are requested to be changed are not changed (i.e., any\nsettings of that personality fail to take effect), then the controller shall:\na) log the failure in the Persistent Event log page (refer to section 5.2.12.1.14.2.15); and\nb) clear the Pending Personality Settings Change (PPSC) bit (refer to Figure 449).\nIf the settings of a personality fail to be changed, then the controller shall continue operating with the\npersonality settings prior to the requested change and if the personality was frozen as part of the change,\nthat personality shall be unfrozen by the controller. If the controller is not able to continue operating with\nthe prior personality settings (e.g., because changes were made to the personality’s settings and are unable\nto be reverted to the prior settings), then:\n•\nthe results of the personality failing to be changed are indeterminate and the NVM subsystem\nbehavior is undefined; and\n•\nthe controller shall set the Indeterminate Personality State (IPS) bit to ‘1’ in the SMART / Health\nInformation log page (refer to Figure 209).\nIf a change to the settings of any personality, other than the Manufacturing Default Personality, takes effect,\nthen the controller shall clear the PMDSS bit to ‘0’ (refer to Figure 285) for that personality and for the\nManufacturing Default Personality.\nChanging the settings of a personality may have an effect on user data as indicated by the Personality\nSettings Change User Data Effect (PSCUDE) bit (refer to Figure 285).\nIf a firmware image is determined to be incompatible with the current personality settings, then the host\nshould submit a Set Features command that specifies the Manufacturing Default Personality prior to\nattempting to commit that firmware image. While processing a Firmware Commit command, if the controller\ndetects that the specified firmware image is incompatible with current personality settings as part of the\nfirmware update process (refer to section 3.11), then the controller shall abort the Firmware Commit\ncommand with a status code of Manufacturing Default Personality Required.\nThe NVM subsystem may be left in an indeterminate state if:\n•\nthe currently active firmware image is not able to be successfully loaded, and the controller reverts\nto a different firmware image that is incompatible with current personality settings; or\n•\nthe settings of a personality fail to be changed, and the controller is not able to revert to the previous\npersonality settings.\nIf a firmware activation with reset is pending (refer to section 3.11), then the controller shall abort a Set\nFeatures command specifying the CDP feature that changes a personality with a status code of Feature\nNot Changeable.\nIf a change to the settings of a personality is pending in the NVM subsystem and any of the following\ncommands are processed, then the controller shall abort the command with a status code of Access\nDenied:\n•\nSanitize (refer to section 5.1.22);\n•\nSanitize Namespace (refer to section 5.2.23);\n•\nFirmware Commit (refer to section 5.1.8); and\n•\nFirmware Image Download (refer to section 5.1.9).\nIf a change to the settings of a personality is pending in the NVM subsystem and a host submits a Set\nFeatures command requesting to change:\n•\nsettings of a different personality than the personality whose settings change is pending; or\n•\nany of the settings of the same personality as the pending personality, but with a different value,\nthen the controller processing the Set Features command shall abort the Set Features command with a\nstatus code of Feature Not Changeable.\nIf a Get Features command completes successfully for the CDP feature with a PERID field value other than\nFFh in Command Dword 13 (refer to Figure 448), then the attributes described in Figure 449 shall be\nreturned corresponding to that specified personality.\nIf a Get Features command is successfully processed for the CDP feature with a PERID field value of FFh\nin Command Dword 13 and:\n•\nthere is a pending change to the settings of a personality in the NVM subsystem, then the attributes\ndescribed in Figure 449 shall be returned corresponding to that pending change; or\n•\nthere is no pending change to the settings of a personality in the NVM subsystem, then the value\nof the PERID field in completion queue entry Dword 0 shall be set to FFh and all other fields in\ncompletion queue entry Dword 0 shall be cleared to 0h.\nIt is not an error to attempt to change:\n•\nthe settings of a personality to the same settings as the pending change of that personality; or\n•\nthe settings of a frozen or unfrozen personality to the same settings as that personality’s current\nsettings.\nIf a Set Features command is processed for the CDP feature that attempts to change the settings of a\npersonality that is currently frozen to a different value, then the controller shall abort the command with a\nstatus code of Feature Not Changeable.\nIf a Set Features command is successfully processed that specifies to freeze all personalities (i.e., the\nPersonality Identifier (PERID) field is set to the All Personalities value of FFh (refer to Figure 447) and the\nPersonality Freeze State (PERFS) bit set to ‘1’ (refer to Figure 448)), then the controller shall freeze all\npersonalities and none of the settings of any personalities are changed.",
    "tables": [],
    "figures": []
  },
  "statistics": {
    "table_count": 0,
    "figure_count": 0
  }
}