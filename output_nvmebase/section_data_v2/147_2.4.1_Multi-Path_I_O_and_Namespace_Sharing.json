{
  "section_index": 147,
  "section_id": "2.4.1",
  "title": "2.4.1 Multi-Path I/O and Namespace Sharing",
  "level": 3,
  "pages": {
    "start": 57,
    "end": 60,
    "count": 4
  },
  "content": {
    "text": "This section provides an overview of multi-path I/O and namespace sharing. Multi-path I/O refers to two or\nmore completely independent paths between a single host and a namespace while namespace sharing\nrefers to the ability for two or more hosts to access a common shared namespace using different NVM\nExpress controllers. Both multi-path I/O and namespace sharing require that the NVM subsystem contain\ntwo or more controllers. NVM subsystems that support Multi-Path I/O and Namespace Sharing may also\nsupport asymmetric controller behavior (refer to section 2.4.2). Concurrent access to a shared namespace\nby two or more hosts requires some form of coordination between hosts. The procedure used to coordinate\nthese hosts is outside the scope of this specification.\nFigure 19 shows an NVM subsystem that contains a single NVM Express controller implemented over PCI\nExpress and a single PCI Express port. Since this is a single Function PCI Express device, the NVM\nExpress controller shall be associated with PCI Function 0. A controller may support multiple namespaces.\nThe controller in Figure 19 supports two namespaces labeled NS A and NS B. Associated with each\ncontroller namespace is a namespace ID, labeled as NSID 1 and NSID 2, that is used by the controller to\nreference a specific namespace. The namespace ID is distinct from the namespace itself and is the handle\na host and controller use to specify a particular namespace in a command. The selection of a controllerâ€™s\nnamespace IDs is outside the scope of this specification. In this example, NSID 1 is associated with\nnamespace A and NSID 2 is associated with namespace B. Both namespaces are private to the controller\nand this configuration supports neither multi-path I/O nor namespace sharing.\nFigure 20 shows a multi-Function NVM subsystem with a single PCI Express port containing two controllers\nimplementing NVMe over PCIe. One controller is associated with PCI Function 0 and the other controller is\nassociated with PCI Function 1. Each controller supports a single private namespace and access to shared\nnamespace B. The namespace ID shall be the same in all controllers that have access to a particular shared\nnamespace. In this example, both controllers use NSID 2 to access shared namespace B.\nThere is one or more Identify Controller data structures for each controller and one or more Identify\nNamespace data structures (refer to section 1.5.50) for each namespace (refer to Figure 326). Controllers\nwith access to a shared namespace return the Identify Namespace data structure associated with that\nshared namespace (i.e., the same data structure contents are returned by all controllers with access to the\nsame shared namespace). There is a globally unique identifier (refer to section 4.7.1) associated with the\nnamespace itself and may be used to determine when there are multiple paths to the same shared\nnamespace.\nControllers associated with a shared namespace may operate on the namespace concurrently. Operations\nperformed by individual controllers are atomic to the shared namespace at the write atomicity level of the\ncontroller to which the command was submitted (refer to section 3.4.3). The write atomicity level is not\nrequired to be the same across controllers that share a namespace. If there are any ordering requirements\nbetween commands issued to different controllers that access a shared namespace, then a host (e.g., host\nsoftware or an associated application) is required to enforce these ordering requirements.\nFigure 21 illustrates an NVM subsystem with two PCI Express ports, each with an associated controller\nimplementing NVMe over PCIe. Both controllers map to PCI Function 0 of the corresponding port. Each\nPCI Express port in this example is completely independent and has its own PCI Express Fundamental\nReset and reference clock input. A reset of a port only affects the controller associated with that port and\nhas no impact on the other controller, shared namespace, or operations performed by the other controller\non the shared namespace. Refer to section 4.4 for Feature behavior on reset. The functional behavior of\nthis example is otherwise the same as that illustrated in Figure 20.\nThe two ports shown in Figure 21 may be associated with the same Root Complex or with different Root\nComplexes and may be used to implement both multi-path I/O and I/O sharing architectures. System-level\narchitectural aspects and use of multiple ports in a PCI Express fabric are beyond the scope of this\nspecification.\nFigure 22 illustrates an NVM subsystem that supports Single Root I/O Virtualization (SR-IOV) and has one\nPhysical Function and four Virtual Functions. An NVM Express controller implementing NVMe over PCIe is\nassociated with each Function with each controller having a private namespace and access to a namespace\nshared by all controllers, labeled NS F. The behavior of the controllers in this example parallels that of the\nother examples in this section. Refer to section 8.2.6.4 for more information on SR-IOV.\nExamples provided in this section are meant to illustrate concepts and are not intended to enumerate all\npossible configurations. For example, an NVM subsystem may contain multiple PCI Express ports with\neach port supporting SR-IOV.",
    "tables": [],
    "figures": [
      {
        "id": "figure_58_117",
        "page": 58,
        "bbox": [
          408.0,
          117.0,
          587.0,
          303.0
        ],
        "title": "Figure 20 shows a multi-Function NVM subsystem with a single PCI Express port containing two controllers\nimplementing NVMe over PCIe. One controller is associated with PCI Function 0 and the other controller is\nassociated with PCI Function 1. Each controller supports a single private namespace and access to shared\nnamespace B. The namespace ID shall be the same in all controllers that have access to a particular shared\nnamespace. In this example, both controllers use NSID 2 to access shared namespace B.",
        "image_path": "Figure_2_4_1_Multi_Path_I_O_and_Namespace_Sharing_1.png"
      },
      {
        "id": "figure_58_432",
        "page": 58,
        "bbox": [
          323.0,
          432.0,
          672.0,
          702.0
        ],
        "title": "Figure 21: NVM Subsystem with Two Controllers and Two Ports",
        "image_path": "Figure_2_4_1_Multi_Path_I_O_and_Namespace_Sharing_2.png"
      },
      {
        "id": "figure_59_268",
        "page": 59,
        "bbox": [
          324.0,
          268.0,
          674.0,
          531.0
        ],
        "title": "Figure 22 illustrates an NVM subsystem that supports Single Root I/O Virtualization (SR-IOV) and has one\nPhysical Function and four Virtual Functions. An NVM Express controller implementing NVMe over PCIe is\nassociated with each Function with each controller having a private namespace and access to a namespace\nshared by all controllers, labeled NS F. The behavior of the controllers in this example parallels that of the\nother examples in this section. Refer to section 8.2.6.4 for more information on SR-IOV.",
        "image_path": "Figure_2_4_1_Multi_Path_I_O_and_Namespace_Sharing_3.png"
      },
      {
        "id": "figure_60_115",
        "page": 60,
        "bbox": [
          119.0,
          115.0,
          876.0,
          380.0
        ],
        "title": "Figure 22: PCI Express Device Supporting Single Root I/O Virtualization (SR-IOV)",
        "image_path": "Figure_2_4_1_Multi_Path_I_O_and_Namespace_Sharing_4.png"
      }
    ]
  },
  "statistics": {
    "table_count": 0,
    "figure_count": 4
  }
}