{
  "section_index": 720,
  "section_id": "8.1.11.1",
  "title": "8.1.11.1 Flexible Data Placement Overview",
  "level": 4,
  "pages": {
    "start": 593,
    "end": 596,
    "count": 4
  },
  "content": {
    "text": "The Flexible Data Placement (FDP) capability is an optional capability which allows the host to reduce write\namplification by aligning user data usage to physical media. The controller supports log pages which\nindicate the status of FDP, statistics about the FDP operation, and information the host uses to detect and\ncorrect usage patterns that increase write amplification.\nThe scope of the Flexible Data Placement capability is an Endurance Group.\nThe host enables or disables Flexible Data Placement by issuing a Set Features command specifying the\nFlexible Data Placement feature (refer to section 5.2.26.1.20) and the FDP configuration (refer to section\n5.2.12.1.29) to be applied to an Endurance Group. The host is required to delete all namespaces associated\nwith the specified Endurance Group before modifying the value of the Flexible Data Placement feature\n(e.g., transitioning from disabled to enabled).\nIf a Set Features command specifies:\n•\nthe Flexible Data Placement feature;\n•\nan Endurance Group in which one or more namespaces exist; and\n•\na different value from the current value of that feature for that Endurance Group,\nthen the controller shall abort the command with a status code of Command Sequence Error.\nIf a Set Features command is successful and changes the Feature value, then:\n•\nall events in the FDP Events log page (refer to section 5.2.12.1.32) are cleared; and\n•\nall fields in the FDP Statistics log page (refer to section 5.2.12.1.31) are cleared to 0h.\nRefer to section 3.2.4 for the logical view of the non-volatile storage capacity for the Endurance Group with\nFlexible Data Placement enabled.\nThe Namespace Management command (refer to section 8.1.16) is used to create a namespace within the\nEndurance Group. All namespaces in an Endurance Group with Flexible Data Placement enabled shall be\nassociated with the NVM Command Set (refer to Figure 327) (i.e., the Command Set Identifier (CSI) field\nin the Namespace Management command shall be cleared to 00h). The capacity for the user data stored\nby a write command to a namespace is allocated from the Reclaim Unit referenced by the Reclaim Unit\nHandle and Reclaim Group specified by that write command. The user data for a namespace is allowed to\nbe in any stored Reclaim Unit within any Reclaim Group within the Endurance Group (refer to Figure 15).\nThe Namespace Management command specifies a Placement Handle List (refer to the Namespace\nManagement command in the applicable NVM Express I/O Command Set specification). Each entry in that\nlist specifies the Reclaim Unit Handle associated with the Placement Handle for that entry. The Placement\nHandles are numbered from 0h to the number of entries in the list minus 1. Figure 664 shows an example\nwhere Namespace A associates Reclaim Unit Handle 1 with Placement Handle 0. A specific Reclaim Unit\nHandle is not allowed to be associated with more than one Placement Handle per namespace. There are\nno other requirements on which Reclaim Unit Handle is associated with which Placement Handle.\nNamespaces are allowed to utilize the same (i.e., share) Reclaim Unit Handle but may have restrictions\ndefined in the applicable NVM Express I/O Command Set specification.\nThe host is required to enable the Data Placement Directive (refer to section 8.1.9.4) to submit write\ncommands that specify a Placement Identifier (refer to Figure 289 and Figure 290) in the DSPEC field. That\nPlacement Identifier uniquely specifies the Reclaim Unit in which to place the user data (refer to Figure\n664). The controller determines the Reclaim Unit by using the Reclaim Unit Handle associated with the\nPlacement Handle that was specified by the host when the namespace was created. For example, if the\nwrite command in Figure 664 specifies a Reclaim Group Identifier value of 2h and a Placement Handle\nvalue of 1h, then the host is targeting the user data for that write command to be placed into the Reclaim\nUnit associated with Reclaim Group 2h and Reclaim Unit Handle NRUH-1.\nA Placement Identifier is invalid if:\n•\nthe Reclaim Group Identifier value is greater than or equal to the number of Reclaim Groups\nsupported by the enabled FDP configuration (refer to the NRG field in Figure 287); or\n•\nthe Placement Handle is greater than or equal to the number of Placement Handles supported by\nthe Namespace Management command of the applicable NVM Express I/O Command Set\nspecification.\nIf the Placement Identifier in the DSPEC field of a write command is invalid, then the controller shall:\n•\nselect the Reclaim Group and Reclaim Unit Handle accessible by the specified namespace to\ndetermine the placement of the user data for that write command; and\n•\ngenerate an Invalid Placement Identifier FDP Event if that event is enabled for the selected Reclaim\nUnit Handle. To receive the FDP event, the host should enable the Invalid Placement Identifier FDP\nEvent on all Reclaim Unit Handles.\nAny write command to a namespace that exists in an Endurance Group with Flexible Data Placement\nenabled that does not specify the Data Placement Directive uses the Placement Handle value 0h and the\ncontroller selects the Reclaim Group for that command. For example, if the write command does not specify\nthe Data Placement Directive, then, as illustrated in Figure 664, Placement Handle value of 0h is associated\nwith Reclaim Unit Handle 1h and the controller may place the user data into the Reclaim Unit associated\nany Reclaim Group using Reclaim Unit Handle 1h.\nA write command that places user data into a Reclaim Unit causes reduction of the remaining capacity of\nthat Reclaim Unit. If that Reclaim Unit is written to capacity, then the controller modifies the Reclaim Unit\nHandle referencing that Reclaim Unit to reference a different Reclaim Unit within the same Reclaim Group.\nA controller may modify a Reclaim Unit Handle to reference a different Reclaim Unit as part of performing\na sanitize operation (refer to section 8.1.26).\nA Reclaim Unit shall only be referenced by one Reclaim Unit Handle. Therefore, a write command that\nutilizes a Reclaim Unit Handle results in the user data from that write command being initially isolated from\nthe user data from any other write command that utilizes a different Reclaim Unit Handle. Each Reclaim\nUnit Handle has a type as defined in Figure 288 that identifies the isolation requirements of the user data\nmoved by the controller to a different Reclaim Unit due to vendor specific controller operations (e.g.,\ngarbage collection).\nA controller is allowed to move user data that was written by the host that utilized a Reclaim Unit Handle\nwith an Initially Isolated type (Figure 288) to a different Reclaim Unit within the same Reclaim Group. In\naddition, the controller is allowed to move user data written by the host that utilized different Reclaim Unit\nHandles with an Initially Isolated type to that different Reclaim Unit within the same Reclaim Group as\nshown in Figure 665.\nA controller is allowed to move user data that was written by the host that utilized a Reclaim Unit Handle\nwith a Persistently Isolated type (Figure 288) to a different Reclaim Unit within the same Reclaim Group.\nHowever, the controller shall only move user data written by the host that utilized the same Reclaim Unit\nHandles with a Persistently Isolated type to the different Reclaim Unit within the same Reclaim Group as\nshown in Figure 666.\nThe result of a Namespace Management command that creates a namespace within the Endurance Group\nis that at least one Placement Handle is defined for that namespace (refer to the Namespace Management\nsection in applicable NVM Express I/O Command Set specification).\nFor any namespace created in an Endurance Group that has Flexible Data Placement enabled, the host\nmay issue an I/O Management Receive command to obtain a list of Placement Handles and the associated\nReclaim Unit Handles that are used by the Data Placement Directive in write commands.\nIf the Flexible Data Placement capability is supported, then the controller shall support the following:\na) the Feature Identifiers Supported and Effects log page (refer to section 5.2.12.1.18);\nb) the I/O Management Receive command (refer to section 7.3) and the Reclaim Unit Handle Status\nManagement Operation in that command (refer to Figure 595);\nc) the I/O Management Send command (refer to section 7.4) and the Placement Identifier Update\nManagement Operation in that command (refer to Figure 599);\nd) the Flexible Data Placement feature (refer to section 5.2.26.1.20);\ne) the FDP Configurations log page (refer to section 5.2.12.1.29);\nf)\nthe Reclaim Unit Handle Usage log page (refer to section 5.2.12.1.30);\ng) the FDP Statistics log page (refer to section 5.2.12.1.31);\nh) the Flexible Data Placement Events feature (refer to section 5.2.26.1.21);\ni)\nthe FDP Events log page (refer to section 5.2.12.1.32); and\nj)\nthe Data Placement Directive (refer to section 8.1.9.4).",
    "tables": [],
    "figures": [
      {
        "id": "figure_595_113",
        "page": 595,
        "bbox": [
          115.0,
          113.0,
          881.0,
          556.0
        ],
        "title": "Figure 665: Initially Isolated Reclaim Unit Handles",
        "image_path": "Figure_8_1_11_1_Flexible_Data_Placement_Overview_1.png"
      },
      {
        "id": "figure_596_115",
        "page": 596,
        "bbox": [
          117.0,
          115.0,
          881.0,
          300.0
        ],
        "title": "Figure 666: Persistently Isolated Reclaim Unit Handle",
        "image_path": "Figure_8_1_11_1_Flexible_Data_Placement_Overview_2.png"
      },
      {
        "id": "figure_596_340",
        "page": 596,
        "bbox": [
          117.0,
          340.0,
          881.0,
          518.0
        ],
        "title": "Figure 664: Flexible Data Placement Model",
        "image_path": "Figure_8_1_11_1_Flexible_Data_Placement_Overview_3.png"
      }
    ]
  },
  "statistics": {
    "table_count": 0,
    "figure_count": 3
  }
}