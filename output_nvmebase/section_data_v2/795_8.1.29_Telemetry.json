{
  "section_index": 795,
  "section_id": "8.1.29",
  "title": "8.1.29 Telemetry",
  "level": 3,
  "pages": {
    "start": 675,
    "end": 677,
    "count": 3
  },
  "content": {
    "text": "Telemetry enables manufacturers to collect internal data logs to improve the functionality and reliability of\nproducts. The telemetry data collection may be initiated by the host or by the controller. The data is returned\nin the Telemetry Host-Initiated log page or the Telemetry Controller-Initiated log page (refer to section\n5.2.12.1.8 and 5.2.12.1.9). The data captured is vendor specific. The telemetry feature defines the\nmechanism to collect the vendor specific data. The controller indicates support for the telemetry log pages\nand for the Data Area 4 size in the Log Page Attributes (LPA) field in the Identify Controller data structure\n(refer to Figure 328).\nAn important aspect to discovering issues by collecting telemetry data is the ability to qualify distinct issues\nthat are being collected. The ability to create a one to one mapping of issues to data collections is essential.\nIf a one to one mapping is not established, there is the risk that several payload collections appear distinct\nbut are actually all caused by the same issue. Conversely, a single payload collection may have payloads\ncaused by several issues mixed together creating additional complexity in determining the root cause. As\na result, flexibility in size is provided in the collection of telemetry payloads and a three phase process is\ntypically used.\nThe first phase establishes that an issue exists and is best accomplished by collecting a minimum set of\ndata to identify the issue as being distinct from other issues. Once the number of instances of an issue\nestablish an investigation, another phase may be necessary to collect actionable information. In the second\nphase, a targeted collection of more in depth medium size payloads are gathered and analyzed to identify\nthe source of the problem.\nIf the small or medium sized telemetry data collection provides insufficient information, a third phase may\nbe employed to collect additional details. If the Data Area 4 Support (DA4S) bit is cleared to ‘0’ in the Log\nPage Attributes field, then the third phase provides the largest and most complete payload to diagnose the\nissue. If the DA4S bit is set to ‘1’ and the Extended Telemetry Data Area 4 Supported (ETDAS) field is set\nto 1h in the Host Behavior Support feature (refer to section 5.2.26.1.14) then a fourth phase may be\nemployed to collect the largest and most complete payload to diagnose the issue. If Data Area 4 is created,\nthen Data Area 3 of non-zero length shall also be created and populated as part of data collection.\nThere are two telemetry data logs (i.e., Telemetry Host-Initiated log page and Telemetry Controller-Initiated\nlog page) defined. Each telemetry data log is made up of a single set of Telemetry Data Blocks. Each\nTelemetry Data Block is 512 bytes in size. Telemetry data is returned (refer to section 5.2.12.1.8 and section\n5.2.12.1.9) in units of Telemetry Data Blocks. Each telemetry data log is segmented into:\na) Three Telemetry Data Areas (i.e., small, medium, and large), if the DA4S bit is cleared to ‘0’; or\nb) Four Telemetry Data Areas (i.e., small, medium, large and extra-large) If the DA4S bit is set to ‘1’\nand the Extended Telemetry Data Area 4 Supported (ETDAS) field is set to 1h in the Host Behavior\nSupport feature (refer to section 5.2.26.1.14).\nAll telemetry data areas start at Telemetry Data Block 1.\nEach Telemetry Data Area shall represent the controller’s internal state at the time the telemetry data was\ncaptured.\nEach Telemetry Data Area is intended to capture a richer set of data to aid in resolution of issues. Telemetry\nData Area 1 is intended to have a small size payload (i.e., the first phase), Telemetry Data Area 2 is intended\nto have a medium size payload (i.e., the second phase), and Telemetry Data Area 3 is intended to have a\nlarge size payload (i.e., the third phase). Telemetry Data Area 4 is intended to have an extra-large size\npayload (i.e., the fourth phase). The size of each Telemetry Data Area is vendor specific and may change\non each data collection. When possible, the host should retrieve the payload for all supported Telemetry\nData Areas to enable the best diagnosis of the issue(s).\nThe preparation, collection, and submission of telemetry data is similar for host-initiated and controller-\ninitiated data; the primary difference is the trigger for the collection. The operational model for telemetry is:\n1. The host identifies controller support for Telemetry log pages in the Identify Controller data\nstructure;\n2. The host may indicate the support for the Telemetry Host-Initiated Data Area 4 and Telemetry\nController-Initiated Data Area 4 by setting the Extended Telemetry Data Area 4 Supported (ETDAS)\nfield to 1h in the Host Behavior Support feature (refer to section 5.2.26.1.14);\n3. The host prepares an area to store telemetry data if needed;\n4. To receive notification that controller-initiated telemetry data is available, the host enables\nTelemetry Log Notices using the Asynchronous Event Configuration feature (refer to section\n5.2.26.1.5); and\n5. If the host decides to collect host-initiated telemetry data or the controller signals that controller-\ninitiated telemetry data is available:\na. The host reads the appropriate blocks of the Telemetry Data Area from the Telemetry Host-\nInitiated log page (refer to section 5.2.12.1.8) or the Telemetry Controller-Initiated log page\n(refer to section 5.2.12.1.9). If possible, the host should collect Telemetry Data Area 1, 2, 3,\nand 4. The host reads the log in 512 byte Telemetry Data Block units (i.e., a starting offset that\nis a multiple of 512, and a length that is a multiple of 512). The host should set the Retain\nAsynchronous Event bit to ‘1’;\nb. The host re-reads the header of the log page and ensures that the Telemetry Host-Initiated\nData Generation Number field from the Telemetry Host-Initiated log page or the Telemetry\nController-Initiated Data Generation Number field in the Telemetry Controller-Initiated log page\nmatches the original value read. If these values do not match, then the data captured is not\nconsistent and should be re-read from the log page with the Retain Asynchronous Event bit set\nto ‘1’;\nc. If the host is reading the controller-initiated log, then the host ensures that the Telemetry\nController-Initiated Data Available field is still set to 1h after reading the appropriate blocks of\nthe Telemetry Data Area because the Telemetry Controller-Initiated Data Available field may\nhave been cleared to 0h by another entity while the log page was being read;\nd. If the host is reading the Telemetry Controller-Initiated log page, then the host reads any portion\nof that log page with the Retain Asynchronous Event bit cleared to ‘0’ to indicate to the controller\nthat the host has completed reading the Telemetry Controller-Initiated log page; and\ne. When all telemetry data has been saved, the data should be forwarded to the manufacturer of\nthe controller.\nThe trigger for the collection for host-initiated data is typically a system crash, but may also be initiated\nduring normal operation. The host proceeds with a host-initiated data collection by submitting the Get Log\nPage command for the Telemetry Host-Initiated log page with the Create Telemetry Host-Initiated Data bit\nset to ‘1’ in the Log Specific Parameter field. The controller should complete the command quickly (e.g., in\nless than one second) to avoid a user rebooting the system prior to completion of the data collection.\nThe NVM subsystem is allowed to provide a Telemetry Host-Initiated log page per controller or a shared\nTelemetry Host-Initiated log page across all controllers in the NVM subsystem. If a shared Telemetry Host-\nInitiated log page is implemented, the Telemetry Host-Initiated Data Generation Number field in the\nTelemetry Host-Initiated log page is used to allow the host to detect that the Telemetry Host-Initiated log\npage has been changed by:\n•\na host through a different controller; or\n•\na Management Controller through a Management Endpoint (refer to the NVM Express\nManagement Interface Specification).\nThe controller notifies the host to collect controller-initiated data through the completion of an Asynchronous\nEvent Request command with an Asynchronous Event Type of Notice that indicates a Telemetry Log\nChanged event. The host may also determine controller-initiated data is available via the Telemetry\nController-Initiated Data Available field in the Telemetry Host-Initiated or the Telemetry Controller-Initiated\nlog pages. The host proceeds with a controller-initiated data collection by submitting the Get Log Page\ncommand for the Telemetry Controller-Initiated log page. Once the host has started reading the Telemetry\nController-Initiated log page, the controller should avoid modifying the controller-initiated data until the host\nhas finished reading all controller-initiated data. The amount of time for the host to read the controller-\ninitiated data is vendor specific.\nSince there is only one set of controller-initiated data, the controller is responsible for prioritizing the version\nof the controller-initiated data that is available for the host to collect. When the controller replaces the\ncontroller-initiated data with new controller-initiated data, the controller shall increment the Telemetry\nController-Initiated Data Generation Number field. The host needs to ensure that the Telemetry Controller-\nInitiated Data Generation Number field has not changed between the start and completion of the controller-\ninitiated data collection to ensure the data captured is consistent.",
    "tables": [],
    "figures": []
  },
  "statistics": {
    "table_count": 0,
    "figure_count": 0
  }
}