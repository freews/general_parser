{
  "section_index": 889,
  "section_id": "8.3.3",
  "title": "8.3.3 Cross-Controller Reset Recovery",
  "level": 3,
  "pages": {
    "start": 729,
    "end": 731,
    "count": 3
  },
  "content": {
    "text": "Cross-Controller Reset Recovery is a capability that enables a host to recover from a loss of communication\nwith one controller, the Impacted Controller, via use of another controller, the Source Controller, in the same\nNVM subsystem. The host submits a Cross-Controller Reset command to the Source Controller, which\ncauses the NVM subsystem to initiate a Cross-Controller Reset operation to perform a Controller Level\nReset (CLR) on the Impacted Controller. The host determines the result of the Cross-Controller Reset\noperation either:\n•\nfrom the Immediate Reset Successful (IRS) bit reported by the CQE of that Cross-Controller Reset\ncommand; or\n•\nby reading the completed entry associated with that operation in the Cross-Controller Reset log\npage from the Source Controller,\nenabling the host to determine whether and when a specific instance of the Impacted Controller is no longer\nprocessing outstanding commands (refer to section 3.4.5) so that the host may proceed with retrying\ncommands as described in section 9.6.3.\nAn instance of an Impacted Controller exists from the time that Impacted Controller is enabled until the time\nthat Impacted Controller is no longer able to process non-Fabrics commands. An instance of an Impacted\nController is identified by the controller ID, the value of the Controller Instance Uniquifier (CIU) field in the\nIdentify Controller data structure (refer to Figure 328), and the value of the Controller Instance Random\nNumber field in the Identify Controller data structure. Determining that the instance changed (e.g., through\na change in the CIU or a completed CLR) is a method for the host to determine that an instance of the\nImpacted Controller is no longer processing commands.\nIf a controller supports causing the NVM subsystem to initiate a Cross-Controller Reset operation, then that\ncontroller shall support:\n•\nthe Cross-Controller Reset command (refer to section 5.4.3);\n•\nthe Cross-Controller Reset log page (refer to section 5.2.12.3.1); and\n•\nthe Cross-Controller Reset Completed asynchronous event (refer to Figure 154).\nIf a controller supports causing the NVM subsystem to initiate a Cross-Controller Reset operation, then that\ncontroller should support the Lost Host Communication log page (refer to section 5.2.12.3.2) and the Lost\nHost Communication asynchronous event (refer to Figure 154).\nIf a controller supports being reset by the Cross-Controller Reset operation, then that controller shall support\nthese fields in the Identify Controller data structure (refer to Figure 328):\n•\nthe Controller Instance Uniquifier (CIU) field;\n•\nthe Controller Instance Random Number (CIRN) field; and\n•\nthe Command Quiesce Time (CQT) field.\nSupport for the Cross-Controller Reset operation should be the same across all controllers in an NVM\nsubsystem (i.e., all controllers support causing the NVM subsystem to initiate that operation and being reset\nby that operation, or all controllers do not support causing the NVM subsystem to initiate that operation and\nbeing reset by that operation).\nThe limit on the number of simultaneous in-progress Cross-Controller Reset operations the Source\nController is able to cause the NVM subsystem to initiate is indicated in the Cross-Controller Reset Limit\nfield of the Identify Controller data structure (refer to Figure 328). A host should not submit Cross-Controller\nReset commands such that the number of outstanding Cross-Controller Reset operations the Source\nController causes the NVM subsystem to initiate would exceed this limit. If a Source Controller is processing\na Cross-Controller Reset command and detects that causing the NVM subsystem to initiate a Cross-\nController Reset operation would exceed this limit, then that Source Controller shall abort that command\nwith a status code of Cross-Controller Reset Limit Exceeded.\nAs described in section 5.4.3, to complete a Cross-Controller Reset command successfully, the Source\nController causes the NVM subsystem to initiate a Cross-Controller Reset operation. If that operation\ncompletes successfully before the CQE of the Cross-Controller Reset command is posted, the IRS bit in\nthe CQE is set to ‘1’ (refer to Figure 527). If that operation does not complete successfully before the CQE\nof the Cross-Controller Reset command that caused the NVM subsystem to initiate that operation is posted,\nan entry is added to the Cross-Controller Reset log page for that operation, and, upon completion of that\noperation, the results (including, the Validated (V) bit and the Controller Level Reset Initiated (CLRI) bit)\nare recorded in that entry (refer to Figure 305). If Cross-Controller Reset Completed Notices are enabled,\nthen the Source Controller shall report a Cross-Controller Reset Completed Notice asynchronous event\n(refer to Figure 154) upon recording the result of that operation in the associated entry in the Cross-\nController Reset log page.\nIf that Cross-Controller Reset operation is successful, then the host is able to proceed with recovery (refer\nto section 9.6.3) for outstanding commands sent to the instance of the Impacted Controller specified in the\nCIU field, CIRNL field and CIRNU field in the Cross-Controller Reset command. If that Cross-Controller\nReset operation is not successful and host retry of the Cross-Controller Reset command on another\ncontroller is likely to result in a successful Cross-Controller Reset operation, then the Source Controller is\nable to provide the controller ID for such a controller in the Alternate Controller ID (ACID) field (refer to\nFigure 305). If a specific alternate controller ID is provided (i.e., value of the ACID field is not set to FFFFh),\nthen that alternate controller shall be associated with the host that submitted the Cross-Controller Reset\ncommand. If a specific alternate controller ID is not provided, the host should use the Retry bit in the\nassociated entry in the Cross-Controller Reset log page to decide whether to:\n•\nretry Cross-Controller Reset Recovery using an alternate controller that the host chooses, using\nthe guidelines in section 5.4.3; or\n•\nend Cross-Controller Reset Recovery and rely on Time-Based Recovery (refer to section 9.6.2.1).\nA Cross-Controller Reset operation is expected to take less time than using KATO and CQT for Time-Based\nRecovery as described in section 9.6.2.1, independent of whether the Cross-Controller Reset operation is\nsuccessful or not.\nAn NVM Subsystem Reset terminates all in-progress Cross-Controller Reset operations and removes all\nentries in the Cross-Controller Reset log page for each controller in the domain being reset (refer to section\n5.2.12.3.1). A Controller Level Reset (CLR) removes all entries for completed operations in the Cross-\nController Reset log page for the controller processing the CLR. An NVM Subsystem Shutdown pauses\nprocessing of all in-progress Cross-Controller Reset operations.",
    "tables": [],
    "figures": []
  },
  "statistics": {
    "table_count": 0,
    "figure_count": 0
  }
}