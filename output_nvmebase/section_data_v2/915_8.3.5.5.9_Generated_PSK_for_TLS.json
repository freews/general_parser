{
  "section_index": 915,
  "section_id": "8.3.5.5.9",
  "title": "8.3.5.5.9 Generated PSK for TLS",
  "level": 5,
  "pages": {
    "start": 756,
    "end": 756,
    "count": 1
  },
  "content": {
    "text": "When used with a non-NULL DH exchange, the DH-HMAC-CHAP protocol is able to generate a session\nkey KS used to generate a pre-shared key (PSK) to establish a secure channel session with the TLS protocol\nbetween host and controller for NVMe/TCP. A TLS session is concatenated to an authentication transaction\nwhen the SC_C indication is set to NEWTLSPSK in the AUTH_Negotiate message (refer to section 8.3.5.1).\nA TLS session shall not be concatenated to an authentication transaction if the involved host and controller\nare administratively configured with a PSK for use with each other. In this case, host and controller shall\nonly establish a TLS session based on the retained PSK derived from that configured PSK.\nThe session key KS shall be computed from the ephemeral DH key (i.e., gxy mod p) generated during the\nDH-HMAC-CHAP transaction by applying the hash function H( ) selected by the HashID parameter in the\nDH-HMAC-CHAP_Challenge message (i.e., KS = H(gxy mod p)). The size of the session key KS is\ndetermined by the selected hash function, as shown in Figure 798. Specifically:\n•\nThe host computes KS as the hash of the ephemeral DH key resulting from the combination of the\nrandom value y selected by the host with the DH exponential (i.e., gx mod p) received from the\ncontroller (i.e., KS = H((gx mod p)y mod p) = H(gxy mod p)).\n•\nThe controller computes KS as the hash of the ephemeral DH key resulting from the combination\nof the random value x selected by the controller with the DH exponential (i.e., gy mod p) received\nfrom the host (i.e., KS = H((gy mod p)x mod p) = H(gxy mod p)).\nThe generated PSK for TLS shall be computed applying the HMAC function using the hash function H( )\nselected by the HashID parameter in the DH-HMAC-CHAP_Challenge message with the session key KS\nas key to the concatenation of the two challenges C1 and C2 (i.e., generated PSK = HMAC(KS, C1 || C2)).\nThis generated PSK should be replaced periodically (e.g., every hour) or on demand by performing a\nreauthentication on the Admin queue of the association with the appropriate SC_C value (refer to section\n8.3.5.1).\nThe host may request secure channel concatenation with the TLS protocol by setting the SC_C field in the\nAUTH_Negotiate message to NEWTLSPSK while performing only unidirectional authentication. In this case\nthe host shall still send a challenge value C2 to the controller and clear the sequence number S2 to 0h to\nindicate that controller authentication is not requested.",
    "tables": [],
    "figures": []
  },
  "statistics": {
    "table_count": 0,
    "figure_count": 0
  }
}