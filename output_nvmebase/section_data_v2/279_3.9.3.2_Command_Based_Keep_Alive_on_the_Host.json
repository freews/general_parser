{
  "section_index": 279,
  "section_id": "3.9.3.2",
  "title": "3.9.3.2 Command Based Keep Alive on the Host",
  "level": 4,
  "pages": {
    "start": 152,
    "end": 153,
    "count": 2
  },
  "content": {
    "text": "The host may use Command Based Keep Alive regardless of the Keep Alive mode used by the controller.\nTo prevent the controller from detecting a Keep Alive Timeout during the use of Command Based Keep\nAlive on the host, the host should send Keep Alive commands at KATT/2 to account for delays (e.g.,\ntransport round-trip times, transport delays, command processing times, and the Keep Alive Timer\ngranularity) while the Keep Alive Timer is active on the controller. If the host receives a successful\ncompletion to a Set Features command for the Keep Alive feature, then the host should adjust the time at\nwhich the host sends the next Keep Alive command because the controller restarts the Keep Alive Timer.\nIf a host detects a Keep Alive Timeout and has outstanding commands for which that host has not received\ncompletions (refer to section 3.4.5), then it is strongly recommended that the host take the steps described\nin section 9.6 to avoid possible data corruption caused by interaction between outstanding commands and\nsubsequent commands submitted by that host to another controller.\nFor an example host implementation of Command Based Keep Alive, the host maintains a Keep Alive Send\nTimer for each controller to which the host is connected. The host uses the Keep Alive Send Timer to track\nwhen the host sends a Keep Alive command to the corresponding controller. The host does not know when\nthe controller fetches the Keep Alive command. Conservatively, the host assumes the controller fetches\nthe Keep Alive command immediately upon the host sending the Keep Alive command. The host tracks\nthis time as the last expired timestamp of the Keep Alive Send Timer, for use when starting or restarting\nthe Keep Alive Send Timer. While the host does restart the Keep Alive Send Timer after a successful Set\nFeatures command for the KATO feature, the host does not change the last expired timestamp when\nsending that Set Features command because at that point in time the host does not know the results of that\ncommand.\nThis example host implementation of Command Based Keep Alive behaves as follows:\n•\nThe host enables the Keep Alive Send Timer if the host requests activation of the Keep Alive Timer\non the controller (e.g., the host enables the controller (refer to section 3.9.2)). The host records the\ncurrent time as the last expired timestamp when the Keep Alive Send Timer becomes enabled.\n•\nThe host disables the Keep Alive Send Timer if the host requests deactivation of the Keep Alive\nTimer on the controller and the host receives a successful response from the controller (e.g., the\nhost disables the controller (refer to section 3.9.2)).\n•\nThe host starts a Keep Alive Send Timer if:\nthe Keep Alive Send Timer becomes enabled; or\na successful Keep Alive command completion is processed by the host.\n•\nThe host restarts a Keep Alive Send Timer if:\nthe Keep Alive Send Timer is enabled;\na Keep Alive command is not outstanding; and\na successful Set Features command completion is processed by the host where the\ncommand specified the Keep Alive Timer feature (i.e., Feature Identifier 0Fh) and a non-\nzero KATO field.\n•\nIf a Keep Alive Send Timer starts or restarts, the host sets the Keep Alive Send Timer to:\nKATT/2 minus the time elapsed since the last expired timestamp; or\nzero, if the time elapsed since the last expired timestamp is greater than KATT/2.\n•\nThe host stops a Keep Alive Send Timer if the Keep Alive Send Timer becomes disabled.\n•\nIf a Keep Alive Send Timer expires, (i.e., the Keep Alive Send Timer is still enabled and time has\nelapsed equal to the value to which the Keep Alive Send Timer was set since the host most recently\nstarted or restarted the Keep Alive Send Timer), then the host records the current time as the last\nexpired timestamp and sends a Keep Alive command.\n•\nThe host detects a Keep Alive Timeout if the host sends a Keep Alive command and does not\nreceive a completion for the Keep Alive command before KATT elapses from when the Keep Alive\ncommand was sent",
    "tables": [],
    "figures": []
  },
  "statistics": {
    "table_count": 0,
    "figure_count": 0
  }
}