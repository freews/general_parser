{
  "section_index": 911,
  "section_id": "8.3.5.5.5",
  "title": "8.3.5.5.5 DH-HMAC-CHAP_Success1 Message",
  "level": 5,
  "pages": {
    "start": 753,
    "end": 754,
    "count": 2
  },
  "content": {
    "text": "The DH-HMAC-CHAP_Success1 message is sent from the controller to the host and indicates that the\ncontroller has successfully authenticated the host. The format of the DH-HMAC-CHAP_Success1 message\nis shown in Figure 802.\nHash Length (HL): Shall be set to the length in bytes of the selected hash function, as specified in Figure\n798.\nResponse Valid: If the host did not request authentication of the controller (i.e., bidirectional authentication)\nthis field shall be cleared to 0h to indicate that no response is conveyed (i.e., the Response Value field is\nnot valid). If the host did request authentication of the controller, this field shall be set to 01h.\nResponse Value (RVAL): DH-HMAC-CHAP response value R2. The value of R2 is computed using the\nhash function H( ) selected by the HashID parameter of the DH-HMAC-CHAP_Challenge message, and\nthe augmented challenge Ca2. If the NULL DH group has been selected, the augmented challenge Ca2 is\nequal to the challenge C2 received from the host (i.e., Ca2 = C2). If a non-NULL DH group has been selected,\nthe augmented challenge is computed applying the HMAC function using the hash function H( ) selected\nby the HashID parameter in the DH-HMAC-CHAP_Challenge message with the hash of the ephemeral DH\nkey resulting from the combination of the random value x selected by the controller with the DH exponential\n(i.e., gy mod p) received from the host as HMAC key (refer to RFC 2104) to the challenge C2 (i.e., Ca2 =\nHMAC(H((gy mod p)x mod p), C2) = HMAC(H(gxy mod p)), C2). The value of R2 shall be computed applying\nthe HMAC function using the hash function H( ) selected by the HashID parameter in the DH-HMAC-\nCHAP_Challenge message with key Kc as HMAC key to the concatenation of the augmented challenge\nCa2, the sequence number S2, the transaction identifier T_ID, the secure channel concatenation indication\nSC_C received in the AUTH_Negotiate message, the ten ASCII characters ”Controller” to indicate the\ncontroller is computing the reply, the NVM Subsystem NQN not including the null terminator, a 00h byte,\nand the host NQN not including the null terminator (i.e., R2 = HMAC(Kc, Ca2 || S2 || T_ID || SC_C ||\n”Controller” || NQNc || 00h || NQNh)). Using C language notation:\nCa2 = (DHgID == 00h) ? C2 : HMAC(H((gy mod p)x mod p)), C2)\nR2 = HMAC(Kc, Ca2 || S2 || T_ID || SC_C || ”Controller” || NQNc || 00h || NQNh)\nUpon receiving a DH-HMAC-CHAP Success1 message:\n•\nif the Hash Length (HL) does not match the value specified in Figure 798 for the selected hash\nfunction, the host shall:\nreply with an AUTH_Failure2 message having reason code ‘Authentication failure’ and\nreason code explanation ‘Incorrect payload’; and\ndisconnect the NVMe over Fabrics connection;\nand\n•\nif the Response Valid field is set to 01h, the host shall verify the response value R2 using the\nnegotiated hash function and DH group. If verification of the response value R2 does not succeed,\nthe host shall:\nreply with an AUTH_Failure2 message having reason code ‘Authentication failure’ and\nreason code explanation ‘Authentication failed’; and\ndisconnect the NVMe over Fabrics connection.\nIf verification of the response value R2 succeeds, the controller has been authenticated and the host shall\ncontinue with a DH-HMAC-CHAP_Success2 message.",
    "tables": [
      {
        "id": "table_753_687",
        "page": 753,
        "bbox": [
          114.0,
          687.0,
          883.0,
          908.0
        ],
        "image_path": "Table_8_3_5_5_5_DH_HMAC_CHAP_Success1_Message.png",
        "title": "Table_8_3_5_5_5_DH_HMAC_CHAP_Success1_Message",
        "table_md": "| Bytes | Description |\n| :--- | :--- |\n| 0 | Authentication Type (AUTH_TYPE): 01h (i.e., DH-HMAC-CHAP) |\n| 1 | Authentication Identifier (AUTH_ID): 03h (i.e., DH-HMAC-CHAP_Success1) |\n| 3:2 | Reserved |\n| 5:4 | Transaction Identifier (T_ID): 16-bit transaction identifier |\n| 6 | Hash Length (HL): Length in bytes of the selected hash function |\n| 7 | Reserved |\n| 8 | Response Valid (RVALID): |\n| | <table><tbody><tr><th>Value</th><th>Definition</th></tr><tr><td>00h</td><td>The Response Value is not valid</td></tr><tr><td>01h</td><td>The Response Value is valid</td></tr><tr><td>All other values</td><td>Reserved</td></tr></tbody></table> |\n| 15:9 | Reserved |\n| 15+HL:16 | Response Value (RVAL): Response R₂, if valid (i.e., if the RVALID field is set to 01h), cleared to 0h otherwise |"
      }
    ],
    "figures": []
  },
  "statistics": {
    "table_count": 1,
    "figure_count": 0
  }
}