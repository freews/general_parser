{
  "section_index": 581,
  "section_id": "5.4.4",
  "title": "5.4.4 Discovery Information Management command",
  "level": 3,
  "pages": {
    "start": 492,
    "end": 499,
    "count": 8
  },
  "content": {
    "text": "The Discovery Information Management command registers, de-registers, or updates discovery information\nentries.\nThe type of task performed by the Discovery Information Management command (i.e., registration, de-\nregistration, or update) is determined by the value set in Task (TAS) field of Command Dword 10 (refer to\nFigure 530).\nFor a register task (i.e., TAS field cleared to 0h), the Discovery Information Management command\nregisters:\n•\none or more host discovery information entries; or\n•\none or more NVM subsystem discovery information entries.\nFor a de-register task (i.e., TAS field set to 1h), the Discovery Information Management command de-\nregisters:\n•\none or more host discovery information entries; or\n•\none or more NVM subsystem discovery information entries.\nFor an update task (i.e., TAS field set to 2h), the Discovery Information Management command updates:\n•\none host discovery information entry; or\n•\none NVM subsystem discovery information entry.\nDiscovery information entries may be one of the following:\n•\na basic discovery information entry (refer to Figure 310); or\n•\nan extended discovery information entry (refer to Figure 532).\nHost discovery information entries shall be extended discovery information entries.\nNVM subsystem discovery information entries may be basic discovery information entries or may be\nextended discovery information entries. Each NVM subsystem discovery information entry may specify an\nNVM subsystem that exposes namespaces that hosts may access or may specify a referral to another\nDiscovery subsystem.\nThe Discovery Information Management command uses the Data Pointer field as shown in Figure 529 and\nCommand Dword 10 as shown in Figure 530. All other command specific fields are reserved.\nThe data portion of the Discovery Information Management command contains a header that identifies the\nentity performing the register, de-register, or update task.\nIf a register task is being performed and the data portion of the Discovery Information Management\ncommand does not contain one or more discovery information entries, then the controller shall abort the\ncommand with status code of Invalid Field in Command. If the number of discovery information entries\ncontained in the data portion of the Discovery Information Management command exceeds the available\ncapacity for new discovery information entries on the CDC or DDC, then the controller shall abort the\ncommand with a status code of Insufficient Discovery Resources. If multiple register tasks are performed\nby the same entity (i.e., the value set in the Entity Identifier (EID) field of the header is associated with an\nexisting registration record contained in the CDC or DDC), and:\na) the Entry Key associated with a discovery information entry in the Discovery Information\nManagement command matches the Entry Key associated with an existing registration record, then\nthe existing registration record contained in the CDC or DDC shall be updated with the discovery\ninformation entry from the Discovery Information Management command; or\nb) the Entry Key associated with a discovery information entry in the Discovery Information\nManagement command does not match the Entry Key associated with an existing registration\nrecord, then the discovery information entry in the Discovery Information Management command\nshall be registered with the CDC or DDC.\nIf a de-register task is being performed and the data portion of the Discovery Information Management\ncommand does not contain one or more discovery information entries, then the controller shall abort the\ncommand with a status code of Invalid Field in Command.\nIf an update task is being performed and the data portion of the Discovery Information Management\ncommand does not contain two discovery information entries, then the controller shall abort the command\nwith a status code of Invalid Field in Command. The first discovery information entry identifies the\nregistration record contained in the CDC or DDC that is to be updated. The fields in the first discovery\ninformation entry that are not used as part of the Entry Key are ignored. The second discovery information\nentry replaces the existing registration record identified by the Entry Key from the first discovery information\nentry. The update task shall be atomic.\nThe format for the data portion of the Discovery Information Management command is defined in Figure\n531.\nBased upon the value set in the Entity Type (ETYPE) field of the header, the data portion of a Discovery\nInformation Management command shall:\n•\nonly contain host extended discovery information entries if the ETYPE field is set to 1h (i.e., a host\nis performing the register, de-register, or update task);\n•\nonly contain host extended discovery information entries if the ETYPE field is set to 3h (i.e., a CDC\nis performing the register, de-register, or update task); and\n•\nonly contain NVM subsystem basic discovery information entries or NVM subsystem extended\ndiscovery information entries if the ETYPE field is set to 2h (i.e., a DDC is performing the register,\nde-register, or update task). The DDC may set the Port Local (PORTLCL) field to 1h if the NVM\nsubsystem discovery information entries being registered, de-registered, or updated are only for\nNVM subsystem ports that are presented through the same NVM subsystem port on the DDC that\nis performing the register, de-register, or update task.\nHost extended discovery information entries and NVM subsystem extended discovery information entries\neach contain the same set of fields, but not all of the fields are used for both extended discovery information\nentry types. Refer to Figure 534 for the usage of the extended discovery information entry fields for each\nextended discovery information entry type. If the entity performing a register, de-register, or update task\nuses any field in an extended discovery information entry that conflicts with the value set in the ETYPE field\nof the Discovery Information Management command data portion’s header (e.g., a host uses a field\nintended for only NVM subsystem extended discovery information entries), then the controller shall abort\nthe command with a status code of Invalid Discovery Information.\nHost extended discovery information entries shall contain at least one extended attribute containing a Host\nIdentifier. NVM subsystem extended discovery information entries may contain zero or more extended\nattributes. The format for an extended attribute is defined in Figure 533.",
    "tables": [
      {
        "id": "table_493_684",
        "page": 493,
        "bbox": [
          115.0,
          684.0,
          883.0,
          729.0
        ],
        "image_path": "Table_5_4_4_Discovery_Information_Management_command.png",
        "title": "Table_5_4_4_Discovery_Information_Management_command",
        "merged_count": 10,
        "table_md": "| Bits | Description |\n| :--- | :--- |\n| 127:00 | Data Pointer (DPTP): This field specifies the start of the data buffer. Refer to Figure 92 for the definition of this field. |\n| 31:04 | Reserved |\n| 03:00 | Task (TAS): This field selects the type of management task to perform. |\n| | | Value | Definition |\n| | | 0h | Register |\n| | | 1h | De-Register |\n| | | 2h | Update |\n| | | 3h to Fh | Reserved |\n| Bytes | O/M¹ | Description |\n| :--- | :--- | :--- |\n| 03:00 | M | Total Data Length (TDL): This field specifies the length in bytes of the entire data portion of the command. |\n| 07:04 | Reserved | |\n| 15:08 | M | Number of Entries (NUMENT): This field specifies the number of discovery information entries being registered, de-registered, or updated. For a register or de-register task, this field shall be non-zero. For an update task, this field shall be set to 2h. |\n| 17:16 | M | Entity Format (ENTFMT): This field specifies the format of the discovery information entries being registered, de-registered, or updated. |\n| | | Value | Definition |\n| | | 0h | Reserved |\n| | | 1h | Basic discovery information entry |\n| | | 2h | Extended discovery information entry |\n| | | 3h to FFFFh | Reserved |\n| 19:18 | M | Entity Type (ETYPE): This field specifies the type of entity performing the register, de-register, or update task. |\n| | | Value | Definition |\n| | | 0h | Reserved |\n| | | 1h | Host |\n| | | 2h | Direct Discovery controller |\n| | | 3h | Centralized Discovery controller |\n| | | 4h to FFFFh | Reserved |\n| 20 | O² | Port Local (PORTLCL): This field specifies if the NVM subsystem discovery information entries are being registered, de-registered, or updated are only for NVM subsystem ports that are presented through the same NVM subsystem port on the DDC that is performing the register, de-register, or update task. If the Entity Type (ETYPE) field is set to any value other than 2h (i.e., an entity other than a DDC is performing the register, de-register, or update task) and this field is not cleared to 0h, then the controller shall abort the command with a status code of Invalid Field in Command. <br> If this field is set to 1h, then the NVM subsystem discovery information entries being registered, de-registered, or updated are only for NVM subsystem ports that are presented through the same NVM subsystem port on the DDC that is performing the register, de-register, or update task. <br> If this field is cleared to 0h, then the NVM subsystem discovery information entries being registered, de-registered, or updated may be for NVM subsystem ports that are presented through any NVM subsystem port on that DDC. |\n| 21 | Reserved | |\n| Bytes | O/M¹ | Description |\n| :--- | :--- | :--- |\n| 23:22 | M | Entry Key Type (EKTYPE): This field specifies the fields in each discovery information entry that shall be used to determine if the entry matches an existing registration record contained in the CDC or DDC. Host discovery information entries shall use an EKTYPE of 5Fh (i.e., TRADDR Based), NVM subsystem discovery information entries may use an EKTYPE of either 3Fh (i.e., Port ID Based) or 5Fh (i.e., TRADDR Based). All other values are reserved. |\n| | | Bits | Description | Port ID Based (3Fh) | TRADDR Based (5Fh) |\n| | | 15:7 | Reserved | Not used | Used |\n| | | 6 | Transport Address (TRADDR) | Not used | Used |\n| | | 5 | Port ID (PORTID) | Used | Not used |\n| | | 4 | Transport Type (TRTYPE) | | |\n| | | 3 | Address Family (ADRFAM) | | |\n| | | 2 | Transport Service Identifier (TRSCID) | Used | Used |\n| | | 1 | Transport Specific Address Subtype (TAS) | | |\n| | | 0 | NVMe Qualified Name (NQN) | | |\n| 279:24 | M | Entity Identifier (EID): This field specifies a NQN that is used to uniquely identify the entity performing the registration, de-registration, or update task within the fabric in UUID-based format. Refer to section 4.7 for the formatting requirements of UUID-based format NQNs. |\n| 535:280 | O | Entity Name (ENAME): This field specifies the name associated with the entity as an ASCII string (refer to section 1.4.2 for ASCII string requirements). The value specified in this field is determined by the value set in the Entity Type (ETYPE) field. <br> If the ETYPE field is set to 1h (i.e., a host is performing the register, de-register, or update task), then this field specifies the name associated with the host. <br> If the ETYPE field is set to 2h (i.e., a DDC is performing the register, de-register, or update task), then this field specifies the Discovery controller entity version (e.g., currently active firmware revision of the DDC). <br> If the ETYPE field is set to 3h (i.e., a CDC is performing the register, de-register, or update task), then this field specifies the name associated with the CDC. <br> If the ETYPE field is set to 1h (i.e., a host is performing the register, de-register, or update task), then this field specifies the Discovery controller entity version (e.g., currently active firmware revision of the DDC). <br> If the ETYPE field is set to 2h (i.e., a DDC is performing the register, de-register, or update task), then this field specifies the name associated with the DDC. <br> If the ETYPE field is set to 3h (i.e., a CDC is performing the register, de-register, or update task), then this field specifies the name associated with the CDC. |\n| 599:536 | O | Entity Version (EVER): This field specifies the entity version as an ASCII string (refer to section 1.4.2 for ASCII string requirements). The value specified in this field is determined by the value set in the Entity Type (ETYPE) field. <br> If the ETYPE field is set to 1h (i.e., a host is performing the register, de-register, or update task), then this field specifies the host entity version (e.g., host operating system name and version). <br> If the ETYPE field is set to 2h (i.e., a DDC is performing the register, de-register, or update task), then this field specifies the Discovery controller entity version (e.g., currently active firmware revision of the DDC). <br> If the ETYPE field is set to 3h (i.e., a CDC is performing the register, de-register, or update task), then this field specifies the name associated with the CDC. |\n| 1023:600 | Reserved | |\n| | | Discovery Information Entry List |\n| | | (TEL - 1) + 1024: 1024 | M | Discovery Information Entry 0: This field contains the first discovery information entry as defined in Figure 531 for extended discovery information entries and as defined in Figure 310 for basic discovery information entries, where TEL is the size specified in the Total Entry Length (TEL) field of the extended discovery information entry. For basic discovery information entries, TEL shall be 1,024 bytes. |\n| Bytes | O/M¹ | Description |\n| :--- | :--- | :--- |\n| ... | O | |\n| TDL - 1: TDL | M³ | Discovery Information Entry NUMENT-1: This field contains the last discovery information entry as defined in Figure 531 for extended discovery information entries (if present) and as defined in Figure 310 for basic discovery information entries (if present), where TEL is the size specified in the Total Entry Length (TEL) field of the extended discovery information entry, and TDL is the size specified in the Total Data Length (TDL) field. For basic discovery information entries, TEL shall be 1,024 bytes. |\n| Notes: | | |\n| 1. | | O/M definition: O = Optional, M = Mandatory. |\n| 2. | | This field is optional for a register, de-register, or update task performed by a DDC. For a register, de-register, or update task performed by a host or CDC, this field shall be cleared to 0h. |\n| 3. | | This field is mandatory for an update task. For a register or de-register task, this field is optional. |\n| Bytes | O/M¹ | Description |\n| :--- | :--- | :--- |\n| 00 | M | Transport Type (TRTYPE): This field specifies the transport type as defined in the Transport Type (TRTYPE) field in Figure 310. |\n| 01 | M | Address Family (ADRFAM): This field specifies the address family as defined in the Address Family (ADRFAM) field in Figure 310. |\n| 02 | M² | Subsystem Type (SUBTYPE): This field specifies the type of the NVM subsystem that is indicated in this entry as defined in the Subsystem Type (SUBTYPE) field in Figure 310. |\n| 03 | M² | Transport Requirements (TREQ): This field specifies the transport requirements for the NVMe Transport as defined in the Transport Requirements (TREQ) field in Figure 310. |\n| 05:04 | M² | Port ID (PORTID): This field specifies a particular NVM subsystem port as defined in the Port ID (PORTID) field in Figure 310. |\n| 06:07 | M² | Controller ID (CNTLID): This field specifies the controller ID as defined in the Controller ID (CNTLID) field in Figure 310. |\n| 09:08 | M² | Admin Max SQ Size (ASQSZ): This field specifies the maximum size of an Admin Submission Queue as defined in the Admin Max SQ Size (ASQSZ) field in Figure 310. |\n| 31:10 | Reserved | |\n| 63:32 | M² | Transport Service Identifier (TRSCID): This field specifies the NVMe Transport Service Identifier as defined in the Transport Service Identifier (TRSCID) field in Figure 310. |\n| 255:64 | Reserved | |\n| 511:256 | M | NVMe Qualified Name (NQN): If the Entity Type (ETYPE) field in the Discovery Information Management command data portion's header is set to 2h (i.e., a DDC is performing the register, de-register, or update task), then this field specifies the NVMe Qualified Name (NQN) that uniquely identifies the NVM subsystem as defined in the NVMe Subsystem Qualified Name (SUBNQN) field in Figure 310. <br> If the ETYPE field in the Discovery Information Management command data portion's header is set to 1h or 3h (i.e., a host or CDC is performing the register, de-register, or update task), then this field specifies the NQN that uniquely identifies the host as defined in the Host NVMe Qualified Name (HOSTNQN) field in Figure 315. |\n| Bytes | O/M¹ | Description |\n| :--- | :--- | :--- |\n| 767:512 | M | Transport Address (TRADDR): If the Entity Type (ETYPE) field in the Discovery Information Management command data portion's header is set to 2h (i.e., a DDC is performing the registration, de-registration, or update task), then this field specifies the address of a fabric interface on the NVM subsystem that may be used for a Connect command as an ASCII string as defined in the Transport Address (TRADDR) field in Figure 310. <br> If the ETYPE field in the Discovery Information Management command data portion's header is set to 1h or 3h (i.e., a host or CDC is performing the register, de-register, or update task), then this field specifies the address of a fabric interface on the host that may be used for a Connect command as an ASCII string as defined in the Transport Address (TRADDR) field in Figure 315. <br> If the first byte (i.e., byte 512) of this field is NULL (i.e., cleared to 00h), then the TRADDR value used by the controller shall be the remote IP address associated with the connection used to transport the Discovery Information Management command. If the host attempts to register or de-register multiple discovery information entries with the first byte of this field containing a NULL, then the controller shall abort the command with a status code of Invalid Field in Command. |\n| 1023:768 | M | Transport Specific Address Subtype (TAS): This field specifies NVMe Transport specific information about the address as defined in the Transport Specific Address Subtype (TAS) field in Figure 310. |\n| 1027:1024 | M | Total Entry Length (TEL): This field specifies the length in bytes of the entire extended discovery information entry. |\n| 1029:1028 | M³ | Number of Extended Attributes (NUMEXAT): This field specifies the number of extended discovery information entries contained in the extended discovery information entry. <br> This field shall be set to a non-zero value (i.e., the extended discovery information entry shall contain at least one extended attribute) if the Entity Type (ETYPE) field in the Discovery Information Management command data portion's header is set to 1h or 3h (i.e., a host or CDC is performing the register, de-register, or update task). If the ETYPE field is set to 1h or 3h and this field is cleared to 0h, then the controller shall abort the command with a status code of Invalid Discovery Information. |\n| 1031:1030 | Reserved | |\n| | | Extended Attribute List |\n| | | ((EXATLEN - 1) + 4) + 1032: 1032 | M³ | Extended Attribute 0: This field contains the first extended attribute as defined in Figure 533 (if present), where EXATLEN is the size specified in the Extended Attribute Length (EXATLEN) field of the extended attribute and TEL is the size specified in the Total Entry Length (TEL) field. |\n| | | ... | O | |\n| | | TEL - 1: TEL - (EXATLEN + 4) | O | Extended Attribute N: This field contains the Nth extended attribute as defined in Figure 533 (if present), where EXATLEN is the size specified in the Extended Attribute Length (EXATLEN) field of the extended attribute and TEL is the size specified in the Total Entry Length (TEL) field. |\n| Notes: | | |\n| 1. | | O/M definition: O = Optional, M = Mandatory. For host discovery information entries, this field shall be cleared to 0h. |\n| 2. | | This field is mandatory for host discovery information entries and optional for NVM subsystem discovery information entries. |\n| 3. | | This field is mandatory for host discovery information entries and optional for NVM subsystem discovery information entries. |\n| Bytes | Description |\n| :--- | :--- |\n| 01:00 | Extended Attribute Type (EXATTYPE): This field specifies the type of extended attribute for the extended attribute contained in the extended discovery information entry. |\n| | | Value | O/M¹ | Definition |\n| | | 0h | Reserved | |\n| | | 1h | HM | Host Identifier |\n| | | 2h | OM | Admin label ASCII |\n| | | 3h | O | Admin label UTF-8 |\n| | | 4h to FFFFh | Reserved | |\n| 03:02 | Extended Attribute Length (EXATLEN): This field specifies the length of the Extended Attribute Value (EXATVAL) field for the extended attribute contained in the extended discovery information entry. The length specified in this field shall be a non-zero value that is a multiple of four, and either a fixed length or within a variable range based upon the value set in the Extended Attribute Type (EXATTYPE) field. If the length specified in this field is not a multiple of four, then the controller shall abort the command with a status code of Invalid Field in Command. |\n| | | Extended Attribute Type | Length |\n| | | Host identifier | 16 bytes |\n| | | Admin label ASCII | 4 to 256 bytes |\n| | | Admin label UTF-8 | |\n| (EXATLEN - 1) + 4:04 | Extended Attribute Value (EXATVAL): This field specifies the value for the extended attribute contained in the extended discovery information entry. The value specified in this field is based upon the value set in the Extended Attribute Type (EXATTYPE) field. Unused bytes, if any, shall be cleared to 0h. |\n| | | Extended Attribute Type | Definition |\n| | | Host identifier | This value specifies the Host Identifier of the host, as defined in section 5.2.26.1.32. |\n| | | Admin label ASCII | This value specifies the admin label of the host or NVM subsystem encoded in ASCII. The admin label is used to identify a host or an NVM subsystem. |\n| | | Admin label UTF-8 | This value specifies the admin label of the host or NVM subsystem encoded in UTF-8. The admin label is used to identify a host or an NVM subsystem. |\n| Notes: | | |\n| 1. | | O/M definition: O = Optional, M = Mandatory, HM = Mandatory for hosts and prohibited for NVM subsystems. |\n| | | Extended Discovery Information Entry Type: |\n| Field Name | Host | NVM Subsystem |\n| :--- | :--- | :--- |\n| Transport Type (TRTYPE) | Used | Used |\n| Address Family (ADRFAM) | Used | Used |\n| Subsystem Type (SUBTYPE) | Ignored¹ | Used |\n| Transport Requirements (TREQ) | Ignored¹ | Used |\n| Port ID (PORTID) | Ignored¹ | Used |\n| Controller ID (CNTLID) | Ignored¹ | Used |\n| Admin Max SQ Size (ASQSZ) | Ignored¹ | Used |\n| Transport Service Identifier (TRSCID) | Used | Used |\n| | | Extended Discovery Information Entry Type: |\n| Field Name | Host | NVM Subsystem |\n| :--- | :--- | :--- |\n| NVMe Qualified Name (NQN) | Used | Used |\n| Transport Address (TRADDR) | Used | Used |\n| Transport Specific Address Subtype (TAS) | Used | Used |\n| Total Entry Length (TEL) | Used | Used |\n| Number of Extended Attributes (NUMEXAT) | Used | Used |\n| Extended Attribute 0 (EXAT0)…Extended Attribute N (EXATN) | Used | Used |\n| Notes: | | |\n| 1. | | This field shall be cleared to 0h. |"
      }
    ],
    "figures": []
  },
  "statistics": {
    "table_count": 1,
    "figure_count": 0
  }
}