{
  "section_index": 685,
  "section_id": "8.1.6.2.2",
  "title": "8.1.6.2.2 Authenticated Unfreeze Operation",
  "level": 5,
  "pages": {
    "start": 567,
    "end": 568,
    "count": 2
  },
  "content": {
    "text": "This section describes how a host initiates an authenticated unfreeze operation using a Personality\nUnfreeze Request by submitting a Security Send command, and subsequently submitting a Security\nReceive command to retrieve the result of the Personality Unfreeze Request operation.\nThe Security Send command contains a CDP Request Data Frame (refer to Figure 630) that specifies:\n•\na CDP Request Message Type value of 01h (i.e., Personality Unfreeze Request); and\n•\neither:\no\nCDP Programmable Key Authentication Unfreeze Data (refer to Figure 632) when using\nProgrammable Key Authentication (refer to the AUS field in Figure 285); or\no\nCDP Physical Credential Authentication Unfreeze Request Data (refer to Figure 634) when\nusing Physical Credential Authentication.\nA controller performs steps such as the following to process a CDP Request Data Frame for an\nAuthenticated Unfreeze Request operation using Physical Credential Authentication:\nAs part of an authenticated unfreeze operation for a host using Programmable Key Authentication, a host:\n•\nretrieves the random nonce using the Random Nonce Request operation as described in section\n8.1.6.3.2; and\n•\nspecifies the random nonce as part of a Personality Unfreeze Request operation (refer to 8.1.6.2.1).\nA controller performs the following steps to process a CDP Request Data Frame for an Authenticated\nUnfreeze Request operation using Programmable Key Authentication:\n1. Verify the specified HMAC size.\nIf the HMAC size specified by the HMAC Size (HMACS) field does not match the expected size as\nspecified in Figure 642 for the specified CDP Authentication Algorithm in the CDPAA field, then the\ncontroller shall set the Result Code field to 02h (i.e., Authentication Failure) in the CDP Response\nData Frame, and the personality remains frozen.\np\ny\n2. Verify the specified HMAC value.\nThe value of the HMAC Value (HMACV) field is an HMAC calculated by the host using the CDP\nAuthentication Algorithm as specified by the CDPAA field (e.g., if the Authentication Algorithm\nspecified is HMAC-SHA-384, then the Hash-based Message Authentication Code (HMAC) is\ncalculated using HMAC-SHA-384 as defined in RFC 6234).\nThe HMAC algorithm takes as input a key and a message as follows:\n•\nthe key is the DHK derived by the host as described in section 8.1.6.3.1.1; and\n•\nthe message is the concatenation of all fields in the CDP Request Data Frame, excluding\nthe HMACV field.\nTo verify the value of the credential, the controller shall calculate an HMAC using:\n•\nthe DHK stored in the NVM subsystem; and\n•\nthe message is the concatenation of all fields in the CDP Request Data Frame, excluding\nthe HMACV field.\nIf the HMAC value calculated by the controller does not match the value of the HMACV field, then\nthe controller shall set the Result Code field to 02h (i.e., Authentication Failure) in the CDP\nResponse Data Frame in response to a subsequent Security Receive command, and the\npersonality remains frozen.\nIf an attempt is made to unfreeze a personality using Programmable Key Authentication prior to the\nDHK being programmed, then the controller shall set the Result Code set to 03h (i.e., DHK Not\nProgrammed) in the CDP Response Data Frame in response to a subsequent Security Receive\ncommand, and the personality remains frozen. If a personality supports Physical Credential\nAuthentication, that personality is able to be unfrozen using PPI (refer to section 5.2.26.1.24.1.1).\n,\np\n3. Verify the random nonce.\nIf the specified random nonce matches the random nonce in the NVM subsystem, then the random\nnonce is successfully verified.\nIf the specified random nonce does not match the random nonce in the NVM subsystem, then the\ncontroller shall set the Result Code field to 02h (i.e., Authentication Failure) in the CDP Data Frame\nin response to a subsequent Security Receive command, and the personality remains frozen.\np\nq\ny\n,\np\ny\n4. If the value of the HMACV field, and the random nonce are successfully verified, then the\nPersonality Unfreeze Request is authenticated.\n5. The personality for the specified Personality Identifier shall be unfrozen.\n6. The controller shall then purge the random nonce.\nOnce the controller returns a successful completion of the Security Send command, then the host should\ncheck the result of the Personality Unfreeze Request by submitting a Security Receive command. The\ncontroller shall return a:\n•\nsuccessful completion of the Security Receive command; and\n•\nCDP Response Data Frame, as defined in Figure 631, indicating a Response Message Type with\na value of 02h (i.e., Personality Unfreeze Response) and the corresponding Response Data.\nIf an error, other than one of the specified ones listed above, occurs during the processing of a Personality\nUnfreeze Request, then the controller shall set the Result Code field to 01h (i.e., General Failure).",
    "tables": [],
    "figures": []
  },
  "statistics": {
    "table_count": 0,
    "figure_count": 0
  }
}