{
  "section_index": 764,
  "section_id": "8.1.23.3",
  "title": "8.1.23.3 Authenticated Device Configuration Block Write",
  "level": 4,
  "pages": {
    "start": 642,
    "end": 643,
    "count": 2
  },
  "content": {
    "text": "The Authenticated Device Configuration Block Write is initiated by a Security Send command. The RPMB\nData Frame delivered from the host to the controller includes the Request Message Type = 0006h, Sector\nCount = 01h, MAC, Write Counter set to the current Write Counter value, and the RPMB Device\nConfiguration Block data structure (refer to Figure 699). All other fields are cleared to 0h.\nIf the Write Counter has expired, then that controller sets the result to 0005h (write failure, write counter\nexpired) and no data is written to the Device Configuration Block.\nThe controller calculates the MAC of Request Type, Block Count, Write Counter, Address and Data, and\ncompares this with the MAC in the request. If the MAC in the request and the calculated MAC are different,\nthen the controller sets the result to 0002h (authentication failure) and no data is written to the RPMB Device\nConfiguration Block.\nIf the Data from the RPMB Device Configuration Block attempts to disable Boot Partition Protection, then\nthe controller sets the result to 0008h (Invalid RPMB Device Configuration Block) and no data is written to\nthe RPMB Device Configuration Block.\nIf the MAC in the request and the calculated MAC are equal, then the write request is authenticated. The\nData from the request is written to the RPMB Device Configuration Block.\nIf any other error occurs during the write procedure, then the returned result is 0001h (general failure).\nThe controller returns a successful completion for the Security Send command when the Authenticated\nData Write operation is completed regardless of whether the Authenticated Device Configuration Block\nWrite was successful or not.\nWhen the host receives a successful completion of the Security Send command from the controller, that\nhost should send a Security Receive command to the controller to retrieve the data. The controller returns\nan RPMB Data Frame with Response Message Type (0600h), the incremented counter value, the MAC,\nand the Result. All other fields are cleared to 0h.\nThe Write Counter for the Device Configuration Block is independent of the Write Counter for RPMB target\n0. Authenticated Device Configuration Block Writes do not affect the Write Counter for RPMB target 0 since\nthe data is not part of the RPMB data area. The current value of the Write Counter for the Device\nConfiguration Block may be read using an Authenticated Device Configuration Block Read (refer to section\n8.1.23.4).",
    "tables": [
      {
        "id": "table_643_199",
        "page": 643,
        "bbox": [
          114.0,
          199.0,
          881.0,
          758.0
        ],
        "image_path": "Table_8_1_23_3_Authenticated_Device_Configuration_Block_Write.png",
        "title": "Table_8_1_23_3_Authenticated_Device_Configuration_Block_Write",
        "table_md": "| Command | Bytes in Command | Field Name | Value | Objective |\n| :--- | :--- | :--- | :--- | :--- |\n| Security Send 1 | Data populated by the host and sent to the controller | | | |\n| | 222-00 | Stuff Bytes | 0...00h | |\n| | 222:222-(N-1) | MAC/Key | MAC generated by the host | |\n| | 223 | RPMB Target | 00h | |\n| | 239:224 | Nonce | 0...00h | |\n| | 243:240 | Write Counter | Current Write Counter value | Request Device Configuration Block Write |\n| | 247:244 | Address | 00000000h | |\n| | 251:248 | Sector Count | 00000001h | |\n| | 253:252 | Result | 0000h | |\n| | 255:254 | Request/Response | 0006h (Request) | |\n| | 767:256 | Data | RPMB Device Configuration Block data structure | |\n| Security Send 2 | Data populated by the host and sent to the controller | | | |\n| | 222-N-00 | Stuff Bytes | 0...00h | |\n| | 222:222-(N-1) | MAC/Key | 0...00h | |\n| | 223 | RPMB Target | RPMB target to access | Request Result of data programming |\n| | 239:224 | Nonce | 0...00h | |\n| | 243:240 | Write Counter | 00000000h | |\n| | 247:244 | Address | 00000000h | |\n| | 251:248 | Sector Count | 00000000h | |\n| | 253:252 | Result | 0000h | |\n| | 255:254 | Request/Response | 0005h (Request) | |\n| Security Receive 1 | Data populated by the controller and returned to the host | | | |\n| | 222-00 | Stuff Bytes | 0...00h | |\n| | 222:222-(N-1) | MAC/Key | MAC generated by the controller | |\n| | 223 | RPMB Target | 00h | |\n| | 239:224 | Nonce | 0...00h | |\n| | 243:240 | Write Counter | Incremented Counter value | Write Result |\n| | 247:244 | Address | 00000000h | |\n| | 251:248 | Sector Count | 00000000h | |\n| | 253:252 | Result | Result Code | |\n| | 255:254 | Request/Response | 0600h (Response) | |"
      }
    ],
    "figures": []
  },
  "statistics": {
    "table_count": 1,
    "figure_count": 0
  }
}