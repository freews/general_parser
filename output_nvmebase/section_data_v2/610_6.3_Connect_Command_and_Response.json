{
  "section_index": 610,
  "section_id": "6.3",
  "title": "6.3 Connect Command and Response",
  "level": 2,
  "pages": {
    "start": 515,
    "end": 520,
    "count": 6
  },
  "content": {
    "text": "The Connect command is used to create a Submission and Completion Queue pair. If the Admin Queue is\nspecified, then the Connect command establishes an association between a host and a controller. The\nfields for the submission queue entry are defined in Figure 579 and the fields for the data portion are defined\nin Figure 580.\nA host that uses a single Host NQN may employ multiple Host Identifiers to designate elements of the host\nthat access an NVM subsystem independently of each other (e.g., physical or logical partitions of the host).\nAlternatively, a host may employ multiple Host NQN values to cause each element to be treated as a\nseparate host by an NVM subsystem.\nIf an NVM subsystem supports DH-HMAC-CHAP authentication (refer to section 8.3.5), then the Host NQN\nand the NVM Subsystem NQN parameters in a Connect command are required to be different. If the Host\nNQN and the NVM Subsystem NQN parameters in a Connect command are identical and the NVM\nsubsystem supports DH-HMAC-CHAP authentication, then the controller shall abort the command with a\nstatus code of Connect Invalid Host.\nThe NVM subsystem shall not allocate a Controller ID in the range FFF0h to FFFFh as a valid Controller\nID on completion of a Connect command. Controller IDs FFF0h to FFFFh are defined in Figure 27. If the\nhost is not allowed to establish an association to any controller in the NVM subsystem, then the controller\nshall abort the command with a status code of Connect Invalid Host.\nIf the NVM subsystem supports the dynamic controller model, then:\n•\nthe Controller ID of FFFFh is specified as the Controller ID in a Connect command for the Admin\nQueue. If the controller ID is not set to FFFFh, then the controller shall abort the command with a\nstatus code of Connect Invalid Parameters;\n•\nthe NVM subsystem shall allocate any available controller to the host; and\n•\nreturn that allocated Controller ID in the Connect response.\nIf the NVM subsystem supports the static controller model, then:\n•\nThe host is able to request a specific controller in a Connect command for the Admin Queue. If the\nhost is not allowed to establish an association to the specified controller, then the controller shall\nabort the command with a status code of Connect Invalid Host;\n•\nThe Controller ID of FFFEh on the Admin Queue specifies that any Controller ID may be allocated\nand returned in the Connect response; and\n•\nIf the host specifies a Controller ID value of FFFFh for the Admin Queue, then the controller shall\nabort the command with a status code of Connect Invalid Parameters.\nThe NVM subsystem may allocate specific controllers to particular hosts. If a host requests a controller that\nis not allocated to that host, then the controller shall abort the command with a status code of Connect\nInvalid Host. The mechanism for allocating specific controllers to particular hosts is outside the scope of\nthis specification.\nWhile a controller is processing a Controller Level Reset (CLR) (refer to section 3.7.2), a Connect command\nfor that controller shall not complete successfully. If the host requests a specific controller in a Connect\ncommand and:\n•\nthe requested controller is currently associated with a host, then the NVM subsystem shall abort\nthat command with the status code of Controller Busy; and\n•\nthe requested controller is currently processing a CLR, then the NVM subsystem shall either wait\nfor that CLR to complete or abort that command with a status code of Controller Busy.\nIf the host specifies a controller ID of FFFFh or FFFEh in the Connect command, then the NVM subsystem\nshall not allocate a controller that is:\n•\ncurrently associated with a host;\n•\ncurrently processing a CLR; or\n•\ncurrently performing shutdown processing (refer to section 3.6).\nThe NVM subsystem should not aggressively reuse controller IDs for a Connect command that specifies a\ncontroller ID of FFFFh or FFFEh (e.g., the NVM subsystem delays reuse of controller IDs by two minutes if\nthere are other controller IDs available for use). The NVM subsystem not aggressively reusing controller\nIDs avoids creating an association between the same host and controller while host recovery of outstanding\ncommands between that host and controller is in-progress resulting in complications of that recovery as\ndescribed in section 5.2.12.3.2.\nThe host shall establish an association with a controller and enable the controller before establishing a\nconnection with an I/O Queue of the controller. If the host sends a Connect command specifying a Queue\nID for an Admin Queue or I/O Queue that exists, then the controller aborts the command as defined by the\nQueue ID field in Figure 579.\nThe Controller shall abort a Connect command with a status code of Connect Invalid Parameters if:\n•\nthe host sends a Connect command to create an I/O Queue while the controller is disabled;\n•\nthe Host NQN, NVM Subsystem NQN, and the Controller ID values specified for an I/O Queue are\nnot the same as the values specified for the associated Admin Queue in which the association\nbetween the host and controller was established;\n•\nthe Host Identifier for an I/O Queue is not set to a value of 0h and is not set to the same value as\nthe value specified for the associated Admin Queue in which the association between the host and\ncontroller was established;\n•\nthe Host NQN or NVM Subsystem NQN values do not match the values that the NVM subsystem\nis configured to support;\n•\nthere is a syntax error in the Host NQN or NVM Subsystem NQN value (refer to section 4.7); or\n•\nthe host specifies a Controller ID value in the range FFF0h to FFFDh.\nIf the NVMe Subsystem Port, NVMe Transport Type or NVMe Transport Address used by the NVMe\nTransport (refer to section 6.3) are not the same as the values used for the associated Admin Queue in\nwhich the association between the host and controller was established, then it is possible that the Connect\ncommand is not received by an NVM subsystem. If the Connect command is received by an NVM\nsubsystem, then:\n•\nthe NVM subsystem that receives the command may not be the same NVM subsystem to which\nthe association between the host and controller was established (i.e., the NVMe Transport Type\nand NVMe Transport Address are unique to an NVM Subsystem Port); and\n•\nthe values of the NVM Subsystem NQN or Controller ID may not be valid at that NVM Subsystem\nPort (e.g., the NVM Subsystem NQN may specify a different NVM subsystem than the one that\nreceived that Connect command, or the Controller ID may specify a controller that is already bound\nto a different NVM Subsystem Port).\nIf this situation occurs and the Connect command is aborted, then the status code shall be set to Connect\nInvalid Parameters. There is no requirement that such a Connect command be received by an NVM\nsubsystem (e.g., if the NVMe Transport Address is not a valid transport address, or is the address of a\nfabric endpoint that does not support NVMe over Fabrics, then the resulting error, if any, is specific to the\nfabric).\nSubmission Queue (SQ) flow control based on the SQ Head Pointer (SQHD) field in Fabrics response\ncapsules (refer to section 3.3.2.1.2) shall be supported by all hosts and controllers. Use of SQ flow control\nis negotiated by the Connect command and response. A host requests that SQ flow control be disabled by\nsetting the Disable SQ Flow Control (DISSQFC) bit of the Connect Attributes field to ‘1’ in a Connect\ncommand. A controller that agrees to disable SQ flow control shall set the SQHD field to FFFFh in the\nresponse to that Connect command. A controller that does not agree to disable SQ flow control shall set\nthe SQHD field to a value other than FFFFh in the response to that Connect command.\nIf the Connect command did not request that SQ flow control be disabled, then the controller shall not set\nthe SQHD field to FFFFh in the response to that Connect command.\nSQ flow control is disabled and shall not be used for a created queue pair only if:\na) the DISSQFC bit is set to ‘1’ in the Connect command that creates the queue pair; and\nb) the SQHD field is set to FFFFh in the response to that Connect command.\nIf SQ flow control is disabled, then the SQHD field is reserved in Fabrics response capsules for all command\ncompletions on that queue pair after the response that completes the Connect command.\nSQ flow control is enabled and shall be used for a created queue pair if:\na) the DISSQFC bit is cleared to ‘0’ in the Connect command that creates the queue pair; or\nb) the SQHD field is not set to FFFFh in the response to that Connect command.\nIf SQ flow control is enabled, then the controller shall use the SQHD field in Fabrics response capsules for\nall command completions on that queue pair, except for command completions that omit the SQHD value\ndue to use of the SQHD pointer update optimization described in section 3.3.2.7.\nThe Connect response provides status for the Connect command. If a connection is established, then the\nController ID allocated to the host is returned. The Connect response is defined in Figure 581.\nFor a Connect command that fails, the controller shall not:\n•\nreturn a status code of Invalid Field in Command; and\n•\nadd an entry to the Error Information log page (refer to section 5.2.12.1.2).",
    "tables": [
      {
        "id": "table_517_616",
        "page": 517,
        "bbox": [
          114.0,
          616.0,
          883.0,
          871.0
        ],
        "image_path": "Table_6_3_Connect_Command_and_Response.png",
        "title": "Table_6_3_Connect_Command_and_Response",
        "merged_count": 5,
        "table_md": "| Bytes | Description |\n| :--- | :--- |\n| 03:00 | Command Dword 0 (CDW0): Refer to Figure 95. |\n| 04 | Fabrics Command Type (FCTYPE): Set to 01h to specify a Connect command. |\n| 23:05 | Reserved |\n| 39:24 | SGL Descriptor 1 (SGL1): Refer to Figure 94. |\n| 41:40 | Record Format (RECFMT): Specifies the format of the Connect command capsule. The format of the record specified in this definition shall be 0h. If the NVM subsystem does not support the value specified, then the command shall be aborted with a status code of Incompatible Format. |\n| 43:42 | Queue ID (QID): Specifies the Queue Identifier for the Admin Queue or I/O Queue to be created. The identifier is used for both the Submission and Completion Queue. The identifier for the Admin Submission Queue and Admin Completion Queue is 0h. The identifier for an I/O Submission and Completion Queue is in the range 1 to 65,534.<br>If the value in this field specifies the Queue ID of a queue that exists, then the controller shall abort the command with one of the following status codes:<br>• Invalid Queue Identifier;<br>• Command Sequence Error; or<br>• Connect Invalid Parameters. |\n| Bytes | Description |\n| :--- | :--- |\n| 45:44 | Submission Queue Size (SQSIZE): This field indicates the size of the Submission Queue to be created. If the size is 0h or larger than the controller supports, then the command shall be aborted with a status code of Connect Invalid Parameters. The maximum size of the Admin Submission Queue is specified in the Discovery Entry Log Page for the NVM subsystem. Refer to Figure 310. This is a 0's based value. |\n| 46 | Connect Attributes (CATTR): This field indicates attributes for the connection. |\n| | <table><tr><th>Bits</th><th>Description</th></tr><tr><td>7:5</td><td>Reserved</td></tr><tr><td>4</td><td>Connecting Entity (CONNENT): Indicates the type of entity performing the Connect command. If this bit is set to '1', then the entity performing the Connect command is a Discovery controller. If this bit is cleared to '0', then the entity performing the Connect command is a host.</td></tr><tr><td>3</td><td>Individual I/O Queue Deletion Support (INDIVIQDELS): Indicates support for deleting individual I/O Queues. If this bit is set to '1', then the host supports the deletion of individual I/O Queues. If this bit is cleared to '0', then the host does not support the deletion of individual I/O Queues.</td></tr><tr><td>2</td><td>Disable SQ Flow Control (DISSQFC): If this bit is set to '1', then the host is requesting that SQ flow control be disabled. If this bit is cleared to '0', then SQ flow control shall not be disabled.</td></tr><tr><td>1:0</td><td>Priority Class (PRIOCCLASS): Indicates the priority class to use for commands within this Submission Queue. This field is only used when the weighted round robin with urgent priority class is the arbitration mechanism selected (refer to CC.AMS in Figure 41, the field is ignored if weighted round robin with urgent priority class is not used. Refer to section 3.4.4. This field is only valid for I/O Queues and shall be cleared to 00b for Admin Queue connections.</td></tr></table> |\n| | <table><tr><th>Value</th><th>Definition</th></tr><tr><td>00b</td><td>Urgent</td></tr><tr><td>01b</td><td>High</td></tr><tr><td>10b</td><td>Medium</td></tr><tr><td>11b</td><td>Low</td></tr></table> |\n| 47 | Reserved |\n| 51:48 | Keep Alive Timeout (KATO): In the Connect command for the Admin Queue, this field has the same definition as the Keep Alive Timeout (KATO) field of the Keep Alive Timer feature (refer to section 5.2.26.1.8). Upon successful completion of the Connect command, the controller shall set the KATO field in the Keep Alive Timer feature. Refer to section 3.9.2 for a description of activating the Keep Alive Timer.<br>In the Connect command for an I/O Queue, this field is reserved. |\n| 53:52 | NVM Set Identifier (NVMSSETID): This field indicates the identifier of the NVM Set to be associated with this Submission Queue. This field is only valid for I/O Queues.<br>In the Connect command for an Admin Queue, the:<br>• host should clear this field to 0h;<br>• controller shall ignore this field; and<br>• Submission Queue is not associated with any NVM Set.<br>In the Connect command for an I/O queue, if the SQ Associations capability is not supported (refer to section 8.1.27) or this field is cleared to 0h, then this Submission Queue is not associated with any specific NVM Set.<br>If the SQ Associations capability is supported (refer to section 8.1.27) and this field contains a non-zero value that is not indicated in the NVM Set List (refer to Figure 333), then the controller shall abort the command with a status code of either Invalid Field in Command or Connect Invalid Parameters.<br>The host should not submit commands for namespaces associated with other NVM Sets in this Submission Queue (refer to section 8.1.27). |\n| 63:54 | Reserved |\n| Bytes | Description |\n| :--- | :--- |\n| 15:00 | Host Identifier (HOSTID): This field has the same definition as the Host Identifier defined in section 5.2.26.1.32.<br>For a Connect command to create an Admin Queue (i.e., the QID field is cleared to 0h) that completes successfully the controller shall set the current Host Identifier (refer to section 5.2.26.1.32.2) to this value.<br>For a Connect command to create an I/O queue (i.e., the QID field is set to a non-zero value):<br>• if this field is cleared to 0h, then the controller shall ignore this field; and<br>• if this field is set to a non-zero value and the value in this field does not match the value in the Host Identifier feature, then the controller shall abort the command with a status code of Connect Invalid Parameters. |\n| 17:16 | Controller ID (CNTLID): Specifies the controller ID requested. This field corresponds to the Controller ID (CNTLID) value returned in the Identify Controller data structure for a particular controller. If the NVM subsystem uses the dynamic controller model, then the value shall be FFFFh for the Admin Queue and any available controller may be returned. If the NVM subsystem uses the static controller model and the value is FFFEh for the Admin Queue, then any available controller may be returned. |\n| 255:18 | Reserved |\n| 511:256 | NVM Subsystem NVMe Qualified Name (SUBNQN): NVMe Qualified Name (NQN) that uniquely identifies the NVM subsystem. Refer to section 4.7. |\n| 767:512 | Host NVMe Qualified Name (HOSTNQN): NVMe Qualified Name (NQN) that uniquely identifies the host. Refer to section 4.7. |\n| 1023:768 | Reserved |\n| Bytes | Description |\n| :--- | :--- |\n| 03:00 | Status Code Specific (SCS): The value is dependent on the status returned. Refer to Figure 582. |\n| 07:04 | Reserved |\n| 09:08 | SQ Head Pointer (SQHD): If the Connect command requested that SQ flow control be disabled, then a value of FFFFh in this field indicates that SQ flow control is disabled for the created queue pair. Otherwise, this field indicates the current Submission Queue Head pointer for the associated Submission Queue and also indicates that SQ flow control is enabled for the created queue pair. |\n| 11:10 | Reserved |\n| 13:12 | Command Identifier (CID): Indicates the identifier of the command that is being completed. |\n| 15:14 | Status Info (STS): Indicates status for the command. |\n| | <table><tr><th>Bits</th><th>Description</th></tr><tr><td>15:01</td><td>Status (STATUS): The Status field for the command. Refer to section 4.2.3. Refer to Figure 105 for values specific to the Connect command.</td></tr><tr><td>00</td><td>Reserved</td></tr></table> |\n| Status Code | Definition of Dword 0 |\n| :--- | :--- |\n| | <table><tr><th>Bytes</th><th>Description</th></tr><tr><td>01:00</td><td>Controller ID (CNTLID): Specifies the controller ID allocated to the host. If a particular controller was specified in the CNTLID field of the Connect command, then this field shall contain the same value.</td></tr><tr><td>03:02</td><td>Authentication and Security Requirements (AUTHREQ): Specifies the NVMe in-band authentication and security requirements. The field is bit significant. If all bits are cleared to '0', then no requirements are specified.<br><table><tr><th>Bits</th><th>Description</th></tr><tr><td>15:03</td><td>Reserved</td></tr><tr><td>02</td><td>Authentication and Secure Channel Required (ASCR): If this bit is set to '1', then authentication using NVMe over Fabrics Authentication protocols followed by secure channel establishment is required and the ATR bit should be cleared to '0'. If this bit is cleared to '0', then authentication using NVMe over Fabrics Authentication protocols followed by secure channel establishment is not required.</td></tr><tr><td>01</td><td>Authentication Transaction Required (ATR): If this bit is set to '1', then authentication using NVMe over Fabrics Authentication protocols is required. If this bit is cleared to '0', then authentication using NVMe over Fabrics Authentication protocols is not required.</td></tr><tr><td>00</td><td>Obsolete.</td></tr></table></td></tr></table> |\n| Successful Completion | |\n| Connect Invalid Parameters | <table><tr><th>Bytes</th><th>Description</th></tr><tr><td>01:00</td><td>Invalid Parameter Offset (IPO): If an invalid parameter is reported, then this field specifies the offset in bytes to the invalid parameter from the start of the SQE or the data.</td></tr><tr><td>02</td><td>Invalid Attributes (IATTR): Specifies attributes of the invalid field parameter.<br><table><tr><th>Bits</th><th>Description</th></tr><tr><td>7:1</td><td>Reserved</td></tr><tr><td>0</td><td>Invalid Parameter Start (IPS): If this bit is cleared to '0', then the invalid parameter is specified from the start of the SQE. If this bit is set to '1', then the invalid parameter is specified from the start of the data.</td></tr></table></td></tr><tr><td>03</td><td>Reserved</td></tr></table> |\n| All Other Status Values | <table><tr><th>Bytes</th><th>Description</th></tr><tr><td>03:00</td><td>Reserved</td></tr></table> |"
      }
    ],
    "figures": []
  },
  "statistics": {
    "table_count": 1,
    "figure_count": 0
  }
}