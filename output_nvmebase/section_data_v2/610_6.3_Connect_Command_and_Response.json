{
  "section_index": 610,
  "section_id": "6.3",
  "title": "6.3 Connect Command and Response",
  "level": 2,
  "pages": {
    "start": 515,
    "end": 520,
    "count": 6
  },
  "content": {
    "text": "The Connect command is used to create a Submission and Completion Queue pair. If the Admin Queue is\nspecified, then the Connect command establishes an association between a host and a controller. The\nfields for the submission queue entry are defined in Figure 579 and the fields for the data portion are defined\nin Figure 580.\nA host that uses a single Host NQN may employ multiple Host Identifiers to designate elements of the host\nthat access an NVM subsystem independently of each other (e.g., physical or logical partitions of the host).\nAlternatively, a host may employ multiple Host NQN values to cause each element to be treated as a\nseparate host by an NVM subsystem.\nIf an NVM subsystem supports DH-HMAC-CHAP authentication (refer to section 8.3.5), then the Host NQN\nand the NVM Subsystem NQN parameters in a Connect command are required to be different. If the Host\nNQN and the NVM Subsystem NQN parameters in a Connect command are identical and the NVM\nsubsystem supports DH-HMAC-CHAP authentication, then the controller shall abort the command with a\nstatus code of Connect Invalid Host.\nThe NVM subsystem shall not allocate a Controller ID in the range FFF0h to FFFFh as a valid Controller\nID on completion of a Connect command. Controller IDs FFF0h to FFFFh are defined in Figure 27. If the\nhost is not allowed to establish an association to any controller in the NVM subsystem, then the controller\nshall abort the command with a status code of Connect Invalid Host.\nIf the NVM subsystem supports the dynamic controller model, then:\n•\nthe Controller ID of FFFFh is specified as the Controller ID in a Connect command for the Admin\nQueue. If the controller ID is not set to FFFFh, then the controller shall abort the command with a\nstatus code of Connect Invalid Parameters;\n•\nthe NVM subsystem shall allocate any available controller to the host; and\n•\nreturn that allocated Controller ID in the Connect response.\nIf the NVM subsystem supports the static controller model, then:\n•\nThe host is able to request a specific controller in a Connect command for the Admin Queue. If the\nhost is not allowed to establish an association to the specified controller, then the controller shall\nabort the command with a status code of Connect Invalid Host;\n•\nThe Controller ID of FFFEh on the Admin Queue specifies that any Controller ID may be allocated\nand returned in the Connect response; and\n•\nIf the host specifies a Controller ID value of FFFFh for the Admin Queue, then the controller shall\nabort the command with a status code of Connect Invalid Parameters.\nThe NVM subsystem may allocate specific controllers to particular hosts. If a host requests a controller that\nis not allocated to that host, then the controller shall abort the command with a status code of Connect\nInvalid Host. The mechanism for allocating specific controllers to particular hosts is outside the scope of\nthis specification.\nWhile a controller is processing a Controller Level Reset (CLR) (refer to section 3.7.2), a Connect command\nfor that controller shall not complete successfully. If the host requests a specific controller in a Connect\ncommand and:\n•\nthe requested controller is currently associated with a host, then the NVM subsystem shall abort\nthat command with the status code of Controller Busy; and\n•\nthe requested controller is currently processing a CLR, then the NVM subsystem shall either wait\nfor that CLR to complete or abort that command with a status code of Controller Busy.\nIf the host specifies a controller ID of FFFFh or FFFEh in the Connect command, then the NVM subsystem\nshall not allocate a controller that is:\n•\ncurrently associated with a host;\n•\ncurrently processing a CLR; or\n•\ncurrently performing shutdown processing (refer to section 3.6).\nThe NVM subsystem should not aggressively reuse controller IDs for a Connect command that specifies a\ncontroller ID of FFFFh or FFFEh (e.g., the NVM subsystem delays reuse of controller IDs by two minutes if\nthere are other controller IDs available for use). The NVM subsystem not aggressively reusing controller\nIDs avoids creating an association between the same host and controller while host recovery of outstanding\ncommands between that host and controller is in-progress resulting in complications of that recovery as\ndescribed in section 5.2.12.3.2.\nThe host shall establish an association with a controller and enable the controller before establishing a\nconnection with an I/O Queue of the controller. If the host sends a Connect command specifying a Queue\nID for an Admin Queue or I/O Queue that exists, then the controller aborts the command as defined by the\nQueue ID field in Figure 579.\nThe Controller shall abort a Connect command with a status code of Connect Invalid Parameters if:\n•\nthe host sends a Connect command to create an I/O Queue while the controller is disabled;\n•\nthe Host NQN, NVM Subsystem NQN, and the Controller ID values specified for an I/O Queue are\nnot the same as the values specified for the associated Admin Queue in which the association\nbetween the host and controller was established;\n•\nthe Host Identifier for an I/O Queue is not set to a value of 0h and is not set to the same value as\nthe value specified for the associated Admin Queue in which the association between the host and\ncontroller was established;\n•\nthe Host NQN or NVM Subsystem NQN values do not match the values that the NVM subsystem\nis configured to support;\n•\nthere is a syntax error in the Host NQN or NVM Subsystem NQN value (refer to section 4.7); or\n•\nthe host specifies a Controller ID value in the range FFF0h to FFFDh.\nIf the NVMe Subsystem Port, NVMe Transport Type or NVMe Transport Address used by the NVMe\nTransport (refer to section 6.3) are not the same as the values used for the associated Admin Queue in\nwhich the association between the host and controller was established, then it is possible that the Connect\ncommand is not received by an NVM subsystem. If the Connect command is received by an NVM\nsubsystem, then:\n•\nthe NVM subsystem that receives the command may not be the same NVM subsystem to which\nthe association between the host and controller was established (i.e., the NVMe Transport Type\nand NVMe Transport Address are unique to an NVM Subsystem Port); and\n•\nthe values of the NVM Subsystem NQN or Controller ID may not be valid at that NVM Subsystem\nPort (e.g., the NVM Subsystem NQN may specify a different NVM subsystem than the one that\nreceived that Connect command, or the Controller ID may specify a controller that is already bound\nto a different NVM Subsystem Port).\nIf this situation occurs and the Connect command is aborted, then the status code shall be set to Connect\nInvalid Parameters. There is no requirement that such a Connect command be received by an NVM\nsubsystem (e.g., if the NVMe Transport Address is not a valid transport address, or is the address of a\nfabric endpoint that does not support NVMe over Fabrics, then the resulting error, if any, is specific to the\nfabric).\nSubmission Queue (SQ) flow control based on the SQ Head Pointer (SQHD) field in Fabrics response\ncapsules (refer to section 3.3.2.1.2) shall be supported by all hosts and controllers. Use of SQ flow control\nis negotiated by the Connect command and response. A host requests that SQ flow control be disabled by\nsetting the Disable SQ Flow Control (DISSQFC) bit of the Connect Attributes field to ‘1’ in a Connect\ncommand. A controller that agrees to disable SQ flow control shall set the SQHD field to FFFFh in the\nresponse to that Connect command. A controller that does not agree to disable SQ flow control shall set\nthe SQHD field to a value other than FFFFh in the response to that Connect command.\nIf the Connect command did not request that SQ flow control be disabled, then the controller shall not set\nthe SQHD field to FFFFh in the response to that Connect command.\nSQ flow control is disabled and shall not be used for a created queue pair only if:\na) the DISSQFC bit is set to ‘1’ in the Connect command that creates the queue pair; and\nb) the SQHD field is set to FFFFh in the response to that Connect command.\nIf SQ flow control is disabled, then the SQHD field is reserved in Fabrics response capsules for all command\ncompletions on that queue pair after the response that completes the Connect command.\nSQ flow control is enabled and shall be used for a created queue pair if:\na) the DISSQFC bit is cleared to ‘0’ in the Connect command that creates the queue pair; or\nb) the SQHD field is not set to FFFFh in the response to that Connect command.\nIf SQ flow control is enabled, then the controller shall use the SQHD field in Fabrics response capsules for\nall command completions on that queue pair, except for command completions that omit the SQHD value\ndue to use of the SQHD pointer update optimization described in section 3.3.2.7.\nThe Connect response provides status for the Connect command. If a connection is established, then the\nController ID allocated to the host is returned. The Connect response is defined in Figure 581.\nFor a Connect command that fails, the controller shall not:\n•\nreturn a status code of Invalid Field in Command; and\n•\nadd an entry to the Error Information log page (refer to section 5.2.12.1.2).",
    "tables": [],
    "figures": [
      {
        "id": "figure_517_616",
        "page": 517,
        "bbox": [
          114.0,
          616.0,
          883.0,
          871.0
        ],
        "detected_title": "Figure 579: Connect Command – Submission Queue Entry",
        "title": "Figure 579: Connect Command – Submission Queue Entry",
        "image_path": "Figure_6_3_Connect_Command_and_Response_1.png",
        "merged_count": 3
      },
      {
        "id": "figure_519_600",
        "page": 519,
        "bbox": [
          114.0,
          600.0,
          881.0,
          800.0
        ],
        "detected_title": "Figure 580: Connect Command – Data",
        "has_intervening_text": true,
        "title": "Figure 580: Connect Command – Data",
        "image_path": "Figure_6_3_Connect_Command_and_Response_2.png"
      },
      {
        "id": "figure_520_127",
        "page": 520,
        "bbox": [
          135.0,
          127.0,
          856.0,
          648.0
        ],
        "detected_title": "Figure 581: Connect Response",
        "title": "Figure 581: Connect Response",
        "image_path": "Figure_6_3_Connect_Command_and_Response_3.png"
      }
    ]
  },
  "statistics": {
    "table_count": 0,
    "figure_count": 3
  }
}