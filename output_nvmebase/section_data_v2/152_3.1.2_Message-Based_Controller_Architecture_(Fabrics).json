{
  "section_index": 152,
  "section_id": "3.1.2",
  "title": "3.1.2 Message-Based Controller Architecture (Fabrics)",
  "level": 3,
  "pages": {
    "start": 61,
    "end": 62,
    "count": 2
  },
  "content": {
    "text": "Message-based controllers, other than Discovery controllers, may support either the dynamic controller\nmodel or the static controller model. A Discovery controller shall support only the dynamic controller model.\nIn an NVM subsystem that supports the static controller model, each controller that is allocated to a\nparticular host may have different state at the time the association is established (e.g., each controller may\nhave state that is preserved from a prior association). The controllers within such an NVM subsystem are\ndistinguished by their controller identifier. The host may request a particular controller based on the\nController ID (refer to the CNTLID field in Figure 580).\nIn an NVM subsystem that supports the dynamic controller model, each controller is allocated by the NVM\nsubsystem on demand with no state (e.g., Controller ID, Feature settings) preserved from prior\nassociations. In this model, all controllers allocated to a specific host have the same state at the time the\nassociation is established, including Feature settings. The initial set of attached namespaces should be the\nsame for all controllers that are allocated to a specific host and accessed via the same NVM subsystem\nport. The initial set of attached namespaces may differ among controllers that are each accessed via a\ndifferent NVM subsystem port. Changes to a dynamic controller (e.g., attached namespaces, Feature\nsettings) after the association is established do not impact other dynamic controllers in that NVM\nsubsystem.\nAn association is established between a host and a controller when the host connects to a controller’s\nAdmin Queue using the Fabrics Connect command (refer to section 6.3). Within the Connect command,\nthe host specifies the Host NQN, NVM Subsystem NQN, Host Identifier, and may request a specific\nController ID (e.g., the static controller model is being used) or may request a connection to any available\ncontroller (e.g., the dynamic controller model is being used). A controller has only one association at a time.\nWhile an association exists between a host and a controller, only that host may establish connections with\nI/O Queues of that controller. To establish a new connection with I/O Queues of that controller, the host\nsends subsequent Connect commands using the same NVM subsystem port, NVMe Transport type, and\nNVMe Transport address and specifies the:\n•\nsame Host NQN;\n•\nsame NVM Subsystem NQN;\n•\nsame Controller ID; and\n•\neither the:\nsame Host Identifier; or\na Host Identifier value of 0h, if supported (refer to section 5.2.12.3.3).\nAn association between a host and controller is terminated if:\n•\nthe controller is shutdown as described in section 3.6.2;\n•\na Controller Level Reset occurs;\n•\nthe NVMe Transport connection is lost between the host and controller for the Admin Queue; or\n•\nan NVMe Transport connection is lost between the host and controller for any I/O Queue and the\nhost or controller does not support individual I/O Queue deletion (refer to section 3.3.2.4).\nThere is no explicit NVMe command that breaks the NVMe Transport association between a host and\ncontroller. The Disconnect command (refer to section 6.4) provides a method to delete an I/O Queue (refer\nto section 3.3.2.4). While a controller is associated with a host, that controller is busy, and no other\nassociations may be made with that controller.\nTo use the dynamic controller model, the host specifies a controller identifier of FFFFh when using the\nFabrics Connect command (refer to section 6.3) to establish an association with an NVM subsystem.\nWhen using the static controller model with a fabric connected controller, the state that persists across\nassociations is any state that persists across a Controller Level Reset. Additionally, different controllers\nmay present different Feature settings or namespace attachments to the same host. The NVM subsystem\nmay allocate particular controllers to specific hosts.\nWhile allocation of static controllers to hosts are expected to be durable (so that hosts can expect to form\nassociations to the same controllers repeatedly (e.g., after each host reboot)), the NVM subsystem may\nremove the host allocation of a controller that is not in use at any time for implementation specific reasons\n(e.g., controller resource reclamation, subsystem reconfiguration).",
    "tables": [],
    "figures": []
  },
  "statistics": {
    "table_count": 0,
    "figure_count": 0
  }
}