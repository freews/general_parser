{
  "section_index": 724,
  "section_id": "8.1.13",
  "title": "8.1.13 Host Managed Live Migration",
  "level": 3,
  "pages": {
    "start": 599,
    "end": 601,
    "count": 3
  },
  "content": {
    "text": "The migration of a controller, by a host that is using the Host Managed Live Migration capability involves\none or more NVM subsystems, multiple hosts, and multiple controllers. In this section, to differentiate\nbetween the multiple hosts and controllers, each is given a unique name as illustrated in Figure 667. In an\nNVM subsystem that supports Host Managed Live Migration, each controller that sets the HMLMS bit to ‘1’\nis referred to as a Migration Management Controller (MMC) and each host associated with an MMC is\nreferred to as a Migration Management Host (MMH). In that same NVM subsystem, all other controllers\n(i.e., those that clear the HMLMS bit to ‘0’) are referred to as Migratable Controllers.\nThe Host Managed Live Migration capability allows an MMH to use an MMC to migrate a Migratable\nController from a Source NVM Subsystem to a Migratable Controller in a Destination NVM Subsystem.\nDuring that migration, a host is actively submitting commands to a Migratable Controller in the Source NVM\nSubsystem and that controller is processing those commands.\nThe MMH that is managing the migration of a Migratable Controller from the Source NVM Subsystem is\nresponsible for ensuring that the Migratable Controller in the Destination NVM Subsystem is compatible\nwith controller state of the Migratable Controller from the Source NVM Subsystem. It is also the\nresponsibility of the MMH to transfer the migrating data between the NVM subsystems.\nAn MMC is an I/O controller or an Administrative controller that supports the Host Managed Live Migration\ncapability and provides the ability for the MMH to use privileged actions (refer to section 3.10) to:\n•\nsuspend the processing of commands on the Migratable Controller in the Source NVM Subsystem\nbeing migrated (refer to the Migration Send command in section 5.2.17.1.1);\n•\nobtain the state of the Migratable Controller in the Source NVM Subsystem being migrated (refer\nto the Migration Receive command in section 5.2.16.1.1);\n•\nset that controller state in the Migratable Controller in the Destination NVM Subsystem (refer to\nthe Migration Send command in section 5.2.17.1.3); and\n•\nresume the operation on the Migratable Controller in the Destination NVM Subsystem (refer to the\nMigration Send command in section 5.2.17.1.2).\nA controller indicates support for the Host Managed Live Migration capability by setting the Host Managed\nLive Migration Support (HMLMS) bit to ‘1’ in the Optional Admin Command Support (OACS) field in the\nIdentify Controller data structure (refer to Figure 328).\nAn MMC is not permitted to be migrated and:\n•\nshall support:\n•\nthe Migration Send command with the Management Operations:\nSuspend (i.e., 0h);\nResume (i.e., 1h); and\nSet Controller State (i.e., 2h);\n•\nthe Migration Receive command with the Management Operation\nController State (i.e., 1h);\nand\n•\nthe CNS value of 20h in the Identify command (i.e., Supported C\nstructure (refer to section 5 2 13 2 21))\nIf the NVM subsystem contains one or more Migration Management Controllers, then:\n•\neach controller (i.e., MMC and Migratable Controller) in that NVM subsystem does not support the\nHost Memory Buffer (refer to the Host Memory Buffer Preferred Size (HMPRE) field in the Identify\nController data structure in Figure 328); and\n•\neach Migratable Controller in that NVM subsystem is allowed to be migrated and shall not support:\nthe Migration Send command (refer to section 5.2.17);\nthe Migration Receive command (refer to section 5.2.16);\nthe CNS value of 20h in the Identify command (i.e., returning Supported Controller State\nFormats data structure (refer to section 5.2.13.2.21)); and\nthe Controller Data Queue command with the Create Queue management operation\nspecifying the User Data Migration Queue (refer to section 5.2.4.1.1).\nA Controller Level Reset on an MMC shall cause that MMC to:\n•\ndelete all User Data Migration Queues on that MMC; and\n•\nstop tracking all host memory changes on that MMC;\nA Controller Level Reset on a Migratable Controller shall cause that Migratable Controller to:\n•\nremove a suspended state if that Migratable Controller is suspended by a Migration Send command\nspecifying the Suspend management operation (refer to section 5.2.17.1.1); and\n•\nretain any persistent controller state that has been committed to that Migratable Controller from a\nMigration Send command specifying the Set Controller State management operation (refer to\nsection 5.2.17.1.3).\nDuring the migration of a Migratable Controller in the Source NVM Subsystem while that Migratable\nController is processing commands, it may be necessary for the MMHS to obtain the user data\nmodifications to namespaces attached to that Migratable Controller and modifications made by that\nMigratable Controller to host memory in the host. The Track Send command (refer to section 5.2.28) and\nthe Track Receive command (refer to section 5.2.27) allows the host to use privileged actions (refer to\nsection 3.10) to:\n•\ndetermine user data in namespaces attached to a controller that has changed; and\n•\ndetermine host memory that has changed due to commands processed by a controller.\nA controller indicates support for tracking changes to user data in namespaces attached to a controller by\nsetting the Track User Data Changes Support (TUDCS) bit to ‘1’ in the Tracking Attributes (TRATTR) field\nin the Identify Controller data structure (refer to Figure 328).\nA controller indicates support for tracking changes to host memory (refer to section 1.5.47) due to the\nprocessing of commands by a controller by setting the Track Host Memory Changes Support (THMCS) bit\nto ‘1’ in the TRATTR field.",
    "tables": [],
    "figures": [
      {
        "id": "figure_599_442",
        "page": 599,
        "bbox": [
          115.0,
          442.0,
          870.0,
          696.0
        ],
        "title": "Figure 667: Host Managed Live Migration Host and Controller Naming",
        "image_path": "Figure_8_1_13_Host_Managed_Live_Migration.png"
      }
    ]
  },
  "statistics": {
    "table_count": 0,
    "figure_count": 1
  }
}