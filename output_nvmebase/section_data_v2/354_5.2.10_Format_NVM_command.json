{
  "section_index": 354,
  "section_id": "5.2.10",
  "title": "5.2.10 Format NVM command",
  "level": 3,
  "pages": {
    "start": 224,
    "end": 227,
    "count": 4
  },
  "content": {
    "text": "The Format NVM command is used to low level format the NVM media. This command is used by the host\nto change the attributes of the NVM media (e.g., the LBA data size and/or metadata size for the NVM\nCommand Set). A low level format may destroy all data and metadata associated with all namespaces that\ncontain formatted storage or only the specific namespace associated with the command (refer to the Format\nNVM Attributes field in the Identify Controller data structure, Figure 328). After the Format NVM command\nsuccessfully completes, the controller shall not return any user data that was previously contained in an\naffected namespace.\nAs part of the Format NVM command, the host requests a format operation and may request a secure\nerase of the contents of the NVM (refer to the SES field in Figure 193). There are two types of secure erase.\nThe User Data Erase erases all user content present in the NVM subsystem. The Cryptographic Erase\nerases all user content present in the NVM subsystem by deleting the encryption key with which the user\ndata was previously encrypted.\nThe scope of the format operation and the scope of the format with secure erase depend on the attributes\nthat the controller supports for the Format NVM command and the Namespace Identifier specified in the\ncommand as described in Figure 192. The type of secure erase, if applicable, is based on the setting of the\nSecure Erase Settings field in Command Dword 10 as defined in Figure 193.\nThe scope of the entire Format NVM command is determined by the value of the SES field (refer to Figure\n193) and the setting of either the Format Namespace Scope (FNS) bit or the Secure Erase Namespace\nScope (SENS) bit (refer to Figure 328) as follows:\na) If the Format NVM command does not specify Secure Erase (i.e., the SES field is cleared to 000b),\nthen the scope of the Format NVM command is indicated by the value of FNS bit and the value of\nSENS bit is not applicable to this command.\nb) If the Format NVM command specifies Secure Erase (i.e., the SES field is set to a non-zero value),\nthen the scope of the Format NVM command is indicated by the value of SENS bit and the value\nof FNS bit is not applicable to this command.\nIf the NVM subsystem supports multiple domains and the Format NVM command is not able to format the\nspecified namespaces as a result of the NVM subsystem being divided (refer to section 3.2.5), then the\nFormat NVM command shall be aborted with a status code of Asymmetric Access Inaccessible or\nAsymmetric Access Persistent Loss.\nThe Format NVM command may be aborted with a status code defined in this specification under\ncircumstances defined by a security specification (e.g., invalid security state as specified in TCG Storage\nInterface Interactions specification). If there are I/O commands being processed for a namespace, then a\nFormat NVM command that is submitted affecting that namespace may be aborted; if aborted, then a status\ncode of Command Sequence Error shall be returned. If a Format NVM command is in progress, then an\nI/O command that is submitted for any namespace affected by that Format NVM command may be aborted;\nif aborted, then a status code of Format in Progress shall be returned. Refer to section 5 for further\ninformation about restrictions on Admin commands during Format NVM.\nFor a Format NVM command with the NSID field set to FFFFFFFFh that specifies secure erase:\na) if the Secure Erase Namespace Scope (SENS) bit is set to ‘1’ in the FNA field (refer to Figure 328)\nand there are no namespaces in the NVM subsystem, then that Format NVM command shall\ncomplete without error; and\nb) if the SENS bit is cleared to ‘0’ in the FNA field and there are no attached namespaces, then that\nFormat NVM command shall complete without error.\nFor a Format NVM command with an NSID field set to FFFFFFFFh that does not specify a secure erase:\na) if the Format Namespace Scope (FNS) bit is set to ‘1’ in the FNA field and there are no namespaces\nin the NVM subsystem, then that Format NVM command shall complete without error; and\nb) if the FNS bit is cleared to ‘0’ in the FNA field and there are no attached namespaces, then that\nFormat NVM command shall complete without error.\nIf a host does not set the LBA Format Extension Enable (LBAFEE) field to 1h in the Host Behavior Support\nfeature (refer to section 5.2.26.1.14), then the 0h value of the LBAFEE field disables any I/O Command Set\nspecific format that requires the LBAFEE field to be set to 1h (refer to the applicable NVM Express I/O\nCommand Set specification). If a Format NVM command specifies a format that is disabled (e.g., the\nLBAFEE field is cleared to 0h), then the controller shall abort that Format NVM command with a status code\nof Invalid Namespace or Format.\nIf the format operation scope (refer to Figure 192) for a Format NVM command includes any namespace\nthat is write protected (refer to section 8.1.17), then the controller aborts that Format NVM command with\na status code of Namespace is Write Protected.\nIf the Format NVM Broadcast Support (FNVMBS) bit in the FNA field is set to ‘1’ and a Format NVM\ncommand has the NSID field set to FFFFFFFFh, then the controller shall abort that command with a status\ncode of Invalid Field in Command.\nAfter successful completion of a Format NVM command, the settings specified in the Format NVM\ncommand (e.g., the PI field, the MSET field, the LBAFL field, and the LBAFU field) are reported as part of\nthe Identify Namespace data structures (refer to section 1.5.50).\nThe Format NVM command uses the Command Dword 10 field. All other command specific fields are\nreserved.",
    "tables": [
      {
        "id": "table_225_186",
        "page": 225,
        "bbox": [
          114.0,
          186.0,
          883.0,
          485.0
        ],
        "image_path": "Table_5_2_10_Format_NVM_command_1.png",
        "title": "Table_5_2_10_Format_NVM_command_1",
        "table_md": "| SES | FNS Bit | SENS Bit | NSID | Format Operation |\n| :--- | :--- | :--- | :--- | :--- |\n| 000b (i.e., not a secure erase) | 0 | N/A | FFFFFFFF¹ | All namespaces attached to the controller. Other namespaces are not affected. |\n| | 0 | | Any allocated value (refer to section 3.2.1.3) | The specified namespace. Other namespaces are not affected. |\n| | 1 | | Any allocated value (refer to section 3.2.1.3) or FFFFFFFFh | All namespaces that exist in the NVM subsystem. |\n| 001b or 010b (i.e., secure erase) | N/A | 0 | FFFFFFFF¹ | All namespaces attached to the controller. Other namespaces are not affected. |\n| | | 0 | Any allocated value (refer to section 3.2.1.3) | The specified namespace. Other namespaces are not affected. |\n| | | 1 | Any allocated value (refer to section 3.2.1.3) or FFFFFFFFh | All namespaces that exist in the NVM subsystem. |\n| | All others | | | The controller shall abort the command with a status code of Invalid Field in Command |\n| Notes: | | | | |\n| | | | | 1. If the Format NVM Broadcast Support (FNVMBS) bit in the FNA field is set to '1', then this value is not supported, and the command is aborted as described in this section. |"
      },
      {
        "id": "table_226_424",
        "page": 226,
        "bbox": [
          114.0,
          424.0,
          881.0,
          848.0
        ],
        "has_intervening_text": true,
        "image_path": "Table_5_2_10_Format_NVM_command_2.png",
        "title": "Table_5_2_10_Format_NVM_command_2",
        "merged_count": 2,
        "table_md": "| Bits | Description |\n| :--- | :--- |\n| 31:14 | LBA Format Upper (LBAFU): This field specifies the most significant 2 bits of the Format Index of the User Data Format to apply to the NVM media. This corresponds to the User Data Formats indicated in the Identify command, refer to the Identify Namespace data structure and the LBA Format data structure in the applicable NVM Express I/O Command Set specification. If an unsupported User Data Format is selected, the controller shall abort the command with a status code of Invalid Format.<br><br>This field shall be ignored by the controller if the LBA Format Extension Enable (LBAFEE) field is cleared to 0h in the Host Behavior Support feature (refer to section 5.2.26.1.14).<br><br>NOTE: This field applies to all User Data Formats. The original name has been retained for historical continuity. |\n| 13:12 | |\n| | |\n| 11:09 | Secure Erase Settings (SES): This field specifies whether a secure erase should be performed as part of the format and the type of the secure erase operation. The erase applies to all user data, regardless of location (e.g., within an exposed LBA (refer to the NVM Express NVM Command Set Specification), within a cache, within deallocated logical blocks, etc.). |\n| | <table><tbody><tr><th>Value</th><th>Definition</th></tr><tr><td>000b</td><td>No secure erase operation requested</td></tr><tr><td>001b</td><td>User Data Erase: All user data shall be erased, contents of the media allocated for user data after the erase is indeterminate (e.g., the user data may be zero filled, one filled, etc.). If a User Data Erase is requested and all affected user data is encrypted, then the controller is allowed to use a cryptographic erase to perform the requested User Data Erase.</td></tr><tr><td>010b</td><td>Cryptographic Erase: All user data shall be erased cryptographically. This is accomplished by deleting the encryption key.</td></tr><tr><td>011b to 111b</td><td>Reserved</td></tr></tbody></table> |\n| 08 | Protection Information Location (PIL): I/O Command Set specific definition.¹ |\n| 07:05 | Protection Information (PI): I/O Command Set specific definition.¹ |\n| 04 | Metadata Settings (MSET): I/O Command Set specific definition.¹ |\n| | |\n| 03:00 | LBA Format Lower (LBAFL): This field specifies the least significant 4 bits of the Format Index of the User Data Format to apply to the NVM media. This corresponds to the User Data Formats indicated in the Identify Namespace data structure, refer to the Identify Namespace data structure and the I/O Command Set specific data structure in the applicable NVM Express I/O Command Set specification. If an unsupported User Data Format is selected, the controller shall abort the command with a status code of Invalid Format.<br><br>Note: This field applies to all User Data Formats. The original name has been retained for historical continuity. |\n| | |\n| | Note: 1. I/O Command Set specific fields are described in the applicable NVM Express I/O Command Set specification. |"
      }
    ],
    "figures": []
  },
  "statistics": {
    "table_count": 2,
    "figure_count": 0
  }
}