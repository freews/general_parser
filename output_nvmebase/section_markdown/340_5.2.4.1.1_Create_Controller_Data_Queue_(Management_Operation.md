###### 5.2.4.1.1 Create Controller Data Queue (Management Operation 0h)

> **Section ID**: 5.2.4.1.1 | **Page**: 213-215

The Create Controller Data Queue management operation of the Controller Data Queue command is used
to create a queue in host memory to which a controller posts the information specified by the Queue Type
field (refer to Figure 169).
The Create Controller Data Queue management operation uses the PRP Entry 1 field, Command Dword
11 field, and Command Dword 12 field.
If a PRP List is provided to describe the Controller Data Queue, then the PRP List shall be maintained by
the host at the same location in host physical memory and the values in the PRP List shall not be modified
until the Controller Data Queue is deleted (refer to section 5.2.4.1.2) or the controller is reset. If the PRP
List values are modified, then the behavior is undefined.
If the number of memory ranges specified by the PRP Entry 1 field is greater than the value defined by the
Maximum CDQ Memory Ranges (MCMR) field in the Identify Controller data structure (refer to Figure 328),
then the controller shall abort the command with a status code of Invalid Field in Command.
If the number of memory ranges specified by the PRP Entry 1 field plus the number of memory ranges that
exists for all of the Controller Data Queues in the NVM subsystem is greater than the value defined by the
NVM Subsystem Maximum Controller CDQ Memory Ranges (NMCMR) field in the Identify Controller data
structure (refer to Figure 328), then the controller shall abort the command with a status code of Invalid
Field in Command.
If the current number of User Data Migration Queues that exist in the controller is equal to the value in the
Maximum Controller User Data Migration Queues (MCUDMQ) field in the Identify Controller data structure,
then the controller shall abort the command with a status code of Invalid Field in Command.
If the current number of User Data Migration Queues that exist in the NVM subsystem is equal to the value
in the Maximum NVM Subsystem User Data Migration Queues (MNSUDMQ) field in the Identify Controller
data structure, then the controller shall abort the command with a status code of Invalid Field in Command.
If the Controller Data Queue Size field value is not a multiple of the size of the entries for the type of
Controller Data Queue as specified by the Queue Type field (refer to Figure 169), then the controller shall
abort the command with a status code of Invalid Field in Command.
The Management Operation Specific field (refer to Figure 165) for the Create Controller Data Queue
management operation is specified in Figure 169.
If the PRP Entry 1 field has a non-zero PRP offset, then the controller shall abort the command with a status
code of PRP Offset Invalid.


---
### ðŸ“Š Tables (2)

#### Table 1: Table_5_2_4_1_1_Create_Controller_Data_Queue_Management_Operation_0h_1
![Table_5_2_4_1_1_Create_Controller_Data_Queue_Management_Operation_0h_1](../section_images/Table_5_2_4_1_1_Create_Controller_Data_Queue_Management_Operation_0h_1.png)

| Bits | Description |
| :--- | :--- |
| 63:00 | PRP Entry 1 (PRP1): If the PC bit is set to '1', then this field specifies a 64-bit base host memory (refer to section 1.5.47) address pointer of the Controller Data Queue that is physically contiguous. The address pointer is memory page aligned (based on the value in CC.MPS field) unless otherwise specified. If the PC bit (refer to Figure 167) is cleared to '0', then this field specifies a PRP List pointer that describes the list of pages that constitute the Controller Data Queue. The list of pages is host memory (refer to section 1.5.47) that is page aligned (based on the value in CC.MPS field) unless otherwise specified. In both cases the PRP Entry shall have an offset of 0h. In a non-contiguous Controller Data Queue, each PRP Entry in the PRP List shall have an offset of 0h. If there is a PRP Entry with a non-zero offset, then the controller shall return an error of PRP Offset Invalid.<br>If the memory specified by this field is not host memory (e.g., CMB or PMR), then the controller shall abort the command with a status code of Invalid Field in Command. |
| Bits | Description |
| 31:16 | Create Queue Specific (CQS): The definition of this field is specific to the type of queue being created (refer to Queue Type (QT) field in Figure 169). If the type of queue being created does not define the use of this field, then this field is reserved. |
| 15:01 | Reserved |
| 00 | Physically Contiguous (PC): If set to '1', then the Controller Data Queue is physically contiguous and PRP Entry 1 (PRP1) is the address of a contiguous physical buffer. If cleared to '0', then the Controller Data Queue is not physically contiguous and PRP Entry 1 (PRP1) is a PRP List pointer. |
| Bits | Description |
| 31:00 | Controller Data Queue Size (CDQSIZE): This field specifies the size of the queue to be created in dwords. |


#### Table 2: Table_5_2_4_1_1_Create_Controller_Data_Queue_Management_Operation_0h_2
![Table_5_2_4_1_1_Create_Controller_Data_Queue_Management_Operation_0h_2](../section_images/Table_5_2_4_1_1_Create_Controller_Data_Queue_Management_Operation_0h_2.png)

| Bits | Description |
| :--- | :--- |
| 15:08 | Reserved |
| | |
| Bits | Description |
| 07:00 | Queue Type (QT): This field specifies the type of queue to be created which defines the information that the controller posts into the entries of the queue. |
| | | | | |
| | | **Value** | **Definition** | **Reference Section** |
| | | 0h | User Data Migration Queue | 5.2.4.1.1.1 |
| | | 1h to BFh | Reserved | |
| | | C0h to FFh | Vendor Specific | |

