###### 9.6.3.2.3 State-Dependent Retry Commands

> **Section ID**: 9.6.3.2.3 | **Page**: 772-772

An outstanding command is a State-Dependent Retry command if the command changes user data or NVM
subsystem state, and the command:
a) is not an idempotent command (refer to section 9.6.3.1); or
b) changes user data or NVM subsystem state in a way that is able to affect the behavior of other
hosts.
A host should not retry an outstanding command that is a State-Dependent Retry command without first
determining that command retry is the appropriate recovery action. This is because retrying such a
command may have different results than the original command, duplicate the results of the original
command, or affect the behavior of other hosts in a different manner than the original command. In general,
determination of the appropriate recovery action is only able to be performed by higher-level software (e.g.,
an associated application, filesystem or database) that is able to determine the extent, if any, to which the
outstanding command has been processed and enforce ordering requirements among commands (refer to
section 3.4.1).
A host should treat an outstanding command that is a State-Dependent Retry command as having
command ordering requirements enforced by higher-level software with respect to other commands (refer
to section 3.4.1). Hence, for any such command, a host should not report completion or error status,
including errors caused by communication loss, to higher-level software (e.g., an associated application, a
filesystem or database), until the host has determined that no further controller processing of the
outstanding command and retries, if any, of that command is possible. If a host violates this
recommendation, corruption of user data or unintended changes to NVM subsystem state are possible;
refer to Annex B.6.2 for an example where unintended changes occur to NVM subsystem state.
A host that does not adhere to the recommendations in this section for handling outstanding commands
that are State-Dependent Retry commands risks causing corruption of user data and unintended changes
to NVM subsystem state. It is strongly recommended that host NVMe implementations adhere to these
recommendations to avoid these outcomes.
