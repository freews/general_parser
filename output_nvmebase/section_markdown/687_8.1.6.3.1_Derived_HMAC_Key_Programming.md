###### 8.1.6.3.1 Derived HMAC Key Programming

> **Section ID**: 8.1.6.3.1 | **Page**: 569-570

A host is able to provide a host-programmed key to the controller that the controller uses to generate the
Derived HMAC Key (DHK). The host-programmed key is specified by submitting a Security Send command,
subsequently followed by a Security Receive command to retrieve the result of the DHK programming
operation.
The size of the key is dependent on the Authentication Algorithm used and the desired security strength
(e.g., for HMAC-SHA-384, the Derived HMAC Key (DHK) length is 32 bytes, as specified in Figure 642, to
provide a security strength comparable to AES-256, refer to NIST SP 800-57 Part 1 Revision 5).
If the size of the key is not specified or not supported by the authentication method, then the controller shall
abort the Security Send command with a status code of Invalid Field in Command.
If the authentication algorithm specified in the CDP Request Data Frame is not supported by the controller,
then the controller shall abort the Security Send command with a status code of Invalid Field in Command.
The Security Send command contains a CDP Request Data Frame (refer to Figure 630) that specifies:
â€¢
a CDP Request Message Type value of 03h (i.e., Derived HMAC Key Programming Request); and
â€¢
CDP Derived HMAC Key Programming Request Data (refer to Figure 636).
The controller shall use the key specified by the host to derive the DHK that is unique to the NVM subsystem
and securely store it for subsequent usage (refer to section 8.1.6.3.1.1).
Once the controller returns a successful completion of the Security Send command, then the host should
check the result of the Derived HMAC Key Programming request by submitting a Security Receive
command. The controller returns a successful completion of the Security Receive command and returns a
CDP Response Data Frame (refer to Figure 631) that indicates:
â€¢
a Response Message Type with a value of 04h (i.e., Derived HMAC Key Programming Response);
and
â€¢
CDP Derived HMAC Key Programming Response Data (refer to Figure 637).
The derived HMAC key programming flow is described in Figure 640.


---
### ðŸ“Š Tables (1)

#### Table 1: Table_8_1_6_3_1_Derived_HMAC_Key_Programming
![Table_8_1_6_3_1_Derived_HMAC_Key_Programming](../section_images/Table_8_1_6_3_1_Derived_HMAC_Key_Programming.png)

| Command | Bytes in Command | Field Name | Value | Objective |
| :--- | :--- | :--- | :--- | :--- |
| | | **Data populated by the host and sent to the controller** | | |
| | | **Header** | | |
| | 00 | Request Data Frame Version | 0h | |
| | 01 | Data Frame Header Length | 4h | |
| | 03:02 | Request Data Frame Size | 6h | |
| | | **Common Payload** | | |
| Security Send 1 | 04 | CDP Request Message Type | 3h (Derived HMAC Key Programming Request) | Derived HMAC Key Programming Request |
| | 05 | Request Data Size | The size of the CDP Request Data | |
| | | **CDP Request Data** | | |
| | 06 | CDP Authentication Algorithm | The requested authentication algorithm | |
| | 07 | Host Programmed Key Size | Size of the host-programmed key | |
| | Variable | Host Programmed Key | Value of the key to be used to derive the DHK | |
| | | **Data populated by the controller and returned to the host** | | |
| | | **Header** | | |
| | 00 | Response Data Frame Version | 0h | |
| | 01 | Data Frame Header Length | 4h | |
| | 03:02 | Response Data Frame Size | 7h | |
| | | **Response Common Payload** | | |
| Security Receive 1 | 04 | CDP Response Message Type | 4h (Derived HMAC Key Programming Response) | Retrieve Derived HMAC Key Programming Request Result |
| | 05 | Result Code | Result Code | |
| | 06 | Response Data Size | 0h | |

