#### 3.6.2 Message-based Controller Shutdown (Fabrics)

> **Section ID**: 3.6.2 | **Page**: 138-139

To initiate a shutdown of a controller, the host should use the Property Set command (refer to section 6.6)
to set the Shutdown Notification (CC.SHN) field to:
•
01b to initiate a normal shutdown operation; or
•
10b to initiate an abrupt shutdown operation.
After the host initiates a controller shutdown, the host may either disconnect at the NVMe Transport level
or the host may choose to poll CSTS.SHST to determine when the controller shutdown is complete (i.e.,
the controller should not initiate a disconnect at the NVMe Transport level). It is an implementation choice
whether the host aborts all outstanding commands prior to initiating the shutdown.
If the host is no longer able to communicate with the controller before that host receives either:
•
completions for all outstanding commands submitted to that controller (refer to section 3.4.5); or
•
a CSTS.SHST field value that indicates that the controller shutdown is complete,
then it is strongly recommended that the host take the steps described in section 9.6 to avoid possible data
corruption caused by interaction between outstanding commands and subsequent commands submitted
by that host to another controller.
The CC.EN field is not used to shutdown the controller (i.e., it is used for Controller Reset, refer to section
3.7.2.1).
From the time a controller shutdown is initiated until:
•
a Controller Level Reset occurs; or
•
the controller, if dynamic, is removed from the NVM subsystem,
the controller shall:
•
process only Fabrics commands (refer to Figure 574); and
•
disable the Keep Alive timer, if supported.
To start executing commands on the controller after that controller reports controller shutdown processing
complete (i.e., the CSTS.ST bit is cleared to ‘0’ and the CSTS.SHST field is set to 10b) utilizing the CC.EN
bit:
•
if the CC.EN bit is set to ‘1’, then a Controller Level Reset is required to clear the CC.EN bit to ‘0’
on that controller and the CC.EN bit is subsequently required to be set to ‘1’ as part of the
initialization sequence (refer to section 3.5); and
•
if the CC.EN bit is cleared to ‘0’, then:
a Controller Level Reset is required and the CC.EN bit is subsequently required to be set
to ‘1’ as part of the initialization sequence (refer to section 3.5); or
the CC.EN bit is required to be set to ‘1’ and the CC.SHN field is required to be cleared to
00b with a single Property Set command (refer to section 6.6) that changes the CC property
(refer to Figure 41). The controller clears the CSTS.SHST field to 00b in response to that
write.
The initialization sequence (refer to section 3.5) should then be executed on that controller.
