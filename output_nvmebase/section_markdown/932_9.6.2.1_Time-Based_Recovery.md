##### 9.6.2.1 Time-Based Recovery

> **Section ID**: 9.6.2.1 | **Page**: 768-769

For Time-Based Recovery, the host performs the following steps:
1. For message-based transports, terminate the association and the associated transport
connections. This step is skipped for memory-based transports.
2. Determine that the controller has detected a loss of communication using at least one of the
following methods:
a. If the controller uses Command Based Keep Alive (refer to section 3.9.3.1), wait at least
until 2 * KATT (refer to section 3.9) from the time the host submitted the most recent Keep
Alive Command to the controller.
b. If the controller uses Traffic Based Keep Alive (refer to section 3.9.4.1), wait at least until
3 * KATT from the time the host submitted the most recent command to the controller.
c. If another controller of the same NVM subsystem supports the Cross-Controller Reset log
page (refer to section 5.2.12.3.1) and the host has initiated Cross-Controller Reset
Recovery for this controller via that other controller, read the Cross-Controller Reset log
page on that other controller. Controller detection of a loss of communication is indicated
by an entry, if any, in that log page that contains:
i.
the controller ID of this controller;
ii.
the value of the Controller Instance Uniquifer (CIU) field that is the same as the
value of CIU field for the Identify Controller data structure for this controller;
iii.
the Cross-Controller Reset Status field with a value of Failed; and
iv.
the Controller Level Reset Initiated bit set to ‘1’.
d. If another controller of the same NVM subsystem supports the Lost Host Communication
log page (refer to section 5.2.12.3.2), read the Lost Host Communication log page on that
other controller. Controller detection of loss of communication is indicated by an entry, if
any, in that log page that contains the controller ID of this controller and the value of the
CIU field that is the same as the value of the CIU field in the Identify Controller data
structure for this controller.
e. Receive a transport-specific notification for determining that the controller has terminated
an NVMe Transport connection or detected a loss of communication (e.g., a fabric
notification or a PCIe surprise link down error notification for a PCIe link that directly
connects a host to an NVM subsystem (e.g., an SSD)).
3. Wait for additional sufficient time to ensure that the controller has stopped processing commands
using one of the following:
a. If the CQT field (refer to Figure 328) is non-zero, wait for the amount of time indicated in
the CQT field to elapse; or
b. If the CQT field is cleared to 0h, wait for an implementation specific amount of time (e.g.,
10 seconds). The host should allow this value to be administratively configured.
The specification of the times to wait to ensure that the controller has detected a Keep Alive Timeout
described in this section (i.e., 2 * KATT and 3 * KATT) assumes that the transport delays any command by
at most one KATT. Once the last command is fetched by the controller, the controller is required to detect
a Keep Alive Timeout after at most a further 1 * KATT for Command Based Keep Alive and at most 2 *
KATT for Traffic Based Keep Alive (refer to Figure 90). The sum of the two delays (i.e., the transport delay
and the delay to detect the Keep Alive timeout) is 2 * KATT for Command Based Keep Alive and 3 * KATT
for Traffic Based Keep Alive.
