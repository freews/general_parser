##### 8.1.11.1 Flexible Data Placement Overview

> **Section ID**: 8.1.11.1 | **Page**: 593-596

The Flexible Data Placement (FDP) capability is an optional capability which allows the host to reduce write
amplification by aligning user data usage to physical media. The controller supports log pages which
indicate the status of FDP, statistics about the FDP operation, and information the host uses to detect and
correct usage patterns that increase write amplification.
The scope of the Flexible Data Placement capability is an Endurance Group.
The host enables or disables Flexible Data Placement by issuing a Set Features command specifying the
Flexible Data Placement feature (refer to section 5.2.26.1.20) and the FDP configuration (refer to section
5.2.12.1.29) to be applied to an Endurance Group. The host is required to delete all namespaces associated
with the specified Endurance Group before modifying the value of the Flexible Data Placement feature
(e.g., transitioning from disabled to enabled).
If a Set Features command specifies:
‚Ä¢
the Flexible Data Placement feature;
‚Ä¢
an Endurance Group in which one or more namespaces exist; and
‚Ä¢
a different value from the current value of that feature for that Endurance Group,
then the controller shall abort the command with a status code of Command Sequence Error.
If a Set Features command is successful and changes the Feature value, then:
‚Ä¢
all events in the FDP Events log page (refer to section 5.2.12.1.32) are cleared; and
‚Ä¢
all fields in the FDP Statistics log page (refer to section 5.2.12.1.31) are cleared to 0h.
Refer to section 3.2.4 for the logical view of the non-volatile storage capacity for the Endurance Group with
Flexible Data Placement enabled.
The Namespace Management command (refer to section 8.1.16) is used to create a namespace within the
Endurance Group. All namespaces in an Endurance Group with Flexible Data Placement enabled shall be
associated with the NVM Command Set (refer to Figure 327) (i.e., the Command Set Identifier (CSI) field
in the Namespace Management command shall be cleared to 00h). The capacity for the user data stored
by a write command to a namespace is allocated from the Reclaim Unit referenced by the Reclaim Unit
Handle and Reclaim Group specified by that write command. The user data for a namespace is allowed to
be in any stored Reclaim Unit within any Reclaim Group within the Endurance Group (refer to Figure 15).
The Namespace Management command specifies a Placement Handle List (refer to the Namespace
Management command in the applicable NVM Express I/O Command Set specification). Each entry in that
list specifies the Reclaim Unit Handle associated with the Placement Handle for that entry. The Placement
Handles are numbered from 0h to the number of entries in the list minus 1. Figure 664 shows an example
where Namespace A associates Reclaim Unit Handle 1 with Placement Handle 0. A specific Reclaim Unit
Handle is not allowed to be associated with more than one Placement Handle per namespace. There are
no other requirements on which Reclaim Unit Handle is associated with which Placement Handle.
Namespaces are allowed to utilize the same (i.e., share) Reclaim Unit Handle but may have restrictions
defined in the applicable NVM Express I/O Command Set specification.
The host is required to enable the Data Placement Directive (refer to section 8.1.9.4) to submit write
commands that specify a Placement Identifier (refer to Figure 289 and Figure 290) in the DSPEC field. That
Placement Identifier uniquely specifies the Reclaim Unit in which to place the user data (refer to Figure
664). The controller determines the Reclaim Unit by using the Reclaim Unit Handle associated with the
Placement Handle that was specified by the host when the namespace was created. For example, if the
write command in Figure 664 specifies a Reclaim Group Identifier value of 2h and a Placement Handle
value of 1h, then the host is targeting the user data for that write command to be placed into the Reclaim
Unit associated with Reclaim Group 2h and Reclaim Unit Handle NRUH-1.
A Placement Identifier is invalid if:
‚Ä¢
the Reclaim Group Identifier value is greater than or equal to the number of Reclaim Groups
supported by the enabled FDP configuration (refer to the NRG field in Figure 287); or
‚Ä¢
the Placement Handle is greater than or equal to the number of Placement Handles supported by
the Namespace Management command of the applicable NVM Express I/O Command Set
specification.
If the Placement Identifier in the DSPEC field of a write command is invalid, then the controller shall:
‚Ä¢
select the Reclaim Group and Reclaim Unit Handle accessible by the specified namespace to
determine the placement of the user data for that write command; and
‚Ä¢
generate an Invalid Placement Identifier FDP Event if that event is enabled for the selected Reclaim
Unit Handle. To receive the FDP event, the host should enable the Invalid Placement Identifier FDP
Event on all Reclaim Unit Handles.
Any write command to a namespace that exists in an Endurance Group with Flexible Data Placement
enabled that does not specify the Data Placement Directive uses the Placement Handle value 0h and the
controller selects the Reclaim Group for that command. For example, if the write command does not specify
the Data Placement Directive, then, as illustrated in Figure 664, Placement Handle value of 0h is associated
with Reclaim Unit Handle 1h and the controller may place the user data into the Reclaim Unit associated
any Reclaim Group using Reclaim Unit Handle 1h.
A write command that places user data into a Reclaim Unit causes reduction of the remaining capacity of
that Reclaim Unit. If that Reclaim Unit is written to capacity, then the controller modifies the Reclaim Unit
Handle referencing that Reclaim Unit to reference a different Reclaim Unit within the same Reclaim Group.
A controller may modify a Reclaim Unit Handle to reference a different Reclaim Unit as part of performing
a sanitize operation (refer to section 8.1.26).
A Reclaim Unit shall only be referenced by one Reclaim Unit Handle. Therefore, a write command that
utilizes a Reclaim Unit Handle results in the user data from that write command being initially isolated from
the user data from any other write command that utilizes a different Reclaim Unit Handle. Each Reclaim
Unit Handle has a type as defined in Figure 288 that identifies the isolation requirements of the user data
moved by the controller to a different Reclaim Unit due to vendor specific controller operations (e.g.,
garbage collection).
A controller is allowed to move user data that was written by the host that utilized a Reclaim Unit Handle
with an Initially Isolated type (Figure 288) to a different Reclaim Unit within the same Reclaim Group. In
addition, the controller is allowed to move user data written by the host that utilized different Reclaim Unit
Handles with an Initially Isolated type to that different Reclaim Unit within the same Reclaim Group as
shown in Figure 665.
A controller is allowed to move user data that was written by the host that utilized a Reclaim Unit Handle
with a Persistently Isolated type (Figure 288) to a different Reclaim Unit within the same Reclaim Group.
However, the controller shall only move user data written by the host that utilized the same Reclaim Unit
Handles with a Persistently Isolated type to the different Reclaim Unit within the same Reclaim Group as
shown in Figure 666.
The result of a Namespace Management command that creates a namespace within the Endurance Group
is that at least one Placement Handle is defined for that namespace (refer to the Namespace Management
section in applicable NVM Express I/O Command Set specification).
For any namespace created in an Endurance Group that has Flexible Data Placement enabled, the host
may issue an I/O Management Receive command to obtain a list of Placement Handles and the associated
Reclaim Unit Handles that are used by the Data Placement Directive in write commands.
If the Flexible Data Placement capability is supported, then the controller shall support the following:
a) the Feature Identifiers Supported and Effects log page (refer to section 5.2.12.1.18);
b) the I/O Management Receive command (refer to section 7.3) and the Reclaim Unit Handle Status
Management Operation in that command (refer to Figure 595);
c) the I/O Management Send command (refer to section 7.4) and the Placement Identifier Update
Management Operation in that command (refer to Figure 599);
d) the Flexible Data Placement feature (refer to section 5.2.26.1.20);
e) the FDP Configurations log page (refer to section 5.2.12.1.29);
f)
the Reclaim Unit Handle Usage log page (refer to section 5.2.12.1.30);
g) the FDP Statistics log page (refer to section 5.2.12.1.31);
h) the Flexible Data Placement Events feature (refer to section 5.2.26.1.21);
i)
the FDP Events log page (refer to section 5.2.12.1.32); and
j)
the Data Placement Directive (refer to section 8.1.9.4).


---
### üñºÔ∏è Figures (3)

#### Figure 1: Figure 664: Flexible Data Placement Model
![Figure 664: Flexible Data Placement Model](../section_images/Figure_8_1_11_1_Flexible_Data_Placement_Overview_1.png)


#### Figure 2: Figure 665: Initially Isolated Reclaim Unit Handles
![Figure 665: Initially Isolated Reclaim Unit Handles](../section_images/Figure_8_1_11_1_Flexible_Data_Placement_Overview_2.png)


#### Figure 3: Figure 666: Persistently Isolated Reclaim Unit Handle
![Figure 666: Persistently Isolated Reclaim Unit Handle](../section_images/Figure_8_1_11_1_Flexible_Data_Placement_Overview_3.png)

