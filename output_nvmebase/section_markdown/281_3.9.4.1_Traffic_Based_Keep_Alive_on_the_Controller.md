##### 3.9.4.1 Traffic Based Keep Alive on the Controller

> **Section ID**: 3.9.4.1 | **Page**: 153-154

If the controller supports the Keep Alive Timer feature, then support for Traffic Based Keep Alive is indicated
by the TBKAS bit in the Controller Attributes field in the Identify Controller data structure (refer to Figure
328). If the Controller does not support Traffic Based Keep Alive (i.e., the TBKAS bit is cleared to ‘0’), then
the operation of the Keep Alive Timer feature is described in section 3.9.3.
For Traffic Based Keep Alive:
•
The controller shall start a Keep Alive Timeout Interval if the Keep Alive Timer becomes active
(refer to section 3.9.2).
•
The controller shall consider a Keep Alive Timeout to have occurred if:
o
the Keep Alive Timer is active;
o
KATT has elapsed since the start of the most recent Keep Alive Timeout Interval; and
o
no Admin command or I/O command was fetched by the controller during the Keep Alive
Timeout Interval.
•
The controller shall end a Keep Alive Timeout Interval and:
o
not start a new Keep alive Timeout Interval if:
▪
a Keep Alive Timeout occurs; or
▪
the Keep Alive Timer becomes inactive (refer to section 3.9.2).
o
start a new Keep Alive Timeout Interval if the Keep Alive Timer is active, and:
▪
a Keep Alive command completes successfully;
▪
a Set Features command specifying the Keep Alive Timer feature and a non-zero
KATO field (refer to section 5.2.26.1.8) completes successfully; or
▪
KATT has elapsed since the start of the Keep Alive Timeout Interval and a Keep
Alive Timeout did not occur during the Keep Alive Timeout Interval (e.g., an Admin
command or an I/O command was fetched by the controller during the Keep Alive
Timeout Interval).
Upon the occurrence of a Keep Alive Timeout, the controller shall perform the cleanup actions described in
section 3.9.5.
A controller using Traffic Based Keep Alive may require up to 2 * KATT after the controller fetches the most
recent command to detect a Keep Alive Timeout as shown in Figure 90.
Figure 90 shows that periodic check 3, not periodic check 2, detects the Keep Alive Timeout. Therefore,
the time between fetching the most recent command and the check that detects the timeout (i.e., periodic
check 3 in Figure 90) is up to 2 * KATT.
