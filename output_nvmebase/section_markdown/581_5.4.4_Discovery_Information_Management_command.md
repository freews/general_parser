#### 5.4.4 Discovery Information Management command

> **Section ID**: 5.4.4 | **Page**: 492-499

The Discovery Information Management command registers, de-registers, or updates discovery information
entries.
The type of task performed by the Discovery Information Management command (i.e., registration, de-
registration, or update) is determined by the value set in Task (TAS) field of Command Dword 10 (refer to
Figure 530).
For a register task (i.e., TAS field cleared to 0h), the Discovery Information Management command
registers:
â€¢
one or more host discovery information entries; or
â€¢
one or more NVM subsystem discovery information entries.
For a de-register task (i.e., TAS field set to 1h), the Discovery Information Management command de-
registers:
â€¢
one or more host discovery information entries; or
â€¢
one or more NVM subsystem discovery information entries.
For an update task (i.e., TAS field set to 2h), the Discovery Information Management command updates:
â€¢
one host discovery information entry; or
â€¢
one NVM subsystem discovery information entry.
Discovery information entries may be one of the following:
â€¢
a basic discovery information entry (refer to Figure 310); or
â€¢
an extended discovery information entry (refer to Figure 532).
Host discovery information entries shall be extended discovery information entries.
NVM subsystem discovery information entries may be basic discovery information entries or may be
extended discovery information entries. Each NVM subsystem discovery information entry may specify an
NVM subsystem that exposes namespaces that hosts may access or may specify a referral to another
Discovery subsystem.
The Discovery Information Management command uses the Data Pointer field as shown in Figure 529 and
Command Dword 10 as shown in Figure 530. All other command specific fields are reserved.
The data portion of the Discovery Information Management command contains a header that identifies the
entity performing the register, de-register, or update task.
If a register task is being performed and the data portion of the Discovery Information Management
command does not contain one or more discovery information entries, then the controller shall abort the
command with status code of Invalid Field in Command. If the number of discovery information entries
contained in the data portion of the Discovery Information Management command exceeds the available
capacity for new discovery information entries on the CDC or DDC, then the controller shall abort the
command with a status code of Insufficient Discovery Resources. If multiple register tasks are performed
by the same entity (i.e., the value set in the Entity Identifier (EID) field of the header is associated with an
existing registration record contained in the CDC or DDC), and:
a) the Entry Key associated with a discovery information entry in the Discovery Information
Management command matches the Entry Key associated with an existing registration record, then
the existing registration record contained in the CDC or DDC shall be updated with the discovery
information entry from the Discovery Information Management command; or
b) the Entry Key associated with a discovery information entry in the Discovery Information
Management command does not match the Entry Key associated with an existing registration
record, then the discovery information entry in the Discovery Information Management command
shall be registered with the CDC or DDC.
If a de-register task is being performed and the data portion of the Discovery Information Management
command does not contain one or more discovery information entries, then the controller shall abort the
command with a status code of Invalid Field in Command.
If an update task is being performed and the data portion of the Discovery Information Management
command does not contain two discovery information entries, then the controller shall abort the command
with a status code of Invalid Field in Command. The first discovery information entry identifies the
registration record contained in the CDC or DDC that is to be updated. The fields in the first discovery
information entry that are not used as part of the Entry Key are ignored. The second discovery information
entry replaces the existing registration record identified by the Entry Key from the first discovery information
entry. The update task shall be atomic.
The format for the data portion of the Discovery Information Management command is defined in Figure
531.
Based upon the value set in the Entity Type (ETYPE) field of the header, the data portion of a Discovery
Information Management command shall:
â€¢
only contain host extended discovery information entries if the ETYPE field is set to 1h (i.e., a host
is performing the register, de-register, or update task);
â€¢
only contain host extended discovery information entries if the ETYPE field is set to 3h (i.e., a CDC
is performing the register, de-register, or update task); and
â€¢
only contain NVM subsystem basic discovery information entries or NVM subsystem extended
discovery information entries if the ETYPE field is set to 2h (i.e., a DDC is performing the register,
de-register, or update task). The DDC may set the Port Local (PORTLCL) field to 1h if the NVM
subsystem discovery information entries being registered, de-registered, or updated are only for
NVM subsystem ports that are presented through the same NVM subsystem port on the DDC that
is performing the register, de-register, or update task.
Host extended discovery information entries and NVM subsystem extended discovery information entries
each contain the same set of fields, but not all of the fields are used for both extended discovery information
entry types. Refer to Figure 534 for the usage of the extended discovery information entry fields for each
extended discovery information entry type. If the entity performing a register, de-register, or update task
uses any field in an extended discovery information entry that conflicts with the value set in the ETYPE field
of the Discovery Information Management command data portionâ€™s header (e.g., a host uses a field
intended for only NVM subsystem extended discovery information entries), then the controller shall abort
the command with a status code of Invalid Discovery Information.
Host extended discovery information entries shall contain at least one extended attribute containing a Host
Identifier. NVM subsystem extended discovery information entries may contain zero or more extended
attributes. The format for an extended attribute is defined in Figure 533.


---
### ðŸ“Š Tables (1)

#### Table 1: Table_5_4_4_Discovery_Information_Management_command
![Table_5_4_4_Discovery_Information_Management_command](../section_images/Table_5_4_4_Discovery_Information_Management_command.png)

| Bytes | O/MÂ¹ | Description |
| :--- | :--- | :--- |
| 127:00 | | **Data Pointer (DPTP):** This field specifies the start of the data buffer. Refer to Figure 92 for the definition of this field. |
| 31:04 | Reserved | |
| 03:00 | | **Task (TAS):** This field selects the type of management task to perform. |
| | | | **Value** | **Definition** |
| | | | 0h | Reserved |
| | | | 1h | De-Register |
| | | | 2h | Update |
| | | | 3h to Fh | Reserved |
| | | | | |
| **Bytes** | **O/MÂ¹** | **Description** | **Header** |
| 03:00 | M | **Total Data Length (TDL):** This field specifies the length in bytes of the entire data portion of this field. | |
| 07:04 | | | |
| 15:08 | M | **Number of Entries (NUMENT):** This field specifies the number of discovery information entries being registered, de-registered, or updated. For a register or de-register task, this field shall be non-zero. For an update task, this field shall be set to 2h. | |
| 17:16 | M | **Entry Format (ENTFMT):** This field specifies the format of the discovery information entries being registered, de-registered, or updated. | |
| | | | **Value** | **Definition** |
| | | | 0h | Reserved |
| | | | 1h | Basic discovery information entry |
| | | | 2h | Extended discovery information entry |
| | | | 3h to FFFFh | Reserved |
| 19:18 | M | **Entity Type (ETYPE):** This field specifies the type of entity performing the register, de-register, or update task. | |
| | | | **Value** | **Definition** |
| | | | 0h | Reserved |
| | | | 1h | Host |
| | | | 2h | Direct Discovery controller |
| | | | 3h | Centralized Discovery controller |
| | | | 4h to FFFFh | Reserved |
| 20 | OÂ² | **Port Local (PORTLCL):** This field specifies if the NVM subsystem discovery information entries being registered, de-registered, or updated are only for NVM subsystem ports that are presented through the same NVM subsystem port on the DDC that is performing the register, de-register, or update task. If the Entity Type (ETYPE) field is set to any value other than 2h (i.e., an entity other than a DDC is performing the register, de-register, or update task) and this field is not cleared to 0h, then the controller shall abort the command with a status code of Invalid Field in Command. <br> If this field is set to 1h, then the NVM subsystem discovery information entries being registered, de-registered, or updated are only for NVM subsystem ports that are presented through the same NVM subsystem port on the DDC that is performing the register, de-register, or update task. <br> If this field is cleared to 0h, then the NVM subsystem discovery information entries being registered, de-registered, or updated may be for NVM subsystem ports that are presented through any NVM subsystem port on that DDC. | |
| 21 | Reserved | | |
| | | | |
| **Bytes** | **O/MÂ¹** | **Description** | |
| 23:22 | M | **Entity Key Type (EKTYPE):** This field specifies the fields in each discovery information entry that shall be used to determine if the entry matches an existing registration record contained in the CDC or DDC. Host discovery information entries shall use an EKTYPE of 5Fh (i.e., TRADDR Based). NVM subsystem discovery information entries may use an EKTYPE of either 3Fh (i.e., Port ID Based) or 5Fh (i.e., TRADDR Based). All other values are reserved. | |
| | | | **Bits** | **Description** | **Port ID Based (3Fh)** | **TRADDR Based (5Fh)** |
| | | | 15:7 | Reserved | Not used | Not used |
| | | | 6 | Transport Address (TRADDR) | | Used |
| | | | 5 | Port ID (PORTID) | Used | Not used |
| | | | 4 | Transport Type (TRTYPE) | | |
| | | | 3 | Address Family (ADRFAM) | | |
| | | | 2 | Transport Service Identifier (TRSCVID) | Used | Used |
| | | | 1 | Transport Specific Address Subtype (TASAS) | | |
| | | | 0 | NVMe Qualified Name (NQN) | | |
| 279:24 | M | **Entity Identifier (EID):** This field specifies a NQN that is used to uniquely identify the entity performing the registration, de-registration, or update task within the fabric in UUID-based format. Refer to section 4.7 for the formatting requirements of UUID-based format NQNs. | |
| 535:280 | O | **Entity Name (ENAME):** This field specifies the name associated with the entity as an ASCII string (refer to section 1.4.2 for ASCII string requirements). The value specified in this field is determined by the value set in the Entity Type (ETYPE) field. <br> If the ETYPE field is set to 1h (i.e., a host is performing the register, de-register, or update task), then this field specifies the name associated with the host. <br> If the ETYPE field is set to 2h (i.e., a DDC is performing the register, de-register, or update task), then this field specifies the name associated with the DDC. <br> If the ETYPE field is set to 3h (i.e., a CDC is performing the register, de-register, or update task), then this field specifies the name associated with the CDC. <br> If the ETYPE field is set to 1h (i.e., a host is performing the register, de-register, or update task), then this field specifies the Discovery controller entity version (e.g., currently active firmware revision of the DDC). <br> If the ETYPE field is set to 3h (i.e., a CDC is performing the register, de-register, or update task), then this field shall specify either: <br> a) the host entity version (e.g., host operating system name and version); or <br> b) the Discovery controller entity version (e.g., currently active firmware revision of the CDC). | |
| 599:536 | | | |
| 1023:600 | | | |
| | | | |
| **Bytes** | **O/MÂ¹** | **Description** | |
| (TEL - 1) + 1024: 1024 | M | **Discovery Information Entry List:** This field contains the first discovery information entry as defined in Figure 531 for extended discovery information entries and as defined in Figure 530 for basic discovery information entries, where TEL is the size specified in the Total Entry Length (TEL) field of the extended discovery information entry and TDL is the size specified in the Total Data Length (TDL) field. For basic discovery information entries, TEL shall be 1,024 bytes. | |
| | | | |
| **Bytes** | **O/MÂ¹** | **Description** | |
| 00 | M | **Transport Type (TRTYPE):** This field specifies the transport type as defined in the Transport Type (TRTYPE) field in Figure 310. | |
| 01 | M | **Address Family (ADRFAM):** This field specifies the address family as defined in the Address Family (ADRFAM) field in Figure 310. | |
| 02 | MÂ² | **Subsystem Type (SUBTYPE):** This field specifies the type of the NVM subsystem that is indicated in this entry as defined in the Subsystem Type (SUBTYPE) field in Figure 310. | |
| 03 | MÂ² | **Transport Requirements (TREQ):** This field specifies the transport requirements for the NVM subsystem as defined in the Transport Requirements (TREQ) field in Figure 310. | |
| 05:04 | MÂ² | **Port ID (PORTID):** This field specifies a particular NVM subsystem port as defined in the Port ID (PORTID) field in Figure 310. | |
| 07:06 | MÂ² | **Controller ID (CNTLID):** This field specifies the controller ID as defined in the Controller ID (CNTLID) field in Figure 310. | |
| 09:08 | MÂ² | **Admin Max SQ Size (ASQSZ):** This field specifies the maximum size of an Admin Submission Queue as defined in the Admin Max SQ Size (ASQSZ) field in Figure 310. | |
| 31:10 | Reserved | | |
| 63:32 | MÂ² | **Transport Service Identifier (TRSVCID):** This field specifies the NVM transport service identifier as defined in the Transport Service Identifier (TRSVCID) field in Figure 310. | |
| 255:64 | Reserved | | |
| 511:256 | M | **NVMe Qualified Name (NQN):** If the Entity Type (ETYPE) field in the Discovery Information Management command data portion's header is set to 2h (i.e., a DDC is performing the register, de-register, or update task), then this field specifies the NVMe Qualified Name (NQN) that uniquely identifies the NVM subsystem as defined in the NVMe Subsystem Qualified Name (SUBNQN) field in Figure 310. <br> If the ETYPE field in the Discovery Information Management command data portion's header is set to 1h or 3h (i.e., a host or CDC is performing the register, de-register, or update task), then this field specifies the host as defined in the Host NVMe Qualified Name (HOSTNQN) field in Figure 315. | |
| | | | |
| **Bytes** | **O/MÂ¹** | **Description** | |
| 767:512 | M | **Transport Address (TRADDR):** If the Entity Type (ETYPE) field in the Discovery Information Management command data portion's header is set to 1h or 3h (i.e., a host or CDC is performing the register, de-register, or update task), then this field specifies the address of a fabric interface on the NVM subsystem that may be used for a Connect command as an ASCII string as defined in the Transport Address (TRADDR) field in Figure 310. <br> If the first byte (i.e., byte 512) of this field is NULL (i.e., cleared to 00h), then the TRADDR value used by the controller shall be the remote IP address associated with the connection used to transport the Discovery Information Management command. If the host attempts to register or de-register multiple discovery information entries with the first byte of this field containing a NULL, then the controller shall abort the command with a status code of Invalid Field in Command. | |
| 1023:768 | M | **Transport Specific Address Subtype (TASAS):** This field specifies NVM transport specific information about the address as defined in the Transport Specific Address Subtype (TASAS) field in Figure 310. | |
| 1027:1024 | M | **Total Entry Length (TEL):** This field specifies the length in bytes of the entire extended discovery information entry. | |
| 1029:1028 | MÂ³ | **Number of Extended Attributes (NUMEXAT):** This field specifies the number of extended discovery information entries contained in the extended discovery information entry. <br> This field shall be set to a non-zero value (i.e., the extended discovery information entry shall contain at least one extended attribute) if the Entity Type (ETYPE) field in the Discovery Information Registration command data portion's header is set to 1h or 3h (i.e., a host or CDC is performing the register, de-register, or update task). If the ETYPE field is set to 1h or 3h and this field is cleared to 0h, then the controller shall abort the command with a status code of Invalid Field in Command. | |
| 1031:1030 | Reserved | | |
| | | | |
| **Bytes** | **O/MÂ¹** | **Description** | |
| ((EXATLEN - 1) + 4) + 1032: 1032 | MÂ³ | **Extended Attribute List:** This field contains the first extended attribute as defined in Figure 533 (if present), where EXATLEN is the size specified in the Extended Attribute Length (EXATLEN) field of the extended attribute. | |
| ... | O | | |
| TEL - 1: TEL - (EXATLEN + 4) | O | **Extended Attribute N:** This field contains the Nth extended attribute as defined in Figure 533 (if present), where EXATLEN is the size specified in the Extended Attribute Length (EXATLEN) field of the extended attribute and TEL is the size specified in the Total Entry Length (TEL) field. | |
| | | | |
| **Bytes** | **O/MÂ¹** | **Description** | |
| 01:00 | | **Extended Attribute Type (EXATTYPE):** This field specifies the type of extended attribute for the extended attribute contained in the extended discovery information entry. | |
| | | | **Value** | **O/MÂ¹** | **Definition** |
| | | | 0h | Reserved |
| | | | 1h | HM |
| | | | 2h | O |
| | | | 3h | O |
| | | | 4h to FEFh | Reserved |
| | | | F00h to FFFFh | O |
| 03:02 | | **Extended Attribute Length (EXATLEN):** This field specifies the length of the Extended Attribute Value (EXATVAL) field for the extended attribute contained in the extended discovery information entry. The length specified in this field shall be a non-zero value that is a multiple of four, and is either a fixed length or within a variable range based upon the value set in the Extended Attribute Type (EXATTYPE) field. If the length specified in this field is not a multiple of four, then the controller shall abort the command with a status code of Invalid Field in Command. | |
| | | | **Extended Attribute Type** | **Length** |
| | | | Host Identifier | 16 bytes |
| | | | Admin label ASCII | Used |
| | | | Admin label UTF-8 | 4 to 256 bytes |
| | | | Reserved | |
| | | | **Extended Attribute Value (EXATVAL):** This field specifies the value for the extended attribute contained in the extended discovery information entry. The value specified in this field is based upon the value set in the Extended Attribute Type (EXATTYPE) field. Unused bytes, if any, shall be cleared to 0h. | |
| | | | **Extended Attribute Type** | **Definition** |
| | | | Host Identifier | This value specifies the Host Identifier of the host, as defined in section 5.2.26.1.32. |
| | | | Admin label ASCII | This value specifies the admin label of the host or NVM subsystem encoded in ASCII. The admin label is used to identify a host or an NVM subsystem. |
| | | | Admin label UTF-8 | This value specifies the admin label of the host or NVM subsystem encoded in UTF-8. The admin label is used to identify a host or an NVM subsystem. |
| | | | | |
| **Field Name** | **Extended Discovery Information Entry Type:** | |
| | **Host** | **NVM Subsystem** |
| Transport Type (TRTYPE) | Used | Used |
| Address Family (ADRFAM) | Used | Used |
| Subsystem Type (SUBTYPE) | Used | Used |
| Transport Requirements (TREQ) | IgnoredÂ¹ | Used |
| Port ID (PORTID) | IgnoredÂ¹ | Used |
| Controller ID (CNTLID) | IgnoredÂ¹ | Used |
| Admin Max SQ Size (ASQSZ) | IgnoredÂ¹ | Used |
| Transport Service Identifier (TRSVCID) | IgnoredÂ¹ | Used |
| **Field Name** | **Extended Discovery Information Entry Type:** | |
| | **Host** | **NVM Subsystem** |
| NVMe Qualified Name (NQN) | Used | Used |
| Transport Address (TRADDR) | Used | Used |
| Transport Specific Address Subtype (TASAS) | Used | Used |
| Total Entry Length (TEL) | Used | Used |
| Number of Extended Attributes (NUMEXAT) | Used | Used |
| Extended Attribute 0 (EXAT0) ... Extended Attribute N (EXATN) | Used | Used |
| Notes: | | |
| 1. This field shall be cleared to 0h. | | |

