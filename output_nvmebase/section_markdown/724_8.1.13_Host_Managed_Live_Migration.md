#### 8.1.13 Host Managed Live Migration

> **Section ID**: 8.1.13 | **Page**: 599-601

The migration of a controller, by a host that is using the Host Managed Live Migration capability involves
one or more NVM subsystems, multiple hosts, and multiple controllers. In this section, to differentiate
between the multiple hosts and controllers, each is given a unique name as illustrated in Figure 667. In an
NVM subsystem that supports Host Managed Live Migration, each controller that sets the HMLMS bit to ‚Äò1‚Äô
is referred to as a Migration Management Controller (MMC) and each host associated with an MMC is
referred to as a Migration Management Host (MMH). In that same NVM subsystem, all other controllers
(i.e., those that clear the HMLMS bit to ‚Äò0‚Äô) are referred to as Migratable Controllers.
The Host Managed Live Migration capability allows an MMH to use an MMC to migrate a Migratable
Controller from a Source NVM Subsystem to a Migratable Controller in a Destination NVM Subsystem.
During that migration, a host is actively submitting commands to a Migratable Controller in the Source NVM
Subsystem and that controller is processing those commands.
The MMH that is managing the migration of a Migratable Controller from the Source NVM Subsystem is
responsible for ensuring that the Migratable Controller in the Destination NVM Subsystem is compatible
with controller state of the Migratable Controller from the Source NVM Subsystem. It is also the
responsibility of the MMH to transfer the migrating data between the NVM subsystems.
An MMC is an I/O controller or an Administrative controller that supports the Host Managed Live Migration
capability and provides the ability for the MMH to use privileged actions (refer to section 3.10) to:
‚Ä¢
suspend the processing of commands on the Migratable Controller in the Source NVM Subsystem
being migrated (refer to the Migration Send command in section 5.2.17.1.1);
‚Ä¢
obtain the state of the Migratable Controller in the Source NVM Subsystem being migrated (refer
to the Migration Receive command in section 5.2.16.1.1);
‚Ä¢
set that controller state in the Migratable Controller in the Destination NVM Subsystem (refer to
the Migration Send command in section 5.2.17.1.3); and
‚Ä¢
resume the operation on the Migratable Controller in the Destination NVM Subsystem (refer to the
Migration Send command in section 5.2.17.1.2).
A controller indicates support for the Host Managed Live Migration capability by setting the Host Managed
Live Migration Support (HMLMS) bit to ‚Äò1‚Äô in the Optional Admin Command Support (OACS) field in the
Identify Controller data structure (refer to Figure 328).
An MMC is not permitted to be migrated and:
‚Ä¢
shall support:
‚Ä¢
the Migration Send command with the Management Operations:
Suspend (i.e., 0h);
Resume (i.e., 1h); and
Set Controller State (i.e., 2h);
‚Ä¢
the Migration Receive command with the Management Operation
Controller State (i.e., 1h);
and
‚Ä¢
the CNS value of 20h in the Identify command (i.e., Supported C
structure (refer to section 5 2 13 2 21))
If the NVM subsystem contains one or more Migration Management Controllers, then:
‚Ä¢
each controller (i.e., MMC and Migratable Controller) in that NVM subsystem does not support the
Host Memory Buffer (refer to the Host Memory Buffer Preferred Size (HMPRE) field in the Identify
Controller data structure in Figure 328); and
‚Ä¢
each Migratable Controller in that NVM subsystem is allowed to be migrated and shall not support:
the Migration Send command (refer to section 5.2.17);
the Migration Receive command (refer to section 5.2.16);
the CNS value of 20h in the Identify command (i.e., returning Supported Controller State
Formats data structure (refer to section 5.2.13.2.21)); and
the Controller Data Queue command with the Create Queue management operation
specifying the User Data Migration Queue (refer to section 5.2.4.1.1).
A Controller Level Reset on an MMC shall cause that MMC to:
‚Ä¢
delete all User Data Migration Queues on that MMC; and
‚Ä¢
stop tracking all host memory changes on that MMC;
A Controller Level Reset on a Migratable Controller shall cause that Migratable Controller to:
‚Ä¢
remove a suspended state if that Migratable Controller is suspended by a Migration Send command
specifying the Suspend management operation (refer to section 5.2.17.1.1); and
‚Ä¢
retain any persistent controller state that has been committed to that Migratable Controller from a
Migration Send command specifying the Set Controller State management operation (refer to
section 5.2.17.1.3).
During the migration of a Migratable Controller in the Source NVM Subsystem while that Migratable
Controller is processing commands, it may be necessary for the MMHS to obtain the user data
modifications to namespaces attached to that Migratable Controller and modifications made by that
Migratable Controller to host memory in the host. The Track Send command (refer to section 5.2.28) and
the Track Receive command (refer to section 5.2.27) allows the host to use privileged actions (refer to
section 3.10) to:
‚Ä¢
determine user data in namespaces attached to a controller that has changed; and
‚Ä¢
determine host memory that has changed due to commands processed by a controller.
A controller indicates support for tracking changes to user data in namespaces attached to a controller by
setting the Track User Data Changes Support (TUDCS) bit to ‚Äò1‚Äô in the Tracking Attributes (TRATTR) field
in the Identify Controller data structure (refer to Figure 328).
A controller indicates support for tracking changes to host memory (refer to section 1.5.47) due to the
processing of commands by a controller by setting the Track Host Memory Changes Support (THMCS) bit
to ‚Äò1‚Äô in the TRATTR field.


---
### üñºÔ∏è Figures (1)

#### Figure 1: Figure 667: Host Managed Live Migration Host and Controller Naming
![Figure 667: Host Managed Live Migration Host and Controller Naming](../section_images/Figure_8_1_13_Host_Managed_Live_Migration.png)

