#### 4.3.2 Scatter Gather List (SGL)

> **Section ID**: 4.3.2 | **Page**: 179-184

A Scatter Gather List (SGL) is a data structure in memory address space used to describe a data buffer.
The controller indicates the SGL types that the controller supports in the Identify Controller data structure.
A data buffer is either a source buffer or a destination buffer. An SGL contains one or more SGL segments.
The SGL length is the combined total of the values in the Length fields in the SGL Data Block, SGL Bit
Bucket, Keyed SGL Data Block, and Transport SGL Data Block descriptors in an SGL. The SGL length
shall be equal to or exceed the requested data transfer length.
The requested data transfer length is either defined in the specification of a command (e.g., the requested
data transfer length for the Reservation Acquire command is 16 bytes); or is determined based on values
in one or more command specific locations in the SQE (e.g., the requested data transfer length is specified
in the NLB field for a Write command (refer to the NVM Express NVM Command Set Specification) and is
specified in the NUMDL field and the NUMDU field for a Get Log Page command (refer to section 5.2.12)).
If the requested data transfer length exceeds the SGL length, then:
â€¢
data shall not be transferred to or from locations that are not described by the SGL;
â€¢
if that SGL is a data SGL, then the controller shall abort the command with a status code of Data
SGL Length Invalid; and
â€¢
if that SGL is a metadata SGL, then the controller shall abort the command with a status code of
Metadata SGL Length Invalid.
An SGL segment is a qword aligned data structure in a contiguous region of physical memory describing
all, part of, or none of a data buffer and the next SGL segment, if any. An SGL segment consists of an array
of one or more SGL descriptors. Only the last descriptor in an SGL segment may be an SGL Segment
descriptor or an SGL Last Segment descriptor.
A last SGL segment is an SGL segment that does not contain an SGL Segment descriptor, or an SGL Last
Segment descriptor.
A controller may support byte or dword alignment and granularity of Data Blocks. If a controller supports
only dword alignment and granularity as indicated in the SGL Support field of the Identify Controller data
structure (refer to Figure 328), then the values in the Address and Length fields of all Data Block descriptors
shall have their two least significant bits cleared to 00b. This requirement applies to Data Block descriptors
that indicate data and/or metadata memory regions.
The SGL Descriptor Threshold (SDT) field in the Identify Controller data structure (refer to Figure 328)
indicates the recommended maximum number of SGL descriptors for a command. If the SDT field is set to
a non-zero value, and a command is submitted for which the sum of:
a) the number of SGL Bit Bucket descriptors with non-zero Length field contents; and
b) the number of SGL Data Block descriptors with a non-zero Length field contents,
exceeds the value of the SDT field, then the performance of the controller may be reduced.
The value of the SDT field shall be less than or equal to the value of the Maximum SGL Data Block
Descriptors (MSDBD) field in the Identify Controller data structure (refer to Figure 328 for the definition of
the MSDBD field).
A Keyed SGL Data Block descriptor is a Data Block descriptor that includes a key that is used as part of
the host memory access. The maximum length that may be specified in a Keyed SGL Data Block descriptor
is (16 MiB â€“ 1).
A Transport SGL Data Block descriptor is a Data Block descriptor that specifies a data block that is
transferred by the NVMe Transport using a transfer mechanism and data buffers that are specific to the
NVMe Transport.
The SGL Identifier Descriptor Sub Type field may indicate additional information about a descriptor. As an
example, the Sub Type may indicate that the Address field is an offset rather than an absolute address.
The Sub Type may also indicate NVMe Transport specific information.
The controller shall examine an SGL descriptor for errors before using that SGL descriptor for data transfer.
SGL descriptor error checking may occur in any order and data may be transferred using a valid SGL
descriptor before an SGL descriptor error is detected in another SGL descriptor. The controller is not
required to examine for errors any SGL descriptor that is not used for data transfer.
If the LLDTS bit is cleared to â€˜0â€™ and the length of an SGL is greater than the requested data transfer length,
then:
â€¢
the controller should not abort the command for this reason; and
â€¢
if the controller does abort the command for this reason, then the controller should abort the
command with a status code of:
Data SGL Length Invalid if that SGL is a data SGL; and
Metadata SGL Length Invalid if that SGL is a metadata SGL.
For all SGL descriptors examined for errors by the controller:
â€¢
If the controller detects an error condition listed in Figure 113, then the controller shall abort the
command with the corresponding status code listed in that figure; and
â€¢
If:
an SGL Data Block descriptor, Keyed SGL Data Block descriptor, or a Transport SGL Data
Block descriptor contains Address or Length fields with either of the two least-significant
bits set to 1b; and
the controller supports only dword alignment and granularity as indicated in the SGL
Support field of the Identify Controller data structure (refer to Figure 328),
then the controller should abort the command with a status code of SGL Data Block Granularity
Invalid.
Figure 114 defines the SGL segment.
An SGL segment contains one or more SGL descriptors. Figure 115 defines the generic SGL descriptor
format.
The SGL Descriptor Type field defined in Figure 116 specifies the SGL descriptor type. If the SGL Descriptor
Type field is set to a reserved value or an unsupported value, then the SGL descriptor shall be processed
as having an SGL Descriptor Type error. If the SGL Descriptor Sub Type field is set to a reserved value or
an unsupported value, then the descriptor shall be processed as having an SGL Descriptor Type error.
An SGL descriptor set to all zeroes is an SGL Data Block descriptor with the Address field cleared to 0h
and the Length field cleared to 0h may be used as a NULL descriptor.
Figure 117 defines the SGL Descriptor Sub Type values and indicates the SGL Descriptor Types to which
each SGL Descriptor Sub Type applies.
The SGL Data Block descriptor, defined in Figure 118, describes a data block.
The SGL Bit Bucket descriptor, defined in Figure 119, is used to ignore parts of source data.
The SGL Segment descriptor, defined in Figure 120, describes the next SGL segment, which is not the last
SGL segment.
The SGL Last Segment descriptor, defined in Figure 121, describes the next and last SGL segment. A last
SGL segment that contains an SGL Segment descriptor or an SGL Last Segment descriptor is processed
as an error.
The Keyed SGL Data Block descriptor, defined in Figure 122, describes a keyed data block.


---
### ðŸ“Š Tables (8)

#### Table 1: Table_4_3_2_Scatter_Gather_List_SGL_1
![Table_4_3_2_Scatter_Gather_List_SGL_1](../section_images/Table_4_3_2_Scatter_Gather_List_SGL_1.png)

| SGL Validation Error Condition | Status Code |
| :--- | :--- |
| An SGL segment contains: <br> â€¢ an SGL Segment descriptor; or <br> â€¢ an SGL Last Segment descriptor, <br> in other than the last descriptor in the segment. | Invalid Number of SGL Descriptors |
| A last SGL segment contains an SGL Segment descriptor or an SGL Last Segment descriptor. | Invalid SGL Segment Descriptor |
| An SGL descriptor has: <br> â€¢ an unsupported type; or <br> â€¢ a combination of type and subtype. | SGL Descriptor Type Invalid |
| **Bytes** | **Description** |
| 15:00 | SGL Descriptor 0: This field is the first SGL descriptor. |
| 31:16 | SGL Descriptor 1: This field is the second SGL descriptor. |
| ... | ... |
| ((n*16)+15):(n*16) | SGL Descriptor n: This field is the last SGL descriptor. |


#### Table 2: Table_4_3_2_Scatter_Gather_List_SGL_2
![Table_4_3_2_Scatter_Gather_List_SGL_2](../section_images/Table_4_3_2_Scatter_Gather_List_SGL_2.png)

| Bytes | Description |
| :--- | :--- |
| 14:00 | Descriptor Type Specific (DTS): This field is descriptor type specific. |
| 15 | SGL Identifier (SGLID): The definition of this field is described in the table below. |
| | |
| Bits | Description |
| 07:04 | SGL Descriptor Type (SGLDT): Refer to Figure 116. |
| 03:00 | SGL Descriptor Sub Type (SGLDST): Refer to Figure 117. |


#### Table 3: Table_4_3_2_Scatter_Gather_List_SGL_3
![Table_4_3_2_Scatter_Gather_List_SGL_3](../section_images/Table_4_3_2_Scatter_Gather_List_SGL_3.png)

| Value | Descriptor |
| :--- | :--- |
| 0h | SGL Data Block descriptor |
| 1h | SGL Bit Bucket descriptor |
| 2h | SGL Segment descriptor |
| 3h | SGL Last Segment descriptor |
| 4h | Keyed SGL Data Block descriptor |
| 5h | Transport SGL Data Block descriptor |
| 6h to Eh | Reserved |
| Fh | Vendor specific |
| SGL Descriptor Sub Type | SGL Descriptor Types | Sub Type Description |
| :--- | :--- | :--- |
| 0h | 0h, 2h, 3h, 4h | **Address**: The Address field specifies the starting 64-bit memory byte address of the Data Block, Segment, or Last Segment descriptor. |
| | 1h | For Type 1h, the Sub Type field shall be cleared to 0h. |
| | All other values | Reserved |
| 1h | 0h, 2h, 3h | **Offset**: The Address field contains an offset from the beginning of the location where data may be transferred. For NVMe over PCIe implementations, this Sub Type is reserved. For NVMe over Fabrics implementations, refer to section 3.3.2.1.3.1. |
| | 1h | The controller shall abort the command with the status code of SGL Descriptor Type Invalid. |
| | 4h | The controller shall abort the command with the status code of SGL Descriptor Type Invalid. |
| | All other values | Reserved |
| Ah to Fh | All | **NVMe Transport Specific**: The definitions for this range of Sub Types are defined by the binding section for the associated NVMe Transport. |
| All other values | All | Reserved |


#### Table 4: Table_4_3_2_Scatter_Gather_List_SGL_4
![Table_4_3_2_Scatter_Gather_List_SGL_4](../section_images/Table_4_3_2_Scatter_Gather_List_SGL_4.png)

| Bytes | Description |
|:---|:---|
| 07:00 | **Address (ADDR):** If the SGL Identifier Descriptor Sub Type field is cleared to 0h in the SGL Identifier field, then this field specifies the starting 64-bit memory byte address of the data block. If the SGL Identifier Sub Type field is set to 1h, then this field contains an offset from the beginning of the location where data is to be transferred. If the controller requires dword alignment and granularity as indicated in the SGL Support (SGLS) field of the Identify Controller data structure (refer to Figure 328), then the two least significant bits shall be cleared to 00b.<br><br>If dword alignment and granularity is required, the controller may report an error of Invalid Field in Command if bits 1:0 are not cleared to 00b. If the controller does not report an error of Invalid Field in Command, then the controller shall operate as if bits 1:0 are cleared to 00b. |
| 11:08 | **Length (LEN):** This field specifies the length in bytes of the data block. This field cleared to 0h specifies that no data is transferred. An SGL Data Block descriptor specifying that no data is transferred is a valid SGL Data Block descriptor. If the controller requires dword alignment and granularity as specified in the SGL Support (SGLS) field of the Identify Controller data structure, then the two least significant bits shall be cleared to 00b.<br><br>If dword alignment and granularity is required, the controller may report an error of Invalid Field in Command if bits 1:0 are not cleared to 00b. If the controller does not report an error of Invalid Field in Command, then the controller shall operate as if bits 1:0 are cleared to 00b.<br><br>If the value in the Address field plus the value in this field is greater than 1_00000000_00000000h, then the SGL Data Block descriptor shall be processed as having a Data SGL Length Invalid or Metadata SGL Length Invalid error. |
| 14:12 | Reserved |
| 15 | **SGL Identifier (SGLID):** The definition of this field is described in the table below. |
| | | | | | | | | | | | | | | | | | | | | | | | | | | | | |


#### Table 5: Table_4_3_2_Scatter_Gather_List_SGL_5
![Table_4_3_2_Scatter_Gather_List_SGL_5](../section_images/Table_4_3_2_Scatter_Gather_List_SGL_5.png)

| Bytes | Description |
| :--- | :--- |
| 07:00 | **Length (LEN):** This field specifies the amount of source data that is discarded. An SGL Bit Bucket descriptor specifying that no source data be discarded (i.e., this field cleared to 0h) is a valid SGL Bit Bucket descriptor. |
| | If the SGL Bit Bucket descriptor describes a destination data buffer (e.g., a read from the controller to host memory), then this field specifies the number of bytes of the source data which the controller shall discard (i.e., not transfer to the destination data buffer). |
| 11:08 | If the SGL Bit Bucket descriptor describes a source data buffer (e.g., a write from host memory to the controller), then the Bit Bucket descriptor shall be treated as if this field were cleared to 0h (i.e., the Bit Bucket descriptor has no effect). |
| | If SGL Bit Bucket descriptors are supported, their length in a destination data buffer shall be included in the specified length of data to be transferred (e.g., their length in a source data buffer is not included in the transfer length specified by the NBL parameter). |
| 14:12 | Reserved |
| 15 | **SGL Identifier (SGLID):** The definition of this field is described in the table below. |
| | |


#### Table 6: Table_4_3_2_Scatter_Gather_List_SGL_6
![Table_4_3_2_Scatter_Gather_List_SGL_6](../section_images/Table_4_3_2_Scatter_Gather_List_SGL_6.png)

| Bytes | Description |
| :--- | :--- |
| 07:00 | **Address (ADDR):** If the SGL Descriptor Sub Type field is cleared to 0h in the SGL Identifier field, then this field specifies the starting 64-bit memory byte address of the next SGL segment, which is an SGL segment. If the SGL Descriptor Sub Type field is set to 1h in the SGL Identifier field, then this field contains offset from the beginning of the location where data may be transferred. |
| 11:08 | **Length (LEN):** This field specifies the length in bytes of the next SGL segment. This field shall be a non-zero value and a multiple of 16.<br>If the value in the Address field plus the value in this field is greater than 1_00000000_00000000h, then the SGL Segment descriptor shall be processed as having a Data SGL Length Invalid or Metadata SGL Length Invalid error. |
| 14:12 | **Reserved** |
| 15 | **SGL Identifier (SGLID):** The definition of this field is described in the table below. |
| | |


#### Table 7: Table_4_3_2_Scatter_Gather_List_SGL_7
![Table_4_3_2_Scatter_Gather_List_SGL_7](../section_images/Table_4_3_2_Scatter_Gather_List_SGL_7.png)

| Bytes | Description |
| :--- | :--- |
| 07:00 | **Address (ADDR):** If the SGL Identifier Descriptor Sub Type field is cleared to 0h in the SGL Identifier field, then this field specifies the starting 64-bit memory byte address of the next and last SGL segment, which is an SGL segment. If the SGL Identifier Descriptor Sub Type field is set to 1h, then this field contains an offset from the beginning of the location where data may be transferred. |
| 11:08 | **Length (LEN):** This field specifies the length in bytes of the next and last SGL segment. This field shall be a non-zero value and a multiple of 16.<br>If the value in the Address field plus the value in this field is greater than 1_00000000_00000000h, then the SGL Last Segment descriptor shall be processed as having a Data SGL Length Invalid or Metadata SGL Length Invalid error. |
| 14:12 | Reserved |
| 15 | **SGL Identifier (SGLID):** The definition of this field is described in the table below. |
| | |


#### Table 8: Table_4_3_2_Scatter_Gather_List_SGL_8
![Table_4_3_2_Scatter_Gather_List_SGL_8](../section_images/Table_4_3_2_Scatter_Gather_List_SGL_8.png)

| Bytes | Description |
| :--- | :--- |
| 07:00 | **Address (ADDR):** This field specifies the starting 64-bit memory byte address of the data block. |
| | **Length (LEN):** This field specifies the length in bytes of the data block. This field cleared to 0h specifies that no data is transferred. An SGL Data Block descriptor specifying that no data is transferred is a valid SGL Data Block descriptor. |
| 10:08 | If the value in the Address field plus the value in this field is greater than 1_00000000_00000000h then the SGL Data Block descriptor shall be processed as having a Data SGL Length Invalid or Metadata SGL Length Invalid error. |
| 14:11 | **Key (KEY):** Specifies a 32-bit key that is associated with the data block. |
| | |
| Bytes | Description |
| 07:00 | **SGL Identifier (SGLID):** The definition of this field is described in the table below. |
| 15 | | 
| | **Bits** | **Description** |
| | 07:04 | **SGL Descriptor Type (SGLDT):** 4h as specified in Figure 116. |
| | 03:00 | **SGL Descriptor Sub Type (SGLDST):** Valid values are specified in Figure 117. |
| | |
| Bytes | Description |
| 07:00 | **Reserved** |
| | |
| 11:08 | **Length (LEN):** This field specifies the length in bytes of the data block. This field cleared to 0h specifies that no data is transferred. A Transport SGL Data Block Descriptor specifying that no data is transferred is a valid Transport SGL Data Block descriptor. If the controller requires dword alignment and granularity as specified in the SGL Support field of Identify Controller (refer to Figure 328), then the two least significant bits shall be cleared to 0b. |
| | The data transfer mechanism and data buffers for data specified by a Transport SGL Data Block descriptor are defined by the binding section for the associated NVMe Transport. |
| 14:12 | **Reserved** |
| | |
| | **SGL Identifier (SGLID):** The definition of this field is described in the table below. |
| | |
| | **Bits** | **Description** |
| | 07:04 | **SGL Descriptor Type (SGLDT):** 5h as specified in Figure 116. |
| | 03:00 | **SGL Descriptor Sub Type (SGLDST):** Valid values are specified in Figure 117. |

