#### 2.4.1 Multi-Path I/O and Namespace Sharing

> **Section ID**: 2.4.1 | **Page**: 57-60

This section provides an overview of multi-path I/O and namespace sharing. Multi-path I/O refers to two or
more completely independent paths between a single host and a namespace while namespace sharing
refers to the ability for two or more hosts to access a common shared namespace using different NVM
Express controllers. Both multi-path I/O and namespace sharing require that the NVM subsystem contain
two or more controllers. NVM subsystems that support Multi-Path I/O and Namespace Sharing may also
support asymmetric controller behavior (refer to section 2.4.2). Concurrent access to a shared namespace
by two or more hosts requires some form of coordination between hosts. The procedure used to coordinate
these hosts is outside the scope of this specification.
Figure 19 shows an NVM subsystem that contains a single NVM Express controller implemented over PCI
Express and a single PCI Express port. Since this is a single Function PCI Express device, the NVM
Express controller shall be associated with PCI Function 0. A controller may support multiple namespaces.
The controller in Figure 19 supports two namespaces labeled NS A and NS B. Associated with each
controller namespace is a namespace ID, labeled as NSID 1 and NSID 2, that is used by the controller to
reference a specific namespace. The namespace ID is distinct from the namespace itself and is the handle
a host and controller use to specify a particular namespace in a command. The selection of a controller‚Äôs
namespace IDs is outside the scope of this specification. In this example, NSID 1 is associated with
namespace A and NSID 2 is associated with namespace B. Both namespaces are private to the controller
and this configuration supports neither multi-path I/O nor namespace sharing.
Figure 20 shows a multi-Function NVM subsystem with a single PCI Express port containing two controllers
implementing NVMe over PCIe. One controller is associated with PCI Function 0 and the other controller is
associated with PCI Function 1. Each controller supports a single private namespace and access to shared
namespace B. The namespace ID shall be the same in all controllers that have access to a particular shared
namespace. In this example, both controllers use NSID 2 to access shared namespace B.
There is one or more Identify Controller data structures for each controller and one or more Identify
Namespace data structures (refer to section 1.5.50) for each namespace (refer to Figure 326). Controllers
with access to a shared namespace return the Identify Namespace data structure associated with that
shared namespace (i.e., the same data structure contents are returned by all controllers with access to the
same shared namespace). There is a globally unique identifier (refer to section 4.7.1) associated with the
namespace itself and may be used to determine when there are multiple paths to the same shared
namespace.
Controllers associated with a shared namespace may operate on the namespace concurrently. Operations
performed by individual controllers are atomic to the shared namespace at the write atomicity level of the
controller to which the command was submitted (refer to section 3.4.3). The write atomicity level is not
required to be the same across controllers that share a namespace. If there are any ordering requirements
between commands issued to different controllers that access a shared namespace, then a host (e.g., host
software or an associated application) is required to enforce these ordering requirements.
Figure 21 illustrates an NVM subsystem with two PCI Express ports, each with an associated controller
implementing NVMe over PCIe. Both controllers map to PCI Function 0 of the corresponding port. Each
PCI Express port in this example is completely independent and has its own PCI Express Fundamental
Reset and reference clock input. A reset of a port only affects the controller associated with that port and
has no impact on the other controller, shared namespace, or operations performed by the other controller
on the shared namespace. Refer to section 4.4 for Feature behavior on reset. The functional behavior of
this example is otherwise the same as that illustrated in Figure 20.
The two ports shown in Figure 21 may be associated with the same Root Complex or with different Root
Complexes and may be used to implement both multi-path I/O and I/O sharing architectures. System-level
architectural aspects and use of multiple ports in a PCI Express fabric are beyond the scope of this
specification.
Figure 22 illustrates an NVM subsystem that supports Single Root I/O Virtualization (SR-IOV) and has one
Physical Function and four Virtual Functions. An NVM Express controller implementing NVMe over PCIe is
associated with each Function with each controller having a private namespace and access to a namespace
shared by all controllers, labeled NS F. The behavior of the controllers in this example parallels that of the
other examples in this section. Refer to section 8.2.6.4 for more information on SR-IOV.
Examples provided in this section are meant to illustrate concepts and are not intended to enumerate all
possible configurations. For example, an NVM subsystem may contain multiple PCI Express ports with
each port supporting SR-IOV.


---
### üñºÔ∏è Figures (4)

#### Figure 1: Figure 19: NVM Express Controller with Two Namespaces
![Figure 19: NVM Express Controller with Two Namespaces](../section_images/Figure_2_4_1_Multi_Path_I_O_and_Namespace_Sharing_1.png)


#### Figure 2: Figure 20: NVM Subsystem with Two Controllers and One Port
![Figure 20: NVM Subsystem with Two Controllers and One Port](../section_images/Figure_2_4_1_Multi_Path_I_O_and_Namespace_Sharing_2.png)


#### Figure 3: Figure 21: NVM Subsystem with Two Controllers and Two Ports
![Figure 21: NVM Subsystem with Two Controllers and Two Ports](../section_images/Figure_2_4_1_Multi_Path_I_O_and_Namespace_Sharing_3.png)


#### Figure 4: Figure 22: PCI Express Device Supporting Single Root I/O Virtualization (SR-IOV)
![Figure 22: PCI Express Device Supporting Single Root I/O Virtualization (SR-IOV)](../section_images/Figure_2_4_1_Multi_Path_I_O_and_Namespace_Sharing_4.png)

