###### 8.3.2.3.8.3.2 Add/Replace Active ZoneGroup (AAZ)

> **Section ID**: 8.3.2.3.8.3.2 | **Page**: 724-726

The Add/Replace Active ZoneGroup (AAZ) operation allows a DDC to add or replace in the CDC an active
ZoneGroup associated with that DDC. For a pull model DDC the AAZ operation is mapped to a Pull Model
DDC Request asynchronous event notification (refer to Figure 154). The CDC responds to that
asynchronous event notification with a Get Log Page command requesting the Pull Model DDC Request
log page (refer to section 5.2.12.3.6), to which the DDC responds with a log page requesting an AAZ
operation for a specified ZoneGroup. The AAZ operation is then completed by the CDC by issuing one or
more FZR commands to retrieve that ZoneGroup from the DDC, and one FZS command to provide an
operation status to the DDC, as shown in Figure 766.
The format of the operation specific parameters of a Pull Model DDC Request log page requesting an AAZ
is shown in Figure 767.
The Transaction ID field is used to relate the Pull Model DDC Request log page for a pull model AAZ
operation to the subsequent FZR and FZS command(s). The Zoning Data Key in Command Dword 10
(refer to Figure 540) of the FZR command(s) shall be set to the received Transaction ID value. The Zoning
Data Key in Command Dword 10 (refer to Figure 546) of the FZS command shall be set to the received
Transaction ID value.
If the specified ZoneGroup is locked on the CDC, then the AAZ operation shall be aborted by the CDC by
issuing one FZS command with AAZ operation status set to 3h (i.e., Zoning Data Structure Locked) to the
DDC. The Transaction ID value returned by the DDC in the Pull Model DDC Request log page for a pull
model AAZ operation shall be the same in the FZS command for this AAZ operation.
If the specified ZoneGroup:
‚Ä¢
does not exist in ZoneDBActive in that CDC; or
‚Ä¢
exists in ZoneDBActive in that CDC and is not locked by another administrative interface,
then the CDC shall lock the specified ZoneGroup in ZoneDBActive and complete the AAZ operation by
issuing one or more FZR commands to request from the DDC the ZoneGroup definition to add/replace,
followed by an FZS command to report status information to the DDC. The ZoneGroup definition is sent
through one or more FZR commands and is provided in the FZR buffer, as shown in Figure 768. The FZR
completion queue entry sending the last fragment shall have the Last Fragment (LF) bit set to ‚Äò1‚Äô in
completion queue entry Dword 0 (refer to Figure 186).
The CDC shall not process received ZoneGroup information until the entire ZoneGroup (i.e., all of the
fragments of the ZoneGroup) is received. Upon receiving the ZoneGroup information, the CDC shall update
that ZoneGroup in ZoneDBActive in that CDC, increment the ZoneGroup generation number, and issue an
FZS command with AAZ operation status cleared to 0h (i.e., Operation Successful) to the DDC.
The AAZ Operation Status is sent through the FZS command and is provided in the FZS buffer, as shown
in Figure 769.
The AAZ Operation Status field is used to encode status information for the pull model AAZ operation, as
shown in Figure 773.
The CDC may enforce access restrictions to the Zoning data structures. In this case, the CDC shall check
if the DDC requesting the AAZ operation is authorized to write the ZoneGroup indicated in Pull Model DDC
Request log page for Pull Model AAZ operation (e.g., if the CDC allows access to a ZoneGroup only to the
DDC that created that ZoneGroup, verify that the ZoneGroup Originator field matches the NQN contained
in the SUBNQN field of the Connect command sent from the CDC to that DDC). If that DDC is not authorized
to access the specified ZoneGroup, then the CDC shall issue an FZS command with AAZ operation status
set to 4h (i.e., ZoneGroup Originator Invalid), and the AAZ operation shall be aborted.


---
### üìä Tables (3)

#### Table 1: Table_8_3_2_3_8_3_2_Add_Replace_Active_ZoneGroup_AAZ_1
![Table_8_3_2_3_8_3_2_Add_Replace_Active_ZoneGroup_AAZ_1](../section_images/Table_8_3_2_3_8_3_2_Add_Replace_Active_ZoneGroup_AAZ_1.png)

| Bytes | Description |
|:---|:---|
| 03:00 | Transaction ID (T_ID) |
| 227:04 | ZoneGroup Originator (ZGORIG) |
| 257:228 | ZoneGroup Name (ZGNAME) |


#### Table 2: Table_8_3_2_3_8_3_2_Add_Replace_Active_ZoneGroup_AAZ_2
![Table_8_3_2_3_8_3_2_Add_Replace_Active_ZoneGroup_AAZ_2](../section_images/Table_8_3_2_3_8_3_2_Add_Replace_Active_ZoneGroup_AAZ_2.png)

| Bytes | Description |
|:---|:---|
| 00 | Operation Type (OTYP): 9h (i.e., Add/Replace Active ZoneGroup for a pull model DDC) |
| 07:01 | Reserved |
| 11:08 | ZoneGroup Fragment Length (ZGFL) |
| 15:12 | Reserved |
| ZGFL+15:16 | ZoneGroup Fragment (ZGF) |


#### Table 3: Table_8_3_2_3_8_3_2_Add_Replace_Active_ZoneGroup_AAZ_3
![Table_8_3_2_3_8_3_2_Add_Replace_Active_ZoneGroup_AAZ_3](../section_images/Table_8_3_2_3_8_3_2_Add_Replace_Active_ZoneGroup_AAZ_3.png)

| Bytes | Description |
|:---|:---|
| 00 | Operation Type (OTYP): Ah (i.e., AAZ status for a pull model DDC) |
| 03:01 | Reserved |
| 07:04 | AAZ Operation Status (ZAAOS) |



---
### üñºÔ∏è Figures (1)

#### Figure 1: Figure 767: AAZ Operation Specific Parameters for Pull Model DDC Request Log Page
![Figure 767: AAZ Operation Specific Parameters for Pull Model DDC Request Log Page](../section_images/Figure_8_3_2_3_8_3_2_Add_Replace_Active_ZoneGroup_AAZ.png)

