###### 8.3.5.4.1 AUTH_Negotiate Message

> **Section ID**: 8.3.5.4.1 | **Page**: 743-745

The AUTH_Negotiate message is sent from the host to the controller and is used to indicate the
authentication protocols the host is able to use in this authentication transaction and which secure channel
protocol, if any, to concatenate to this authentication transaction. The AUTH_Negotiate message format is
shown in Figure 789.
The SC_C field determines if a secure channel concatenation to the authentication transaction is requested
and with which secure channel protocol, as shown in Figure 790.
An authentication transaction with the SC_C field set to NOSC is allowed on any Admin or I/O Queue and
does not generate a PSK (i.e., it performs authentication only).
An authentication transaction with the SC_C field set to NEWTLSPSK:
â€¢
is allowed on an Admin Queue over a TCP channel without TLS and generates a new PSK;
â€¢
is prohibited on an I/O Queue over a TCP channel without TLS; and
â€¢
is prohibited on an Admin Queue or I/O queue over a TLS secure channel.
An authentication transaction with the SC C field set to REPLACETLSPSK:
â€¢
is allowed on an Admin Queue over a TLS secure channel and replaces the associationâ€™s PSK;
â€¢
is prohibited on an Admin Queue or I/O queue over a TCP channel without TLS; and
â€¢
is prohibited on an I/O Queue over a TLS secure channel.
The AUTH_Negotiate message is structured as a list of 64-byte authentication protocol descriptors to
enable extensibility to define additional authentication protocols. Currently only one authentication protocol
is defined (i.e., DH-HMAC-CHAP), therefore the AUTH_Negotiate message carries only one authentication
protocol descriptor (i.e., NAPD=1). Implementations should support more than one descriptor to enable
protocol extensibility. The first byte of an authentication protocol descriptor identifies the specific
authentication protocol, as shown in Figure 791.
Upon receiving an AUTH_Negotiate message, if the SC_C value indicated by the host:
â€¢
does not satisfy the security requirements of the controller (e.g., the host did not request secure
channel concatenation, but the controllerâ€™s security configuration requires secure channel
concatenation);
â€¢
is prohibited for the Admin Queue or I/O Queue via which the AUTH_Negotiate message was
received, as specified in this section; or
â€¢
requests secure channel concatenation and that value is contained in an AUTH_Negotiate
message received over a secure channel established in compliance with the requirements of an
NVM Express Transport specification (e.g., the NVMe over TCP Transport Specification),
then the controller shall:
â€¢
reply to the AUTH_Negotiate message with an AUTH_Failure1 message having reason code
â€˜Authentication failureâ€™ and reason code explanation â€˜Secure channel concatenation mismatchâ€™; and
â€¢
disconnect the NVMe over Fabrics connection upon transmitting the AUTH_Failure1 message.
Upon receiving an AUTH_Negotiate message, if the protocol descriptors proposed by the host do not satisfy
the security requirements of the controller, then the controller shall:
â€¢
reply to the AUTH_Negotiate message with an AUTH_Failure1 message having reason code
â€˜Authentication failureâ€™ and reason code explanation â€˜Authentication protocol not usableâ€™; and
â€¢
disconnect the NVMe over Fabrics connection upon transmitting the AUTH_Failure1 message.


---
### ðŸ“Š Tables (3)

#### Table 1: Table_8_3_5_4_1_AUTH_Negotiate_Message_1
![Table_8_3_5_4_1_AUTH_Negotiate_Message_1](../section_images/Table_8_3_5_4_1_AUTH_Negotiate_Message_1.png)

| Bytes | Description |
| :--- | :--- |
| 0 | Authentication Type (AUTH TYPE): 00h (i.e., common messages) |
| 1 | Authentication Identifier (AUTH ID): 00h (i.e., AUTH Negotiate) |
| 3:2 | Reserved |
| 5:4 | Transaction Identifier (T_ID): 16-bit transaction identifier |
| 6 | Transaction Identifier (SC_C) |
| 7 | Number of Authentication Protocol Descriptors (NAPD): This field specifies the number of Authentication Protocol Descriptors are in the Authentication Protocol Descriptor list. |
| | **Authentication Protocol Descriptor List** |
| 71:8 | Authentication Protocol Descriptor 1 |
| 135:72 | Authentication Protocol Descriptor 2 |
| ... | ... |
| NAPD*64+7:(NAPD-1)*64+8 | Authentication Protocol Descriptor NAPD |


#### Table 2: Table_8_3_5_4_1_AUTH_Negotiate_Message_2
![Table_8_3_5_4_1_AUTH_Negotiate_Message_2](../section_images/Table_8_3_5_4_1_AUTH_Negotiate_Message_2.png)

| Value | Definition | Transport Applicability |
| :--- | :--- | :--- |
| 00h | NOSC: No secure channel concatenation | n/a |
| 01h | Obsolete (refer to NVM Express Base Specification 2.0) | |
| 02h | NEWTLSPSK: Used on an Admin Queue over a TCP channel without TLS to generate a PSK and associated PSK identity. This (PSK, PSK Identity) pair may be used to set up TLS secure channels for subsequent Admin and I/O queues. | TCP |
| 03h | REPLACETLSPSK: Used on an Admin Queue over a TLS secure channel to generate a PSK and associated PSK identity. This (PSK, PSK Identity) pair replaces the (PSK, PSK Identity) pair that was used to set up the TLS secure channel over which the authentication transaction is performed. | TCP with TLS |
| All other values | Reserved | |


#### Table 3: Table_8_3_5_4_1_AUTH_Negotiate_Message_3
![Table_8_3_5_4_1_AUTH_Negotiate_Message_3](../section_images/Table_8_3_5_4_1_AUTH_Negotiate_Message_3.png)

Table_8_3_5_4_1_AUTH_Negotiate_Message_3
| Value | Definition |
|:---|:---|
| 01h | DH-HMAC-CHAP (refer to section 8.3.5.5) |
| All other values | Reserved |

