##### 8.1.9.3 Streams (Directive Type 01h, Optional)

> **Section ID**: 8.1.9.3 | **Page**: 579-583

The Streams Directive enables the host to indicate (i.e., by using the stream identifier) to the controller that
the specified user data in a User Data Out command (e.g., logical blocks in a write command) are part of
one group of associated data. This information may be used by the controller to store related data in
associated locations or for other performance enhancements.
The controller provides information in response to the Return Parameters operation about the configuration
of the controller that indicates Stream Write Size, Stream Granularity Size, and stream resources at the
NVM subsystem and namespace levels.
Data that is aligned to and in multiples of the Stream Write Size (SWS) provides optimal performance of
the write commands to the controller. The SWS unit of granularity is defined independently for each I/O
Command Set. The Stream Granularity Size indicates the size of the media that is prepared as a unit for
future allocation for write commands and is a multiple of the Stream Write Size. The controller may allocate
and group together a stream in Stream Granularity Size (SGS) units. Refer to Figure 651.
One example of this is if the host issues an NVM Command Set Dataset Management command (refer to
the Dataset Management command section of the NVM Express NVM Command Set Specification) to
deallocate logical blocks that are associated with a stream, that host should specify a starting LBA and
length that is aligned to and in multiples of the Stream Granularity Size. This provides optimal performance
and endurance of the media.
Stream resources are the resources in the NVM subsystem that are necessary to track operations
associated with a specified stream identifier. There are a maximum number of stream resources that are
available in an NVM subsystem as indicated by the Max Stream Limit (MSL) field in the Return Parameters
data structure (refer to Figure 655).
Available NVM subsystem stream resources are stream resources that are not allocated for exclusive use
in any namespace. Available NVM subsystem stream resources are reported in the NVM Subsystem
Streams Available (NSSA) field (refer to Figure 655) and may be used by any host in any namespace that:
â€¢
has the Streams Directive enabled;
â€¢
has not been allocated exclusive stream resources by that host if the Shared Stream Identifiers
(SSID) bit is cleared to â€˜0â€™ in the NSSC field; and
â€¢
has not been allocated exclusive stream resources by any host if the SSID bit is set to â€˜1â€™.
Each time stream resources are allocated for exclusive use in a specified namespace, the available NVM
subsystem stream resources reported in the NSSA field are reduced.
For a given namespace:
a) a host allocates stream resources to that namespace for the exclusive use of that host(s) by issuing
the Allocate Resources operation;
b) other hosts may concurrently allocate stream resources to that namespace for their exclusive use;
and
c) hosts which have not allocated stream resources to that namespace may use available NVM
subsystem stream resources for access to that namespace.
If an NVM subsystem has streams resources allocated to a host with a Host Identifier value of 0h and the
Host Identifier is subsequently changed to a non-zero value, then those streams resources remain
associated with the Host with a Host Identifier value of 0h and are not associated with the host with the
non-zero Host Identifier.
The Directive operations that shall be supported if the Streams Directive is supported are listed in Figure
652. The Directive Specific field in a command is referred to as the Stream Identifier when the Directive
Type field is set to the Streams Directive.
Stream identifiers are assigned by the host and may be in the range 0001h to FFFFh. The host may specify
a sparse set of stream identifiers (i.e., there is no requirement for the host to use Stream Identifiers in any
particular order).
The host may access a namespace through multiple controllers in the NVM subsystem. The controllers in
an NVM subsystem indicate in the SSID bit (refer to Figure 655) if a stream identifier is unique based on
the Host Identifier (i.e., the same stream identifier used to access the same namespace by a host that has
registered a different Host Identifier is referencing a different stream), or if a stream identifier may be used
by multiple Host Identifiers (i.e., the same stream identifier used to access the same namespace by a host
that has registered a different Host Identifier is referencing the same stream). All controllers in an NVM
subsystem shall report the same value in the NSSC field.
If multiple controllers receive a registration of a Host Identifier (refer to section 5.2.26.1.32) that has the
same non-zero value, then that value represents a single host that is accessing the namespace through
those controllers and a stream identifier is used across those controllers to access the same stream on the
namespace. If a Host Identifier has a unique non-zero value, then each value represents a unique host that
is accessing the namespace and:
â€¢
if the SSID bit is cleared to â€˜0â€™, then the same stream identifier on controllers with different non-zero
Host Identifiers does not have the same meaning for a particular namespace (i.e., the stream
identifier is not used across controllers with different non-zero Host Identifiers to access the same
stream on the namespace); and
â€¢
if the SSID bit is set to â€˜1â€™, then the same stream identifier on any controller with a non-zero Host
Identifier has the same meaning for a particular namespace (i.e., the stream identifier is used
across controllers to access the same stream on the namespace).
If a Host Identifier is cleared to 0h, then a unique host is accessing the namespace and the stream identifier
does not have the same meaning for a particular namespace.
In the example shown in Figure 653, if the SSID bit is cleared to â€˜0â€™, then there are three streams as follows:
â€¢
Stream ID 1-a and Stream ID 1-b have the same meaning;
â€¢
Stream ID 1-c has a different meaning; and
â€¢
Stream ID 1-d has a different meaning.
In the example shown in Figure 653, if the SSID bit is set to â€˜1â€™, then there is one stream as follows:
â€¢
Stream ID 1-a, Stream ID 1-b, Stream ID 1-c, and Stream ID 1-d have the same meaning.
The controller(s) recognized by the NVM subsystem as being associated with a specific host or hosts and
attached to a specific namespace either:
â€¢
utilizes a number of stream resources allocated for exclusive use of that namespace as returned
in response to an Allocate Resources operation; or
â€¢
utilizes resources from the NVM subsystem stream resources.
The value of Namespace Streams Allocated (NSA) indicates how many resources for individual stream
identifiers have been allocated for exclusive use for the specified namespace by the associated controllers.
This indicates the maximum number of stream identifiers that may be open at any given time in the specified
namespace by the associated controllers. To request a different number of resources than are currently
allocated for exclusive use by the associated controllers for a specific namespace, all currently allocated
resources are first required to be released using the Release Resources operation. There is no mechanism
to incrementally increase or decrease the number of allocated resources for a given namespace.
Streams are opened by the controller when the host issues a Write command that specifies a stream
identifier that is not currently open. While a stream is open the controller maintains context for that stream
(e.g., buffers for associated data). The host may determine the streams that are open using the Get Status
operation.
For a namespace that has a non-zero value of Namespace Streams Allocated (NSA), if the host submits a
Write command specifying a stream identifier not currently in use and stream resources are exhausted,
then an arbitrary stream identifier for that namespace is released by the controller to free the stream
resources associated with that stream identifier for the new stream. The host may ensure the number of
open streams does not exceed the allocated stream resources for the namespace by explicitly releasing
stream identifiers as necessary using the Release Identifier operation.
For a namespace that has zero namespace stream resources allocated, if the host submits an I/O command
specifying a stream identifier not currently in use and:
â€¢
NVM subsystem streams available are exhausted, then an arbitrary stream identifier for an arbitrary
namespace that is using NVM subsystem stream resources is released by the NVM subsystem to
free the stream resources associated with that stream identifier for the new stream; or
â€¢
all NVM subsystem stream resources have been allocated for exclusive use for specific
namespaces, then the Write command is treated as a normal Write command that does not specify
a stream identifier.
The host determines parameters associated with stream resources using the Return Parameters operation
The host may get a list of open stream identifiers using the Get Status operation.
If the Streams Directive becomes disabled for use by a host within a namespace, then all stream resources
and stream identifiers shall be released for that host for the affected namespace. If the host issues a Format
NVM command, then all stream identifiers for all open streams for affected namespaces shall be released.
If the host deletes a namespace, then all stream resources and all stream identifiers for that namespace
shall be released. If the write protection state of a namespace changes such that the namespace becomes
write protected (refer to section 8.1.17), then the controller shall release all stream resources and stream
identifiers for that namespace.
Streams Directive defines the command specific status values specified in Figure 654.
The Streams Directive is not allowed to be enabled in any namespace that is contained in an Endurance
Group with Flexible Data Placement enabled. If the specified namespace is contained in an Endurance
Group that has Flexible Data Placement enabled, then the controller shall not enable the Streams Directive.
If:
â€¢
a Directive Send command specifies the Streams Directive in the DTYPE field and the Directive
Operation field is set to 01h (i.e., Enable Directive); and
â€¢
the namespace specified by the NSID field is contained in an Endurance Group that has Flexible
Data Placement enabled,
then the controller shall:
â€¢
abort that Directive Send command with a status code of Invalid Field in Command; and
â€¢
indicate the Directive Operation field in the Parameter Error Location field (refer to Figure 209) if
an entry is added to the Error Information log page due to aborting that Directive Send command.


---
### ðŸ“Š Tables (1)

#### Table 1: Table_8_1_9_3_Streams_Directive_Type_01h_Optional
![Table_8_1_9_3_Streams_Directive_Type_01h_Optional](../section_images/Table_8_1_9_3_Streams_Directive_Type_01h_Optional.png)

| Directive Command | Directive Operation Name | Directive Operation Value | Reference |
| :--- | :--- | :--- | :--- |
| Directive Receive | Return Parameters | 01h | 8.1.9.3.1.1 |
| | Get Status | 02h | 8.1.9.3.1.2 |
| | Allocate Resources | 03h | 8.1.9.3.1.3 |
| | Reserved | All other values | |
| Directive Send | Release Identifier | 01h | 8.1.9.3.2.1 |
| | Release Resources | 02h | 8.1.9.3.2.2 |
| | Reserved | All other values | |
| **Value** | **Definition** | | |
| 7Fh | **Stream Resource Allocation Failed**: The controller was not able to allocate stream resources for exclusive use of the specified namespace and no NVM subsystem stream resources are available. | | |

