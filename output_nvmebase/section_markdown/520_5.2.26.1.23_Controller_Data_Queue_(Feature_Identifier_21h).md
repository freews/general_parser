###### 5.2.26.1.23 Controller Data Queue (Feature Identifier 21h)

> **Section ID**: 5.2.26.1.23 | **Page**: 445-446

This Feature allows a host to update the status of the head pointer of a Controller Data Queue (CDQ) and
specify the configuration of a Controller Data Queue Tail event. The CDQ is specified by the Controller
Data Queue Identifier (CDQID) field in Command Dword 11 (refer to Figure 443).
The Head Pointer field specifies the current slot of the head pointer in the queue (refer to section 8.1.7)
The controller uses this value to determine if CDQ entries have been freed by the host.
If the Enable Tail Pointer Trigger (ETPT) bit is set to â€˜1â€™, then when the slot specified by the Tail Pointer
Trigger (TPT) field for the specified CDQ is posted with an entry, the controller shall generate a Controller
Data Queue Tail Pointer event to the host (refer to section 8.1.7).
If the Set Features command is successful and there is a pending Controller Data Queue Tail Pointer event
for the specified Controller Data Queue specified by the CDQID field, then the controller shall clear that
pending event.
A controller should report Controller Data Queue Tail Pointer events in the order of occurrence to avoid
reporting the same Controller Data Queue when a Controller Data Queue Tail Pointer event for that
Controller Data Queue is being repeatedly triggered.
If the Enable Tail Pointer Trigger (ETPT) bit is set to â€˜1â€™ in the current value of this Feature (refer to section
4.4) and the controller processes a Set Features command for this Feature that specifies:
â€¢
the Enable Tail Pointer Trigger (ETPT) bit set to â€˜1â€™; and
â€¢
a slot in the Tail Pointer Trigger (TPT) field,
then prior to posting the completion for that Set Features command, the controller may post an entry into
the specified CDQ in the slot specified by the value of the TPT field that had been set prior to processing
that Set Features command. To detect this condition, after receiving the completion of that Set Features
command, a host should examine the CDQ to determine if the requested tail pointer trigger has already
occurred. If the requested tail pointer trigger has occurred, then a subsequent Set Features command
should be submitted by the host to disable the Tail Pointer Trigger event or request a different tail pointer
trigger.
If a Get Features command is submitted for this Feature, the attributes described in Figure 443 are returned
in Dword 0 of the completion queue entry and the attributes described in Figure 447 are returned in the
data buffer for that command.
If the CDQ is empty (refer to section 3.3.1.4) and the Head Pointer field specifies a value that is not the
same value as the current value, then the controller shall abort the command with a status code of Invalid
Field in Command.
If the CDQ is not empty and the Head Pointer field specifies a slot not associated with an entry that was
posted by the controller within the specified CDQ, then the controller shall abort the command with a status
code of Invalid Field in Command.
If the Enable Tail Pointer Trigger bit is set to â€˜1â€™ and the Tail Pointer Trigger field specifies a slot not
associated with an entry within the specified CDQ, then the controller shall abort the command with a
status code of Invalid Field in Command.
If the value in the Controller Data Queue Identifier field specifies a CDQ that does not exist in the controller
processing the command, then the controller shall abort the command with a status code of Invalid
Controller Data Queue.


---
### ðŸ“Š Tables (2)

#### Table 1: Table_5_2_26_1_23_Controller_Data_Queue_Feature_Identifier_21h_1
![Table_5_2_26_1_23_Controller_Data_Queue_Feature_Identifier_21h_1](../section_images/Table_5_2_26_1_23_Controller_Data_Queue_Feature_Identifier_21h_1.png)

| Bits | Description |
| :--- | :--- |
| 31 | **Enable Tail Pointer Trigger (ETPT):** If this bit is set to '1', then the controller is to generate a Controller Data Queue Tail Pointer event when that controller posts the entry into the slot specified by the TPT field for the specified CDQ. If this bit is cleared to '0', then there is no request for a Controller Data Queue Tail Pointer event to be sent by the controller.<br>If a Controller Data Queue Tail Pointer event is generated for the specified Controller Data Queue, then the current value of this bit for this Feature shall be cleared to '0' (i.e., the current value for this bit only enables a single occurrence of a Controller Data Queue Tail Pointer event for the specified Controller Data Queue). |
| 30:16 | For a Get Features command, this field shall be ignored by the controller. |
| | |
| Bits | Description |
| 15:00 | **Controller Data Queue Identifier (CDQID):** This field contains the identifier associated with the CDQ. |
| | |
| Bits | Description |
| 31:00 | **Head Pointer (HP):** This field specifies the slot of the head pointer for the specified CDQ. |
| | |
| Bits | Description |
| 31:00 | **Tail Pointer Trigger (TPT):** If the ETPT bit is set to '1', then this field specifies a slot in the CDQ that when posted with an entry causes the controller to issue a Controller Data Queue Tail Pointer event.<br>For a Set Features command, if the ETPT bit is cleared to '0', then this field shall be ignored by the controller.<br>For a Get Features command, this field shall be ignored by the controller. |


#### Table 2: Table_5_2_26_1_23_Controller_Data_Queue_Feature_Identifier_21h_2
![Table_5_2_26_1_23_Controller_Data_Queue_Feature_Identifier_21h_2](../section_images/Table_5_2_26_1_23_Controller_Data_Queue_Feature_Identifier_21h_2.png)

| Bytes | Description |
| :--- | :--- |
| 03:00 | **Head Pointer (HP):** This field indicates the slot of the head pointer for the specified CDQ. |
| 07:04 | **Tail Pointer Trigger (TPT):** If the ETPT bit is set to '1', then this field indicates the slot in the CDQ that when posted with an entry causes the controller to issue a Controller Data Queue Tail Pointer event. <br> If the ETPT bit is cleared to '0', then this field shall be cleared to 0h and should be ignored by the host. |
| 511:08 | Reserved |

