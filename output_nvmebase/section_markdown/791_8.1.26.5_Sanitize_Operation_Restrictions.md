##### 8.1.26.5 Sanitize Operation Restrictions

> **Section ID**: 8.1.26.5 | **Page**: 672-673

In the following states:
•
Restricted Processing;
•
Restricted Failure;
•
Unrestricted Processing;
•
Unrestricted Failure;
•
Media Verification; and
•
Post-Verification Deallocation,
all enabled controllers in the NVM subsystem have restrictions in the set of actions that they are allowed to
perform.
When a sanitize operation starts on any controller (i.e., a transition into the Restricted Processing state
occurs or a transition into the Unrestricted Processing state occurs), all controllers in the NVM subsystem
shall:
•
update the Sanitize Status log page for the sanitization target (refer to section 5.2.12.1.36);
•
suspend autonomous power state management activities as described in section 8.1.18.2;
•
for NVM subsystem sanitize operations:
clear all of the following outstanding asynchronous events:
▪
Sanitize Operation Completed asynchronous event, if any;
▪
Sanitize Operation Completed With Unexpected Deallocation asynchronous event, if any;
and
▪
Sanitize Operation Entered Media Verification State asynchronous event, if any;
abort any command (submitted or in progress) not allowed during an NVM subsystem sanitize
operation (refer to Figure 143) with a status code of Sanitize In Progress, unless otherwise
specified (e.g., a media verification Read command);
abort any in progress device self-test operations; and
release stream identifiers for any open streams;
and
•
for namespace sanitize operations:
•
for namespace sanitize operations:
abort any I/O command (submitted or in progress) specifying the NSID of the namespace,
unless otherwise specified (e.g., a media verification Read command);
process any Admin command as specified in section 5.1.2;
abort any in progress device self-test operations specifying the NSID of the namespace or
specifying the NSID set to FFFFFFFFh; and
release stream identifiers allocated for exclusive use by the namespace for any open streams.
If a sanitize operation is in any of the following states (i.e., is in progress):
•
Restricted Processing;
•
Unrestricted Processing;
•
Media Verification; or
•
Post-Verification Deallocation,
then for each controller in the NVM subsystem:
•
processing of a Flush command is specified in section 7.2;
•
activation of new firmware is prohibited;
•
if the sanitization target is the NVM subsystem:
all I/O commands other than a Flush command shall be aborted with a status code of
Sanitize In Progress, unless otherwise specified;
any command or command option that is not explicitly permitted in Figure 143 shall be
aborted with a status code of Sanitize In Progress if processed by the controller;
the Persistent Memory Region shall be prevented from being enabled (i.e., setting
PMRCTL.EN to ‘1’ does not result in PMRSTS.NRDY being cleared to ‘0’); and
Set Features commands for the CDP feature (refer to section 8.1.6.1) shall be aborted with
a status code of Sanitize In Progress;
and
•
if the sanitization target is a namespace, then for each controller in the NVM subsystem:
if the sanitize operation is in the Media Verification state, then the Sanitize Namespace
command is permitted with access restrictions (refer to section 8.1.26.3);
all I/O commands specifying the NSID of the namespace, other than a Flush command,
shall be aborted with a status code of Sanitize Namespace In Progress, unless otherwise
specified; and
all Admin commands shall be processed by the controller as specified in section 5.1.2.
While the sanitization target is in the Restricted Failure state or the Unrestricted Failure state, then for each
controller in the NVM subsystem:
•
the Sanitize command is permitted with action restrictions (refer to section 5.2.22);
•
if the sanitization target is the NVM subsystem, then:
any command or command option that is not explicitly permitted in Figure 143 shall be
aborted with a status code of Sanitize In Progress if processed by the controller;
all I/O commands other than a Flush command (refer to section 7.2), shall be aborted with
a status code of Sanitize Failed; and
the Persistent Memory Region shall be prevented from being enabled (i.e., setting
PMRCTL.EN to ‘1’ does not result in PMRSTS.NRDY being cleared to ‘0’);
and
•
if the sanitization target is a namespace, then:
the Sanitize command is permitted with access restrictions (refer to section 8.1.26.3);
the Sanitize Namespace command is permitted with access restrictions (refer to section
8.1.26.3);
all Admin commands other than a Sanitize command or a Sanitize Namespace command
shall be processed by the controller as specified in section 5.1.2; and
all I/O commands that specify the NSID of the namespace, other than a Flush command
(refer to section 7.2), shall be aborted with a status code of Sanitize Namespace Failed;
When a sanitize operation starts on any controller in an NVM subsystem (i.e., a transition into the Restricted
Processing state occurs or a transition into the Unrestricted Processing state occurs), all Management
Endpoints in the NVM subsystem shall perform the sanitize operation as described in the NVM Express
Management Interface Specification.
