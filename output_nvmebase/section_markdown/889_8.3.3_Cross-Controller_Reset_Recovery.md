#### 8.3.3 Cross-Controller Reset Recovery

> **Section ID**: 8.3.3 | **Page**: 729-731

Cross-Controller Reset Recovery is a capability that enables a host to recover from a loss of communication
with one controller, the Impacted Controller, via use of another controller, the Source Controller, in the same
NVM subsystem. The host submits a Cross-Controller Reset command to the Source Controller, which
causes the NVM subsystem to initiate a Cross-Controller Reset operation to perform a Controller Level
Reset (CLR) on the Impacted Controller. The host determines the result of the Cross-Controller Reset
operation either:
•
from the Immediate Reset Successful (IRS) bit reported by the CQE of that Cross-Controller Reset
command; or
•
by reading the completed entry associated with that operation in the Cross-Controller Reset log
page from the Source Controller,
enabling the host to determine whether and when a specific instance of the Impacted Controller is no longer
processing outstanding commands (refer to section 3.4.5) so that the host may proceed with retrying
commands as described in section 9.6.3.
An instance of an Impacted Controller exists from the time that Impacted Controller is enabled until the time
that Impacted Controller is no longer able to process non-Fabrics commands. An instance of an Impacted
Controller is identified by the controller ID, the value of the Controller Instance Uniquifier (CIU) field in the
Identify Controller data structure (refer to Figure 328), and the value of the Controller Instance Random
Number field in the Identify Controller data structure. Determining that the instance changed (e.g., through
a change in the CIU or a completed CLR) is a method for the host to determine that an instance of the
Impacted Controller is no longer processing commands.
If a controller supports causing the NVM subsystem to initiate a Cross-Controller Reset operation, then that
controller shall support:
•
the Cross-Controller Reset command (refer to section 5.4.3);
•
the Cross-Controller Reset log page (refer to section 5.2.12.3.1); and
•
the Cross-Controller Reset Completed asynchronous event (refer to Figure 154).
If a controller supports causing the NVM subsystem to initiate a Cross-Controller Reset operation, then that
controller should support the Lost Host Communication log page (refer to section 5.2.12.3.2) and the Lost
Host Communication asynchronous event (refer to Figure 154).
If a controller supports being reset by the Cross-Controller Reset operation, then that controller shall support
these fields in the Identify Controller data structure (refer to Figure 328):
•
the Controller Instance Uniquifier (CIU) field;
•
the Controller Instance Random Number (CIRN) field; and
•
the Command Quiesce Time (CQT) field.
Support for the Cross-Controller Reset operation should be the same across all controllers in an NVM
subsystem (i.e., all controllers support causing the NVM subsystem to initiate that operation and being reset
by that operation, or all controllers do not support causing the NVM subsystem to initiate that operation and
being reset by that operation).
The limit on the number of simultaneous in-progress Cross-Controller Reset operations the Source
Controller is able to cause the NVM subsystem to initiate is indicated in the Cross-Controller Reset Limit
field of the Identify Controller data structure (refer to Figure 328). A host should not submit Cross-Controller
Reset commands such that the number of outstanding Cross-Controller Reset operations the Source
Controller causes the NVM subsystem to initiate would exceed this limit. If a Source Controller is processing
a Cross-Controller Reset command and detects that causing the NVM subsystem to initiate a Cross-
Controller Reset operation would exceed this limit, then that Source Controller shall abort that command
with a status code of Cross-Controller Reset Limit Exceeded.
As described in section 5.4.3, to complete a Cross-Controller Reset command successfully, the Source
Controller causes the NVM subsystem to initiate a Cross-Controller Reset operation. If that operation
completes successfully before the CQE of the Cross-Controller Reset command is posted, the IRS bit in
the CQE is set to ‘1’ (refer to Figure 527). If that operation does not complete successfully before the CQE
of the Cross-Controller Reset command that caused the NVM subsystem to initiate that operation is posted,
an entry is added to the Cross-Controller Reset log page for that operation, and, upon completion of that
operation, the results (including, the Validated (V) bit and the Controller Level Reset Initiated (CLRI) bit)
are recorded in that entry (refer to Figure 305). If Cross-Controller Reset Completed Notices are enabled,
then the Source Controller shall report a Cross-Controller Reset Completed Notice asynchronous event
(refer to Figure 154) upon recording the result of that operation in the associated entry in the Cross-
Controller Reset log page.
If that Cross-Controller Reset operation is successful, then the host is able to proceed with recovery (refer
to section 9.6.3) for outstanding commands sent to the instance of the Impacted Controller specified in the
CIU field, CIRNL field and CIRNU field in the Cross-Controller Reset command. If that Cross-Controller
Reset operation is not successful and host retry of the Cross-Controller Reset command on another
controller is likely to result in a successful Cross-Controller Reset operation, then the Source Controller is
able to provide the controller ID for such a controller in the Alternate Controller ID (ACID) field (refer to
Figure 305). If a specific alternate controller ID is provided (i.e., value of the ACID field is not set to FFFFh),
then that alternate controller shall be associated with the host that submitted the Cross-Controller Reset
command. If a specific alternate controller ID is not provided, the host should use the Retry bit in the
associated entry in the Cross-Controller Reset log page to decide whether to:
•
retry Cross-Controller Reset Recovery using an alternate controller that the host chooses, using
the guidelines in section 5.4.3; or
•
end Cross-Controller Reset Recovery and rely on Time-Based Recovery (refer to section 9.6.2.1).
A Cross-Controller Reset operation is expected to take less time than using KATO and CQT for Time-Based
Recovery as described in section 9.6.2.1, independent of whether the Cross-Controller Reset operation is
successful or not.
An NVM Subsystem Reset terminates all in-progress Cross-Controller Reset operations and removes all
entries in the Cross-Controller Reset log page for each controller in the domain being reset (refer to section
5.2.12.3.1). A Controller Level Reset (CLR) removes all entries for completed operations in the Cross-
Controller Reset log page for the controller processing the CLR. An NVM Subsystem Shutdown pauses
processing of all in-progress Cross-Controller Reset operations.
