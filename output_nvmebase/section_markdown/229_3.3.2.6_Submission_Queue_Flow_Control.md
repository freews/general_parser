##### 3.3.2.6 Submission Queue Flow Control

> **Section ID**: 3.3.2.6 | **Page**: 122-122

This section applies only to Submission Queues that use SQ flow control.
The Submission Queue has a Head entry pointer and a Tail entry pointer that are used to manage the
queue and determine the number of Submission Queue capsules available to the host for new submissions.
The Head and Tail entry pointers are initialized to 0h when a queue is created. All arithmetic operations
and comparisons on entry pointers are performed modulo the queue size with queue wrap conditions taken
into account. The host increments the Tail entry pointer when the host adds a capsule to a queue. The
controller increments the Head entry pointer when that controller removes a capsule from the queue.
The Submission Queue Head entry pointer is maintained by the controller and is communicated to the host
in the SQHD field of completion queue entries. The host uses the received SQHD values for Submission
Queue management (e.g., to determine whether the Submission Queue is full).
The Submission Queue Tail entry pointer is local to the host and is not communicated to the controller.
The Submission Queue is full when the Head entry pointer equals one more than the Tail entry pointer (i.e.,
incrementing the Tail entry pointer has caused it to wrap around to just behind the Head entry pointer). A
full Submission Queue contains one less capsule than the queue size. A host may continue to submit
commands to a Submission Queue as long as the queue is not full.
If the controller detects that the host has submitted a command capsule to a full Submission Queue, then
the controller shall:
a) stop processing commands and set the Controller Fatal Status (CSTS.CFS) bit to ‘1’ (refer to
section 9.5); and
b) terminate the NVMe Transport connection and end the association between the host and the
controller.
The Submission Queue is empty when the Head entry pointer equals the Tail entry pointer.
