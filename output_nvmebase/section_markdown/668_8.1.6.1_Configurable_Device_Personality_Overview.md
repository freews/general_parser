##### 8.1.6.1 Configurable Device Personality Overview

> **Section ID**: 8.1.6.1 | **Page**: 559-561

The Configurable Device Personality (CDP) is an optional capability allowing a host to change the NVM
subsystem configuration. If the CDP capability is supported, then all controllers in the NVM subsystem shall
support:
•
the Configurable Device Personality feature;
•
the Device Personalities log page;
•
the Persistent Event log page;
•
the Device Personality Change Event (refer to section 5.2.12.1.14.2.15); and
•
at least one personality, other than the Manufacturing Default Personality (refer to section
5.2.12.1.28).
A change to the settings of the personality specified in a Set Features command for this Feature consists
of the settings of that personality taking effect in the NVM subsystem as described in this section.
Personality settings are any of the following:
•
feature values for the personality specified by the Set Features command with the Configurable
Device Personality feature (e.g., settings in the Security Personality that allow a host to enable or
disable security protocols);
•
feature values for personalities other than the personality specified by the Set Features command
(e.g., the Manufacturing Default Personality causes the feature current value of all other
personalities in the NVM subsystem to change to the feature default value);
•
settings that are host visible via means other than feature values (e.g., a field in the Identify
Controller data structure); or
•
internal NVM subsystem settings that are not host visible using methods defined by this
specification.
A host submits a Set Features command specifying the CDP feature (refer to section 5.2.26.1.24) for a
given personality to request any of the following:
•
a change to the settings of the specified personality (i.e., the command specifies the Change
Personality Settings bit (CHPS) set to ‘1’, and the command may specify additional data in the
command data buffer); and
•
a personality to be frozen (i.e., the command specifies the Freeze State bit set to ‘1’).
If a Set Features command specifying the CDP feature requests the specified personality to be frozen, then
the controller shall freeze that personality before the successful completion of the Set Features command
(i.e., the personality is frozen and therefore prevents a host from making further changes to that
personality).
If no reset is required for the settings of the specified personality to be changed, as indicated by the
Minimum Required Reset Type (MRSTT) field in Figure 285, then that change shall take effect before the
successful completion of the Set Features command.
If a reset is required for the settings of the specified personality to be changed, then that change of the
settings of the specified personality is pending and shall be changed as the result of the required reset
being performed by the controller processing the Set Features command.
If the settings of the specified personality that are requested to be changed are not changed (i.e., any
settings of that personality fail to take effect), then the controller shall:
a) log the failure in the Persistent Event log page (refer to section 5.2.12.1.14.2.15); and
b) clear the Pending Personality Settings Change (PPSC) bit (refer to Figure 449).
If the settings of a personality fail to be changed, then the controller shall continue operating with the
personality settings prior to the requested change and if the personality was frozen as part of the change,
that personality shall be unfrozen by the controller. If the controller is not able to continue operating with
the prior personality settings (e.g., because changes were made to the personality’s settings and are unable
to be reverted to the prior settings), then:
•
the results of the personality failing to be changed are indeterminate and the NVM subsystem
behavior is undefined; and
•
the controller shall set the Indeterminate Personality State (IPS) bit to ‘1’ in the SMART / Health
Information log page (refer to Figure 209).
If a change to the settings of any personality, other than the Manufacturing Default Personality, takes effect,
then the controller shall clear the PMDSS bit to ‘0’ (refer to Figure 285) for that personality and for the
Manufacturing Default Personality.
Changing the settings of a personality may have an effect on user data as indicated by the Personality
Settings Change User Data Effect (PSCUDE) bit (refer to Figure 285).
If a firmware image is determined to be incompatible with the current personality settings, then the host
should submit a Set Features command that specifies the Manufacturing Default Personality prior to
attempting to commit that firmware image. While processing a Firmware Commit command, if the controller
detects that the specified firmware image is incompatible with current personality settings as part of the
firmware update process (refer to section 3.11), then the controller shall abort the Firmware Commit
command with a status code of Manufacturing Default Personality Required.
The NVM subsystem may be left in an indeterminate state if:
•
the currently active firmware image is not able to be successfully loaded, and the controller reverts
to a different firmware image that is incompatible with current personality settings; or
•
the settings of a personality fail to be changed, and the controller is not able to revert to the previous
personality settings.
If a firmware activation with reset is pending (refer to section 3.11), then the controller shall abort a Set
Features command specifying the CDP feature that changes a personality with a status code of Feature
Not Changeable.
If a change to the settings of a personality is pending in the NVM subsystem and any of the following
commands are processed, then the controller shall abort the command with a status code of Access
Denied:
•
Sanitize (refer to section 5.1.22);
•
Sanitize Namespace (refer to section 5.2.23);
•
Firmware Commit (refer to section 5.1.8); and
•
Firmware Image Download (refer to section 5.1.9).
If a change to the settings of a personality is pending in the NVM subsystem and a host submits a Set
Features command requesting to change:
•
settings of a different personality than the personality whose settings change is pending; or
•
any of the settings of the same personality as the pending personality, but with a different value,
then the controller processing the Set Features command shall abort the Set Features command with a
status code of Feature Not Changeable.
If a Get Features command completes successfully for the CDP feature with a PERID field value other than
FFh in Command Dword 13 (refer to Figure 448), then the attributes described in Figure 449 shall be
returned corresponding to that specified personality.
If a Get Features command is successfully processed for the CDP feature with a PERID field value of FFh
in Command Dword 13 and:
•
there is a pending change to the settings of a personality in the NVM subsystem, then the attributes
described in Figure 449 shall be returned corresponding to that pending change; or
•
there is no pending change to the settings of a personality in the NVM subsystem, then the value
of the PERID field in completion queue entry Dword 0 shall be set to FFh and all other fields in
completion queue entry Dword 0 shall be cleared to 0h.
It is not an error to attempt to change:
•
the settings of a personality to the same settings as the pending change of that personality; or
•
the settings of a frozen or unfrozen personality to the same settings as that personality’s current
settings.
If a Set Features command is processed for the CDP feature that attempts to change the settings of a
personality that is currently frozen to a different value, then the controller shall abort the command with a
status code of Feature Not Changeable.
If a Set Features command is successfully processed that specifies to freeze all personalities (i.e., the
Personality Identifier (PERID) field is set to the All Personalities value of FFh (refer to Figure 447) and the
Personality Freeze State (PERFS) bit set to ‘1’ (refer to Figure 448)), then the controller shall freeze all
personalities and none of the settings of any personalities are changed.
