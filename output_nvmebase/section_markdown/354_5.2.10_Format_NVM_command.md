#### 5.2.10 Format NVM command

> **Section ID**: 5.2.10 | **Page**: 224-227

The Format NVM command is used to low level format the NVM media. This command is used by the host
to change the attributes of the NVM media (e.g., the LBA data size and/or metadata size for the NVM
Command Set). A low level format may destroy all data and metadata associated with all namespaces that
contain formatted storage or only the specific namespace associated with the command (refer to the Format
NVM Attributes field in the Identify Controller data structure, Figure 328). After the Format NVM command
successfully completes, the controller shall not return any user data that was previously contained in an
affected namespace.
As part of the Format NVM command, the host requests a format operation and may request a secure
erase of the contents of the NVM (refer to the SES field in Figure 193). There are two types of secure erase.
The User Data Erase erases all user content present in the NVM subsystem. The Cryptographic Erase
erases all user content present in the NVM subsystem by deleting the encryption key with which the user
data was previously encrypted.
The scope of the format operation and the scope of the format with secure erase depend on the attributes
that the controller supports for the Format NVM command and the Namespace Identifier specified in the
command as described in Figure 192. The type of secure erase, if applicable, is based on the setting of the
Secure Erase Settings field in Command Dword 10 as defined in Figure 193.
The scope of the entire Format NVM command is determined by the value of the SES field (refer to Figure
193) and the setting of either the Format Namespace Scope (FNS) bit or the Secure Erase Namespace
Scope (SENS) bit (refer to Figure 328) as follows:
a) If the Format NVM command does not specify Secure Erase (i.e., the SES field is cleared to 000b),
then the scope of the Format NVM command is indicated by the value of FNS bit and the value of
SENS bit is not applicable to this command.
b) If the Format NVM command specifies Secure Erase (i.e., the SES field is set to a non-zero value),
then the scope of the Format NVM command is indicated by the value of SENS bit and the value
of FNS bit is not applicable to this command.
If the NVM subsystem supports multiple domains and the Format NVM command is not able to format the
specified namespaces as a result of the NVM subsystem being divided (refer to section 3.2.5), then the
Format NVM command shall be aborted with a status code of Asymmetric Access Inaccessible or
Asymmetric Access Persistent Loss.
The Format NVM command may be aborted with a status code defined in this specification under
circumstances defined by a security specification (e.g., invalid security state as specified in TCG Storage
Interface Interactions specification). If there are I/O commands being processed for a namespace, then a
Format NVM command that is submitted affecting that namespace may be aborted; if aborted, then a status
code of Command Sequence Error shall be returned. If a Format NVM command is in progress, then an
I/O command that is submitted for any namespace affected by that Format NVM command may be aborted;
if aborted, then a status code of Format in Progress shall be returned. Refer to section 5 for further
information about restrictions on Admin commands during Format NVM.
For a Format NVM command with the NSID field set to FFFFFFFFh that specifies secure erase:
a) if the Secure Erase Namespace Scope (SENS) bit is set to â€˜1â€™ in the FNA field (refer to Figure 328)
and there are no namespaces in the NVM subsystem, then that Format NVM command shall
complete without error; and
b) if the SENS bit is cleared to â€˜0â€™ in the FNA field and there are no attached namespaces, then that
Format NVM command shall complete without error.
For a Format NVM command with an NSID field set to FFFFFFFFh that does not specify a secure erase:
a) if the Format Namespace Scope (FNS) bit is set to â€˜1â€™ in the FNA field and there are no namespaces
in the NVM subsystem, then that Format NVM command shall complete without error; and
b) if the FNS bit is cleared to â€˜0â€™ in the FNA field and there are no attached namespaces, then that
Format NVM command shall complete without error.
If a host does not set the LBA Format Extension Enable (LBAFEE) field to 1h in the Host Behavior Support
feature (refer to section 5.2.26.1.14), then the 0h value of the LBAFEE field disables any I/O Command Set
specific format that requires the LBAFEE field to be set to 1h (refer to the applicable NVM Express I/O
Command Set specification). If a Format NVM command specifies a format that is disabled (e.g., the
LBAFEE field is cleared to 0h), then the controller shall abort that Format NVM command with a status code
of Invalid Namespace or Format.
If the format operation scope (refer to Figure 192) for a Format NVM command includes any namespace
that is write protected (refer to section 8.1.17), then the controller aborts that Format NVM command with
a status code of Namespace is Write Protected.
If the Format NVM Broadcast Support (FNVMBS) bit in the FNA field is set to â€˜1â€™ and a Format NVM
command has the NSID field set to FFFFFFFFh, then the controller shall abort that command with a status
code of Invalid Field in Command.
After successful completion of a Format NVM command, the settings specified in the Format NVM
command (e.g., the PI field, the MSET field, the LBAFL field, and the LBAFU field) are reported as part of
the Identify Namespace data structures (refer to section 1.5.50).
The Format NVM command uses the Command Dword 10 field. All other command specific fields are
reserved.


---
### ðŸ“Š Tables (2)

#### Table 1: Table_5_2_10_Format_NVM_command_1
![Table_5_2_10_Format_NVM_command_1](../section_images/Table_5_2_10_Format_NVM_command_1.png)

| SES | FNS Bit | SENS Bit | NSID | Format Operation |
| :--- | :--- | :--- | :--- | :--- |
| 000b (i.e., not a secure erase) | 0 | N/A | FFFFFFFFÂ¹ | All namespaces attached to the controller. Other namespaces are not affected. |
| | 0 | | Any allocated value (refer to section 3.2.1.3) | The specified namespace. Other namespaces are not affected. |
| | 1 | | Any allocated value (refer to section 3.2.1.3) or FFFFFFFFh | All namespaces that exist in the NVM subsystem. |
| 001b or 010b (i.e., secure erase) | N/A | 0 | FFFFFFFFÂ¹ | All namespaces attached to the controller. Other namespaces are not affected. |
| | | 0 | Any allocated value (refer to section 3.2.1.3) | The specified namespace. Other namespaces are not affected. |
| | | 1 | Any allocated value (refer to section 3.2.1.3) or FFFFFFFFh | All namespaces that exist in the NVM subsystem. |
| | All others | | | The controller shall abort the command with a status code of Invalid Field in Command |
| Notes: | | | | |
| | | | | 1. If the Format NVM Broadcast Support (FNVMBS) bit in the FNA field is set to '1', then this value is not supported, and the command is aborted as described in this section. |


#### Table 2: Table_5_2_10_Format_NVM_command_2
![Table_5_2_10_Format_NVM_command_2](../section_images/Table_5_2_10_Format_NVM_command_2.png)

| Bits | Description |
| :--- | :--- |
| 31:14 | LBA Format Upper (LBAFU): This field specifies the most significant 2 bits of the Format Index of the User Data Format to apply to the NVM media. This corresponds to the User Data Formats indicated in the Identify command, refer to the Identify Namespace data structure and the LBA Format data structure in the applicable NVM Express I/O Command Set specification. If an unsupported User Data Format is selected, the controller shall abort the command with a status code of Invalid Format.<br><br>This field shall be ignored by the controller if the LBA Format Extension Enable (LBAFEE) field is cleared to 0h in the Host Behavior Support feature (refer to section 5.2.26.1.14).<br><br>NOTE: This field applies to all User Data Formats. The original name has been retained for historical continuity. |
| 13:12 | |
| | |
| 11:09 | Secure Erase Settings (SES): This field specifies whether a secure erase should be performed as part of the format and the type of the secure erase operation. The erase applies to all user data, regardless of location (e.g., within an exposed LBA (refer to the NVM Express NVM Command Set Specification), within a cache, within deallocated logical blocks, etc.). |
| | <table><tbody><tr><th>Value</th><th>Definition</th></tr><tr><td>000b</td><td>No secure erase operation requested</td></tr><tr><td>001b</td><td>User Data Erase: All user data shall be erased, contents of the media allocated for user data after the erase is indeterminate (e.g., the user data may be zero filled, one filled, etc.). If a User Data Erase is requested and all affected user data is encrypted, then the controller is allowed to use a cryptographic erase to perform the requested User Data Erase.</td></tr><tr><td>010b</td><td>Cryptographic Erase: All user data shall be erased cryptographically. This is accomplished by deleting the encryption key.</td></tr><tr><td>011b to 111b</td><td>Reserved</td></tr></tbody></table> |
| 08 | Protection Information Location (PIL): I/O Command Set specific definition.Â¹ |
| 07:05 | Protection Information (PI): I/O Command Set specific definition.Â¹ |
| 04 | Metadata Settings (MSET): I/O Command Set specific definition.Â¹ |
| | |
| 03:00 | LBA Format Lower (LBAFL): This field specifies the least significant 4 bits of the Format Index of the User Data Format to apply to the NVM media. This corresponds to the User Data Formats indicated in the Identify Namespace data structure, refer to the Identify Namespace data structure and the I/O Command Set specific data structure in the applicable NVM Express I/O Command Set specification. If an unsupported User Data Format is selected, the controller shall abort the command with a status code of Invalid Format.<br><br>Note: This field applies to all User Data Formats. The original name has been retained for historical continuity. |
| | |
| | Note: 1. I/O Command Set specific fields are described in the applicable NVM Express I/O Command Set specification. |

