###### 8.3.2.3.8.2.2 Add/Replace Active ZoneGroup (AAZ)

> **Section ID**: 8.3.2.3.8.2.2 | **Page**: 720-722

The Add/Replace Active ZoneGroup (AAZ) operation allows a DDC to add or replace in the CDC an active
ZoneGroup associated with the DDC initiating the AAZ operation. For a push model DDC, the AAZ
operation is mapped to an FZL command to lookup the key of the ZoneGroup to add or replace in
ZoneDBActive in that CDC, followed by one or more FZS commands to provide the CDC with the
ZoneGroup to add or replace, as shown in Figure 758.
The identifier of the ZoneGroup to add or replace is provided in the FZL buffer, as shown in Figure 759.
The FZL command returns the key of the ZoneGroup to add or replace as a Zoning Data key value in the
Completion Queue. For the FZL command of an AAZ operation:
‚Ä¢
if the ZoneGroup that matches the specified FZL data exists in ZoneDBActive in that CDC and is
locked by another administrative interface, then the CDC shall abort the command with a status
code of Zoning Data Structure Locked;
‚Ä¢
if the ZoneGroup that matches the specified FZL data exists in ZoneDBActive in that CDC and is
not locked by another administrative interface, then that ZoneGroup should be locked by the
submitting DDC and its key shall be returned as the Zoning Data key in the Completion Queue; or
‚Ä¢
if the ZoneGroup that matches the specified FZL data does not exist in ZoneDBActive in that CDC,
then an empty ZoneGroup having the provided identifier shall be created in ZoneDBActive in that
CDC, that ZoneGroup should be locked by the submitting DDC, and its key shall be returned as
the Zoning Data key in the Completion Queue.
Successful completion of the FZL command for the AAZ operation results in the identified ZoneGroup on
the CDC being locked by the DDC performing the operation.
The ZoneGroup to add or replace is provided in the FZS buffer of subsequent FZS commands with the
appropriate Zoning Data key in Command Dword 10 (refer to Figure 546) and is transferred in one or more
fragments, as needed, as shown in Figure 760. The FZS command sending the last fragment shall have
the Last Fragment (LF) bit set to ‚Äò1‚Äô in Command Dword 12 (refer to Figure 548).
For the FZS command of an AAZ request operation:
‚Ä¢
if the ZoneGroup identified by the specified ZoneGroup key does not exist on the CDC, then the
CDC shall abort the command with a status code of Zoning Data Structure Not Found; or
‚Ä¢
if the ZoneGroup identified by the specified ZoneGroup key is locked by another entity on the CDC
(i.e., another administrative interface is modifying that ZoneGroup), then the CDC shall abort the
command with a status code of Zoning Data Structure Locked.
The CDC shall update a ZoneGroup and increment its generation number only upon successful reception
of the full ZoneGroup (i.e., all of the fragments of the ZoneGroup). Successful receipt of the full ZoneGroup
for the AAZ operation shall unlock the identified ZoneGroup on the CDC. If the full ZoneGroup is not
received within 30 seconds from the establishment of the lock (during processing of the related FZL
command), then all the received data shall be discarded and the lock shall be released (i.e., ZoneDBActive
in that CDC is not changed).
The CDC may enforce access restrictions to the Zoning data structures. In this case, the CDC shall check
if the DDC issuing the FZL command or FZS command is authorized to write the ZoneGroup specified in
the FZL data (e.g., if the CDC allows access to a ZoneGroup only to the DDC that created that ZoneGroup,
verify that the ZoneGroup Originator field matches the NQN contained in the HOSTNQN field of the Connect
command sent from the DDC to that CDC). If that DDC is not authorized to access the specified ZoneGroup,
then the CDC shall abort the FZL command and the FZS command with a status code of ZoneGroup
Originator Invalid.


---
### üñºÔ∏è Figures (2)

#### Figure 1: Figure 758: AAZ for Push Model DDC
![Figure 758: AAZ for Push Model DDC](../section_images/Figure_8_3_2_3_8_2_2_Add_Replace_Active_ZoneGroup_AAZ_1.png)


#### Figure 2: Figure 759: FZL Data for AAZ
![Figure 759: FZL Data for AAZ](../section_images/Figure_8_3_2_3_8_2_2_Add_Replace_Active_ZoneGroup_AAZ_2.png)

