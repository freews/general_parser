###### 8.3.5.5.3 DH-HMAC-CHAP_Challenge Message

> **Section ID**: 8.3.5.5.3 | **Page**: 750-751

The DH-HMAC-CHAP_Challenge message is sent from the controller to the host. The format of the DH-
HMAC-CHAP Challenge message is shown in Figure 800.
Hash Length (HL): Shall be set to the length in bytes of the selected hash function, as specified in Figure
798.
HashID: Shall be set to the hash function identifier (refer to Figure 798) selected for this authentication
transaction among those proposed in the DH-HMAC-CHAP protocol descriptor in the AUTH_Negotiate
message. The controller shall select a hash function in accord with its applicable policy.
DHgID: Shall be set to the DH group identifier (refer to Figure 800) selected for this authentication
transaction among those proposed in the DH-HMAC-CHAP protocol descriptor in the AUTH_Negotiate
message. The controller shall select a DH group identifier in accord with its applicable policy. If this field is
cleared to 0h, then the DH portion of the DH-HMAC-CHAP protocol shall not be performed in this
authentication transaction. The controller shall not clear this field to 00h if the AUTH_Negotiate message
(refer to section 8.3.5.4.1) for this instance of the DH-HMAC-CHAP protocol requested secure channel
concatenation (i.e., the SC C field in that message was set to a non-zero value).
DH Value Length (DHVLEN): Diffie-Hellman exponential length. This length shall be a multiple of 4. If the
DH group identifier is cleared to 0h (i.e., NULL DH exchange), this field shall be cleared to 0h. Otherwise,
it shall be set to the length in bytes of the DH Value.
Sequence Number (SEQNUM): 32-bit sequence number S1. A random non-zero value shall be used as
the initial value. The sequence number is incremented modulo 232 after each use, except that the value 0h
is skipped (i.e., incrementing the value FFFFFFFFh results in the value 00000001h).
Challenge Value (CVAL): Shall be set to a random challenge value C1 (refer to section 8.3.5.5.7). Each
challenge value should be unique and unpredictable, since repetition of a challenge value in conjunction
with the same key may reveal information about the key or the correct response to this challenge. The
algorithm for generating the challenge value is outside the scope of this specification. Randomness of the
challenge value is crucial to the security of the protocol (refer to section 8.3.5.5.7). The CVAL length is the
same as the length of the selected hash function (i.e., HL).
DH Value (DHV): Diffie-Hellman exponential. If the DH Value Length is cleared to 0h, this field is not
present. The DH value shall be set to the value of gx mod p, where x is a random number selected by the
controller that shall be at least 256 bits long (refer to section 8.3.5.5.7) and p and g shall have the values
indicated in Figure 799, based on the selected DH group identifier.
Upon receiving a DH-HMAC-CHAP_Challenge message, if:
‚Ä¢
the Hash Length (HL) does not match the value specified in Figure 798 for the selected hash
function;
‚Ä¢
the Sequence Number (SEQNUM) is cleared to 0h;
‚Ä¢
DHgID is cleared to 0h and the AUTH_Negotiate message (refer to section 8.3.5.4.1) that the host
sent for this instance of the DH-HMAC-CHAP protocol requested secure channel concatenation
(i.e., the SC_C field in that message is set to a non-zero value);
‚Ä¢
DHgID is non-zero and the DH Value Length (DHVLEN) is cleared to 0h; or
‚Ä¢
DHgID is non-zero and the DH Value (DHV) is 0, 1, or p-1;
then the host shall:
‚Ä¢
reply with an AUTH_Failure2 message having reason code ‚ÄòAuthentication failure‚Äô and reason code
explanation ‚ÄòIncorrect payload‚Äô; and
‚Ä¢
disconnect the NVMe over Fabrics connection.


---
### üñºÔ∏è Figures (1)

#### Figure 1: Figure 800: DH-HMAC-CHAP_Challenge message format
![Figure 800: DH-HMAC-CHAP_Challenge message format](../section_images/Figure_8_3_5_5_3_DH_HMAC_CHAP_Challenge_Message.png)

