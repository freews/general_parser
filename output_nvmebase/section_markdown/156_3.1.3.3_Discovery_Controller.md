##### 3.1.3.3 Discovery Controller

> **Section ID**: 3.1.3.3 | **Page**: 65-67

A Discovery controller is a controller used in NVMe over Fabrics. A Discovery controller enables a host to
discover other NVM subsystems or other Discovery subsystems. A Discovery controller only implements
features related to Discovering other subsystems and does not implement I/O Queues, I/O commands, or
expose namespaces. The features supported by the Discovery controller are defined in section 3.1.3.6.
If the Discovery subsystem provides a unique Discovery Service NQN (i.e., the NVM Subsystem NVMe
Qualified Name (SUBNQN) field in that Discovery subsystemâ€™s Identify Controller data structure contains a
unique Discovery Service NQN value), then that Discovery subsystem shall support both the unique
Discovery
Service
NQN
and
the
well-known
Discovery
Service
NQN
(i.e.,
nqn.2014-
08.org.nvmexpress.discovery) being specified in the Connect command (refer to section 6.3) from the host.
If the Discovery subsystem does not provide a unique Discovery Service NQN (i.e., the SUBNQN field in
that Discovery subsystemâ€™s Identify Controller data structure contains the well-known Discovery Service
NQN), then that Discovery subsystem shall support the well-known Discovery Service NQN being specified
in the Connect command from the host.
In the Connect command to a Discovery subsystem that provides a unique Discovery Service NQN, the
host may use either of the following:
â€¢
the well-known Discovery Service NQN; or
â€¢
the unique Discovery Service NQN of that Discovery subsystem.
In the Connect command to a Discovery subsystem that does not provide a unique Discovery Service NQN
the host uses the well-known Discovery Service NQN.
The method that a host uses to obtain the fabric information necessary to connect to a Discovery controller
using the well-known Discovery Service NQN or the unique NQN via the NVMe Transport may be:
a) implementation specific;
b) fabric specific;
c) known in advance (e.g., a well-known address);
d) administratively configured; or
e) for IP-based fabrics, Automated Discovery of Discovery Controllers for IP-based Fabrics (refer to
section 8.3.1) may be used.
The Discovery log page provided by a Discovery controller contains one or more entries. Each entry
specifies information necessary for the host to connect to an NVM subsystem. An entry may be associated
with an NVM subsystem that exposes namespaces or a referral to another Discovery Service. There are
no ordering requirements for log page entries within the Discovery log page.
Discovery controller(s) may provide different log page contents depending on the Host NQN provided (e.g.,
different NVM subsystems may be accessible to different hosts). The set of Discovery Log Page Entries
should include all applicable addresses on the same fabric as the Discovery Service and may include
addresses on other fabrics.
Discovery controllers that support explicit persistent connections shall support both the Asynchronous
Event Request command and the Keep Alive command (refer to sections 5.2.2 and 5.2.14 respectively). A
host requests an explicit persistent connection to a Discovery controller and Asynchronous Event
Notifications from the Discovery controller on that persistent connection by specifying a non-zero Keep
Alive Timer value in the Connect command. If the Connect command specifies a non-zero Keep Alive Timer
value and the Discovery controller does not support Asynchronous Events, then the Discovery controller
shall return a status value of Connect Invalid Parameters (refer to Figure 582) for the Connect command.
Discovery controllers shall indicate support for Discovery Log Change Notifications in the Identify Controller
data structure (refer to Figure 328).
Discovery controllers that do not support explicit persistent connections shall not support Keep Alive
commands and may use a fixed Discovery controller activity timeout value (e.g., 2 minutes). If no commands
are received by such a Discovery controller within that time period, the controller may perform the actions
for Keep Alive Timer expiration defined in section 3.9.5.
A Discovery controller shall not support the Disconnect command.
A Discovery log page with multiple Discovery Log Page Entries for the same NVM subsystem indicates that
there are multiple fabric paths to the NVM subsystem, and/or that multiple static controllers may share a
fabric path. The host may use this information to form multiple associations to controllers within an NVM
subsystem.
Multiple Discovery Log Page Entries for the same NVM subsystem with different Port ID values indicates
that the resulting NVMe Transport connections are independent with respect to NVM subsystem port
hardware failures. A host that uses a single association should pick a record to attach to an NVM
subsystem. A host that uses multiple associations should choose different ports.
A transport specific method may exist to indicate changes to a Discovery controller.
Controller IDs in the range FFF0h to FFFFh are not allocated as valid Controller IDs on completion of a
Connect command, as described in section 6.3. Figure 27 defines these Controller IDs.
The Controller ID values returned in the Discovery Log Page Entries indicate whether an NVM subsystem
supports the dynamic or static controller model. The controller ID value of FFFFh is used for NVM
subsystems that support the dynamic controller model indicating that any available controller may be
returned. The Controller ID value of FFFEh is used for NVM subsystems that support the static controller
model indicating that any available controller may be returned. An NVM subsystem supports the dynamic
controller model if Discovery Log Page Entries use the Controller ID value of FFFFh. An NVM subsystem
supports the static controller model if Discovery Log Page Entries use a Controller ID value that is less than
FFFFh. The Identify Controller data structure also indicates whether an NVM subsystem is dynamic or
static.
If an NVM subsystem implements the dynamic controller model, then multiple Discovery Log Page Entries
(refer to Figure 310) with the Controller ID set to FFFFh may be returned for that NVM subsystem (e.g., to
indicate multiple NVM subsystem ports) in the Discovery log page. If an NVM subsystem implements the
static controller model, then multiple Discovery Log Page Entries that indicate different Controller ID values
may be returned for that NVM subsystem in the Discovery log page. If an NVM subsystem that implements
the static controller model includes any Discovery Log Page Entries that indicate a Controller ID of FFFEh,
then the host should remember the Controller ID returned from the Fabrics Connect command and re-use
the allocated Controller ID for future associations to that particular controller.


---
### ðŸ“Š Tables (1)

#### Table 1: Table_3_1_3_3_Discovery_Controller
![Table_3_1_3_3_Discovery_Controller](../section_images/Table_3_1_3_3_Discovery_Controller.png)

| Controller ID | Definition |
|---|---|
| FFF0h to FFFCh | Reserved. Use of this value in a Connect command results in a status code of Connect Invalid Parameters being returned, as described in section 6.3. |
| FFFDh | This value in the Controller ID (CNTLID) field of the Registered Controller data structure or Registered Controller Extended data structure for a dispersed namespace indicates that the controller is not contained in the same participating NVM subsystem as the controller processing the command (refer to section 8.1.10.6). Use of this value in a Connect command results in a status code of Connect Invalid Parameters being returned, as described in section 6.3. |
| FFFEh | This value is sent in a Connect command to specify that any available static controller is allowed to be allocated. |
| FFFFh | This value is sent in a Connect command to specify that any available dynamic controller is allowed to be allocated. |

