##### 8.2.6.2 VI Resource Definition

> **Section ID**: 8.2.6.2 | **Page**: 695-696

A Virtual Interrupt Resource (VI Resource) is a type of controller resource that manages one interrupt
vector, such as an MSI-X vector. For a VI Resource that is assigned to a controller, its resource identifier
is equivalent to its interrupt vector number.
The Controller Resource Types field of the Primary Controller Capabilities Structure indicates whether VI
Resources are supported. If VI Resources are unsupported, a primary controller and its associated
secondary controllers have all interrupts as Private Resources. The rest of this section assumes that VI
Resources are supported.
The secondary controller is assigned VI Resources using the Virtualization Management command. The
number of VI Resources assigned is discoverable in the Secondary Controller List entry for the associated
secondary controller.
While a primary controller and/or its associated secondary controllers may concurrently support multiple
types of interrupt vectors (e.g., MSI and MSI-X), all the controllersâ€™ VI Resources shall contain interrupt
resources for interrupt vectors of the same type. In this revision, MSI-X is the only supported type of VI
Resource.
For a secondary controller that supports VI Resources with MSI-X vectors, if at least one VI Resource is
assigned to that controller, MSIXCAP.MXC.TS (refer to the MSI-X Capability section of the NVMe over
PCIe Transport Specification) indicates the number of VI Resources assigned to the controller. Since
MSIXCAP.MXC.TS is read-only, the value shall only be updated when the secondary controller is in the
Offline state. MSI-X Table Entries on the secondary controller for newly assigned VI Resources shall be
reset to default values.
If a secondary controller that supports VI Resources has no assigned VI Resources, then that controller
remains in the Offline state. A secondary controller is not able to transition to the Online state until a VI
Resource for interrupt vector 0 has been assigned to that controller. For a secondary controller that supports
VI Resources with MSI-X vectors, if no VI Resources are assigned to that controller, then
MSIXCAP.MXC.TS is reserved.
A primary controller that supports VI Resources shall have at least one interrupt that is a Private Resource.
Interrupt vector 0 is always assigned to the primary controller. A primary controller may be allocated VI
Resources using the Primary Controller Flexible Allocation action of the Virtualization Management
command. The VI resources allocated take effect after a Controller Level Reset and are persistent across
power cycles and resets. The number of VI Resources currently allocated is discoverable in the Primary
Controller Capabilities Structure. For a primary controller that supports VI Resources with MSI-X vectors,
MSIXCAP.MXC.TS indicates an MSI-X Table size equal to the total number of Private Resources and the
Flexible Resources currently allocated following a Controller Level Reset.
When an I/O CQ is created, the controller supports mapping that I/O CQ to any valid interrupt vector,
regardless of whether they have the same resource identifier, as long as the I/O CQ and the interrupt vector
are attached to the same controller.
