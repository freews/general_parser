###### 8.3.5.5.2 DH-HMAC-CHAP Authentication Protocol Descriptor

> **Section ID**: 8.3.5.5.2 | **Page**: 748-750

The authentication protocol descriptor for DH-HMAC-CHAP (refer to section 8.3.5.4.1) is shown in Figure
797.
The one-way hash functions used by DH-HMAC-CHAP are shown in Figure 798.
The SHA-256 hash function shall be supported. Use of the SHA-256 hash function may be prohibited by
the requirements of security policies that are not defined by NVM Express (e.g., CNSA 1.0 requires use of
SHA-384).
Upon receiving an AUTH_Negotiate message, if the HashIDList proposed by the host does not satisfy the
security requirements of the controller (e.g., the host proposed SHA-256, but the controllerâ€™s security policy
requires a SHA-384 hash), then the controller shall:
â€¢
reply to the AUTH_Negotiate message with an AUTH_Failure1 message having reason code
â€˜Authentication failureâ€™ and reason code explanation â€˜Hash function not usableâ€™; and
â€¢
disconnect the NVMe over Fabrics connection upon transmitting the AUTH_Failure1 message.
The Diffie-Hellman (DH) groups used by DH-HMAC-CHAP are shown in Figure 799.
The 00h identifier indicates that no Diffie-Hellman exchange is performed, which reduces the DH-HMAC-
CHAP protocol to the HMAC-CHAP protocol. The 00h identifier shall not be proposed in an
AUTH_Negotiate message that requests secure channel concatenation (i.e., with the SC_C field set to a
non-zero value).
The 2048-bit DH group and the 3072-bit DH group shall be supported. A mechanism shall be provided to
disable (i.e., prohibit) use of the 2048-bit DH group. Use of the 2048-bit DH group may be prohibited by the
requirements of security policies that are not defined by NVM Express (e.g., CNSA 1.0 requires use of a
3072-bit or larger DH group).
Upon receiving an AUTH_Negotiate message, if the DHgIDList proposed by the host:
â€¢
does not satisfy the security requirements of the controller (e.g., the host proposed only the NULL
DH group, but the controllerâ€™s security policy requires a DH group whose size is 3072-bit or larger);
or
â€¢
contains the NULL DH group (i.e., identifier 00h) and the AUTH_Negotiate message is requesting
secure channel concatenation (i.e., with the SC_C field set to a non-zero value),
then the controller shall:
â€¢
reply to the AUTH_Negotiate message with an AUTH_Failure1 message having reason code
â€˜Authentication failureâ€™ and reason code explanation â€˜DH group not usableâ€™; and
â€¢
disconnect the NVMe over Fabrics connection upon transmitting the AUTH_Failure1 message.


---
### ðŸ“Š Tables (3)

#### Table 1: Table_8_3_5_5_2_DH_HMAC_CHAP_Authentication_Protocol_Descriptor_1
![Table_8_3_5_5_2_DH_HMAC_CHAP_Authentication_Protocol_Descriptor_1](../section_images/Table_8_3_5_5_2_DH_HMAC_CHAP_Authentication_Protocol_Descriptor_1.png)

| Bytes | Description |
| :--- | :--- |
| 0 | Authentication Protocol Identifier (AuthID): (01h for DH-HMAC-CHAP) |
| 1 | Reserved |
| 2 | HashIDList Length (HALEN): Number of hash function identifiers (1 to 30) |
| 3 | DHgIDList Length (DHLEN): Number of Diffie-Hellman groups (1 to 30) |
| 3+HALEN:4 | Hash Function identifier List (HashIDList): Array of hash function identifiers (one byte per identifier) |
| 33:4+HALEN | Pad (PAD): Padding bytes cleared to 0h, if present |
| 33+DHLEN:34 | Diffie-Hellman Group identifier List (DHgIDList): Array of Diffie-Hellman Group identifiers (one byte per identifier) |
| 63:34+DHLEN | Pad1 (PAD1): Padding bytes cleared to 0h, if present |


#### Table 2: Table_8_3_5_5_2_DH_HMAC_CHAP_Authentication_Protocol_Descriptor_2
![Table_8_3_5_5_2_DH_HMAC_CHAP_Authentication_Protocol_Descriptor_2](../section_images/Table_8_3_5_5_2_DH_HMAC_CHAP_Authentication_Protocol_Descriptor_2.png)

| Identifier | Hash Function | Hash Length (bytes) | Hash Block SizeÂ¹ (bytes) | Reference |
| :--- | :--- | :--- | :--- | :--- |
| 00h | Reserved | | | |
| 01h | SHA-256 | 32 | 64 | RFC 6234 |
| 02h | SHA-384 | 48 | 128 | RFC 6234 |
| 03h | SHA-512 | 64 | 128 | RFC 6234 |
| 04h-DFh | Reserved | | | |
| E0h-FEh | Vendor specific | | | |
| FFh | Reserved | | | |
| Notes: | | | | |
| 1. | The hash block size is used by the HMAC calculation | | | |


#### Table 3: Table_8_3_5_5_2_DH_HMAC_CHAP_Authentication_Protocol_Descriptor_3
![Table_8_3_5_5_2_DH_HMAC_CHAP_Authentication_Protocol_Descriptor_3](../section_images/Table_8_3_5_5_2_DH_HMAC_CHAP_Authentication_Protocol_Descriptor_3.png)

| Identifier | DH group size | Generator (g) | Modulus (p) and Reference |
| :--- | :--- | :--- | :--- |
| 00h | NULL | n/a | n/a |
| 01h | 2048-bit | 2 | refer to RFC 7919 |
| 02h | 3072-bit | 2 | refer to RFC 7919 |
| 03h | 4096-bit | 2 | refer to RFC 7919 |
| 04h | 6144-bit | 2 | refer to RFC 7919 |
| 05h | 8192-bit | 2 | refer to RFC 7919 |
| 06h-DFh | Reserved | | |
| E0h-FEh | Vendor specific | | |
| FFh | Reserved | | |

