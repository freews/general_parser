###### 8.3.5.6.3 AVE Access Protocol

> **Section ID**: 8.3.5.6.3 | **Page**: 763-765

Communication with a DH-HMAC-CHAP AVE uses two PDUs, DH-HMAC-CHAP_Access-Request and
DH-HMAC-CHAP_Access-Result, that are sent directly over the TLS connection with the AVE (refer to
section 8.3.5.6.2). The format of the DH-HMAC-CHAP Access-Request PDU is shown in Figure 813.
The DH-HMAC-CHAP_Access-Request PDU contains the parameters exchanged by the host and the
controller during a DH-HMAC-CHAP authentication transaction. The responder is the entity that replied to
a DH-HMAC-CHAP challenge sent by an authenticator.
Referring to Figure 812, when the controller transmits the DH-HMAC-CHAP_Access-Request PDU, the
parameters are instantiated as follows:
‚Ä¢
Responder‚Äôs Role: ‚ÄòH‚Äô
‚Ä¢
Sequence Number: S1
‚Ä¢
Augmented Challenge Value: Ca1
‚Ä¢
Response Value: R1
‚Ä¢
NQNR: NQNh
‚Ä¢
HashID, T_ID, SC_C: the correspondent DH-HMAC-CHAP parameters
When the host transmits the DH-HMAC-CHAP_Access-Request PDU, the parameters are instantiated as
follows:
‚Ä¢
Responder‚Äôs Role: ‚ÄòC‚Äô
‚Ä¢
Sequence Number: S2
‚Ä¢
Augmented Challenge Value: Ca2
‚Ä¢
Response Value: R2
‚Ä¢
NQNR: NQNc
‚Ä¢
HashID, T_ID, SC_C: the correspondent DH-HMAC-CHAP parameters
Upon receiving a DH-HMAC-CHAP_Access-Request PDU, the AVE shall perform the following steps in
order:
1.
Lookup the DH-HMAC-CHAP key of the responder (i.e., Kr) from NQNR;
2.
If the Responder‚Äôs Role is ‚ÄòH‚Äô, compute the expected response R‚Äô as:
R‚Äô = HMAC(Kr, Ca || S || T_ID || SC_C || ‚ÄùHostHost‚Äù || NQNr || 00h || NQNa)
where NQNa is the NQN of the authenticator;
3.
If the Responder‚Äôs Role is ‚ÄòC‚Äô, compute the expected response R‚Äô as:
R‚Äô = HMAC(Kr, Ca || S || T_ID || SC_C || ‚ÄùController‚Äù || NQNr || 00h || NQNa)
where NQNa is the NQN of the authenticator; and
4.
Compare the expected response R‚Äô with the response value R received in the DH-HMAC-
CHAP_Access-Request PDU. If R‚Äô = R then the authentication is successful; if R‚Äô ‚â† R then the
authentication has failed.
The NQN of the authenticator (i.e., NQNa) is retrieved from the TLS identity associated to the TLS
connection with the AVE (refer to section 8.3.5.6.2).
The result of an authentication verification is returned to the NVMe entity in a DH-HMAC-CHAP_Access-
Result PDU. The format of the DH-HMAC-CHAP_Access-Result PDU is shown in Figure 814.


---
### üñºÔ∏è Figures (1)

#### Figure 1: Figure 813: DH-HMAC-CHAP_Access-Request PDU format
![Figure 813: DH-HMAC-CHAP_Access-Request PDU format](../section_images/Figure_8_3_5_6_3_AVE_Access_Protocol.png)

