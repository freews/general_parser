##### 3.3.2.2 Queue Creation

> **Section ID**: 3.3.2.2 | **Page**: 118-119

Message-based controllers use the Connect command (refer to section 6.3) to create Admin Queues or I/O
Queues. The creation of an Admin Queue establishes an association between a host and the corresponding
controller. The message-based transport queue model does not support the Admin Submission Queue
Base Address (ASQ), Admin Completion Queue Base Address (ACQ), and Admin Queue Attributes (AQA)
properties as all information necessary to establish an Admin Queue is contained in the Connect command.
The message-based transport queue model does not support the Admin commands associated with I/O
Queue creation and deletion (i.e., Create I/O Completion Queue, Create I/O Submission Queue, Delete I/O
Completion Queue, Delete I/O Submission Queue).
An NVMe Transport connection is established between a host and an NVM subsystem prior to the transfer
of any capsules or data. The mechanism used to establish an NVMe Transport connection is NVMe
Transport specific and defined by the corresponding NVMe Transport binding specification. The NVMe
Transport may require a separate NVMe Transport connection for each Admin Queue or I/O Queue or may
utilize the same NVMe Transport connection for all Admin and I/O Queues associated with a particular
controller. An NVMe Transport may also require that NVMe layer information be passed between the host
and controller in the process of establishing an NVMe Transport connection (e.g., exchange queue size to
appropriately size send and receive buffers).
The Connect command specifies the Queue ID and type (Admin or I/O), the size of the Submission and
Completion Queues, queue attributes, Host NQN, NVM Subsystem NQN, and Host Identifier. The Connect
command may specify a particular controller if the NVM subsystem supports a static controller model. The
Connect response indicates whether the connection was successfully established as well as whether NVMe
in-band authentication is required.
The Connect command is submitted to the same Admin Queue or I/O Queue that the Connect command
creates. The underlying NVMe Transport connection that is used for that queue is created first and the
Connect command and response capsules are sent over that NVMe Transport connection. The Connect
command shall be sent once to a queue.
When a Connect command successfully completes, the corresponding Submission and Completion
Queues are created. If NVMe in-band authentication is required as indicated in the Connect response, then
NVMe in-band authentication shall be performed before the queues may be used to perform other Fabrics
commands, Admin commands, or I/O commands.
Once a Connect command for an Admin Queue has completed successfully (and NVMe in-band
authentication, if required, has succeeded), only Fabrics commands may be submitted until the controller
is ready (CSTS.RDY = 1). Both Fabrics commands and Admin commands may be submitted to the Admin
Queue while the controller is ready. A Connect command for an I/O Queue may be submitted after the
controller is ready. Once a Connect command for an I/O Queue has completed successfully (and NVMe in-
band authentication, if required, has succeeded), I/O commands may be submitted to the queue.
The Connect response contains the controller ID allocated to the host.
After an Admin Queue is created on a controller, all subsequent Connect commands sent from the same
host to that controller, to create an I/O Queue, are required to:
•
utilize the same NVMe Transport;
•
have the same Host NQN;
•
have the same NVM Subsystem NQN; and
•
either have the:
same Host Identifier value; or
a Host Identifier value of 0h, if supported (refer to section 5.2.12.3.3).
