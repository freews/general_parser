###### 8.3.5.6.2 AVE Connections

> **Section ID**: 8.3.5.6.2 | **Page**: 763-763

An NVMe entity (i.e., a host or a controller) connection with a DH-HMAC-CHAP AVE shall use TLS version
1.3 (refer to RFC 8446) with pre-shared key (PSK) authentication, as specified for NVMe/TCP (refer to the
NVMe over TCP Transport Specification).
In order to establish a TLS connection with an AVE, an NVMe entity requires a PSK shared between that
entity and the AVE (i.e., PSKea) for authentication of the TLS connection. PSKea shall be either derived from
the DH-HMAC-CHAP secret, if the DH-HMAC-CHAP secret representation specifies a hash function (refer
to section 8.3.5.5.8), or provisioned on the NVMe entity through a configured PSK, as specified for
NVMe/TCP.
Derivation of PSKea from a DH-HMAC-CHAP secret shall use the HKDF-Extract and HKDF-Expand-Label
operations (refer to RFC 5869 and RFC 8446) in the following order:
1.
PRK = HKDF-Extract(0, DH-HMAC-CHAP secret); and
2.
PSKea = HKDF-Expand-Label(PRK, “A-V-Entity” || NQNAVE, NQNe, Length(DH-HMAC-CHAP
secret)),
where NQNAVE is the NQN of the AVE and NQNe is the NQN of the NVMe entity. The hash function used
with HKDF shall be the one specified in the DH-HMAC-CHAP secret representation (refer to section
8.3.5.5.8). This transform requires that the NVMe entity knows NQNAVE.
Derivation of PSKea from a DH-HMAC-CHAP secret is not possible if the DH-HMAC-CHAP secret
representation does not specify a hash function. In this case PSKea shall be provisioned on the NVMe entity
through a configured PSK, as specified for NVMe/TCP, and that configured PSK should be different than
the DH-HMAC-CHAP secret for that entity.
Derivation of PSKea from a configured PSK shall use the HKDF-Extract and HKDF-Expand-Label operations
in the following order:
1.
PRK = HKDF-Extract(0, Configured PSK); and
2.
PSKea = HKDF-Expand-Label(PRK, “A-V-Entity” || NQNAVE, NQNe, Length(Configured PSK)),
where NQNAVE is the NQN of the AVE and NQNe is the NQN of the NVMe entity. The hash function used
with HKDF shall be the one specified in the PSK interchange format (refer to the NVMe over TCP Transport
Specification). If no hash function is specified in the PSK interchange format, then the configured PSK shall
be used as PSKea. This transform requires that the NVMe entity knows NQNAVE.
The TLS connection with the AVE shall be performed as specified in the TLS PSK and PSK Identity
Derivation section of the NVMe over TCP Transport Specification, with PSKea used as the Retained PSK,
NQNe used as the host NQN, and NQNAVE used as the controller NQN. Mandatory and recommended
cipher suites for this TLS connection are specified in the Mandatory and Recommended Cipher Suites
section of the NVMe over TCP Transport Specification. This TLS connection may be used for multiple
authentication verifications. An NVMe entity may terminate this TLS connection and re-establish it as
required. An AVE may terminate this TLS connection after some period of inactivity (e.g., 10 minutes). An
NVMe entity may avoid termination of this TLS connection by using the TLS heartbeat extension (refer to
RFC 6520).
