###### 8.3.5.5.11 DH-HMAC-CHAP Configuration

> **Section ID**: 8.3.5.5.11 | **Page**: 757-761

DH-HMAC-CHAP implementations that do not use an AVE (refer to section 8.3.5.6 for AVE information)
shall be able to be provisioned with their own DH-HMAC-CHAP secret and with a verification secret per
each remote entity that is able to be authenticated. DH-HMAC-CHAP implementations that use an AVE
shall be able to be provisioned with their own DH-HMAC-CHAP secret and the parameters for accessing
the AVE (refer to section 8.3.5.6.2).
This section uses the term configuration to indicate an NVMe internal state that controls the use of DH-
HMAC-CHAP. That internal state may or may not be externally configurable for a host or NVM subsystem.
For an NVMe/TCP implementation that supports DH-HMAC-CHAP, a DH-HMAC-CHAP configuration may
apply to:
‚Ä¢
a single connection;
‚Ä¢
a group of connections; or
‚Ä¢
all connections.
DH-HMAC-CHAP implementations that do not support secure channel concatenation with the TLS protocol
shall support configuring use of DH-HMAC-CHAP using one or more of the configurations shown in Figure
804.
NVM subsystems that do not support secure channel concatenation with the TLS protocol shall set the ATR
and ASCR bits in the AUTHREQ field in the response of a successful Connect command (refer to Figure
582) as defined in Figure 805.
Hosts that do not support secure channel concatenation with the TLS protocol shall behave as defined in
Figure 806, according to the ATR and ASCR bits in the AUTHREQ field received in the response of a
successful Connect command (refer to Figure 582).
NVM subsystems that do not support secure channel concatenation with the TLS protocol shall behave as
defined in Figure 807, according to the SC_C field in a received AUTH_Negotiate message (refer to section
8.3.5.4.1).
For example, consider a host that supports DH-HMAC-CHAP without secure channel concatenation with
the TLS protocol configured with Authentication Permitted and an NVM subsystem that supports DH-
HMAC-CHAP without secure channel concatenation with the TLS protocol configured with Authentication
Required. As defined in Figure 805, the NVM subsystem clears the ASCR bit to ‚Äò0‚Äô and sets the ATR bit to
‚Äò1‚Äô in the Connect response. As defined in Figure 806, upon receiving the Connect response the host begins
an authentication transaction with the SC_C field set to NOSC. As defined in Figure 807, the NVM
subsystem participates in the authentication transaction.
DH-HMAC-CHAP implementations that support secure channel concatenation with the TLS protocol shall
support configuring use of DH-HMAC-CHAP with secure channel concatenation with the TLS protocol using
one or more of the configurations shown in Figure 808.
NVM subsystems that support secure channel concatenation with the TLS protocol shall set the ATR and
ASCR bits in the AUTHREQ field in the response of a successful Connect command on an Admin Queue
over a TCP channel without TLS (refer to Figure 582) as defined in Figure 809.
Hosts that support secure channel concatenation with the TLS protocol shall behave as defined Figure 810,
according to the ATR and ASCR bits in the AUTHREQ field received in the response of a successful
Connect command on an Admin Queue over a TCP channel without TLS (refer to Figure 582).
NVM subsystems that support secure channel concatenation with the TLS protocol shall behave as defined
in Figure 811, according to the SC_C field in a received AUTH_Negotiate message on an Admin Queue
over a TCP channel without TLS (refer to section 8.3.5.4.1).
As an example, consider a host that supports DH-HMAC-CHAP with secure channel concatenation with
the TLS protocol configured with Authentication Permitted, TLS Permitted and an NVM subsystem that
supports DH-HMAC-CHAP with secure channel concatenation with the TLS protocol configured with
Authentication Required, TLS Required. As defined in Figure 809, the NVM subsystem sets the ASCR bit
to ‚Äò1‚Äô and clears the ATR bit to ‚Äò0‚Äô in the Connect response. As defined in Figure 810, upon receiving the
Connect response the host begins an authentication transaction with the SC_C field set to NEWTLSPSK.
As defined in Figure 811, the NVM subsystem participates in the authentication transaction and establishes
a TLS channel.


---
### üñºÔ∏è Figures (8)

#### Figure 1: Figure 804: DH-HMAC-CHAP Configurations
![Figure 804: DH-HMAC-CHAP Configurations](../section_images/Figure_8_3_5_5_11_DH_HMAC_CHAP_Configuration_1.png)


#### Figure 2: Figure 805: NVM Subsystem AUTHREQ Settings for DH-HMAC-CHAP
![Figure 805: NVM Subsystem AUTHREQ Settings for DH-HMAC-CHAP](../section_images/Figure_8_3_5_5_11_DH_HMAC_CHAP_Configuration_2.png)


#### Figure 3: Figure 806: DH-HMAC-CHAP Host Behavior
![Figure 806: DH-HMAC-CHAP Host Behavior](../section_images/Figure_8_3_5_5_11_DH_HMAC_CHAP_Configuration_3.png)


#### Figure 4: Figure 807: DH-HMAC-CHAP NVM Subsystem Behavior
![Figure 807: DH-HMAC-CHAP NVM Subsystem Behavior](../section_images/Figure_8_3_5_5_11_DH_HMAC_CHAP_Configuration_4.png)


#### Figure 5: Figure 808: DH-HMAC-CHAP with TLS Concatenation Configurations
![Figure 808: DH-HMAC-CHAP with TLS Concatenation Configurations](../section_images/Figure_8_3_5_5_11_DH_HMAC_CHAP_Configuration_5.png)


#### Figure 6: Figure 809: NVM Subsystem AUTHREQ Settings for DH-HMAC-CHAP with TLS Concatenation
![Figure 809: NVM Subsystem AUTHREQ Settings for DH-HMAC-CHAP with TLS Concatenation](../section_images/Figure_8_3_5_5_11_DH_HMAC_CHAP_Configuration_6.png)


#### Figure 7: Figure 810: DH-HMAC-CHAP with TLS Concatenation Host Behavior
![Figure 810: DH-HMAC-CHAP with TLS Concatenation Host Behavior](../section_images/Figure_8_3_5_5_11_DH_HMAC_CHAP_Configuration_7.png)


#### Figure 8: Figure 811: DH-HMAC-CHAP with TLS Concatenation NVM Subsystem Behavior
![Figure 811: DH-HMAC-CHAP with TLS Concatenation NVM Subsystem Behavior](../section_images/Figure_8_3_5_5_11_DH_HMAC_CHAP_Configuration_8.png)

