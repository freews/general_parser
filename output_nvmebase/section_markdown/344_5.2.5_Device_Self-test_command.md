#### 5.2.5 Device Self-test command

> **Section ID**: 5.2.5 | **Page**: 216-218

The Device Self-test command is used to start a device self-test operation or abort a device self-test
operation (refer to section 8.1.8). The Device Self-test command is used specifically to:
a) start a short device self-test operation;
b) start an extended device self-test operation;
c) start a Host-Initiated Refresh operation;
d) start a vendor specific device self-test operation; or
e) abort a device self-test operation already in process.
A Host-Initiated Refresh operation is a device self-test operation.
The device self-test operation is performed by the controller that the Device Self-test command was
submitted to. The Namespace Identifier field controls which namespaces are included in the device self-
test operation as specified in Figure 174. For a Host-Initiated Refresh operation, the Namespace Identifier
field shall be ignored by the controller.
The Device Self-test command uses the Command Dword 10 field and the Command Dword 15 field. All
other command specific fields are reserved.
The processing of a Device Self-test command and interactions with a device self-test operation already in
progress is defined in Figure 177.


---
### ðŸ“Š Tables (3)

#### Table 1: Table_5_2_5_Device_Self_test_command_1
![Table_5_2_5_Device_Self_test_command_1](../section_images/Table_5_2_5_Device_Self_test_command_1.png)

| NSID Value | Definition |
|---|---|
| 00000000h | Specifies that the device self-test operation shall not include any namespaces, and only the controller is included as part of the device self-test operation. |
| 00000001h to FFFFFFFFh | Specifies that the device self-test operation shall include the specified namespace. If this field specifies an invalid namespace ID, then the controller shall abort the command with a status code of Invalid Namespace or Format. If this field specifies an inactive namespace ID, then the controller shall abort the command with a status code of Invalid Field in Command. |
| FFFFFFFFh | Specifies that the device self-test operation shall include all attached namespaces accessible through the controller at the time the device self-test operation is started. |


#### Table 2: Table_5_2_5_Device_Self_test_command_2
![Table_5_2_5_Device_Self_test_command_2](../section_images/Table_5_2_5_Device_Self_test_command_2.png)

| Bits | Description |
| :--- | :--- |
| 31:04 | Reserved |
| | **Self-test Code (STC):** This field specifies the action taken by the Device Self-test command. |
| | <table><tbody><tr><th>Value</th><th>Definition</th></tr><tr><td>0h</td><td>Reserved</td></tr><tr><td>1h</td><td>Start a short device self-test operation</td></tr><tr><td>2h</td><td>Start an extended device self-test operation</td></tr><tr><td>3h</td><td>Start a Host-Initiated Refresh operation</td></tr><tr><td>4h to Dh</td><td>Reserved</td></tr><tr><td>Eh</td><td>Vendor specific. Additional information may be provided in Command Dword 15 (refer to Figure 176).</td></tr><tr><td>Fh</td><td>Abort device self-test operation</td></tr></tbody></table> |
| 03:00 | |
| | |
| | |
| | |
| | |
| | |
| | |
| | |
| | |
| | |
| |


#### Table 3: Table_5_2_5_Device_Self_test_command_3
![Table_5_2_5_Device_Self_test_command_3](../section_images/Table_5_2_5_Device_Self_test_command_3.png)

| Self-test in Progress Â¹ | Self-test Code value in new Drive Self-test command | Controller Action |
| :--- | :--- | :--- |
| | 1h â€“ Short device self-test | Abort the new Device Self-test command with a status code of Device Self-test in Progress. |
| | 2h â€“ Extended device self-test | |
| | 3h â€“ Host-Initiated Refresh | |
| | Eh â€“ Vendor specific | Vendor specific |
| Yes | Fh â€“ Abort device self-test | The controller takes the following actions in order:<br>1. Abort device self-test operation in progress;<br>2. Create log entry in the Newest Self-test Result Data Structure in the Device Self-test Result log page;<br>3. Set the Device Self-test Result field of the current Device Self-test Status field in the Device Self-test log page to 0h; and<br>4. Completes command successfully. |
| | | |
| No | 1h â€“ Short device self-test | The controller takes the following actions in order:<br>1. Validate the command parameters;<br>2. Set the Device Self-test Result field of the current Device Self-test Status field in the Device Self-test log page to 1h;<br>3. Start a device self-test operation; and<br>4. Completes command successfully. |
| | | |
| Self-test in Progress Â¹ | Self-test Code value in new Drive Self-test command | Controller Action |
| | 2h â€“ Extended device self-test | The controller takes the following actions in order:<br>1. Validate the command parameters;<br>2. Set the Device Self-test Result field of the current Device Self-test Status field in the Device Self-test log page to 2h;<br>3. Start a device self-test operation; and<br>4. Complete the command successfully. |
| | 3h â€“ Host-Initiated Refresh | The controller takes the following actions in order:<br>1. Validate the command parameters;<br>2. Set the Device Self-test Result field of the current Device Self-test Status field in the Device Self-test log page to 3h;<br>3. Start a device self-test Refresh operation; and<br>4. Complete the command successfully. |
| | Eh â€“ Vendor specific | Vendor specific |
| | Fh â€“ Abort device self-test | Completes command successfully. The Device Self-test log page is not modified. |
| Notes: | | |
| 1. | | If the Single Device Self-test Operation (SDSO) bit is cleared to '0' in the Device Self-test Options (DSTO) of the Identify Controller data structure (refer to Figure 328), then the Self-test in Progress column represents that a device self-test operation is in progress on the controller that the new Device Self-test command was received on. If the SDSO bit is set to '1', then the Self-test in Progress column represents that a device self-test operation was in progress on the controller that the new Device Self-test command was received on. |

