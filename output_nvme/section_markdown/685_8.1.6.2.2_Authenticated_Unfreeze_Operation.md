###### 8.1.6.2.2 Authenticated Unfreeze Operation

> **Section ID**: 8.1.6.2.2 | **Page**: 567-568

This section describes how a host initiates an authenticated unfreeze operation using a Personality
Unfreeze Request by submitting a Security Send command, and subsequently submitting a Security
Receive command to retrieve the result of the Personality Unfreeze Request operation.
The Security Send command contains a CDP Request Data Frame (refer to Figure 630) that specifies:
•
a CDP Request Message Type value of 01h (i.e., Personality Unfreeze Request); and
•
either:
o
CDP Programmable Key Authentication Unfreeze Data (refer to Figure 632) when using
Programmable Key Authentication (refer to the AUS field in Figure 285); or
o
CDP Physical Credential Authentication Unfreeze Request Data (refer to Figure 634) when
using Physical Credential Authentication.
A controller performs steps such as the following to process a CDP Request Data Frame for an
Authenticated Unfreeze Request operation using Physical Credential Authentication:
As part of an authenticated unfreeze operation for a host using Programmable Key Authentication, a host:
•
retrieves the random nonce using the Random Nonce Request operation as described in section
8.1.6.3.2; and
•
specifies the random nonce as part of a Personality Unfreeze Request operation (refer to 8.1.6.2.1).
A controller performs the following steps to process a CDP Request Data Frame for an Authenticated
Unfreeze Request operation using Programmable Key Authentication:
1. Verify the specified HMAC size.
If the HMAC size specified by the HMAC Size (HMACS) field does not match the expected size as
specified in Figure 642 for the specified CDP Authentication Algorithm in the CDPAA field, then the
controller shall set the Result Code field to 02h (i.e., Authentication Failure) in the CDP Response
Data Frame, and the personality remains frozen.
p
y
2. Verify the specified HMAC value.
The value of the HMAC Value (HMACV) field is an HMAC calculated by the host using the CDP
Authentication Algorithm as specified by the CDPAA field (e.g., if the Authentication Algorithm
specified is HMAC-SHA-384, then the Hash-based Message Authentication Code (HMAC) is
calculated using HMAC-SHA-384 as defined in RFC 6234).
The HMAC algorithm takes as input a key and a message as follows:
•
the key is the DHK derived by the host as described in section 8.1.6.3.1.1; and
•
the message is the concatenation of all fields in the CDP Request Data Frame, excluding
the HMACV field.
To verify the value of the credential, the controller shall calculate an HMAC using:
•
the DHK stored in the NVM subsystem; and
•
the message is the concatenation of all fields in the CDP Request Data Frame, excluding
the HMACV field.
If the HMAC value calculated by the controller does not match the value of the HMACV field, then
the controller shall set the Result Code field to 02h (i.e., Authentication Failure) in the CDP
Response Data Frame in response to a subsequent Security Receive command, and the
personality remains frozen.
If an attempt is made to unfreeze a personality using Programmable Key Authentication prior to the
DHK being programmed, then the controller shall set the Result Code set to 03h (i.e., DHK Not
Programmed) in the CDP Response Data Frame in response to a subsequent Security Receive
command, and the personality remains frozen. If a personality supports Physical Credential
Authentication, that personality is able to be unfrozen using PPI (refer to section 5.2.26.1.24.1.1).
,
p
3. Verify the random nonce.
If the specified random nonce matches the random nonce in the NVM subsystem, then the random
nonce is successfully verified.
If the specified random nonce does not match the random nonce in the NVM subsystem, then the
controller shall set the Result Code field to 02h (i.e., Authentication Failure) in the CDP Data Frame
in response to a subsequent Security Receive command, and the personality remains frozen.
p
q
y
,
p
y
4. If the value of the HMACV field, and the random nonce are successfully verified, then the
Personality Unfreeze Request is authenticated.
5. The personality for the specified Personality Identifier shall be unfrozen.
6. The controller shall then purge the random nonce.
Once the controller returns a successful completion of the Security Send command, then the host should
check the result of the Personality Unfreeze Request by submitting a Security Receive command. The
controller shall return a:
•
successful completion of the Security Receive command; and
•
CDP Response Data Frame, as defined in Figure 631, indicating a Response Message Type with
a value of 02h (i.e., Personality Unfreeze Response) and the corresponding Response Data.
If an error, other than one of the specified ones listed above, occurs during the processing of a Personality
Unfreeze Request, then the controller shall set the Result Code field to 01h (i.e., General Failure).
