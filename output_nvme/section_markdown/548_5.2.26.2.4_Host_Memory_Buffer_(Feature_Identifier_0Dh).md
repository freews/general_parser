###### 5.2.26.2.4 Host Memory Buffer (Feature Identifier 0Dh)

> **Section ID**: 5.2.26.2.4 | **Page**: 469-472

This Feature controls use of the Host Memory Buffer by the controller. The attributes are specified in
Command Dword 11, Command Dword 12, Command Dword 13, Command Dword 14, and Command
Dword 15.
The Host Memory Buffer feature provides a mechanism for the host to allocate a portion of host memory
for the exclusive use of the controller. After a successful completion of a Set Features command enabling
the host memory buffer, the host shall not write to:
a) The Host Memory Descriptor List (refer to Figure 481); and
b) the associated host memory region (i.e., the memory regions described by the Host Memory
Descriptor List),
until the host memory buffer has been disabled.
If the host memory buffer is enabled, then a Set Features command to enable the host memory buffer (i.e.,
the EHM bit (refer to Figure 476) set to â€˜1â€™) shall abort with a status code of Command Sequence Error.
If the host memory buffer is not enabled, then a Set Features command to disable the host memory buffer
(i.e., the EHM bit (refer to Figure 476) cleared to â€˜0â€™) shall succeed without taking any action.
After a successful completion of a Set Features command that disables the host memory buffer, the
controller shall not access any data in the host memory buffer until the host memory buffer has been
enabled. The controller should retrieve any necessary data from the host memory buffer in use before
posting the completion queue entry for the Set Features command that disables the host memory buffer.
Posting of the completion queue entry for the Set Features command that disables the host memory buffer
acknowledges that it is safe for the host to modify the host memory buffer contents. Refer to section 8.2.3.
A host is able to restrict access to the host memory buffer (HMB) while the controller is in a non-operational
power state that was configured by the host (refer to section 5.2.26.1.2). If this HMB non-operational power
state access restriction is enabled by the host (refer to Figure 476) and the host configures a non-
operational power state, then the controller does not access the HMB until the controller transitions to an
operational power state except for HMB access required to process Admin commands and background
operations initiated by Admin commands. Enabling or disabling Non-Operational Power State Permissive
Mode (refer to section 5.2.26.1.10) shall have no effect on HMB non-operational power state access
restriction.
Enabling or disabling HMB non-operational power state access restriction should not affect the Entry
Latency (ENLAT) for non-operational power states (refer to section 8.1.18) that are reported in the power
state descriptors in Identify Controller data structure (e.g., if HMB non-operational power state access
restriction is enabled, the controller may consume additional time beyond the applicable Entry Latency
value in order to retrieve necessary data from the HMB before the controller transitions to a non-operational
power state).
If HMB non-operational power state access restriction is enabled and the controller autonomously
transitions from an operational power state to a non-operational power state, then HMB access by the
controller is not restricted and that access should be minimized (e.g., access ceases as soon as possible
after that transition and does not resume until after the controller transitions to an operational power state).
If HMB non-operational power state access restriction is enabled and the host configures a non-operational
power state while the controller is in a non-operational power state, then HMB access by the controller is
restricted.
If a Get Features command is issued for this Feature, then the completion queue entry indicates whether
HMB non-operational power state access restriction is enabled and whether HMB non-operational power
state access restriction is currently restricting controller access to the HMB (refer to Figure 483).
The Host Memory Descriptor List Address (HMDLLA/HMDLUA) specifies the address of a physically
contiguous data structure in host memory that describes the address and length pairs of the Host Memory
Buffer. The number of address and length pairs is specified in the Host Memory Descriptor List Entry Count
in Figure 480. The Host Memory Descriptor List is described in Figure 481.
If the host specifies the Host Memory Descriptor List Entry Count field cleared to 0h, then the controller
shall abort the command with a status code of Invalid Field in Command.
Each Host Memory Buffer Descriptor Entry shall describe a host memory address in memory page size
units and the number of contiguous memory page size units associated with the host address.
If a Get Features command is issued for this Feature, the attributes specified in Figure 483 are returned in
Dword 0 of the completion queue entry and the Host Memory Buffer Attributes data structure, whose
structure is defined in Figure 484, is returned in the data buffer for that command.


---
### ðŸ“Š Tables (10)

#### Table 1: Untitled Table
![Untitled Table](../section_images/table_470_505.png)

| Description | Description |
| :--- | :--- |
| Host Memory Descriptor List Lower Address (HMDLLA): This field specifies the least significant 32 bits of the physical location of the Host Memory Descriptor List (refer to Figure 481) for the Host Memory Buffer. | |
| Host Memory Descriptor List Upper Address (HMDLUA): This field specifies the most significant 32 bits of the physical location of the Host Memory Descriptor List for the Host Memory Buffer. | |
| Host Memory Descriptor List Entry Count (HMDLEC): This field specifies the number of entries in the Host Memory Buffer Descriptor List. | |
| Host Memory Buffer Descriptor Entry 0: This field is the first Host Memory Buffer Descriptor (refer to Figure 482) in the list, if any. | |
| Host Memory Buffer Descriptor Entry 1: This field is the second Host Memory Buffer Descriptor in the list, if any. | |
| Host Memory Buffer Descriptor Entry n: This field is the last Host Memory Buffer Descriptor in the list, if any. | |
| Buffer Size (BSIZE): Indicates the number of contiguous memory page size (CC.MPS) units for this descriptor. If this field is cleared to 0h, then the controller shall ignore this descriptor. | |
| Buffer Address (BADD): Indicates the host memory address for this descriptor aligned to the memory page size (CC.MPS). The least significant bits (n:0) of this field indicate the offset within the memory page is 0h (e.g., if the memory page size is 4 KiB, then bits 11:00 shall be 0h; if the memory page size is 8 KiB, then bits 12:00 shall be 0h). | |
| | |
| | |
| | |
| | |
| | |
| | |
| | |
| | |
| | |
| |


#### Table 2: Untitled Table
![Untitled Table](../section_images/table_471_128.png)

(Continuation of Untitled Table - see first part)


#### Table 3: Untitled Table
![Untitled Table](../section_images/table_471_264.png)

(Continuation of Untitled Table - see first part)


#### Table 4: Untitled Table
![Untitled Table](../section_images/table_471_353.png)

(Continuation of Untitled Table - see first part)


#### Table 5: Untitled Table
![Untitled Table](../section_images/table_471_489.png)

(Continuation of Untitled Table - see first part)


#### Table 6: Untitled Table
![Untitled Table](../section_images/table_471_642.png)

(Continuation of Untitled Table - see first part)


#### Table 7: Untitled Table
![Untitled Table](../section_images/table_471_769.png)

(Continuation of Untitled Table - see first part)


#### Table 8: Untitled Table
![Untitled Table](../section_images/table_472_156.png)

(Continuation of Untitled Table - see first part)


#### Table 9: Untitled Table
![Untitled Table](../section_images/table_472_362.png)

(Continuation of Untitled Table - see first part)


#### Table 10: Untitled Table
![Untitled Table](../section_images/table_472_624.png)

(Continuation of Untitled Table - see first part)

