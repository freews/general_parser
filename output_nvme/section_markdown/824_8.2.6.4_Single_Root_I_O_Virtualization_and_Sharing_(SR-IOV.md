##### 8.2.6.4 Single Root I/O Virtualization and Sharing (SR-IOV)

> **Section ID**: 8.2.6.4 | **Page**: 697-697

The PCI-SIG® PCI Express Base specification defines Single Root I/O Virtualization and Sharing
Specification (SR-IOV) extensions to PCI Express that allow multiple System Images (SIs), such as virtual
machines running on a hypervisor, to share PCI hardware resources. The primary benefit of SR-IOV is that
it eliminates the hypervisor from participating in I/O operations which may be a significant factor limiting
storage performance in some virtualized environments and allows direct SI access to PCI hardware
resources.
A Physical Function (PF) is a PCI Express Function that supports the SR-IOV Capability, which in turn
allows that PF to support one or more dependent Virtual Functions (VFs). These PFs and VFs may support
NVM Express controllers that share an underlying NVM subsystem with multi-path I/O and namespace
sharing capabilities (refer to section 2.4.1).
SR-IOV Virtual Functions (VFs) with an NVM Express Class Code (refer to the PCI Header section of the
NVMe over PCIe Transport Specification) shall implement fully compliant NVM Express controllers. This
ensures that the same host software developed for non-virtualized environments is capable of running
unmodified within an SI.
For hosts where SR-IOV is unsupported or not needed, a controller that is a PF shall support operation as
a stand-alone controller.
For a controller that is a PF, the requirements for SR-IOV Capability registers VF BAR0, VF BAR1, VF
BAR2, VF BAR4, and VF BAR5 are the same as the requirements for PCI registers BAR0, BAR1, BAR4,
and BAR5, respectively. For a controller that is a PF, SR-IOV Capability register VF BAR2 shall not support
Index/Data Pair. Refer to the PCI Header section of the NVMe over PCIe Transport Specification.
To accommodate SR-IOV address range isolation requirements, VF BAR2 and VF BAR3 may support a
64-bit prefetchable memory register space which shall only be used for MSI-X Tables and MSI-X PBAs of
VFs. MSI-X Table BIR = ‘2’ and MSI-X PBA BIR = ‘2’ are valid for controllers that are VFs. Refer to the
MSI-X Capability section of the NVMe over PCIe Transport Specification.
While the controller properties of a controller that is a VF are accessible only if SR-IOV Control.VF MSE is
set to ‘1’, clearing VF MSE from ‘1’ to ‘0’ does not cause a reset of that controller. In this case, controller
properties are hidden, but their values are not reset.
