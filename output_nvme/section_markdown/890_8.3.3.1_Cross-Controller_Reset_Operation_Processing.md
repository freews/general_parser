##### 8.3.3.1 Cross-Controller Reset Operation Processing

> **Section ID**: 8.3.3.1 | **Page**: 731-733

A Cross-Controller Reset operation consists of the following steps:
1. Determine whether the NVM subsystem is able to validate the Host NQN, the CIU field and
the CIRN field.
If:
•
the NVM subsystem is not able to validate the Host NQN, the CIU field or the CIRN field
(e.g., the Source Controller is not able to communicate with the Impacted Controller); and
•
the NVM subsystem is able to determine via an implementation-dependent mechanism
that command processing for commands submitted to the Impacted Controller satisfies all
Immediate Abort requirements as described in section 5.2.1.1 (e.g., the NVM subsystem
determines that the Impacted Controller is powered down),
then the NVM subsystem shall complete the Cross-Controller Reset operation and report that the
operation succeeded with the V bit cleared to ‘0’ and the CLRI bit cleared to ‘0’.
If:
•
the NVM subsystem is not able to validate at least one of the Host NQN, the CIU field or
the CIRN field; and
•
the NVM subsystem is not able to determine that the Impacted Controller is no longer
processing outstanding commands,
then the NVM subsystem shall complete the Cross-Controller Reset operation and report that the
operation failed with the V bit cleared to ‘0’ and the CLRI bit cleared to ‘0’.
Otherwise, the operation proceeds to the next step.
The NVM subsystem determines whether the Source Controller is authorized to cause the NVM
subsystem to initiate a Cross-Controller Reset operation on the Impacted Controller and prohibits
the operation if the Source Controller is not authorized.
The authorization checks performed by the NVM subsystem include determining whether the
Source Controller is allowed to access the Impacted Controller for the purpose of a Cross-Controller
Reset (i.e., whether that access is prohibited by an access control policy or other NVM subsystem
authorization policy). If that access is not allowed, then this authorization check fails and the NVM
subsystem prohibits the operation.
Hosts that support Cross-Controller Reset Recovery should use the same security mechanisms,
protocols, and algorithms with all controllers in the same NVM subsystem. If the Source Controller
and Impacted Controller do not use the same security mechanisms, protocols, and algorithms with
the host (e.g., to authenticate the host), then the operation should be prohibited unless the NVM
subsystem is able to determine that for any security mechanism, protocol, or algorithm that differs
between these two controllers, the Source Controller uses a stronger security mechanism, protocol
or algorithm than the Impacted Controller. For example, if the Source Controller has authenticated
the host, and the Impacted Controller has not authenticated the host, then the operation should not
be prohibited, as the Source Controller has used a stronger security mechanism. However, if the
Impacted Controller has authenticated the host, and the Source Controller has not authenticated
that host, then the operation should be prohibited.
If any authorization check causes the Cross-Controller Reset operation to be prohibited, then the
NVM subsystem shall complete that Cross-Controller Reset operation and report that the operation
failed with the V bit cleared to ‘0’ and the CLRI bit cleared to ‘0’.
Otherwise, the operation proceeds to the next step.
If:
•
the Source Controller and the Impacted Controller are associated with hosts that have
different Host NQNs;
•
the value of the CIU field specified in the Cross-Controller Reset command is not the same
as the current value of the CIU field in the Identify Controller data structure for the Impacted
Controller; or
•
the CIRN (i.e., the combination of the value of the CIRNL field and the value of the CIRNU
field) specified in the Cross-Controller Reset command is not the same as the current value
of the CIRN field in the Identify Controller data structure for the Impacted Controller,
then the NVM subsystem shall complete the Cross-Controller Reset operation and report that the
operation succeeded with the V bit cleared to ‘0’ and the CLRI bit cleared to ‘0’.
The operation completes successfully because each of these three conditions indicates that the
instance of the Impacted Controller specified in the CIU field, CIRNL field and CIRNU field in the
Cross-Controller Reset command no longer exists and hence is not processing commands that this
host is trying to recover.
Otherwise, the operation proceeds to the next step.
If a CLR is not in progress on that Impacted Controller, the NVM subsystem shall initiate a CLR (as
described in section 3.7.2) on the Impacted Controller.
If the NVM subsystem is not able to either initiate a CLR on that Impacted Controller or determine
that a CLR is in progress on that Impacted Controller, then the NVM subsystem shall complete the
Cross-Controller Reset operation and report that the operation failed with the V bit set to ‘1’ and
the CLRI bit cleared to ‘0’.
Otherwise (i.e., the Impacted Controller is processing a CLR), the operation proceeds to the next
step.
At the start of this step, the Impacted Controller is processing a CLR. The Cross-Controller Reset
operation remains in progress until one of the following events occurs, which causes the NVM
subsystem to complete the Cross-Controller Reset operation:
a. If the NVM subsystem determines that the Impacted Controller has completed processing
the CLR, then the NVM subsystem shall complete the Cross-Controller Reset operation
and report that the operation succeeded with the V bit set to ‘1’ and the CLRI bit set to ‘1’.
b. If the NVM subsystem is able to determine via an implementation-dependent mechanism
that command processing for commands submitted to the Impacted Controller satisfies all
Immediate Abort requirements as described in section 5.2.1.1 (e.g., the NVM subsystem
determines that the Impacted Controller is powered down), then the NVM subsystem shall
complete the Cross-Controller Reset operation and report that the operation succeeded
with the V bit set to ‘1’ and the CLRI bit set to ‘1’.
c. If the NVM subsystem is not able to determine whether the Impacted Controller is
processing the CLR (e.g., the Source Controller is no longer able to contact the Impacted
Controller), and available implementation-dependent mechanisms fail to determine that
command processing for commands submitted to the Impacted Controller satisfies all
Immediate Abort requirements as described in section 5.2.1.1, then the NVM subsystem
shall complete the Cross-Controller Reset operation and report that the operation failed
with the V bit set to ‘1’ and the CLRI bit set to ‘1’.
Upon the NVM subsystem completing the Cross-Controller Reset operation, the Source Controller records
the result in either:
•
the entry for the Impacted Controller in the Cross-Controller Reset log page; or
•
the completion of the Cross-Controller Reset command if the operation is successful and the CQE
of the Cross-Controller Reset command has not been posted by setting the IRS bit to ‘1’.
