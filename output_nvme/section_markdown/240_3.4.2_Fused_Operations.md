#### 3.4.2 Fused Operations

> **Section ID**: 3.4.2 | **Page**: 125-125

Fused operations enable a more complex command by “fusing” together two simpler commands. This
feature is optional; support for this feature is indicated in the FUSES field in the Identify Controller data
structure in Figure 328.
Whether a command is part of a fused operation is specified by the Fused Operation (FUSE) field of
Command Dword 0 shown in Figure 91. The FUSE field also specifies whether the command is the first
command in the fused operation or the second command in the fused operation. If the FUSE field is set to
a non-zero value and the controller does not support the requested fused operation, then the controller
should abort the command with a status code of Invalid Field in Command.
In a fused operation, the requirements are:
o
The commands shall be executed in sequence as an atomic unit. The controller shall behave as if
no other operations have been executed between these two commands;
o
The operation ends at the point an error is encountered in either command. If the first command in
the sequence failed, then the second command in the sequence shall be aborted. If the second
command in the sequence failed, then the completion status of the first command is sequence
specific and is defined within the Fused Operation section of the applicable NVM Express I/O
Command Set specification;
o
The commands shall be inserted next to each other in the same Submission Queue. If the controller
processes a command violating this condition (e.g., a command with the FUSE field cleared to 00b
(i.e., Normal operation) is inserted immediately after a command specifying the FUSE field set to
01b (i.e., Fused operation, first command), or is inserted immediately before a command specifying
the FUSE field set to 10b (i.e., Fused operation, second command)), then the controller shall abort
the command specifying non-zero values of the FUSE field with a status code of Command Aborted
due to Missing Fused Command. If the first command is in the last slot in the Submission Queue,
then the second command shall be in the first slot in the Submission Queue as part of wrapping
around. In the memory-based transport queue model, the Submission Queue Tail doorbell pointer
update shall indicate both commands as part of one doorbell update. In the message-based
transport queue model, the command capsules shall be submitted in-order;
o
To abort the fused operation, the host submits an Abort command separately for each of the
commands; and
o
A completion queue entry is posted by the controller for each of the commands.
Refer to each NVM Express I/O Command Set specification for applicability and additional details, if any.
