### 6.3 Connect Command and Response

> **Section ID**: 6.3 | **Page**: 515-520

The Connect command is used to create a Submission and Completion Queue pair. If the Admin Queue is
specified, then the Connect command establishes an association between a host and a controller. The
fields for the submission queue entry are defined in Figure 579 and the fields for the data portion are defined
in Figure 580.
A host that uses a single Host NQN may employ multiple Host Identifiers to designate elements of the host
that access an NVM subsystem independently of each other (e.g., physical or logical partitions of the host).
Alternatively, a host may employ multiple Host NQN values to cause each element to be treated as a
separate host by an NVM subsystem.
If an NVM subsystem supports DH-HMAC-CHAP authentication (refer to section 8.3.5), then the Host NQN
and the NVM Subsystem NQN parameters in a Connect command are required to be different. If the Host
NQN and the NVM Subsystem NQN parameters in a Connect command are identical and the NVM
subsystem supports DH-HMAC-CHAP authentication, then the controller shall abort the command with a
status code of Connect Invalid Host.
The NVM subsystem shall not allocate a Controller ID in the range FFF0h to FFFFh as a valid Controller
ID on completion of a Connect command. Controller IDs FFF0h to FFFFh are defined in Figure 27. If the
host is not allowed to establish an association to any controller in the NVM subsystem, then the controller
shall abort the command with a status code of Connect Invalid Host.
If the NVM subsystem supports the dynamic controller model, then:
â€¢
the Controller ID of FFFFh is specified as the Controller ID in a Connect command for the Admin
Queue. If the controller ID is not set to FFFFh, then the controller shall abort the command with a
status code of Connect Invalid Parameters;
â€¢
the NVM subsystem shall allocate any available controller to the host; and
â€¢
return that allocated Controller ID in the Connect response.
If the NVM subsystem supports the static controller model, then:
â€¢
The host is able to request a specific controller in a Connect command for the Admin Queue. If the
host is not allowed to establish an association to the specified controller, then the controller shall
abort the command with a status code of Connect Invalid Host;
â€¢
The Controller ID of FFFEh on the Admin Queue specifies that any Controller ID may be allocated
and returned in the Connect response; and
â€¢
If the host specifies a Controller ID value of FFFFh for the Admin Queue, then the controller shall
abort the command with a status code of Connect Invalid Parameters.
The NVM subsystem may allocate specific controllers to particular hosts. If a host requests a controller that
is not allocated to that host, then the controller shall abort the command with a status code of Connect
Invalid Host. The mechanism for allocating specific controllers to particular hosts is outside the scope of
this specification.
While a controller is processing a Controller Level Reset (CLR) (refer to section 3.7.2), a Connect command
for that controller shall not complete successfully. If the host requests a specific controller in a Connect
command and:
â€¢
the requested controller is currently associated with a host, then the NVM subsystem shall abort
that command with the status code of Controller Busy; and
â€¢
the requested controller is currently processing a CLR, then the NVM subsystem shall either wait
for that CLR to complete or abort that command with a status code of Controller Busy.
If the host specifies a controller ID of FFFFh or FFFEh in the Connect command, then the NVM subsystem
shall not allocate a controller that is:
â€¢
currently associated with a host;
â€¢
currently processing a CLR; or
â€¢
currently performing shutdown processing (refer to section 3.6).
The NVM subsystem should not aggressively reuse controller IDs for a Connect command that specifies a
controller ID of FFFFh or FFFEh (e.g., the NVM subsystem delays reuse of controller IDs by two minutes if
there are other controller IDs available for use). The NVM subsystem not aggressively reusing controller
IDs avoids creating an association between the same host and controller while host recovery of outstanding
commands between that host and controller is in-progress resulting in complications of that recovery as
described in section 5.2.12.3.2.
The host shall establish an association with a controller and enable the controller before establishing a
connection with an I/O Queue of the controller. If the host sends a Connect command specifying a Queue
ID for an Admin Queue or I/O Queue that exists, then the controller aborts the command as defined by the
Queue ID field in Figure 579.
The Controller shall abort a Connect command with a status code of Connect Invalid Parameters if:
â€¢
the host sends a Connect command to create an I/O Queue while the controller is disabled;
â€¢
the Host NQN, NVM Subsystem NQN, and the Controller ID values specified for an I/O Queue are
not the same as the values specified for the associated Admin Queue in which the association
between the host and controller was established;
â€¢
the Host Identifier for an I/O Queue is not set to a value of 0h and is not set to the same value as
the value specified for the associated Admin Queue in which the association between the host and
controller was established;
â€¢
the Host NQN or NVM Subsystem NQN values do not match the values that the NVM subsystem
is configured to support;
â€¢
there is a syntax error in the Host NQN or NVM Subsystem NQN value (refer to section 4.7); or
â€¢
the host specifies a Controller ID value in the range FFF0h to FFFDh.
If the NVMe Subsystem Port, NVMe Transport Type or NVMe Transport Address used by the NVMe
Transport (refer to section 6.3) are not the same as the values used for the associated Admin Queue in
which the association between the host and controller was established, then it is possible that the Connect
command is not received by an NVM subsystem. If the Connect command is received by an NVM
subsystem, then:
â€¢
the NVM subsystem that receives the command may not be the same NVM subsystem to which
the association between the host and controller was established (i.e., the NVMe Transport Type
and NVMe Transport Address are unique to an NVM Subsystem Port); and
â€¢
the values of the NVM Subsystem NQN or Controller ID may not be valid at that NVM Subsystem
Port (e.g., the NVM Subsystem NQN may specify a different NVM subsystem than the one that
received that Connect command, or the Controller ID may specify a controller that is already bound
to a different NVM Subsystem Port).
If this situation occurs and the Connect command is aborted, then the status code shall be set to Connect
Invalid Parameters. There is no requirement that such a Connect command be received by an NVM
subsystem (e.g., if the NVMe Transport Address is not a valid transport address, or is the address of a
fabric endpoint that does not support NVMe over Fabrics, then the resulting error, if any, is specific to the
fabric).
Submission Queue (SQ) flow control based on the SQ Head Pointer (SQHD) field in Fabrics response
capsules (refer to section 3.3.2.1.2) shall be supported by all hosts and controllers. Use of SQ flow control
is negotiated by the Connect command and response. A host requests that SQ flow control be disabled by
setting the Disable SQ Flow Control (DISSQFC) bit of the Connect Attributes field to â€˜1â€™ in a Connect
command. A controller that agrees to disable SQ flow control shall set the SQHD field to FFFFh in the
response to that Connect command. A controller that does not agree to disable SQ flow control shall set
the SQHD field to a value other than FFFFh in the response to that Connect command.
If the Connect command did not request that SQ flow control be disabled, then the controller shall not set
the SQHD field to FFFFh in the response to that Connect command.
SQ flow control is disabled and shall not be used for a created queue pair only if:
a) the DISSQFC bit is set to â€˜1â€™ in the Connect command that creates the queue pair; and
b) the SQHD field is set to FFFFh in the response to that Connect command.
If SQ flow control is disabled, then the SQHD field is reserved in Fabrics response capsules for all command
completions on that queue pair after the response that completes the Connect command.
SQ flow control is enabled and shall be used for a created queue pair if:
a) the DISSQFC bit is cleared to â€˜0â€™ in the Connect command that creates the queue pair; or
b) the SQHD field is not set to FFFFh in the response to that Connect command.
If SQ flow control is enabled, then the controller shall use the SQHD field in Fabrics response capsules for
all command completions on that queue pair, except for command completions that omit the SQHD value
due to use of the SQHD pointer update optimization described in section 3.3.2.7.
The Connect response provides status for the Connect command. If a connection is established, then the
Controller ID allocated to the host is returned. The Connect response is defined in Figure 581.
For a Connect command that fails, the controller shall not:
â€¢
return a status code of Invalid Field in Command; and
â€¢
add an entry to the Error Information log page (refer to section 5.2.12.1.2).


---
### ðŸ“Š Tables (5)

#### Table 1: Untitled Table
![Untitled Table](../section_images/table_517_616.png)

| Bits | Description |
| :--- | :--- |
| 7:5 | Reserved |
| 4 | **Connecting Entity (CONNENT):** Indicates the type of entity performing the Connect command. If this bit is set to '1', then the entity performing the Connect command is a Discovery controller. If this bit is cleared to '0', then the entity performing the Connect command is a host. |
| 3 | **Individual I/O Queue Deletion Support (INDIVIOQDELS):** Indicates support for deleting individual I/O Queues. If this bit is set to '1', then the host supports the deletion of individual I/O Queues. If this bit is cleared to '0', then the host does not support the deletion of individual I/O Queues. |
| 2 | **Disable SQ Flow Control (DISSQFC):** If this bit is set to '1', then the host is requesting that SQ flow control be disabled. If this bit is cleared to '0', then SQ flow control shall not be disabled. |
| 1:0 | **Priority Class (PRIOCLASS):** Indicates the priority class to use for commands within this Submission Queue. This field is only used when the weighted round robin with urgent priority class is the arbitration mechanism selected (refer to CC.AMS in Figure 41, the field is ignored if weighted round robin with urgent priority class is not used). Refer to section 3.4.4. This field is only valid for I/O Queues and shall be cleared to 00b for Admin Queue connections. |
| | <table><tr><th>Value</th><th>Definition</th></tr><tr><td>00b</td><td>Urgent</td></tr><tr><td>01b</td><td>High</td></tr><tr><td>10b</td><td>Medium</td></tr><tr><td>11b</td><td>Low</td></tr></table> |
| Reserved | |
| Keep Alive Timeout (KATO): In the Connect command for the Admin Queue, this field has the same definition as the Keep Alive Timeout (KATO) field of the Keep Alive Timer feature (refer to section 5.2.26.1.8). Upon successful completion of the Connect command, the controller shall set the KATO field in the Keep Alive Timer feature. Refer to section 3.9.2 for a description of activating the Keep Alive Timer. <br> In the Connect command for an I/O Queue, this field is reserved. | |
| NVM Set Identifier (NVMSETID): This field indicates the identifier of the NVM Set to be associated with this Submission Queue. This field is only valid for I/O Queues. | |
| In the Connect command for an Admin Queue, if the SQ Associations capability is not supported (refer to section 8.1.27) or this field is cleared to 0h, then this Submission Queue is not associated with any specific NVM Set. | |
| If the SQ Associations capability is supported (refer to section 8.1.27) and this field contains a non-zero value that is not indicated in the NVM Set List (refer to Figure 333), then the controller shall abort the command with a status code of either Invalid Field in Command or Connect Invalid Parameters. | |
| The host should not submit commands for namespaces associated with other NVM Sets in this Submission Queue (refer to section 8.1.27). | |
| Reserved | |
| | | |
| :--- | :--- | :--- |
| | | |
| | | |
| | | |
| | | |
| | | |
| | | |
| | | |
| |
| Bytes | Description |
| :--- | :--- |
| 01:00 | **Controller ID (CNTLID):** Specifies the controller ID allocated to the host. If a particular controller was specified in the CNTLID field of the Connect command, then this field shall contain the same value. |
| 03:02 | **Authentication and Security Requirements (AUTHREQ):** Specifies the NVMe in-band authentication and security requirements. The field is bit significant. If all bits are cleared to '0', then no requirements are specified. |
| | | **Bits** | **Description** |
| | | 15:03 | Reserved |
| | | 02 | **Authentication and Secure Channel Required (ASCR):** If this bit is set to '1', then authentication using NVMe over Fabrics Authentication protocols followed by secure channel establishment is required and the ATR bit should be cleared to '0'. If this bit is cleared to '0', then authentication using NVMe over Fabrics Authentication protocols followed by secure channel establishment is not required. |
| | | 01 | **Authentication Transaction Required (ATR):** If this bit is set to '1', then authentication using NVMe over Fabrics Authentication protocols is required. If this bit is cleared to '0', then authentication using NVMe over Fabrics Authentication protocols is not required. |
| | | 00 | Obsolete. |
| | | **Bytes** | **Description** |
| | | 01:00 | **Invalid Parameter Offset (IPO):** If an invalid parameter is reported, then this field specifies the offset in bytes to the invalid parameter from the start of the SQE or the data. |
| | | 02 | **Invalid Attributes (IATTR):** Specifies attributes of the invalid field parameter. |
| | | | **Bits** | **Description** |
| | | | 7:1 | Reserved |
| | | | 0 | **Invalid Parameter Start (IPS):** If this bit is cleared to '0', then the invalid parameter is specified from the start of the SQE. If this bit is set to '1', then the invalid parameter is specified from the start of the data. |
| | | 03 | Reserved |
| | | **Bytes** | **Description** |
| | | 03:00 | Reserved |


#### Table 2: Untitled Table
![Untitled Table](../section_images/table_518_124.png)

(Continuation of Untitled Table - see first part)


#### Table 3: Untitled Table
![Untitled Table](../section_images/table_519_128.png)

(Continuation of Untitled Table - see first part)


#### Table 4: Untitled Table
![Untitled Table](../section_images/table_519_600.png)

(Continuation of Untitled Table - see first part)


#### Table 5: Untitled Table
![Untitled Table](../section_images/table_520_127.png)

(Continuation of Untitled Table - see first part)

