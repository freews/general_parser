##### 8.1.26.2 Elements of Sanitize Operations

> **Section ID**: 8.1.26.2 | **Page**: 656-657

A sanitize operation consists of:
•
sanitize processing, which may include:
o
deallocation of all media in the sanitization target that is allocated for user data, if permitted;
and
o
additional media modification;
•
optional verification of media in the sanitization target that is allocated for user data; and
•
post-verification deallocation of all media in the sanitization target that is allocated for user data
following media verification, if any.
Sanitize processing is performed in either restricted completion mode (i.e., in the Restricted Processing
state) or in unrestricted completion mode (i.e., in the Unrestricted Processing state), as specified by the
Allow Unrestricted Sanitize Exit (AUSE) bit in the Sanitize command (refer to Figure 388) or in the Sanitize
Namespace command (refer to Figure 391).
Additional media modification may be performed as part of sanitize processing (i.e., in the Restricted
Processing state or the Unrestricted Processing state) to prevent commands that access media after
completion of sanitize processing from encountering data integrity errors caused by that sanitize
processing.
For a sanitization target of NVM subsystem, additional media modification shall be performed if the
NODMMAS field is set to 10b (refer to Figure 328) and the Sanitize command that started the sanitize
operation specifies:
•
the Enter Media Verification State (EMVS) bit cleared to ‘0’; and
•
the No-Deallocate After Sanitize (NDAS) bit set to ‘1’.
Verification of media in the sanitization target that is allocated for user data is able to be performed by the
host if the Sanitize Operation State Machine is in the Media Verification state. A Block Erase sanitize
operation or Crypto Erase sanitize operation may invalidate error correction codes on the media, causing
subsequent reads to fail because of media errors. In the Media Verification state, reads are successful
regardless of such invalid error correction codes which enables the host to perform an audit (refer to section
1.5.11) to verify that the media was sanitized. Refer to the applicable NVM Express I/O Command Set
specification for details. Media verification is performed if the command that starts a sanitize operation
specified the EMVS bit set to ‘1’ and sanitize processing completed successfully.
If a sanitize operation includes deallocation of all media in the sanitization target that is allocated for user
data, then that deallocation shall be performed in exactly one of the following states:
•
Restricted Processing state;
•
Unrestricted Processing state; or
•
Post-Verification Deallocation state.
If the command (refer to Figure 388 and Figure 391) that starts a sanitize operation specified:
•
the Enter Media Verification State (EMVS) bit cleared to ‘0’;
•
the AUSE bit cleared to ‘0’; and
•
the No-Deallocate After Sanitize (NDAS) bit, if any:
o
cleared to ‘0’; or
o
set to ‘1’ and the controller encounters a condition that results in unexpected deallocation
of all media in the sanitization target that is allocated for user data (refer to section
5.2.26.1.15),
then deallocation of all media in the sanitization target that is allocated for user data shall be performed in
the Restricted Processing state. If that deallocation fails, then sanitize processing fails.
If Media Verification state is canceled (i.e., the MVCNCLD bit is set to ‘1’) during the Restricted Processing
state, then deallocation of all media in the sanitization target that is allocated for user data shall be
performed in the Restricted Processing state.
If the command that starts a sanitize operation specifies:
•
the Enter Media Verification State (EMVS) bit cleared to ‘0’;
•
the AUSE bit set to ‘1’; and
•
the No-Deallocate After Sanitize (NDAS) bit, if any:
o
cleared to ‘0’; or
o
set to ‘1’ and the controller encounters a condition that results in unexpected deallocation
of all media in the sanitization target that is allocated for user data (refer to section
5.2.26.1.15),
then deallocation of all media in the sanitization target that is allocated for user data shall be performed in
the Unrestricted Processing state. If that deallocation fails, then sanitize processing fails.
If the Media Verification state is canceled (i.e., the MVCNCLD bit is set to ‘1’) during the Unrestricted
Processing state, then deallocation of all media in the sanitization target that is allocated for user data shall
be performed in the Unrestricted Processing state.
In the Post-Verification Deallocation state the controller deallocates all user data.
In the Post-Verification Deallocation state, if the controller:
•
successfully completes deallocating all media in the sanitization target that is allocated for user
data, then the sanitization target enters the Idle state; or
•
fails to deallocate all media in the sanitization target that is allocated for user data, then the
sanitization target enters the Restricted Failure state or the Unrestricted Failure state, as described
in section 8.1.26.4.7.
A Controller Level Reset may cause the sanitize operation not to include the Media Verification state and
the Post-Verification Deallocation state, as described in section 8.1.26.4.
