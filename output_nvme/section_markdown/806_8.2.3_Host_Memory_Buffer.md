#### 8.2.3 Host Memory Buffer

> **Section ID**: 8.2.3 | **Page**: 684-684

The Host Memory Buffer (HMB) feature allows the controller to utilize an assigned portion of host memory
exclusively. The use of the host memory resources is vendor specific. The host may not be able to provide
any or a limited amount of the host memory resources requested by the controller. The controller shall
function properly without host memory resources. Refer to section 5.2.26.2.4.
The controller may indicate limitations for the minimum usable descriptor entry size and the maximum
number of descriptor entries (refer to the HMMINDS and HMMAXD fields in the Identify Controller data
structure, Figure 328). If the host does not create the Host Memory Buffer within the indicated limits, then
the host memory allocated for use by the controller may not be fully utilized (e.g., descriptor entries beyond
the maximum number of entries indicated may be ignored by the controller).
During initialization, the host may provide a descriptor list that describes a set of host memory address
ranges for exclusive use by the controller. The host memory resources assigned are for the exclusive use
of the controller (the host should not modify the ranges) until the host requests that the controller release
the ranges and the controller completes the Set Features command. The controller is responsible for
initializing the host memory resources. The host should request that the controller release the assigned
ranges prior to a shutdown event, a Runtime D3 event, or any other event that requires the host to reclaim
the assigned ranges. After the controller acknowledges that the ranges are no longer in use, the host may
reclaim the host memory resources. In the case of Runtime D3, the host should provide the host memory
resources to the controller again and inform the controller that the ranges were in use prior to the RTD3
event and have not been modified.
The host memory resources are not persistent in the controller across a Controller Level Reset. The host
should provide the previously allocated host memory resources to the controller after that reset completes.
If the host is providing previously allocated host memory resources (with the same contents) to the
controller, the Memory Return bit (refer to Figure 476) is set to ‘1’ in the Set Features command.
The controller shall ensure that there is no data loss or data corruption in the event of a surprise removal
while the Host Memory Buffer feature is being utilized.
