###### 8.1.18.6.2 Removing or Increasing a Power Limit and Enabling Power States for Use

> **Section ID**: 8.1.18.6.2 | **Page**: 618-619

If controller processing of the Power Limit feature (e.g., processing of a Set Features command for this
Feature or processing a Controller Level Reset) causes at least one prohibited power state to become
enabled for use (i.e., results in a power limit that is greater than the value of the MP field in the PSD0 field
in the Identify Controller data structure while there is at least one RPSD data structure for which the MP
field indicates a maximum power that is less than or equal to that new power limit), then the controller shall
perform the following actions in order:
1. internally restore the following data from the most recent instance of processing that created RPSD
data structures (refer to step 1 in section 8.1.18.6.1):
a. the entire set of PSD data structures;
b. the entire set of entries in the Autonomous Power State Transition data structure;
c. the value of the NPSS field; and
d. the values of the Power State attribute of the Power Management feature;
and
2. if that power limit is less than the value indicated by the MP field in the internally restored PSD0
data structure, then process that power limit as specified in section 8.1.18.6.1 against the results
of step 1 in this section, otherwise perform no action in this step.
The results of steps 1 and 2 (including the new power limit processing specified in section 8.1.18.6.1) shall
only become visible outside the controller (e.g., in the Identify Controller data structure) upon the completion
of step 2.
A host is able to remove a power limit from a controller by submitting a Set Features command for the
Power Limit feature with the PLV attribute cleared to 0h. The controller shall process such a command as
if the command were setting a power limit that is greater than the maximum power indicated by the MP field
of all RPSD data structures. The power indicated by the Maximum Unlimited Power (MUP) field in Identify
Controller data structure combined with the value of the Maximum Unlimited Power Scale (MUPS) field in
that data structure is the maximum power of power state 0 that results from successful processing of such
a command.
While a power limit is in force, if controller processing changes the current or saved value of the Power
State attribute of the Power Management feature to indicate the PSD for a different power state, then the
controller shall change the corresponding retained value (i.e., the retained current value or the retained
saved value) to indicate the PSD for that different power state in the RPSD data structures. This ensures
that subsequent processing for step 1 in this section does not cause a power state change).
For example, if the original power state 0 and power state 1 have been removed, and the current power
state of the controller is set to power state 3, then the retained value of the current power state is set to
power state 5 because restoring the PSD data structures for power state 0 and power state 1 (in step 1 in
this section) shifts the PSD for power state 3 to become the PSD for power state 5.
