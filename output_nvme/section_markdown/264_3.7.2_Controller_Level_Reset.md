#### 3.7.2 Controller Level Reset

> **Section ID**: 3.7.2 | **Page**: 144-145

The following methods initiate a Controller Level Reset (CLR):
•
NVM Subsystem Reset;
•
Controller Reset (i.e., the host writes the CC property to clear the CC.EN bit from ‘1’ to ‘0’);
•
Cross-Controller Reset command (refer to section 5.4.3); and
•
Transport specific reset types (refer to the applicable NVMe Transport binding specification), if any.
A CLR consists of the following actions:
•
The controller stops processing any outstanding Admin or I/O commands;
•
All I/O Submission Queues are deleted;
•
All I/O Completion Queues are deleted;
•
The controller is brought to an idle state. When this is complete, the CSTS.RDY bit is cleared to
‘0’; and
•
All NVMe controller properties defined in either section 3.1.4 or the applicable NVMe Transport
binding specification and all internal controller state are reset, with the following exceptions:
o
for memory-based controllers:
▪
the following are not reset as part of a CLR initiated by a Controller Reset:
•
Admin Queue properties (i.e., AQA, ASQ, and ACQ);
•
Persistent Memory Region properties (i.e., PMRCAP, PMRCTL, PMRSTS, PMREBS,
PMRSWTP, PMRMSCU, and PMRMSCL); and
•
The Controller Memory Buffer Memory Space Control property (CMBMSC);
and
▪
the following are not reset as part of a CLR initiated by a Function Level Reset:
•
the Controller Memory Buffer Memory Space Control property (CMBMSC);
and
for message-based controllers:
▪
there are no exceptions.
For all CLRs except those initiated by a Controller Reset, the controller properties defined by the transport
(e.g., the PCIe registers defined by the PCIe Base Specification) are reset as defined by the applicable
NVMe Transport binding specification (e.g., refer the NVMe over PCIe Transport Specification).
Upon completion of a CLR, if the media is not usable and an NVM Subsystem Shutdown that includes the
controller is neither reported as in progress nor reported as complete (i.e., the CSTS.ST bit is cleared to ‘0’
or the CSTS.SHST field is cleared to 00b), then the controller is permitted to initialize the media for use.
To continue after a CLR, the host should:
•
update transport specific state and controller property state as appropriate;
•
set the CC.EN bit to ‘1’;
•
wait for the CSTS.RDY bit to be set to ‘1’;
•
configure the controller using Admin commands as needed;
•
create I/O Completion Queues and I/O Submission Queues as needed; and
•
proceed with normal I/O operations.
Note that all CLRs except those initiated by a Controller Reset result in the controller immediately losing
communication with the host. In all these cases, the controller is unable to indicate any aborts or update
any completion queue entries.
For a message-based controller, if the CC.EN bit transitions to ‘0’ due to a Controller Reset while controller
shutdown processing is either in progress or reported as complete (i.e., the CSTS.ST bit is cleared to ‘0’
and the CSTS.SHST field is set to either 01b or 10b), then the association between the host and that
controller shall be preserved for at least 2 minutes (i.e., the Admin Queue shall remain connected). After
this time, the association may be removed if that controller has not been re-enabled. The requirements in
this paragraph do not apply to NVM Subsystem Shutdown processing (i.e., these requirements do not apply
if the CSTS.ST bit is set to ‘1’).
After a Controller Reset, a message-based controller continues to process Fabrics commands (e.g.
Property Get, Property Set) (refer to section 3.3.2.3).
If the host is no longer able to communicate with the controller before that host receives either:
•
completions for all outstanding commands submitted to that controller (refer to section 3.4.5); or
•
a CSTS.RDY bit value cleared to ‘0’,
then it is strongly recommended that the host take the steps described in section 9.6 to avoid possible data
corruption caused by interaction between outstanding commands and subsequent commands submitted
by that host to another controller.
