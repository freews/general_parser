###### 8.1.18.6.1 Establishing or Reducing a Power Limit and Prohibiting Power States from Use

> **Section ID**: 8.1.18.6.1 | **Page**: 617-618

If controller processing of the Power Limit feature (e.g., processing of a Set Features command for this
feature or processing of a Controller Level Reset) causes at least one enabled power state to become
prohibited from use (i.e., results in a power limit that is less than the current value of the Maximum Power
(MP) field in the Power State 0 Descriptor (PSD0) field in the Identify Controller data structure (refer to
Figure 328)), then the controller shall perform the following steps in order:
1. if there is no current power limit in force (i.e., the current value of the PLV attribute of the Power
Limit feature is cleared to 0h, refer to section 5.2.26.1.25) or the controller has removed a power
limit as part of the power limit processing specified in section 8.1.18.6.2, then retain the following
data for use as specified in section 8.1.18.6.2:
a. the entire set of PSD data structures;
b. the entire set of entries in the Autonomous Power State Transition (APST) data structure
(refer to Figure 411);
c. the Number of Power States Support (NPSS) value in the Identify Controller data structure;
and
d. the two or three values (refer to section 4.4) of the power state attribute of the Power
Management feature;
2. prohibit the use of all power states whose maximum power (indicated by the MP field in the PSD
for that power state) is greater than the specified power limit;
p
)
g
p
p
3. for each power state prohibited in step 2, remove:
a. the PSD data structure from the Identify Controller data structure; and
b. the APST data structure entry (refer to Figure 412) for that power state;
4. shift the remaining set of PSD data structures (in step 3a) to lower byte offsets in the Identify
Controller data structure so that the PSD0 field contains the PSD for the lowest numbered power
state whose MP field value is less than or equal to that new power limit, and adjust the value of the
Number of Power States Support (NPSS) field to match the number of remaining PSD data
structures;
;
5. shift the remaining set of entries in the APST data structure (in step 3b) to match the shift of the
PSD data structures in step 4, so that the first entry aligns with the new PS0 after the power limit is
applied;
pp
6. clear to zero the:
a. PSD data structures in the Identify Controller data structure that no longer contain a usable
PSD as a result of the changes made in step 3(a); and
b. entries in the APST data structure that no longer contain usable contents as a result of the
changes made in step 3(b);
7. for each of the current, default, and saved (if any) values of the Power State attribute of the Power
Management feature:
a. if the power state indicated by that value has not been prohibited by step 2, then change
that value to match the new location of the PSD data structure for that power state (i.e.,
the resulting value matches the location that resulted from the data structure shift in step
4); and
b. if the power state indicated by that value has been prohibited by step 2, then clear that
value to 0h;
and
8. for the value of the Idle Transition Power State field in each entry in each of the current, default and
saved (if any) values of the APST feature:
a. if the power state indicated by that value has not been prohibited by step 2, then change
that value to match the new location of the APST data structure for that power state (i.e.,
the resulting value matches the location that resulted from the data structure shift in step
5); and
b. if the power state indicated by that value has been prohibited by step 2, then clear that
value to 0h.
Each PSD data structure that is retained in step 1 and removed in step 3 is referred to as a Removed Power
State Descriptor (RPSD) data structure.
