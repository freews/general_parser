#### 5.2.2 Asynchronous Event Request command

> **Section ID**: 5.2.2 | **Page**: 202-203

Asynchronous events are used to notify a host of status, error, and health information as these events
occur. To enable asynchronous events to be reported by the controller, a host needs to submit one or more
Asynchronous Event Request commands to the controller. The controller specifies an event to the host by
completing an Asynchronous Event Request command. A host should expect that the controller may or
may not execute the command immediately; the command should be completed when there is an event to
be reported.
The Asynchronous Event Request command is submitted by a host to enable the reporting of asynchronous
events from the controller. The host should not place a timeout on this command. The controller posts a
completion queue entry for this command when there is an asynchronous event to report to the host. If
Asynchronous Event Request commands are outstanding when the controller is reset, then each of those
commands is aborted and shall not return a CQE.
All command specific fields are reserved.
A host may submit multiple Asynchronous Event Request commands to reduce event reporting latency.
The total number of simultaneously outstanding Asynchronous Event Request commands is limited by the
value indicated in the Asynchronous Event Request Limit field in the Identify Controller data structure in
Figure 328.
Asynchronous events are grouped into event types. The event type shall be indicated in the Asynchronous
Event Type field in Dword 0 of the completion queue entry for the Asynchronous Event Request command.
When the controller posts a completion queue entry for an outstanding Asynchronous Event Request
command and thus reports an asynchronous event, then, except for immediate events, subsequent events
of that event type are automatically masked by the controller until the host clears that event. Unless
otherwise stated (e.g., for immediate events), an event is cleared by reading the log page associated with
that event (refer to section 5.2.12). If that log page is not accessible because media is not ready (i.e., the
controller aborts the Get Log Page command with a status code of Admin Command Media Not Ready),
then the controller shall not post a completion queue entry for that asynchronous event until the controller
is able to successfully return the log page that is required to be read to clear the asynchronous event.
The following event types are defined:
a) Error event: Indicates a general error that is not associated with a specific command (refer to
Figure 152). The controller shall set the Log Page Identifier field to the identifier of the Error
Information log page (i.e., 01h). To clear this event, a host reads that log page (i.e., the Error
Information log page (refer to section 5.2.12.1.2)) using the Get Log Page command with the Retain
Asynchronous Event bit cleared to ‘0’;
b) SMART / Health Status event: Indicates a SMART or health status event (refer to Figure 153).
The controller shall set the Log Page Identifier field to the identifier of the SMART / Health
Information log page (i.e., 02h). To clear this event, a host reads the SMART / Health Information
log (refer to section 5.2.12.1.3) using the Get Log Page command with the Retain Asynchronous
Event bit cleared to ‘0’. The SMART / Health conditions that trigger asynchronous events may be
configured in the Asynchronous Event Configuration feature using the Set Features command
(refer to section 5.2.26.1.5);
c) Notice event: Indicates a general event (refer to Figure 154). The controller shall set the Log Page
Identifier field to the log page identifier of the appropriate log page as described in Figure 154. To
clear this event, a host reads that log page (i.e., the appropriate log page as described in Figure
154). The conditions that trigger asynchronous events may be configured in the Asynchronous
Event Configuration feature using the Set Features command (refer to section 5.2.26.1.5);
d) I/O Command Specific Status event: Indicates an event that is specific to an I/O command (refer
to Figure 155);
e) Immediate event: Indicates an event that is only reported when an outstanding Asynchronous
Event Request command exists at the time the event occurs (refer to Figure 156). If the event
occurs and there is no outstanding Asynchronous Event Request command, then the event shall
not be reported;
f)
One-Shot event: Indicates an event that is only reported once and the event is cleared by the
controller when that event is reported in the completion of an Asynchronous Event Request
command. Refer to the description of each event to determine how to clear any pending events
(e.g., refer to the Controller Data Queue feature in section 5.2.26.1.23); and
g) Vendor Specific event: Indicates a vendor specific event. To clear this event, a host reads the
indicated vendor specific log page using the Get Log Page command with the Retain Asynchronous
Event bit cleared to ‘0’.
The Sanitize Operation Completed With Unexpected Deallocation asynchronous event shall be supported
if the controller supports the Sanitize Config feature (refer to section 5.2.26.1.15).
Asynchronous events are reported due to a new entry being added to a log page (e.g., Error Information
log page), a status change (e.g., status in the SMART / Health log page), or occurrence of a defined
condition (e.g., Firmware Activation Starting, NVM Subsystem Normal Shutdown). A status change may be
permanent (e.g., the media has become read only) or transient (e.g., the temperature reached or exceeded
a threshold for a period of time). A host should modify the event threshold or mask the event for transient
and permanent status changes before clearing that event to avoid repeated reporting of asynchronous
events caused by clearing an asynchronous event in the absence of change to the status that caused that
event to be reported.
If an event occurs for which reporting is enabled and there are no Asynchronous Event Request commands
outstanding, the controller should retain the event information for that Asynchronous Event Type (i.e., a
pending event) and use that information as a response to the next Asynchronous Event Request command
that is received. If a Get Log Page command clears the event prior to receiving the Asynchronous Event
Request command or if a Controller Level Reset occurs, then a notification is not sent. If multiple events of
the same type occur that have identical responses to the Asynchronous Event Request command, then
those events may be reported as a single response to an Asynchronous Event Request command. If
multiple events occur that are of different types or have different responses to the Asynchronous Event
Request command, then the controller should retain a queue of those events for reporting in responses to
subsequent Asynchronous Event Request commands.
