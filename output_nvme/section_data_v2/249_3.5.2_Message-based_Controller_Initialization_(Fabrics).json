{
  "section_index": 249,
  "section_id": "3.5.2",
  "title": "3.5.2 Message-based Controller Initialization (Fabrics)",
  "level": 3,
  "pages": {
    "start": 130,
    "end": 131,
    "count": 2
  },
  "content": {
    "text": "The host selects the NVM subsystem with which to create a host to controller association. The host first\nestablishes an NVMe Transport connection with the NVM subsystem. Next the host forms an association\nwith a controller and creates the Admin Queue using the Fabrics Connect command. Finally, the host\nconfigures the controller and creates I/O Queues. Figure 82 is a ladder diagram that describes the queue\ncreation process for an Admin Queue or an I/O Queue.\nThe controller initialization steps after an association is established are described below. For determining\ncapabilities or configuring properties, the host uses the Property Get command and Property Set command,\nrespectively.\n1. NVMe in-band authentication is performed if required (refer to section 8.3.5.2);\n2. The host determines the controller capabilities;\n3. The host determines the supported I/O Command Sets by checking the state of CAP.CSS and\nappropriately initializing CC.CSS as follows:\na. If the CAP.CSS.NOIOCSS bit is set to ‘1’, then the CC.CSS field should be set to 111b;\nb. If the CAP.CSS.IOCSS bit is set to ‘1’, then the CC.CSS field should be set to 110b; and\nc. If the CAP.CSS.IOCSS bit is cleared to ‘0’ and the CAP.CSS.NCSS bit is set to ‘1’, then the\nCC.CSS field should be set to 000b;\n4. The host configures controller settings. Specific settings include:\na. The arbitration mechanism should be selected in CC.AMS; and\nb. The memory page size should be initialized in CC.MPS;\n5. The controller should be enabled by setting CC.EN to ‘1’;\ny\ng\n6. The host should wait for the controller to indicate the controller is ready to process commands. The\ncontroller is ready to process commands when CSTS.RDY is set to ‘1’;\n7. The host determines the configuration of the controller by issuing the Identify command specifying\nthe Identify Controller data structure (i.e., CNS 01h);\ny\n(\n)\n8. The host determines any I/O Command Set specific configuration information as follows:\na. If the CAP.CSS.IOCSS bit is set to ‘1’, then the host does the following:\ni. Issue the Identify command specifying the Identify I/O Command Set data structure (CNS\n1Ch); and\nii. Issue the Set Features command with the I/O Command Set Profile Feature Identifier (FID\n19h) specifying the index of the I/O Command Set Combination (refer to Figure 343) to be\nenabled;\nand\nb. For each I/O Command Set that is enabled (Note: the NVM Command Set is enabled if the\nCC.CSS field is set to 000b):\ni. Issue the Identify command specifying the I/O Command Set specific Active Namespace\nID list (CNS 07h) with the appropriate Command Set Identifier (CSI) value of that I/O\nCommand Set; and\nii\nFor each NSID that is returned:\n1. If the enabled I/O Command Set is the NVM Command Set or an I/O Command Set\nbased on the NVM Command Set (e.g., the Zoned Namespace Command Set) issue\nthe Identify command specifying the Identify Namespace data structure (CNS 00h);\nand\n2. Issue the Identify command specifying each of the following data structures (refer to\nFigure 326: the I/O Command Set specific Identify Namespace data structure, the I/O\nCommand Set specific Identify Controller data structure, and the I/O Command Set\nindependent Identify Namespace data structure;\n9. The host should determine:\na. the maximum I/O Queue size using CAP.MQES; and\nb. the number of I/O Submission Queues and I/O Completion Queues supported using the\nresponse from the Set Features command with the Number of Queues feature identifier;\n10. The host should use the Connect command (refer to section 6.3) to create I/O Submission and\nCompletion Queue pairs; and\np\np\n;\n11. To enable asynchronous notification of optional events, the host should issue a Set Features\ncommand specifying the events to enable. The host may submit one or more Asynchronous Event\nRequest commands to be notified of asynchronous events as described by section 5.2.2. This step\nmay be done at any point after the controller signals that the controller is ready (i.e., CSTS.RDY is\nset to ‘1’).\nThe association may be removed if step 5 (i.e., setting CC.EN to ‘1’) is not completed within 2 minutes after\nestablishing the association.",
    "tables": [],
    "figures": []
  },
  "statistics": {
    "table_count": 0,
    "figure_count": 0
  }
}