{
  "section_index": 820,
  "section_id": "8.2.6",
  "title": "8.2.6 Virtualization Enhancements",
  "level": 3,
  "pages": {
    "start": 693,
    "end": 695,
    "count": 3
  },
  "content": {
    "text": "Virtualized environments may use an NVM subsystem with multiple controllers to provide virtual or physical\nhosts direct I/O access. The NVM subsystem is composed of primary controller(s) and secondary\ncontroller(s), where the secondary controller(s) depend on primary controller(s) for dynamically assigned\nresources. A host may issue the Identify command to a primary controller specifying the Secondary\nController List to discover the secondary controllers associated with that primary controller. All secondary\ncontrollers shall be part of the same domain as the primary controller with which they are associated.\nController resources may be assigned or removed from a controller using the Virtualization Management\ncommand (refer to section 5.3.6) issued to a primary controller. The following types of controller resources\nare defined:\n•\nVirtual Queue Resource (VQ Resource): a type of controller resource that manages one\nSubmission Queue (SQ) and one Completion Queue (CQ) (refer to section 8.2.6.1); and\n•\nVirtual Interrupt Resource (VI Resource): a type of controller resource that manages one interrupt\nvector (refer to section 8.2.6.2).\nFlexible Resources are controller resources that may be assigned to the primary controller or one of its\nsecondary controllers. The Virtualization Management command is used to provision the Flexible\nResources between a primary controller and one of its secondary controller(s). A primary controller’s\nallocation of Flexible Resources may be modified using the Virtualization Management command and the\nchange takes effect as a result of the next Controller Level Reset initiated by any method other than a\nController Reset. A secondary controller only supports having Flexible Resources assigned or removed\nwhen in the Offline state.\nPrivate Resources are controller resources that are permanently assigned to a primary or secondary\ncontroller. These resources are not supported by the Virtualization Management command.\nThe primary controller is allowed to have a mix of Private and Flexible Resources for a particular controller\nresource type. If there is a mix, then the Private Resources occupy the lower contiguous range of resource\nidentifiers starting with 0. Secondary controllers shall have all Private or all Flexible Resources for a\nparticular resource type. Controller resources assigned to a secondary controller always occupy a\ncontiguous range of identifiers with no gaps, starting with 0. If a particular controller resource type is\nsupported as indicated in the Controller Resource Types field of the Primary Controller Capabilities\nStructure, then all secondary controllers shall have that controller resource type assigned as a Flexible\nResource. Figure 728 shows the controller resource allocation model for a controller resource type that is\nassignable as a Flexible Resource.\nFor each controller resource type supported, the Primary Controller Capabilities Structure (refer to Figure\n346) defines:\n•\nThe total number of Flexible Resources;\n•\nThe total number of Private Resources for the primary controller;\n•\nThe maximum number of Flexible Resources that may be assigned to a secondary controller using\nthe Virtualization Management command; and\n•\nThe assignment of resources to the primary controller.\nPrimary and secondary controllers may implement all features of this specification, except where\ncommands are defined as being only supported by a primary controller. It is recommended that only primary\ncontrollers support the privileged actions described in section 3.10 so that untrusted hosts using secondary\ncontrollers do not impact the entire NVM subsystem state.\nThe Secondary Controller List structure returned by the Identify command is used to determine the topology\nof secondary controllers and the resources assigned. The secondary controller shall be in the Offline state\nto configure resources. The Virtualization Management command is used to transition the secondary\ncontroller between the Online state and the Offline state. Refer to section 8.2.6.3 for details on the Online\nand Offline states.\nTo support the Virtualization Enhancements capability, the NVM subsystem shall support the following:\n•\nOne or more primary controllers, each of which supports:\no\nOne or more secondary controllers;\no\nA pool of unassigned Flexible Resources that supports allocation to a primary controller and\ndynamic assignment to its associated secondary controllers;\no\nTwo or more Private Resource queue pairs;\no\nIndicate support for the Virtualization Management command by setting the VMS bit to ‘1’ in\nthe Optional Admin Command Support (OACS) field in the Identify Controller data structure;\no\nThe Virtualization Management command;\no\nThe Primary Controller Capabilities Structure defined in Figure 346 (Identify command with\nCNS value of 14h);\no\nThe Secondary Controller List defined in Figure 346 (Identify command with CNS value of 15h);\nand\no\nThe Namespace Management capability (refer to section 8.1.16);\n•\nOne or more secondary controllers; and\n•\nFlexible Resources, each of which supports all of the following:\no\nAssignment and removal by exactly one primary controller; and\no\nAssignment to no more than one controller at a time.\nWithin an NVM subsystem that supports both the Virtualization Enhancements capability and SR-IOV (refer\nto section 8.2.6.4), all controllers that are SR-IOV PFs shall be primary controllers, and all controllers that\nare SR-IOV VFs shall be secondary controllers of their associated PFs.",
    "tables": [],
    "figures": []
  },
  "statistics": {
    "table_count": 0,
    "figure_count": 0
  }
}