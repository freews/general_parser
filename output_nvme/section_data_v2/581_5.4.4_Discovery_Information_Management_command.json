{
  "section_index": 581,
  "section_id": "5.4.4",
  "title": "5.4.4 Discovery Information Management command",
  "level": 3,
  "pages": {
    "start": 492,
    "end": 499,
    "count": 8
  },
  "content": {
    "text": "The Discovery Information Management command registers, de-registers, or updates discovery information\nentries.\nThe type of task performed by the Discovery Information Management command (i.e., registration, de-\nregistration, or update) is determined by the value set in Task (TAS) field of Command Dword 10 (refer to\nFigure 530).\nFor a register task (i.e., TAS field cleared to 0h), the Discovery Information Management command\nregisters:\n•\none or more host discovery information entries; or\n•\none or more NVM subsystem discovery information entries.\nFor a de-register task (i.e., TAS field set to 1h), the Discovery Information Management command de-\nregisters:\n•\none or more host discovery information entries; or\n•\none or more NVM subsystem discovery information entries.\nFor an update task (i.e., TAS field set to 2h), the Discovery Information Management command updates:\n•\none host discovery information entry; or\n•\none NVM subsystem discovery information entry.\nDiscovery information entries may be one of the following:\n•\na basic discovery information entry (refer to Figure 310); or\n•\nan extended discovery information entry (refer to Figure 532).\nHost discovery information entries shall be extended discovery information entries.\nNVM subsystem discovery information entries may be basic discovery information entries or may be\nextended discovery information entries. Each NVM subsystem discovery information entry may specify an\nNVM subsystem that exposes namespaces that hosts may access or may specify a referral to another\nDiscovery subsystem.\nThe Discovery Information Management command uses the Data Pointer field as shown in Figure 529 and\nCommand Dword 10 as shown in Figure 530. All other command specific fields are reserved.\nThe data portion of the Discovery Information Management command contains a header that identifies the\nentity performing the register, de-register, or update task.\nIf a register task is being performed and the data portion of the Discovery Information Management\ncommand does not contain one or more discovery information entries, then the controller shall abort the\ncommand with status code of Invalid Field in Command. If the number of discovery information entries\ncontained in the data portion of the Discovery Information Management command exceeds the available\ncapacity for new discovery information entries on the CDC or DDC, then the controller shall abort the\ncommand with a status code of Insufficient Discovery Resources. If multiple register tasks are performed\nby the same entity (i.e., the value set in the Entity Identifier (EID) field of the header is associated with an\nexisting registration record contained in the CDC or DDC), and:\na) the Entry Key associated with a discovery information entry in the Discovery Information\nManagement command matches the Entry Key associated with an existing registration record, then\nthe existing registration record contained in the CDC or DDC shall be updated with the discovery\ninformation entry from the Discovery Information Management command; or\nb) the Entry Key associated with a discovery information entry in the Discovery Information\nManagement command does not match the Entry Key associated with an existing registration\nrecord, then the discovery information entry in the Discovery Information Management command\nshall be registered with the CDC or DDC.\nIf a de-register task is being performed and the data portion of the Discovery Information Management\ncommand does not contain one or more discovery information entries, then the controller shall abort the\ncommand with a status code of Invalid Field in Command.\nIf an update task is being performed and the data portion of the Discovery Information Management\ncommand does not contain two discovery information entries, then the controller shall abort the command\nwith a status code of Invalid Field in Command. The first discovery information entry identifies the\nregistration record contained in the CDC or DDC that is to be updated. The fields in the first discovery\ninformation entry that are not used as part of the Entry Key are ignored. The second discovery information\nentry replaces the existing registration record identified by the Entry Key from the first discovery information\nentry. The update task shall be atomic.\nThe format for the data portion of the Discovery Information Management command is defined in Figure\n531.\nBased upon the value set in the Entity Type (ETYPE) field of the header, the data portion of a Discovery\nInformation Management command shall:\n•\nonly contain host extended discovery information entries if the ETYPE field is set to 1h (i.e., a host\nis performing the register, de-register, or update task);\n•\nonly contain host extended discovery information entries if the ETYPE field is set to 3h (i.e., a CDC\nis performing the register, de-register, or update task); and\n•\nonly contain NVM subsystem basic discovery information entries or NVM subsystem extended\ndiscovery information entries if the ETYPE field is set to 2h (i.e., a DDC is performing the register,\nde-register, or update task). The DDC may set the Port Local (PORTLCL) field to 1h if the NVM\nsubsystem discovery information entries being registered, de-registered, or updated are only for\nNVM subsystem ports that are presented through the same NVM subsystem port on the DDC that\nis performing the register, de-register, or update task.\nHost extended discovery information entries and NVM subsystem extended discovery information entries\neach contain the same set of fields, but not all of the fields are used for both extended discovery information\nentry types. Refer to Figure 534 for the usage of the extended discovery information entry fields for each\nextended discovery information entry type. If the entity performing a register, de-register, or update task\nuses any field in an extended discovery information entry that conflicts with the value set in the ETYPE field\nof the Discovery Information Management command data portion’s header (e.g., a host uses a field\nintended for only NVM subsystem extended discovery information entries), then the controller shall abort\nthe command with a status code of Invalid Discovery Information.\nHost extended discovery information entries shall contain at least one extended attribute containing a Host\nIdentifier. NVM subsystem extended discovery information entries may contain zero or more extended\nattributes. The format for an extended attribute is defined in Figure 533.",
    "tables": [
      {
        "id": "table_493_684",
        "page": 493,
        "bbox": [
          115.0,
          684.0,
          883.0,
          729.0
        ],
        "table_md": "| | | |\n| :--- | :--- | :--- |\n| | | 1h | De-Register |\n| | | 2h | Update |\n| | | 3h to Fh | Reserved |\n| | | | |\n| | | | |\n| | | | |\n| | | | |\n| | | | |\n| | | | |\n| | | | | |\n| :--- | :--- | :--- | :--- | :--- |\n| | | | **Port ID Based (3Fh)** | **TRADDR Based (5Fh)** |\n| | | **Bits** | **Description** | |\n| | | 15:7 | Reserved | |\n| | | 6 | Transport Address (TRADDR) | Not used | Used |\n| | | 5 | Port ID (PORTID) | Used | Not used |\n| | | 4 | Transport Type (TRTYPE) | | |\n| | | 3 | Address Family (ADRFAM) | | |\n| | | 2 | Transport Service Identifier (TRSVCID) | Used | Used |\n| | | 1 | Transport Specific Address Subtype (TSAS) | | |\n| | | 0 | NVMe Qualified Name (NQN) | | |\n| | | | | |\n| | | | | |\n| | | | | |\n| | | | | |\n| | | |\n| 02 | M² | Subsystem Type (SUBTYPE): This field specifies the type of the NVM subsystem that is indicated in this entry as defined in the Subsystem Type (SUBTYPE) field in Figure 310. |\n| :--- | :--- | :--- |\n| 03 | M² | Transport Requirements (TREQ): This field specifies requirements for the NVMe Transport as defined in the Transport Requirements (TREQ) field in Figure 310. |\n| 05:04 | M² | Port ID (PORTID): This field specifies a particular NVM subsystem port as defined in the Port ID (PORTID) field in Figure 310. |\n| 07:06 | M² | Controller ID (CNTLID): This field specifies the controller ID as defined in the Controller ID (CNTLID) field in Figure 310. This field shall specify a controller ID that a host is able to use in a Connect command to the NVM subsystem being registered. |\n| 09:08 | M² | Admin Max SQ Size (ASQSZ): This field specifies the maximum size of an Admin Submission Queue as defined in the Admin Max SQ Size (ASQSZ) field in Figure 310. |\n| 31:10 | | Reserved |\n| 63:32 | M² | Transport Service Identifier (TRSVCID): This field specifies the NVMe Transport service identifier as an ASCII string as defined in the Transport Service Identifier (TRSVCID) field in Figure 310. |\n| 255:64 | | Reserved |\n| 511:256 | M | NVMe Qualified Name (NQN): If the Entity Type (ETYPE) field in the Discovery Information Management command data portion's header is set to 2h (i.e., a DDC is performing the register, de-register, or update task), then this field specifies the NVMe Qualified Name (NQN) that uniquely identifies the NVM subsystem as defined in the NVM Subsystem Qualified Name (SUBNQN) field in Figure 310. <br> If the ETYPE field in the Discovery Information Management command data portion's header is set to 1h or 3h (i.e., a host or CDC is performing the register, de-register, or update task), then this field specifies the NQN that uniquely identifies the host as defined in the Host NVMe Qualified Name (HOSTNQN) field in Figure 315. |\n| | | |\n| :--- | :--- | :--- |\n| 767:512 | M | Transport Address (TRADDR): If the Entity Type (ETYPE) field in the Discovery Information Management command data portion's header is set to 2h (i.e., a DDC is performing the registration, de-registration, or update task), then this field specifies the address of a fabric interface on the NVM subsystem that may be used for a Connect command as an ASCII string as defined in the Transport Address (TRADDR) field in Figure 310.<br><br>If the ETYPE field in the Discovery Information Management command data portion's header is set to 1h or 3h (i.e., a host or CDC is performing the registration, de-registration, or update task), then this field specifies the address of a fabric interface on the host that may be used for a Connect command as an ASCII string as defined in the Transport Address (TRADDR) field in Figure 315.<br><br>If the first byte (i.e., byte 512) of this field is NULL (i.e., cleared to 00h), then the TRADDR value used by the controller shall be the remote IP address associated with the connection used to transport the Discovery Information Management command. If the host attempts to register or de-register multiple discovery information entries with the first byte of this field containing a NULL, then the controller shall abort the command with a status code of Invalid Field in Command. |\n| 1023:768 | M | Transport Specific Address Subtype (TSAS): This field specifies NVMe Transport specific information about the address as defined in the Transport Specific Address Subtype (TSAS) field in Figure 310. |\n| 1027:1024 | M | Total Entry Length (TEL): This field specifies the length in bytes of the entire extended discovery information entry. |\n| 1029:1028 | M³ | Number of Extended Attributes (NUMEXAT): This field specifies the number of extended attributes contained in the extended discovery information entry.<br><br>This field shall be set to a non-zero value (i.e., the extended discovery information entry shall contain at least one extended attribute) if the Entity Type (ETYPE) field in the Discovery Information Registration command data portion's header is set to 1h or 3h (i.e., a host or CDC is performing the register, de-register, or update task). If the ETYPE field is set to 1h or 3h and this field is cleared to 0h, then the controller shall abort the command with a status code of Invalid Discovery Information. |\n| 1031:1030 | | Reserved |\n| | | **Extended Attribute List** |\n| LEN - 1) + 4) + 1032: 1032 | M³ | **Extended Attribute 0**: This field contains the first extended attribute as defined in Figure 533 (if present), where EXATLEN is the size specified in the Extended Attribute Length (EXATLEN) field of the extended attribute. |\n| ... | O | ... |\n| TEL - 1: - (EXATLEN + 4) | O | **Extended Attribute N**: This field contains the Nth extended attribute as defined in Figure 533 (if present), where EXATLEN is the size specified in the Extended Attribute Length (EXATLEN) field of the extended attribute and TEL is the size specified in the Total Entry Length (TEL) field. |\n| | | M definition: O = Optional, M = Mandatory.<br>This field is mandatory for NVM subsystem discovery information entries. For host discovery information entries, this field shall be cleared to 0h.<br>This field is mandatory for host discovery information entries and optional for NVM subsystem discovery information entries. |\n| Field Name | Extended Discovery Information Entry Type: |  |\n| :--- | :--- | :--- |\n| | Host | NVM Subsystem |\n| Transport Type (TRTYPE) | Used | Used |\n| Address Family (ADRFAM) | Used | Used |\n| Subsystem Type (SUBTYPE) | Ignored¹ | Used |\n| Transport Requirements (TREQ) | Ignored¹ | Used |\n| Port ID (PORTID) | Ignored¹ | Used |\n| Controller ID (CNTLID) | Ignored¹ | Used |\n| NVMe Qualified Name (NQN) | Used | Used |\n| Transport Address (TRADDR) | Used | Used |\n| Transport Specific Address Subtype (TSAS) | Used | Used |\n| Total Entry Length (TEL) | Used | Used |\n| Number of Extended Attributes (NUMEXAT) | Used | Used |\n| Extended Attribute 0 (EXAT0)...Extended Attribute N (EXATN) | Used | Used |"
      },
      {
        "id": "table_493_772",
        "page": 493,
        "bbox": [
          115.0,
          772.0,
          883.0,
          904.0
        ],
        "table_md": "(Continuation of Untitled Table - see first part)"
      },
      {
        "id": "table_494_127",
        "page": 494,
        "bbox": [
          114.0,
          127.0,
          882.0,
          732.0
        ],
        "table_md": "(Continuation of Untitled Table - see first part)"
      },
      {
        "id": "table_495_124",
        "page": 495,
        "bbox": [
          114.0,
          124.0,
          881.0,
          911.0
        ],
        "table_md": "(Continuation of Untitled Table - see first part)"
      },
      {
        "id": "table_496_128",
        "page": 496,
        "bbox": [
          115.0,
          128.0,
          882.0,
          309.0
        ],
        "table_md": "(Continuation of Untitled Table - see first part)"
      },
      {
        "id": "table_496_355",
        "page": 496,
        "bbox": [
          114.0,
          355.0,
          882.0,
          853.0
        ],
        "table_md": "(Continuation of Untitled Table - see first part)"
      },
      {
        "id": "table_497_124",
        "page": 497,
        "bbox": [
          114.0,
          124.0,
          881.0,
          829.0
        ],
        "table_md": "(Continuation of Untitled Table - see first part)"
      },
      {
        "id": "table_498_128",
        "page": 498,
        "bbox": [
          114.0,
          128.0,
          881.0,
          676.0
        ],
        "table_md": "(Continuation of Untitled Table - see first part)"
      },
      {
        "id": "table_498_722",
        "page": 498,
        "bbox": [
          114.0,
          722.0,
          883.0,
          909.0
        ],
        "table_md": "(Continuation of Untitled Table - see first part)"
      },
      {
        "id": "table_499_128",
        "page": 499,
        "bbox": [
          115.0,
          128.0,
          881.0,
          273.0
        ],
        "table_md": "(Continuation of Untitled Table - see first part)"
      }
    ],
    "figures": []
  },
  "statistics": {
    "table_count": 10,
    "figure_count": 0
  }
}