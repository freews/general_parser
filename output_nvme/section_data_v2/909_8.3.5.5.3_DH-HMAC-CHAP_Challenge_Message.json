{
  "section_index": 909,
  "section_id": "8.3.5.5.3",
  "title": "8.3.5.5.3 DH-HMAC-CHAP_Challenge Message",
  "level": 5,
  "pages": {
    "start": 750,
    "end": 751,
    "count": 2
  },
  "content": {
    "text": "The DH-HMAC-CHAP_Challenge message is sent from the controller to the host. The format of the DH-\nHMAC-CHAP Challenge message is shown in Figure 800.\nHash Length (HL): Shall be set to the length in bytes of the selected hash function, as specified in Figure\n798.\nHashID: Shall be set to the hash function identifier (refer to Figure 798) selected for this authentication\ntransaction among those proposed in the DH-HMAC-CHAP protocol descriptor in the AUTH_Negotiate\nmessage. The controller shall select a hash function in accord with its applicable policy.\nDHgID: Shall be set to the DH group identifier (refer to Figure 800) selected for this authentication\ntransaction among those proposed in the DH-HMAC-CHAP protocol descriptor in the AUTH_Negotiate\nmessage. The controller shall select a DH group identifier in accord with its applicable policy. If this field is\ncleared to 0h, then the DH portion of the DH-HMAC-CHAP protocol shall not be performed in this\nauthentication transaction. The controller shall not clear this field to 00h if the AUTH_Negotiate message\n(refer to section 8.3.5.4.1) for this instance of the DH-HMAC-CHAP protocol requested secure channel\nconcatenation (i.e., the SC C field in that message was set to a non-zero value).\nDH Value Length (DHVLEN): Diffie-Hellman exponential length. This length shall be a multiple of 4. If the\nDH group identifier is cleared to 0h (i.e., NULL DH exchange), this field shall be cleared to 0h. Otherwise,\nit shall be set to the length in bytes of the DH Value.\nSequence Number (SEQNUM): 32-bit sequence number S1. A random non-zero value shall be used as\nthe initial value. The sequence number is incremented modulo 232 after each use, except that the value 0h\nis skipped (i.e., incrementing the value FFFFFFFFh results in the value 00000001h).\nChallenge Value (CVAL): Shall be set to a random challenge value C1 (refer to section 8.3.5.5.7). Each\nchallenge value should be unique and unpredictable, since repetition of a challenge value in conjunction\nwith the same key may reveal information about the key or the correct response to this challenge. The\nalgorithm for generating the challenge value is outside the scope of this specification. Randomness of the\nchallenge value is crucial to the security of the protocol (refer to section 8.3.5.5.7). The CVAL length is the\nsame as the length of the selected hash function (i.e., HL).\nDH Value (DHV): Diffie-Hellman exponential. If the DH Value Length is cleared to 0h, this field is not\npresent. The DH value shall be set to the value of gx mod p, where x is a random number selected by the\ncontroller that shall be at least 256 bits long (refer to section 8.3.5.5.7) and p and g shall have the values\nindicated in Figure 799, based on the selected DH group identifier.\nUpon receiving a DH-HMAC-CHAP_Challenge message, if:\n•\nthe Hash Length (HL) does not match the value specified in Figure 798 for the selected hash\nfunction;\n•\nthe Sequence Number (SEQNUM) is cleared to 0h;\n•\nDHgID is cleared to 0h and the AUTH_Negotiate message (refer to section 8.3.5.4.1) that the host\nsent for this instance of the DH-HMAC-CHAP protocol requested secure channel concatenation\n(i.e., the SC_C field in that message is set to a non-zero value);\n•\nDHgID is non-zero and the DH Value Length (DHVLEN) is cleared to 0h; or\n•\nDHgID is non-zero and the DH Value (DHV) is 0, 1, or p-1;\nthen the host shall:\n•\nreply with an AUTH_Failure2 message having reason code ‘Authentication failure’ and reason code\nexplanation ‘Incorrect payload’; and\n•\ndisconnect the NVMe over Fabrics connection.",
    "tables": [
      {
        "id": "table_750_466",
        "page": 750,
        "bbox": [
          115.0,
          466.0,
          883.0,
          674.0
        ],
        "table_md": "| 9 | Diffie-Hellman Group Identifier (DHgID): Identifier of selected Diffie-Hellman group |\n|---|---|\n| 11:10 | DH Value Length (DHVLEN): Length in bytes of DH value. If no DH value is included in the message, then this field is cleared to 0h |\n| 15:12 | Sequence Number (SEQNUM): Sequence number S₁ |\n| 15+HL:16 | Challenge Value (CVAL): Challenge C₁ |\n| DHVLEN:16+HL | DH Value (DHV): DH exponential gˣ mod p. This field is not present (i.e., the CVAL field is the last field in the message) if DHVLEN is cleared to 0h |"
      }
    ],
    "figures": []
  },
  "statistics": {
    "table_count": 1,
    "figure_count": 0
  }
}