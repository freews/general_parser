{
  "section_index": 766,
  "section_id": "8.1.24",
  "title": "8.1.24 Reservations",
  "level": 3,
  "pages": {
    "start": 644,
    "end": 646,
    "count": 3
  },
  "content": {
    "text": "NVM Express reservations provide capabilities that may be utilized by two or more hosts to coordinate\naccess to a shared namespace. The protocol and manner in which these capabilities are used is outside\nthe scope of this specification. Incorrect application of these capabilities may corrupt data and/or otherwise\nimpair system operation.\nReservation operation after a division event (refer to section 3.2.5.1) is described in section 3.2.5.2.\nA reservation on a namespace restricts hosts access to that namespace. If a host submits a command that\nuses the Namespace Identifier (NSID) field and that NSID field contains an active NSID, then in the\npresence of a reservation on the namespace identified by that NSID where that host lacks sufficient rights,\nthat command is aborted by the controller with a status code of Reservation Conflict. If a host submits a\ncommand that uses the NSID field and that NSID field is set to FFFFFFFFh, then in the presence of a\nreservation on any of the namespaces impacted by that command where that host lacks sufficient rights on\nany of the impacted namespaces, that command is aborted by the controller with a status code of\nReservation Conflict. Capabilities are provided that allow recovery from a reservation on a namespace held\nby a failing or uncooperative host.\nA command is checked for reservation conflict at the time that the controller begins processing that\ncommand. If that reservation conflict check allows the command to be performed (i.e., the host has sufficient\nrights for that command with respect to existing reservations, if any), then that command shall not be\nsubsequently aborted by the controller with a status code of Reservation Conflict (e.g., due to a subsequent\nreservation).\nA reservation requires an association between a host and a namespace. As shown in Figure 701, each\ncontroller in a multi-path I/O and namespace sharing environment is associated with exactly one host. While\nit is possible to construct systems where two or more hosts share a single controller, such usage is outside\nthe scope of this specification.\nA host may be associated with multiple controllers. In Figure 701 host A is associated with two controllers\nwhile hosts B and C are each associated with a single controller. A host should register a non-zero Host\nIdentifier (refer to section 5.2.26.1.32) with each controller with which that host is associated using a Set\nFeatures command (refer to section 5.2.26) prior to performing any operations associated with reservations.\nThe Host Identifier allows the NVM subsystem to identify controllers associated with the same host and\npreserve reservation properties across these controllers (i.e., a host issued command has the same\nreservation rights no matter which controller associated with the host processes the command).\nAn NVM subsystem may require that the host register a non-zero Host Identifier for a host to use\nreservations (e.g., the RHII bit is set to ‘1’ in the CTRATT field of the Identify Controller data structure (refer\nto Figure 328)). If the controller does not support reservations with a Host Identifier value of 0h and a\nreservation command is received from a host with a Host Identifier value of 0h, then the controller shall\nabort that reservation command with a status of Host Identifier Not Initialized.\nIf an NVM subsystem supports reservations with a Host Identifier value of 0h, and:\nthen those registrations or reservations remain associated with the Host with a Host Identifier value of 0h\nand are not associated with the host with the non-zero Host Identifier.\nIf the controller does not support reservations with a Host Identifier value of 0h, reservations may have\nbeen established by hosts with non-zero Host Identifiers connected to other controllers, and commands\nfrom a host with a Host Identifier value of 0h that conflict with a reservation (refer to Figure 702 and Figure\n703) are aborted by the controller with a status code of Reservation Conflict.\nSupport for reservations by a namespace or controller is optional. A namespace indicates support for\nreservations by reporting a non-zero value in the Reservation Capabilities (RESCAP) field in the Identify\nNamespace data structure. A controller indicates support for reservations through the Optional NVM\nCommand Support (ONCS) field in the Identify Controller data structure (refer to Figure 328). If a host\nsubmits a command associated with reservations (i.e., Reservation Report, Reservation Register,\nReservation Acquire, and Reservation Release):\n•\nto a controller that does not support reservations; or\n•\nthat impacts a namespace that does not support reservations,\nthen the command is aborted by the controller with a status code of Invalid Command Opcode.\nControllers that make up an NVM subsystem shall all have the same support for reservations. Although\nstrongly encouraged, namespaces that make up an NVM subsystem are not all required to have the same\nsupport for reservations. For example, some namespaces within a single controller may support\nreservations while others do not, or the supported reservation types may differ among namespaces. If a\ncontroller supports reservations, then the controller shall:\n•\nIndicate support for reservations by returning a '1' in the Reservations Support (RESERVS) bit of\nthe Optional NVM Command Support (ONCS) field in the Identify Controller data structure;\n•\nSupport the Reservation Report command (refer to section 7.8), Reservation Register command\n(refer to section 7.6), Reservation Acquire command (refer to section 7.5), and Reservation\nRelease command (refer to section 7.7);\n•\nSupport the Reservation Notification log page;\n•\nSupport the Reservation Log Page Available asynchronous events;\n•\nSupport the Reservation Notification Mask Feature;\n•\nSupport the Host Identifier Feature; and\n•\nSupport the Reservation Persistence Feature.\nIf a controller supports dispersed namespaces and supports reservations, then the controller supports the\nDispersed Namespace Reservation Support (DISNSRS) bit being set to ‘1’ in the Reservation Report\ncommand, Reservation Register command, Reservation Acquire command, and Reservation Release\ncommand, as described in section 8.1.10.6.\nIf a namespace supports reservations, then the namespace shall:\n•\nReport a non-zero value in the Reservation Capabilities (RESCAP) field in the Identify Namespace\ndata structure;\n•\nSupport Persist Through Power Loss (PTPL) state; and\n•\nSupport sufficient resources to allow a host to successfully register a reservation key on every\ncontroller in the NVM subsystem with access to the shared namespace (i.e., a Reservation Register\ncommand shall never fail due to lack of resources).\nNOTE: The behavior of Ignore Existing Key has been changed to improve compatibility with SCSI based\nimplementations. Conformance to the modified behavior is indicated in the Reservation Capabilities\n(RESCAP) field of the Identify Namespace data structure. For the previous definition of Ignore Existing Key\nbehavior, refer to NVM Express Base Specification, Revision 1.2.1.",
    "tables": [],
    "figures": []
  },
  "statistics": {
    "table_count": 0,
    "figure_count": 0
  }
}