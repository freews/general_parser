{
  "section_index": 762,
  "section_id": "8.1.23.2.3",
  "title": "8.1.23.2.3 Authenticated Data Write",
  "level": 5,
  "pages": {
    "start": 639,
    "end": 641,
    "count": 3
  },
  "content": {
    "text": "The Authenticated Data Write is initiated by a Security Send command. The RPMB Data Frame delivered\nfrom the host to the controller includes the Request Message Type = 0003h, Block Count, Address, Write\nCounter, Data and MAC.\nWhen the controller receives this RPMB Data Frame, that controller first checks whether the Write Counter\nhas expired. If the Write Counter has expired, then that controller sets the RPMB Operation Result to 0085h\n(write failure, write counter expired) and no data is written to the RPMB data area.\nAfter checking the Write Counter is not expired, the Address is checked. If there is an error in the Address\n(e.g., out of range), then the result is set to 0004h (address failure) and no data is written to the RPMB data\narea.\nAfter checking the Address is valid, the controller calculates the MAC (refer to section 8.1.23.1) and\ncompares this with the MAC in the request. If the MAC in the request and the calculated MAC are different,\nthen the controller sets the result to 0002h (authentication failure) and no data is written to the RPMB data\narea.\nIf the MAC in the request and the calculated MAC are equal, then the controller compares the Write Counter\nin the request with the Write Counter stored in the controller. If the counters are different, then the controller\nsets the result to 0003h (counter failure) and no data is written to the RPMB data area.\nIf the MAC and Write Counter comparisons are successful, then the write request is authenticated. The\nData from the request is written to the Address indicated in the request and the Write Counter is\nincremented by one.\nIf the write fails, then the returned result is 0005h (write failure). If another error occurs during the write\nprocedure, then the returned result is 0001h (general failure).\nThe controller returns a successful completion for the Security Send command when the Authenticated\nData Write operation is completed regardless of whether the Authenticated Data Write was successful or\nnot.\nThe success of programming the data should be checked by the host by reading the result property of the\nRPMB:\n1) The host initiates the Authenticated Data Write verification process by issuing a Security Send\ncommand with delivery of a RPMB data frame containing the Request Message Type = 0005h;\n2) The controller returns a successful completion of the Security Send command when the verification\nresult is ready for retrieval;\n3) The host should then retrieve the verification result by issuing a Security Receive command; and\n4) The controller returns a successful completion of the Security Receive command and returns the\nRPMB data frame containing the Response Message Type = 0300h, the incremented counter\nvalue, the data address, the MAC and result of the data programming operation.",
    "tables": [
      {
        "id": "table_641_126",
        "page": 641,
        "bbox": [
          114.0,
          126.0,
          881.0,
          631.0
        ],
        "table_md": "| | | | |\n| :--- | :--- | :--- | :--- |\n| 222-N:00 | Stuff Bytes | 0...00h | |\n| 222:222-(N-1) | MAC/Key | MAC generated by the host | |\n| 223 | RPMB Target | RPMB target to access | |\n| 239:224 | Nonce | 0...00h | |\n| 243:240 | Write Counter | Current Write Counter value | |\n| 247:244 | Address | Address in the RPMB | |\n| 251:248 | Sector Count | Number of 512B blocks | |\n| 253:252 | Result | 0000h | |\n| 255:254 | Request/Response | 0003h (Request) | |\n| (M-1)+256:256 | Data | Data to be written | |\n| | | | Program data request |\n| | | | |\n| 222-N:00 | Stuff Bytes | 0...00h | |\n| 222:222-(N-1) | MAC/Key | 0...00h | |\n| 223 | RPMB Target | RPMB target to access | |\n| 239:224 | Nonce | 0...00h | |\n| 243:240 | Write Counter | 00000000h | |\n| 247:244 | Address | 00000000h | |\n| 251:248 | Sector Count | 00000000h | |\n| 253:252 | Result | 0000h | |\n| 255:254 | Request/Response | 0005h (Request) | |\n| | | | Request Result of data programming |\n| | | | |\n| 222-N:00 | Stuff Bytes | 0...00h | |\n| 222:222-(N-1) | MAC/Key | MAC generated by the controller | |\n| 223 | RPMB Target | RPMB target response was sent from | |\n| 239:224 | Nonce | 0...00h | |\n| 243:240 | Write Counter | Incremented Write Counter value | |\n| 247:244 | Address | Address in RPMB | |\n| 251:248 | Sector Count | 00000000h | |\n| 253:252 | Result | Result Code | |\n| 255:254 | Request/Response | 0300h (Response) | |\n| | | | Retrieve Result from data programming |"
      }
    ],
    "figures": []
  },
  "statistics": {
    "table_count": 1,
    "figure_count": 0
  }
}