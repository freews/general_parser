{
  "section_index": 213,
  "section_id": "3.3.1.2",
  "title": "3.3.1.2 Queue Usage",
  "level": 4,
  "pages": {
    "start": 112,
    "end": 113,
    "count": 2
  },
  "content": {
    "text": "The submitter of entries to a memory-based transport queue uses the current Tail entry pointer to identify\nthe next open queue slot. The submitter increments the Tail entry pointer after placing the new entry to the\nopen queue slot. If the Tail entry pointer increment exceeds the queue size, the Tail entry shall roll to zero.\nThe submitter may continue to place entries in free queue slots as long as the Full queue condition is not\nmet (refer to section 3.3.1.5).\nNote: The submitter shall take queue wrap conditions into account.\nThe consumer of entries on a memory-based transport queue uses the current Head entry pointer to identify\nthe slot containing the next entry to be consumed. The consumer increments the Head entry pointer after\nconsuming the next entry from the queue. If the Head entry pointer increment exceeds the queue size, the\nHead entry pointer shall roll to zero. The consumer may continue to consume entries from the queue as\nlong as the Empty queue condition is not met (refer to section 3.3.1.4).\nNote: The consumer shall take queue wrap conditions into account.\nCreation and deletion of memory-based transport Submission Queue and associated Completion Queues\nare required to be ordered correctly by a host. A host creates the Completion Queue before creating any\nassociated Submission Queue. Submission Queues may be created at any time after the associated\nCompletion Queue is created. A host deletes all associated Submission Queues prior to deleting a\nCompletion Queue. To abort all commands submitted to the Submission Queue, a host issues a Delete I/O\nSubmission Queue command for that queue (refer to section 3.3.1.3).\nA host writes the Submission Queue Tail Doorbell and the Completion Queue Head Doorbell (refer to the\nTransport Specific Controller Properties section in the NVMe over PCIe Transport Specification) to\ncommunicate new values of the corresponding entry pointers to the controller. If a host writes an invalid\nvalue to the Submission Queue Tail Doorbell or Completion Queue Head Doorbell property and an\nAsynchronous Event Request command is outstanding, then an asynchronous event is posted to the Admin\nCompletion Queue with a status code of Invalid Doorbell Write Value. The associated queue is then deleted\nand recreated by a host. For a Submission Queue that experiences this error, the controller may complete\npreviously consumed commands; no additional commands are consumed. This condition may be caused\nby a host attempting to add an entry to a full Submission Queue or remove an entry from an empty\nCompletion Queue.\nA host checks completion queue entry Phase Tag (P) bits in memory to determine whether new completion\nqueue entries have been posted (refer to section 4.2.4). The Completion Queue Tail pointer is only used\ninternally by the controller and is not visible to the host. The controller uses the SQ Head Pointer (SQHD)\nfield in completion queue entries to communicate new values of the Submission Queue Head Pointer to the\nhost. A new SQHD value indicates that submission queue entries have been consumed, but does not\nindicate either execution or completion of any command. Refer to section 4.2.\nA submission queue entry is submitted to the controller when the host writes the associated Submission\nQueue Tail Doorbell with a new value that indicates that the Submission Queue Tail Pointer has moved to\nor past the slot in which that submission queue entry was placed. A Submission Queue Tail Doorbell write\nmay indicate that one or more submission queue entries have been submitted.\nA submission queue entry has been consumed by the controller when a completion queue entry is posted\nthat indicates that the Submission Queue Head Pointer has moved past the slot in which that submission\nqueue entry was placed. A completion queue entry may indicate that one or more submission queue entries\nhave been consumed.\nA completion queue entry is posted to the Completion Queue when the controller write of that completion\nqueue entry to the next free Completion Queue slot inverts the Phase Tag (P) bit from its previous value in\nmemory (refer to section 4.2.4). The controller may generate an interrupt to the host to indicate that one or\nmore completion queue entries have been posted.\nA completion queue entry has been consumed by the host when the host writes the associated Completion\nQueue Head Doorbell with a new value that indicates that the Completion Queue Head Pointer has moved\npast the slot in which that completion queue entry was placed. A Completion Queue Head Doorbell write\nmay indicate that one or more completion queue entries have been consumed.\nOnce a submission queue entry or a completion queue entry has been consumed, the slot in which it was\nplaced is free and available for reuse. Altering a submission queue entry after that entry has been submitted\nbut before that entry has been consumed results in undefined behavior. Altering a completion queue entry\nafter that entry has been posted but before that entry has been consumed results in undefined behavior.",
    "tables": [],
    "figures": []
  },
  "statistics": {
    "table_count": 0,
    "figure_count": 0
  }
}