{
  "section_index": 559,
  "section_id": "5.2.28.1.2",
  "title": "5.2.28.1.2 Track Memory Changes (Management Operation 1h)",
  "level": 5,
  "pages": {
    "start": 477,
    "end": 480,
    "count": 4
  },
  "content": {
    "text": "The Track Memory Changes management operation of the Track Send command requests the controller\nprocessing that Track Send command to:\n•\nstart tracking host memory changes described by the specified host memory ranges that are\ncaused by the processing commands in the controller specified by Controller Identifier field (refer\nto Figure 496); or\n•\nstop tracking the host memory changes that are caused by the processing commands by the\ncontroller specified by Controller Identifier field.\nIf the TACT bit is set to ‘1’ (refer to Figure 495), then:\n•\nThe data buffer contains a Track Memory Changes data structure (refer to Figure 497) that\nspecifies one or more host memory ranges associated with the controller specified by the\nController Identifier field.\n•\nIf the value in the Requested Memory Range Tracking Granularity (RMRTG) field is greater than\nthe value in the Maximum Memory Range Tracking Granularity (MAXMRTG) field in the Identify\nController data structure (refer to Figure 328), then the controller shall abort the command with a\nstatus code of Invalid Field in Command.\n•\nIf the value in the Requested Memory Range Tracking Granularity (RMRTG) field is less than the\nvalue in the Minimum Memory Range Granularity (MINMRG) field in the Identify Controller data\nstructure (refer to Figure 328), then the controller shall abort the command with a status code of\nInvalid Field in Command.\n•\nIf the sum of:\no\nthe value in the Requested Number of Memory Range Tracking Descriptors (RNMRTD)\nfield; and\no\nthe number of Memory Range Tracking Descriptors currently being tracked by the\ncontroller processing the command for other controllers in the NVM subsystem,\nis greater than the value in the Controller Maximum Memory Range Tracking Descriptors\n(CMMRTD) field in the Identify Controller data structure (refer to Figure 328), then the controller\nprocessing the command shall abort the command with a status code of Invalid Field in Command.\np\ng\n•\nIf the sum of the value in the Requested Number of Memory Range Tracking Descriptors\n(RNMRTD) field plus the number of Memory Range Tracking Descriptors currently being tracked\nby all controllers in the NVM subsystem is greater than the value in the NVM subsystem Maximum\nMemory Range Tracking Descriptors (NMMRTD) field in the Identify Controller data structure (refer\nto Figure 328), then the controller shall abort the command with a status code of Invalid Field in\nCommand.\n•\nIf any controller in the NVM subsystem is already tracking host memory changes for the controller\nspecified by the CNTLID field, then the controller processing the command shall abort the\ncommand with a status code of Invalid Controller Identifier.\n•\no\nthe Memory Range Tracking Length Limit (MRTLL) bit in the Identify Controller data\nstructure is set to ‘1’; and\no\nthe length as specified by the Requested Memory Range Tracking Granularity field and\nany Length field in a Track Memory Changes data structure is not a value that is a power\nof 2,\nthen the controller shall abort the command with a status code of Invalid Field in Command.\nIf the TACT bit is cleared to ‘0’, then the data buffer shall be ignored by the controller.\nIf the controller specified by the CNTLID field is suspended (refer to section 5.2.17.1.1), then the controller\nshall abort the command with a status code of Controller Suspended.\nFigure 498 defines a Memory Range Tracking Descriptor. The address range specified by a Memory Range\nTracking Descriptor describes addresses specified in an SGL or PRP for a command submitted by a host\nto the controller specified in the CNTLID field (refer to Figure 496).\nIf the controller is unable to track the requested number of Memory Range Tracking Descriptors (i.e.,\nspecified in the RNMRTD field) or unable to track the memory changes at the specified granularity (i.e.,\nRMRTG field), then:\n•\nthe controller shall abort the command with a status code of Not Enough Resources; and\n•\nDword 0 and Dword 1 of the completion queue entry shall be returned as defined in Figure 499\nand Figure 500.\nIf any Address field is not aligned to the granularity specified by the RMRTG field, then the controller shall\nabort the command with a status code of Invalid Field in Command.\nIf the address range specified by the Address field and the Length field specifies an address that is not host\nmemory (refer to section 1.5.47) associated with the controller specified by the CNTLID field, then the\ncontroller processing the command shall abort the command with a status code of Invalid Field in\nCommand. If:\n•\nthe command is successful; and\n•\nthe configuration within the controller associated with the controller specified by the CNTLID field\nchanges resulting in that address range is no longer specifying host memory associated with the\ncontroller specified by the CNTLID field (e.g., the address range overlaps with PMR or CMB), then\nthe behavior for tracking host memory changes for the controller specified by the CNTLID field is\nundefined.\nA host should not specify MSI or MSI-X registers in the address range. If the address range specified by\nthe Address field and the Length field contains addresses for MSI or MSI-X registers on the controller\nspecified by the CNTLID field, then the controller may or may not report modification to those MSI or MSI-\nX register addresses.",
    "tables": [
      {
        "id": "table_478_583",
        "page": 478,
        "bbox": [
          115.0,
          583.0,
          882.0,
          710.0
        ],
        "table_md": "| | Description |\n|:---|:---|\n| | **Controller Identifier (CNTLID):** This field specifies the identifier of the controller for which changes to host memory is being tracked. If the value of this field is the controller identifier of the controller processing the command, then the controller processing the command shall abort the command with a status code of Invalid Controller Identifier. |\n| | If the controller specified by the CNTLID field is suspended (refer to section 5.2.17.1.1), then the controller shall abort the command with a status code of Controller Suspended. |\n| | |\n| 00 | **Version (VER):** This field specifies the version of this data structure. <br> If this field is not cleared to 0h, then the controller shall abort this command with a status code of Invalid Field in Command. |\n| 02:01 | Reserved |\n| 03 | **Requested Memory Range Tracking Granularity (RMR TG):** This field specifies the granularity for the Length field in each Memory Range Tracking Descriptor contained in this data structure. The value specified is a power of two (2^n) times 4 KiB. For example, a value of 8h indicates that the granularity of tracking is (2^8) * 4 KiB which in 1 MiB. |\n| 07:04 | **Number of Memory Range Tracking Descriptors (RNMRTD):** This field specifies the number of Memory Range Tracking Descriptors in the Memory Range Tracking Descriptor list. <br> This field is a 1's based number. |\n| | **Memory Range Tracking Descriptor List** |\n| 9:08 | **Memory Range Tracking Descriptor 0:** This field contains the first Memory Range Tracking Descriptor as defined in Figure 498. |\n| 31:20 | **Memory Range Tracking Descriptor 1:** This field contains the second Memory Range Tracking Descriptor as defined in Figure 498, if any. |\n| (RMR TD*12)+7: (RMR TD-1)*12+8 | **Memory Range Tracking Descriptor RNMRTD-1:** This field contains the last Memory Range Tracking Descriptor as defined in Figure 498, if any. |\n| | Figure 498 defines a Memory Range Tracking Descriptor. The address range specified by a Memory Range Tracking Descriptor describes addresses specified in an SGL or PRP for a command submitted by a host controller specified in the CNTLID field (refer to Figure 496). |\n| | **Figure 498: Memory Range Tracking Descriptor** |\n| | **Description** |\n| | **Address (SADDR):** This field specifies the starting 64-bit address of the memory range where the address controller is unable to track the requested number of Memory Range Tracking Descriptors (i.e., as defined in the RNMRTD field) or unable to track the memory changes at the specified granularity (i.e., as defined in the RMR TG field), then: <br> the controller shall abort the command with a status code of Not Enough Resources; and <br> Dword 0 and Dword 1 of the completion queue entry shall be returned as defined in Figure 499 and Figure 500. |\n| | If the Address field is not aligned to the granularity specified by the RMR TG field, then the controller shall abort the command with a status code of Invalid Field in Command. |\n| | If the address range specified by the Address field and the Length field specifies an address that is not host memory (refer to section 1.5.47) associated with the controller specified by the CNTLID field, then the controller shall abort the command with a status code of Invalid Field in Command. |\n| | This units for this field is defined by the RMR TG field. |\n| | **Figure 500: Track Memory Changes – Completion Queue Entry Dword 1** |\n| | |\n| 0 | **Number of Memory Range Tracking Descriptors (NMRTD):** This field indicates the number of Memory Range Tracking Descriptors for which the controller is able to track the memory changes with the requested granularity specified in the RMR TG field (refer to Figure 497). |\n| | On completion of the Track Send command, the controller posts a completion queue entry to the Admin Completion Queue indicating the status for the command. Section 5.2.28.1 describes completion details for management operation. |\n| | The contents of Dword 0 and Dword 1 of the completion queue entry is specific to the management operation selected in the Select field (refer to Figure 492). Refer to each management operation description in section 5.2.28 for details. |"
      },
      {
        "id": "table_478_755",
        "page": 478,
        "bbox": [
          115.0,
          755.0,
          882.0,
          840.0
        ],
        "table_md": "(Continuation of Untitled Table - see first part)"
      },
      {
        "id": "table_479_128",
        "page": 479,
        "bbox": [
          114.0,
          128.0,
          881.0,
          444.0
        ],
        "table_md": "(Continuation of Untitled Table - see first part)"
      },
      {
        "id": "table_479_535",
        "page": 479,
        "bbox": [
          114.0,
          535.0,
          881.0,
          660.0
        ],
        "table_md": "(Continuation of Untitled Table - see first part)"
      },
      {
        "id": "table_480_266",
        "page": 480,
        "bbox": [
          115.0,
          266.0,
          881.0,
          358.0
        ],
        "table_md": "(Continuation of Untitled Table - see first part)"
      },
      {
        "id": "table_480_404",
        "page": 480,
        "bbox": [
          115.0,
          404.0,
          881.0,
          460.0
        ],
        "table_md": "(Continuation of Untitled Table - see first part)"
      }
    ],
    "figures": []
  },
  "statistics": {
    "table_count": 6,
    "figure_count": 0
  }
}